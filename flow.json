[{"id":"50119c6e.6ff584","type":"tab","label":"Temperaturas","disabled":false,"info":""},{"id":"3ce5b54a.127d6a","type":"tab","label":"Baterias/Alarma","disabled":false,"info":""},{"id":"e6e33852.2495f8","type":"tab","label":"Medidor internet","disabled":true,"info":""},{"id":"73083520.75304c","type":"tab","label":"Lavadero","disabled":false,"info":""},{"id":"950c1426.ff4008","type":"tab","label":"Baño","disabled":false,"info":""},{"id":"a89e305a.c50bb","type":"tab","label":"Iluminacion Living","disabled":false,"info":""},{"id":"d1d22de5.be7d8","type":"tab","label":"backEstados","disabled":false,"info":""},{"id":"1b403a13.0ec8c6","type":"tab","label":"Termo Solar","disabled":false,"info":""},{"id":"e364a467.07a6a8","type":"tab","label":"Dolar","disabled":false,"info":""},{"id":"f682d492.22a758","type":"tab","label":"BackUp","disabled":false,"info":""},{"id":"7ac92c99.66ea94","type":"tab","label":"Google Now","disabled":false,"info":""},{"id":"deff4396.4722a","type":"tab","label":"Cope","disabled":false,"info":""},{"id":"9c63fd61.9908c","type":"tab","label":"Config Genericas","disabled":false,"info":""},{"id":"230e7f04.aca52","type":"tab","label":"Pruebas","disabled":false,"info":""},{"id":"b86d561e.834378","type":"serial-port","z":"","serialport":"/dev/ttyUSB0","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":false},{"id":"ff2252ef.d12aa","type":"ui_group","z":"","name":"Pruebas","tab":"265ca5a8.8a0dca","order":1,"disp":true,"width":"8","collapse":false},{"id":"d1041da5.a5788","type":"ui_tab","z":"","name":"Home","icon":"dashboard","order":2},{"id":"e779f8d6.7bc2c8","type":"mqtt-broker","z":"","name":"","broker":"127.0.0.1","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"c339edbf.39572","type":"mqtt-broker","z":"","name":"","broker":"127.0.0.1","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"177e0064.22348","type":"ui_group","z":"","name":"Temperaturas Baterias","tab":"d1041da5.a5788","order":1,"disp":false,"width":"16","collapse":false},{"id":"637ff0bd.3c84b","type":"mqtt-broker","z":"","name":"","broker":"127.0.0.1","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"43555c62.30ed34","type":"mqtt-broker","z":"","name":"","broker":"127.0.0.1","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"900627dc.76e6a8","type":"mqtt-broker","z":"","name":"","broker":"127.0.0.1","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"2c18e412.5f5cbc","type":"blynk-ws-client","z":"","name":"wss://127.0.0.1:9443/websockets","path":"wss://127.0.0.1:9443/websockets","key":"bdd6cc84a9c94dd8be574aa5d91bfa6b","dbg_all":false,"dbg_read":false,"dbg_write":false,"dbg_notify":false,"dbg_mail":false,"dbg_prop":false,"dbg_sync":false,"dbg_bridge":false,"dbg_low":false,"dbg_pins":"","multi_cmd":false,"proxy_type":"no","proxy_url":""},{"id":"6b36e4a.1d30b1c","type":"mqtt-broker","z":"","name":"","broker":"127.0.0.1","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"3fe9d635.ec409a","type":"mqtt-broker","z":"","name":"","broker":"127.0.0.1","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"af08803a.808f4","type":"mqtt-broker","z":"","name":"","broker":"127.0.0.1","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"8e33ffbb.27076","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"e73b3a0d.765918","type":"ui_tab","z":"","name":"Luces","icon":"dashboard","order":1},{"id":"6a6e2505.7b8a5c","type":"ui_group","z":"","name":"Living","tab":"e73b3a0d.765918","order":2,"disp":true,"width":"5","collapse":false},{"id":"1c362bad.cfd2e4","type":"ui_group","z":"","name":"Lavadero","tab":"e73b3a0d.765918","order":4,"disp":true,"width":"5","collapse":false},{"id":"1134b585.4c9e0a","type":"ui_group","z":"","name":"Datos Baterias","tab":"e73b3a0d.765918","order":5,"disp":true,"width":"8","collapse":false},{"id":"1a0f799.46f9186","type":"ui_group","z":"","name":"Baño","tab":"e73b3a0d.765918","order":3,"disp":true,"width":"5","collapse":false},{"id":"ee76ee3c.4da06","type":"blynk-ws-client","z":"","name":"bomba anita","path":"wss://127.0.0.1:9443/websockets","key":"ebdf8457181f458b80b2ad88dc21fc07","dbg_all":false,"dbg_read":false,"dbg_write":false,"dbg_notify":false,"dbg_mail":false,"dbg_prop":false,"dbg_sync":false,"dbg_bridge":false,"dbg_low":false,"dbg_pins":"","multi_cmd":false,"proxy_type":"no","proxy_url":""},{"id":"265ca5a8.8a0dca","type":"ui_tab","z":"","name":"Pruebas","icon":"dashboard"},{"id":"4244f3d0.dcc0fc","type":"ui_gauge","z":"3ce5b54a.127d6a","name":"","group":"177e0064.22348","order":3,"width":"2","height":"2","gtype":"gage","title":"Temp Bat1","label":"units","format":"{{value}}","min":"0","max":"50","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":2810,"y":210,"wires":[]},{"id":"4bb5fb58.83db84","type":"debug","z":"e6e33852.2495f8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":580.7777404785156,"y":69,"wires":[]},{"id":"4d605608.32c4f8","type":"debug","z":"3ce5b54a.127d6a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":640,"y":830,"wires":[]},{"id":"4a88ff94.6b429","type":"mqtt in","z":"1b403a13.0ec8c6","name":"","topic":"ESP/TermoSolar/Debug","qos":"2","broker":"900627dc.76e6a8","x":1040,"y":40,"wires":[["4925f5fb.a7fa3c","504fa5d9.30bf1c"]]},{"id":"2ef0894a.4f29a6","type":"mqtt out","z":"1b403a13.0ec8c6","name":"","topic":"","qos":"2","retain":"","broker":"900627dc.76e6a8","x":680,"y":190,"wires":[]},{"id":"6bd3ae3f.85f67","type":"blynk-ws-in-write","z":"a89e305a.c50bb","name":"","pin":"16","pin_all":false,"client":"2c18e412.5f5cbc","x":320,"y":330,"wires":[["cce091cd.a69e5"]]},{"id":"aac6683a.0edb98","type":"blynk-ws-in-write","z":"3ce5b54a.127d6a","name":"Blynk","pin":"1","client":"2c18e412.5f5cbc","x":1330,"y":920,"wires":[["893a6b3c.fdb088"]]},{"id":"7f41c912.6882e8","type":"function","z":"1b403a13.0ec8c6","name":"val. in. termo","func":"var dato = msg.payload.split(\"#\");\nglobal.set(\"autoBomba\", dato[0]);\nglobal.set(\"autoResistencia\", dato[1]);\nglobal.set(\"autoToldo\", dato[2]);\nglobal.set(\"pedBomba\", dato[3]);\nglobal.set(\"pedResistencia\", dato[4]);\nglobal.set(\"pedToldo\", dato[5]);\nglobal.set(\"tempMaximaTermo\", dato[6]);\nglobal.set(\"tempMaxResistencia\", dato[7]);\nglobal.set(\"tempMaxResistenciaManual\", dato[8]);\nglobal.set(\"tempMinimaResistencia\", dato[9]);\nglobal.set(\"valorDia\", dato[10]);\nglobal.set(\"valorNoche\", dato[11]);\nglobal.set(\"segundosMarchaBomba\", dato[12]);\n// global.set(\"offsetDia\", dato[13]);\n// global.set(\"offsetNoche\", dato[14]);\n\nglobal.set(\"estBomba\", 0);\nglobal.set(\"estResistencia\", 0);\nglobal.set(\"estToldo\", 0);\nglobal.set(\"tempTermoFin\", 0);\nglobal.set(\"tempExteriorFin\", 0);\nglobal.set(\"sensorCrep\", 0);\nglobal.set(\"comienzoLlenado\", 0);\nglobal.set(\"tiempoLlenado\", 0);\nmsg = {topic: \"ESP/TermoSolar/pedido\", payload: 1}; node.send(msg);//ESP/TermoSolar/Recibo\n\n","outputs":1,"noerr":0,"x":1660,"y":570,"wires":[["9ac4a3ca.adf2f"]]},{"id":"c2a0d286.2ba8f","type":"mqtt out","z":"a89e305a.c50bb","name":"","topic":"","qos":"2","retain":"","broker":"6b36e4a.1d30b1c","x":780,"y":260,"wires":[]},{"id":"91de3003.b9dff","type":"inject","z":"7ac92c99.66ea94","name":"","topic":"","payload":"luces del lavadero alacena","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":390,"wires":[["d18e6794.44d0b8"]]},{"id":"95918cd1.4e44e","type":"inject","z":"3ce5b54a.127d6a","name":"Info","topic":"","payload":"{\"topic\":\"Baterias/Est/Pedido\",\"payload\":1}","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":370,"y":720,"wires":[["22061400.194d3c","15c00bc2.e4ea64"]]},{"id":"228a0974.4bf346","type":"mqtt in","z":"a89e305a.c50bb","name":"","topic":"ESP/living/Iluminacion/Envio","qos":"2","broker":"6b36e4a.1d30b1c","x":300,"y":250,"wires":[["cce091cd.a69e5"]]},{"id":"13d24f97.6f3b5","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg = {topic: \"tempBat1\", payload: global.get(\"tempBat1\")}; node.send(msg);\n","outputs":1,"noerr":0,"x":2583.5951919555664,"y":215.4523634229388,"wires":[["4244f3d0.dcc0fc"]]},{"id":"4f310b0e.f40b74","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"[]","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2580.3808822631836,"y":101.16667338779996,"wires":[["35b5038b.76c79c"]]},{"id":"a14c5529.801d68","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"resetAutos","qos":"2","broker":"c339edbf.39572","x":1450,"y":240,"wires":[[]]},{"id":"4a51d0e8.24515","type":"debug","z":"3ce5b54a.127d6a","name":"Blynk display","active":false,"tosidebar":true,"console":false,"tostatus":true,"complete":"true","x":720,"y":220,"wires":[]},{"id":"e9640668.b315e8","type":"function","z":"e364a467.07a6a8","name":"","func":"msg.payload = msg.payload.replace(\",\", \".\");\nglobal.set(\"MaximoVender\", parseFloat(msg.payload).toFixed(2));\nnode.status({text: \"MaximoVender:\" + global.get(\"MaximoVender\")});\nreturn msg;","outputs":1,"noerr":0,"x":451.7777557373047,"y":224.24999809265137,"wires":[[]]},{"id":"a3832c3f.01897","type":"blynk-ws-out-write","z":"a89e305a.c50bb","name":"","pin":0,"pinmode":"1","client":"2c18e412.5f5cbc","x":951.8810272216797,"y":347.7499885559082,"wires":[]},{"id":"d6c2fdea.31e4e","type":"blynk-ws-out-set-property","z":"a89e305a.c50bb","name":"","pin":0,"pinmode":"1","prop":"bycode","client":"2c18e412.5f5cbc","x":870,"y":310,"wires":[]},{"id":"9e25b334.c4563","type":"file","z":"f682d492.22a758","name":"","filename":"","appendNewline":false,"createDir":false,"overwriteFile":"true","x":741.3333740234375,"y":120.99999046325684,"wires":[[]]},{"id":"ae138e5d.50e71","type":"file in","z":"f682d492.22a758","name":"flows_vps_cred.json","filename":"/home/gaston/.node-red/projects/Node-Red-Mi-Casa/flow_cred.json","format":"utf8","sendError":true,"x":383,"y":126,"wires":[["5fae0180.0724f"]]},{"id":"13adbc11.4ab694","type":"ui_chart","z":"3ce5b54a.127d6a","name":"","group":"177e0064.22348","order":7,"width":"16","height":"10","label":"Tanque","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"140","ymax":"620","removeOlder":"3","removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":true,"x":2799.8810119628906,"y":138.285699571882,"wires":[[],[]]},{"id":"c8be9ca.b68de6","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg = {topic: \"Blynk/mostrar/infos\", payload: msg.payload};\nreturn msg;","outputs":1,"noerr":0,"x":1530,"y":590,"wires":[["29c9ac88.41f9b4","37d15e3c.0a1382"]]},{"id":"7b8f8d35.3a0bc4","type":"delay","z":"3ce5b54a.127d6a","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1834.3800048828125,"y":929.5000540869577,"wires":[["7d2e1271.afd57c"]]},{"id":"748c0ad2.0b8444","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"3","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1328.5717124938965,"y":601.4286403656006,"wires":[["c8be9ca.b68de6"]]},{"id":"f80091fc.1ea","type":"function","z":"7ac92c99.66ea94","name":"","func":"msg.estado = 1;\nreturn msg;","outputs":1,"noerr":0,"x":341.6071891784668,"y":128.92858457565308,"wires":[["771db2a8.1bf0fc"]]},{"id":"58cd06ab.bd05c8","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"USBin/Baterias","qos":"2","broker":"c339edbf.39572","x":269.8810577392578,"y":243.8095147269113,"wires":[["f1697d45.0cc3b","690bb97b.d73e48"]]},{"id":"73837d68.7c6a34","type":"blynk-ws-out-write","z":"3ce5b54a.127d6a","name":"","pin":0,"pinmode":"1","client":"2c18e412.5f5cbc","x":2071.3927841186523,"y":595.9643287658691,"wires":[]},{"id":"eef57e3.f227e8","type":"mqtt out","z":"f682d492.22a758","name":"","topic":"USBout","qos":"","retain":"","broker":"3fe9d635.ec409a","x":750,"y":320,"wires":[]},{"id":"b241dea3.0cc9f","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1741.1667823791504,"y":488.5238674027579,"wires":[["c628fd83.f544d"]]},{"id":"6e949be8.c70644","type":"thingspeak42","z":"e6e33852.2495f8","name":"BDX88EB6QMF2IKY0","delay":"5","topic1":"DescargaFast","topic2":"SubidaFast","topic3":"DescargaFiber","topic4":"SubidaFiber","topic5":"","topic6":"","topic7":"","topic8":"","endpoint":"https://thingspeak.com","x":884.6666564941406,"y":425.66665029525757,"wires":[]},{"id":"288336d4.991aaa","type":"debug","z":"3ce5b54a.127d6a","name":"salida2 lcd blynk","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1891.3927841186523,"y":715.9643287658691,"wires":[]},{"id":"21296bc1.2ea0d4","type":"mqtt out","z":"50119c6e.6ff584","name":"","topic":"","qos":"2","retain":"","broker":"e779f8d6.7bc2c8","x":520,"y":100,"wires":[]},{"id":"d4c01dc9.1020d","type":"debug","z":"7ac92c99.66ea94","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":408.3691177368164,"y":589.7857265472412,"wires":[]},{"id":"817c4eab.44409","type":"function","z":"7ac92c99.66ea94","name":"Penreder (Nuevo)","func":"var payload = msg.payload;\nvar estado = msg.estado;\n\n// if (!payload.includes(\"living\")) return;\nif (payload.includes(\"luces\") || payload.includes(\"luz\")){\n\n    if (payload.includes(\"lavadero\") || payload.includes(\"Lavadero\")){\n        if (payload.includes(\"alacena\")){\n            global.set(\"luzAlacenaLavadero\", parseInt(estado));\n            msg = {topic: \"google/Lavadero\", payload: \"1\"};\n            // msg = {pin: 35, payload: estado}; node.send([null, msg]);\n            // msg = {topic: \"ESP/Lavadero/Bombas/Estado/Rele0\", payload: estado}; //node.send(msg);    \n            return msg;\n        }             \n        // msg = {pin: 36, payload: estado}; node.send([null, msg]);\n        global.set(\"luzLavadero\", parseInt(estado));\n        // if (global.get(\"luzLavadero\") === 0)global.set(\"luzAlacenaLavadero\", 0); \n        msg = {topic: \"google/Lavadero\", payload: \"1\"};\n        // msg = {topic: \"ESP/Lavadero/Bombas/Estado/Rele1\", payload: estado}; //node.send(msg);   \n        return msg;\n    }      \n\n    if (payload.includes(\"baño\") || payload.includes(\"Baño\")){\n        if (payload.includes(\"ducha\") || payload.includes(\"Ducha\")){\n\t\t\tglobal.set(\"modoDucha\", 0);\n\t\t\tglobal.set(\"pedidoDucha\", parseInt(estado));\n            msg = {topic: \"google/Baño\", payload: \"1\"};\n            return msg;\n        }             \n        global.set(\"luzBano\", parseInt(estado));\n        msg = {topic: \"google/Baño\", payload: \"1\"}; \n        return msg;\n    }     \n\n    if (payload.includes(\"living\")){\n        if (payload.includes(\"isla\")){\n            global.set(\"estIsla\", estado);\n            msg = {topic: \"google/Living\", payload: \"estIsla= \" + global.get(\"estIsla\")};\n            return msg;\n        }\n        if (payload.includes(\"cielo raso\")){\n            global.set(\"estCielorrazo\", estado);\n            msg = {topic: \"google/Living\", payload: \"estCielorrazo= \" + global.get(\"estCielorrazo\")};\n            return msg;\n        }\n        if (payload.includes(\"rgb\")){\n            global.set(\"estIslaRGB\", estado);\n            msg = {topic: \"google/Living\", payload: \"estIslaRGB= \" + global.get(\"estIslaRGB\")};\n            return msg;\n        }\n    }\n        global.set(\"estLiving\", estado); \n        global.set(\"estIsla\", estado);\n        global.set(\"estCielorrazo\", estado);\n        global.set(\"estIslaRGB\", estado);\n        msg = {topic: \"google/Living\", payload: \"estLiving= \" + global.get(\"estLiving\")};\n        return msg;}\n\nif (payload.includes(\"bomba\") && payload.includes(\"centrifuga\") || payload.includes(\"centrífuga\")){\n    global.set(\"bombaPozo\", msg.estado);\n    msg = {topic: \"google/Lavadero\", payload: \"luzLavadero= \" + global.get(\"luzLavadero\")};\n    // msg = {topic: \"google/Tanque\", payload: msg.estado};\n    return msg; \n}","outputs":1,"noerr":0,"x":564.4642677307129,"y":336.071457862854,"wires":[["a110d805.3e0758","ddd8882e.f587d8"]]},{"id":"41887e33.4312e","type":"function","z":"50119c6e.6ff584","name":"tempPatioLuz","func":"var temp = parseFloat(msg.payload) + 0;\nglobal.set(\"tempPatioLuz\", temp.toFixed(1));\nmsg= {topic: \"tempPatioLuz\", payload: global.get(\"tempPatioLuz\")}; node.send(msg);\nnode.status({text: \"temp: \" + global.get(\"tempPatioLuz\") + \" -- \" + global.get(\"hsCpu\")});","outputs":1,"noerr":0,"x":500,"y":320,"wires":[["3fde6b72.65b1a4","e7016801.01fa68"]]},{"id":"6a9e13c8.88f12c","type":"inject","z":"e364a467.07a6a8","name":"","topic":"","payload":"Prueba node-red","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":422.6944007873535,"y":284.4285914301872,"wires":[["a2ae1c14.e354a"]]},{"id":"9600b95a.280848","type":"debug","z":"7ac92c99.66ea94","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":581.9405250549316,"y":718.1786017417908,"wires":[]},{"id":"bf1f52aa.5c9ae","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1310.5236053466797,"y":377.14293003082275,"wires":[["ae746686.8cad28"]]},{"id":"f0069ce0.a32ee","type":"exec","z":"e6e33852.2495f8","command":" speedtest --share --server 10748","addpay":false,"append":"","useSpawn":"true","timer":"","oldrc":true,"name":"Server FastNet","x":341.8888931274414,"y":126.77777767181396,"wires":[["40cbd7ce.d528d8","4bb5fb58.83db84"],[],[]]},{"id":"b4b09a6e.a09678","type":"blynk-ws-in-write","z":"a89e305a.c50bb","name":"","pin":"19","pin_all":false,"client":"2c18e412.5f5cbc","x":320,"y":490,"wires":[[]]},{"id":"393719e5.4bc726","type":"function","z":"e364a467.07a6a8","name":"","func":"msg.payload = msg.payload.replace(\",\", \".\");\nglobal.set(\"MinimoVender\", parseFloat(msg.payload).toFixed(2));\nnode.status({text: \"MinimoVender:\" + global.get(\"MinimoVender\")});\nreturn msg;","outputs":1,"noerr":0,"x":451.77772521972656,"y":174.24999904632568,"wires":[[]]},{"id":"2ff411a2.ce3fce","type":"ui_gauge","z":"3ce5b54a.127d6a","name":"","group":"1134b585.4c9e0a","order":3,"width":"2","height":"2","gtype":"gage","title":"Voltaje Bat.","label":"units","format":"{{value}}","min":"9","max":"16","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":2817.880958557129,"y":512.5952598026824,"wires":[]},{"id":"be7730f2.1d5f3","type":"blynk-ws-in-write","z":"3ce5b54a.127d6a","name":"","pin":"3","client":"2c18e412.5f5cbc","x":1230.3807563781738,"y":259.9524841308594,"wires":[["ae746686.8cad28"]]},{"id":"290cd25a.fc6afe","type":"function","z":"e364a467.07a6a8","name":"Patagonia","func":"var dolarCompra;\nvar dolarVenta;\nvar payload = msg.payload;\nvar compra;\nvar venta;\n\npayload = payload.substring(payload.indexOf(\"nbsp\")+5); compra = payload.substring(0, payload.indexOf(\"</td>\"));\npayload = payload.substring(payload.indexOf(\"nbsp\")+5); venta = payload.substring(0, payload.indexOf(\"</td>\"));\n\ncompra = compra.replace(\",\", \".\");\nventa = venta.replace(\",\", \".\");\n\ncompra = parseFloat(compra).toFixed(2);\nventa = parseFloat(venta).toFixed(2);\n\nmsg = {pin:65, payload: \"$ \"+compra + \"  --  \" + \"$ \" + venta};\nreturn msg","outputs":1,"noerr":0,"x":365.9444274902344,"y":530.3611297607422,"wires":[["3368b0c3.9c168","aad01191.7f05d"]]},{"id":"3fde6b72.65b1a4","type":"thingspeak42","z":"50119c6e.6ff584","name":"DPO83R5G06KFD4UD","delay":"15","topic1":"tempPasillo","topic2":"tempLiving","topic3":"tempLavadero","topic4":"tempExterior","topic5":"tempPatioLuz","topic6":"humLiving","topic7":"Crep","topic8":"","endpoint":"https://thingspeak.com","x":763.761890411377,"y":317.47623348236084,"wires":[]},{"id":"33f85d17.3511d2","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"USBin","qos":"2","broker":"c339edbf.39572","x":560,"y":510,"wires":[["1c00a8ed.d8b847","bc158034.05b6","cee63a6d.8910d8"]]},{"id":"43519e36.7141d","type":"debug","z":"7ac92c99.66ea94","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":464.44052505493164,"y":439.42860174179077,"wires":[]},{"id":"97534816.4d4508","type":"debug","z":"7ac92c99.66ea94","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":693.9405250549316,"y":106.92860174179077,"wires":[]},{"id":"c4c78de.b08867","type":"mqtt in","z":"a89e305a.c50bb","name":"","topic":"ESP/living/Iluminacion/Inicio","qos":"2","broker":"6b36e4a.1d30b1c","x":300,"y":130,"wires":[["cce091cd.a69e5"]]},{"id":"90a598cd.e88248","type":"comment","z":"f682d492.22a758","name":"PID Control For CPU Temperature of Raspberry PI","info":"","x":230,"y":160,"wires":[]},{"id":"ef327ef2.6c0f6","type":"debug","z":"50119c6e.6ff584","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":720,"y":150,"wires":[]},{"id":"df0fdba0.2a4e58","type":"file","z":"e6e33852.2495f8","name":"","filename":"/home/gaston/BackUp-Node-Red/FastNet.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":790,"y":110,"wires":[[]]},{"id":"c4069bb3.95f608","type":"http in","z":"7ac92c99.66ea94","name":"prender luces","url":"/prender","method":"post","upload":false,"swaggerDoc":"","x":223.13096237182617,"y":310.85715103149414,"wires":[["e06c23ee.4ad0f"]]},{"id":"4cc51e6c.2ddc7","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1324.2859573364258,"y":534.2858028411865,"wires":[["c8be9ca.b68de6"]]},{"id":"ab59ea94.49c4f8","type":"function","z":"e364a467.07a6a8","name":"Dolar","func":"var dolarCompra;\nvar dolarVenta;\nvar payload = msg.payload;\nvar compra;\nvar venta;\ncontext.minimo = context.minimo || 0;\ncontext.maximo = context.maximo || 0;\ncontext.inicio = context.inicio || 0;\nvar date = new Date();\nvar frecuencia = 15;\nvar dia = date.getDay();\nvar hh = date.getHours();\nvar mm = date.getMinutes();\nvar ss = date.getSeconds();\nif (hh===0 && mm===0 && ss===0){\n    context.minimo = 100;\n    context.maximo = 0;\n    context.inicio = 0;\n}\n\npayload = payload.substring(payload.indexOf(\"$\")+2); compra = payload.substring(0, payload.indexOf(\"</t\"));\npayload = payload.substring(payload.indexOf(\"<td>$\")+5); venta = payload.substring(0, payload.indexOf(\"</t\"));\n\nif (parseFloat(compra) === 0 || compra === undefined) return;\nif (parseFloat(venta) === 0 || venta === undefined) return;\n\ncompra = compra.replace(\",\", \".\");\nventa = venta.replace(\",\", \".\");\n\ncompra = parseFloat(compra).toFixed(2);\nventa = parseFloat(venta).toFixed(2);\n\nglobal.set(\"DolarOff\", compra);\n\nmsg = {pin: 55, payload: \"$ \"+compra + \"  --  \" + \"$ \" + venta}; node.send([null, null, null, msg]);\n// msg = {pin: 53, payload: compra}; node.send([null, null, null, msg]);\n// msg = {pin: 54, payload: venta}; node.send([null, null, null, msg]);\n\n\nmsg = {topic: \"DolarVenta\", payload: venta}; node.send([msg, null, null, null]);\nmsg = {topic: \"DolarCompra\", payload: compra}; node.send([msg, null, null, null]);\n\nif (parseFloat(global.get(\"MinimoVender\")) > parseFloat(compra) || parseFloat(global.get(\"MaximoVender\")) < parseFloat(compra)){    //diferenciaCompraVenta\n    context.minimo = compra;\n    var datos = \"Dolar Alto o muy bajo opcion a Vender, valor: \" + compra;//Dolar Bajo opcion a Comprar, valor: \n    msg = {payload: datos}; node.send([null, msg, null, null]);\n    msg = {topic: \"notifyBlynk\", payload: datos}; node.send([null, null, msg, null]);\n}\n// if (hh > 9 && hh < 17 && parseFloat(dato.libre) < parseFloat(context.maximo)){\n// if (parseFloat(global.get(\"compreA\")) + parseFloat(global.get(\"diferenciaCompraVenta\") < parseFloat(compra)){    // compre a 39.04\nif (parseFloat(global.get(\"MinimoComprar\")) > parseFloat(venta)){    // compre a 39.04    \n    context.maximo = venta;\n    var datos = \"Dolar Bajo opcion a Comprar, valor: \" + venta;\n    msg = {payload: datos}; node.send([null, msg, null, null]);\n    msg = {topic: \"notifyBlynk\", payload: datos}; node.send([null, null, msg, null]);\n}\n","outputs":4,"noerr":0,"x":558.6467437744141,"y":367.09527081251144,"wires":[["a9f3050a.052758","43870af5.baac94"],["a2ae1c14.e354a","338fa6cc.48bf2a"],["be4bba1b.4d9d28","840836b7.f5aab8"],["169a443b.7a749c","3c3e448b.d778bc"]]},{"id":"ba2ee176.ff725","type":"http in","z":"7ac92c99.66ea94","name":"apagar luces","url":"/apagar","method":"post","upload":false,"swaggerDoc":"","x":221.0476417541504,"y":352.6429567337036,"wires":[["d18e6794.44d0b8"]]},{"id":"3a763a46.3166e6","type":"http in","z":"7ac92c99.66ea94","name":"cambiar color luces","url":"/colorluces","method":"post","upload":false,"swaggerDoc":"","x":187.65485382080078,"y":496.8689994812012,"wires":[["b8f71abc.973838","43519e36.7141d"]]},{"id":"651c6da5.a31dd4","type":"mqtt out","z":"7ac92c99.66ea94","name":"","topic":"","qos":"","retain":"","broker":"43555c62.30ed34","x":781.3690605163574,"y":478.9286513328552,"wires":[]},{"id":"2428a89d.746c48","type":"e-mail","z":"3ce5b54a.127d6a","server":"smtp.mail.yahoo.com","port":"465","secure":true,"name":"gdietrich22@yahoo.com.ar","dname":"gd28722563","x":740,"y":280,"wires":[]},{"id":"cfe7da5b.0b0058","type":"delay","z":"3ce5b54a.127d6a","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":740,"y":170,"wires":[["bd6b96af.2bd918"]]},{"id":"5975772b.bee358","type":"function","z":"7ac92c99.66ea94","name":"","func":"msg.estado = 0;\nreturn msg;","outputs":1,"noerr":0,"x":345.8929214477539,"y":173.21431970596313,"wires":[["771db2a8.1bf0fc","6c87ee78.5a478"]]},{"id":"8d0c20c6.485a6","type":"mqtt in","z":"50119c6e.6ff584","name":"","topic":"ESP/PatioLuz/Sens/Temp/Resp","qos":"2","broker":"e779f8d6.7bc2c8","x":250,"y":320,"wires":[["41887e33.4312e"]]},{"id":"ded2eb3f.7be2b8","type":"blynk-ws-in-write","z":"7ac92c99.66ea94","name":"","pin":"32","pin_all":false,"client":"2c18e412.5f5cbc","x":181.94055557250977,"y":566.9286065101624,"wires":[["d4c01dc9.1020d","bc4d7dba.786f4"]]},{"id":"43870af5.baac94","type":"debug","z":"e364a467.07a6a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":725.7895431518555,"y":354.2381092905998,"wires":[]},{"id":"3f220851.238a18","type":"mqtt in","z":"1b403a13.0ec8c6","name":"","topic":"ESP/TermoSolar/Envio","qos":"2","broker":"900627dc.76e6a8","x":120,"y":210,"wires":[["7b9c509e.eef1d"]]},{"id":"61e09e5d.a5996","type":"ui_text_input","z":"3ce5b54a.127d6a","name":"","label":"Serial Arduino Nano","group":"177e0064.22348","order":5,"width":0,"height":0,"passthru":true,"mode":"text","delay":"0","topic":"","x":330,"y":640,"wires":[["22061400.194d3c","9952dd57.57521","15c00bc2.e4ea64"]]},{"id":"42479228.e1d82c","type":"mqtt in","z":"a89e305a.c50bb","name":"","topic":"google/Living","qos":"2","broker":"6b36e4a.1d30b1c","x":350,"y":210,"wires":[["cce091cd.a69e5"]]},{"id":"cfe8aa20.5a0e18","type":"blynk-ws-out-write","z":"e6e33852.2495f8","name":"","pin":0,"pinmode":"1","client":"2c18e412.5f5cbc","x":876.3332977294922,"y":474.5555667877197,"wires":[]},{"id":"c628fd83.f544d","type":"mqtt out","z":"3ce5b54a.127d6a","name":"","topic":"pedidoActualizacion","qos":"","retain":"","broker":"c339edbf.39572","x":1897.1430206298828,"y":540.0000352859497,"wires":[]},{"id":"8ac2932b.0cf64","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg = {topic: \"tempExterior\", payload: global.get(\"tempExterior\")}; node.send(msg);\nmsg = {topic: \"tempPatioLuz\", payload: global.get(\"tempPatioLuz\")}; node.send(msg);\nmsg = {topic: \"tempLiving\", payload: global.get(\"tempLiving\")}; node.send(msg);\nmsg = {topic: \"tempPasillo\", payload: global.get(\"tempPasillo\")}; node.send(msg);\nmsg = {topic: \"tempLavadero\", payload: global.get(\"tempLavadero\")}; node.send(msg);\nmsg = {topic: \"tempBat6\", payload: global.get(\"tempBat6\")}; node.send(msg);\nmsg = {topic: \"tempAmbiente\", payload: global.get(\"tempAmbienteBat\")}; node.send(msg);\nmsg = {topic: \"voltajeBaterias\", payload: global.get(\"voltajeBaterias\")}; node.send(msg);\nmsg = {topic: \"voltajeBaterias\", payload: global.get(\"voltajeBaterias\")}; node.send(msg);\nmsg = {topic: \"tempCPU\", payload: global.get(\"tempCPU\")}; node.send(msg);\nreturn;","outputs":1,"noerr":0,"x":2579.309543609619,"y":175.45234816414973,"wires":[["35b5038b.76c79c"]]},{"id":"ea88b81d.851bb8","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"{\"topic\":\"most\",\"payload\":\"0\"}","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":260,"y":550,"wires":[["9641fbd0.64c858"]]},{"id":"30b18e6c.811f92","type":"debug","z":"3ce5b54a.127d6a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1515.4205669826933,"y":638.7540316051907,"wires":[]},{"id":"d18e6794.44d0b8","type":"function","z":"7ac92c99.66ea94","name":"","func":"msg.estado = 0;\nreturn msg;","outputs":1,"noerr":0,"x":366.9881582260132,"y":346.92860174179077,"wires":[["817c4eab.44409"]]},{"id":"b0fa95e2.45b538","type":"inject","z":"f682d492.22a758","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":"16","x":170,"y":440,"wires":[["164c686f.fee268","3b30e656.644aca","37becc30.948424","4f9303f0.e61c5c"]]},{"id":"29c810f2.f893f","type":"function","z":"f682d492.22a758","name":"","func":"msg.filename = \"/home/gaston/BackUp-Node-Red/flow.json\";\nreturn msg;\n","outputs":1,"noerr":0,"x":593,"y":66,"wires":[["a295c51.e493e38"]]},{"id":"bbcc7f70.46ebd","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg = {topic: \"Corriente Carga\", payload: global.get(\"corrienteCarga\")}; node.send(msg);\n","outputs":1,"noerr":0,"x":2589.3095474243164,"y":302.59523364475797,"wires":[["c808b636.2b3e58"]]},{"id":"4b708dd9.817a44","type":"blynk-ws-in-write","z":"3ce5b54a.127d6a","name":"","pin":"12","client":"2c18e412.5f5cbc","x":1300.5358810424805,"y":651.4683103561401,"wires":[["c8be9ca.b68de6","30b18e6c.811f92"]]},{"id":"af3d9613.f56998","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"toldo/abrir","qos":"2","broker":"c339edbf.39572","x":1299.6188926696777,"y":301.9762897491455,"wires":[["ae746686.8cad28"]]},{"id":"e7a48f48.bfb8d","type":"comment","z":"f682d492.22a758","name":"PID Control For CPU Temperature of Raspberry PI","info":"","x":270,"y":20,"wires":[]},{"id":"1a6d9f60.807471","type":"mqtt out","z":"3ce5b54a.127d6a","name":"","topic":"","qos":"","retain":"","broker":"c339edbf.39572","x":860,"y":490,"wires":[]},{"id":"55a52bbf.d92134","type":"mqtt in","z":"1b403a13.0ec8c6","name":"","topic":"ESP/TermoSolar/Inicio","qos":"2","broker":"900627dc.76e6a8","x":260,"y":130,"wires":[["34ae7c41.536534"]]},{"id":"d9f5febb.e48e8","type":"blynk-ws-in-write","z":"e6e33852.2495f8","name":"","pin":"76","pin_all":0,"client":"2c18e412.5f5cbc","x":141.8888931274414,"y":195.66666221618652,"wires":[["16b67857.ba97a8"]]},{"id":"c112e012.ca981","type":"inject","z":"50119c6e.6ff584","name":"","topic":"tomarMedicion","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":214.28571891784668,"y":66.19046211242676,"wires":[["37d229b6.e29ba6"]]},{"id":"e06c23ee.4ad0f","type":"function","z":"7ac92c99.66ea94","name":"","func":"msg.estado = 1;\nreturn msg;","outputs":1,"noerr":0,"x":369.8571662902832,"y":312.5238199234009,"wires":[["817c4eab.44409"]]},{"id":"3368b0c3.9c168","type":"debug","z":"e364a467.07a6a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":514,"y":545.6388549804688,"wires":[]},{"id":"cee63a6d.8910d8","type":"function","z":"3ce5b54a.127d6a","name":"filtro USB","func":"var dato = JSON.parse(msg.payload);\n\nif (dato.topic === \"Alarma/Activacion\" || dato.topic === \"Alarma/Disparo\"){\n    msg = {topic: \"USBin/Alarma\", payload: msg.payload};\n\treturn msg;\n}\nif (dato.topic === \"Toldo\"){\n    msg = {topic: \"USBin/Toldo\", payload: msg.payload};\n\treturn msg;\n}\n\nif (dato.topic === \"Baterias/Est/Pedido/Resp\" || dato.topic === \"Cargador\"){\n    msg = {topic: \"USBin/Baterias\", payload: msg.payload};\n\treturn msg;\n}\n\n","outputs":1,"noerr":0,"x":730,"y":510,"wires":[["ba875d73.41fcf","1a6d9f60.807471"]]},{"id":"5a958881.fb0918","type":"mqtt in","z":"a89e305a.c50bb","name":"","topic":"aviso/Alarma","qos":"2","broker":"6b36e4a.1d30b1c","x":345.00000762939453,"y":90.75000190734863,"wires":[["cce091cd.a69e5"]]},{"id":"348adaea.07eaa6","type":"function","z":"50119c6e.6ff584","name":"tempLavadero","func":"var temp = parseFloat(msg.payload) + 1.6;\nglobal.set(\"tempLavadero\", temp.toFixed(1));\nmsg= {topic: \"tempLavadero\", payload: global.get(\"tempLavadero\")}; node.send(msg);\nnode.status({text: \"temp: \" + global.get(\"tempLavadero\") + \" -- \" + global.get(\"hsCpu\")});","outputs":1,"noerr":0,"x":460,"y":260,"wires":[["3fde6b72.65b1a4","a5c52eba.0fcbf"]]},{"id":"bc4d7dba.786f4","type":"function","z":"7ac92c99.66ea94","name":"","func":"msg.payload = msg.payload + \"living color \";\nreturn msg;","outputs":1,"noerr":0,"x":395.51197814941406,"y":535.5000057220459,"wires":[["b8f71abc.973838"]]},{"id":"fa1e6676.3dc9e8","type":"inject","z":"50119c6e.6ff584","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":true,"onceDelay":"0.1","x":224.2857265472412,"y":102.85712432861322,"wires":[["37d229b6.e29ba6"]]},{"id":"9dc175d5.17a7e8","type":"file in","z":"e6e33852.2495f8","name":"lectura archivo","filename":"/home/gaston/BackUp-Node-Red/Fibertel.txt","format":"utf8","chunk":false,"sendError":false,"x":596.3333282470703,"y":527.8888940811157,"wires":[["cd0a799.4e81988"]]},{"id":"5a1b2f56.1eef7","type":"inject","z":"e6e33852.2495f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"900","crontab":"","once":false,"onceDelay":0.1,"x":161.8888931274414,"y":121.22223472595215,"wires":[["f0069ce0.a32ee"]]},{"id":"c1dd659e.9aa308","type":"ui_gauge","z":"3ce5b54a.127d6a","name":"","group":"177e0064.22348","order":1,"width":"2","height":"2","gtype":"gage","title":"Temp CPU","label":"units","format":"{{value}}","min":"30","max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":2798.8807258605957,"y":656.6428856168477,"wires":[]},{"id":"8794c1f0.2f8c1","type":"ui_gauge","z":"3ce5b54a.127d6a","name":"","group":"177e0064.22348","order":2,"width":"2","height":"2","gtype":"gage","title":"Amb. Baterias","label":"units","format":"{{value}}","min":"0","max":"50","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":2825.023780822754,"y":471.1666731153218,"wires":[]},{"id":"ba875d73.41fcf","type":"debug","z":"3ce5b54a.127d6a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":860,"y":530,"wires":[]},{"id":"840836b7.f5aab8","type":"debug","z":"e364a467.07a6a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":814.0277633666992,"y":243.99999809265137,"wires":[]},{"id":"553e2b0e.e02dc4","type":"ui_text","z":"3ce5b54a.127d6a","group":"1134b585.4c9e0a","order":7,"width":0,"height":0,"name":"","label":"est. bat.: ","format":"{{msg.payload}}","layout":"row-left","x":2818.6428451538086,"y":604.4999935286387,"wires":[]},{"id":"6e892952.cfc598","type":"inject","z":"1b403a13.0ec8c6","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":"1","x":1250,"y":550,"wires":[["43b083da.46c06c","179e0cda.eb9203"]]},{"id":"aad01191.7f05d","type":"blynk-ws-out-write","z":"e364a467.07a6a8","name":"","pin":"65","pinmode":"1","client":"2c18e412.5f5cbc","x":668.8610763549805,"y":625.7777690887451,"wires":[]},{"id":"94219c12.04844","type":"debug","z":"e6e33852.2495f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":675.5555038452148,"y":326.88891220092773,"wires":[]},{"id":"c78fc939.967d08","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg = {topic: \"tempBat5\", payload: global.get(\"tempBat5\")}; node.send(msg);\n","outputs":1,"noerr":0,"x":2592.166603088379,"y":386.88093921116433,"wires":[[]]},{"id":"57650f5c.b4ca7","type":"debug","z":"a89e305a.c50bb","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":760,"y":390,"wires":[]},{"id":"c47e992b.e889b8","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"toldo/cerrar","qos":"2","broker":"c339edbf.39572","x":1291.9046592712402,"y":207.97626876831055,"wires":[["ae746686.8cad28"]]},{"id":"771db2a8.1bf0fc","type":"function","z":"7ac92c99.66ea94","name":"Activacion (Nuevo)","func":"if (msg.payload.includes(\"alarma\") && msg.payload.includes(\"casa\")){\n\tif (msg.estado === 0){\n\t\tif(global.get(\"estadoAlarma\") === 1){\n\t\t\tmsg = {topic: \"google/Alarma\", payload: 1}; return msg;\n\t\t}\n\t\tif(global.get(\"estadoAlarma\") === 0){\n\t\t\tmsg = {topic: \"aviso/Alarma\", payload: 1}; return msg;\n\t\t}\n\t}\n    msg = {topic: \"google/Alarma\", payload: msg.estado}; return msg;\n}\n\nif (msg.payload.includes(\"llenado\") && msg.payload.includes(\"tanque\")){\n\tglobal.set(\"llenarTanque\", parseInt(msg.estado));\n\tmsg = {topic: \"google/Lavadero\", payload: msg.estado};\n    return msg;\n}","outputs":1,"noerr":0,"x":512.5595741271973,"y":146.54764604568481,"wires":[["895329af.f7c068","97534816.4d4508"]]},{"id":"16c661b6.92124e","type":"function","z":"3ce5b54a.127d6a","name":"hs cel","func":"msg.payload = global.get(\"fechaCompleta\");\nreturn msg;","outputs":1,"noerr":0,"x":1527.6428565979004,"y":552.6429491043091,"wires":[["4bbcff4e.de9ea"]]},{"id":"69d71644.c47cf8","type":"mqtt out","z":"7ac92c99.66ea94","name":"","topic":"","qos":"","retain":"","broker":"43555c62.30ed34","x":605.2619438171387,"y":662.476279258728,"wires":[]},{"id":"4603fbcf.274954","type":"http request","z":"e364a467.07a6a8","name":"","method":"GET","ret":"txt","url":"https://blockchain.info/es/ticker","tls":"","x":441.6944007873535,"y":470.4285914301872,"wires":[["b26bb4d4.da8e08"]]},{"id":"b26bb4d4.da8e08","type":"function","z":"e364a467.07a6a8","name":"BTC","func":"var dato = JSON.parse(msg.payload);\n// dato = JSON.parse(dato);\n\nmsg = dato.USD;\nvar datos = msg.buy;\nmsg = {topic: \"BitCoinUSD\", payload: parseFloat(datos)};\nnode.send(msg);\ndatos = datos * global.get(\"DolarOff\");\nmsg = {topic: \"BitCoinPesos\", payload: parseFloat(datos)};\nreturn msg;\n","outputs":1,"noerr":0,"x":578.6944007873535,"y":470.4285914301872,"wires":[["a9f3050a.052758"]]},{"id":"283c31f.9655ece","type":"debug","z":"3ce5b54a.127d6a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":720,"y":90,"wires":[]},{"id":"257593f1.ccf32c","type":"inject","z":"e6e33852.2495f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":188.5555648803711,"y":375.6666717529297,"wires":[["8f7d1150.7be34"]]},{"id":"b8046fd8.4022b","type":"inject","z":"e6e33852.2495f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":161.33333587646484,"y":321.11111068725586,"wires":[["89e0166f.74bba8"]]},{"id":"955a8862.016a38","type":"debug","z":"3ce5b54a.127d6a","name":"salida lcd blynk","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1901.3927841186523,"y":675.9643287658691,"wires":[]},{"id":"c7e2b7b5.a98f68","type":"blynk-ws-in-write","z":"a89e305a.c50bb","name":"","pin":"14","pin_all":false,"client":"2c18e412.5f5cbc","x":320,"y":290,"wires":[["cce091cd.a69e5"]]},{"id":"14fcc9d3.57f256","type":"inject","z":"7ac92c99.66ea94","name":"","topic":"","payload":"desactivar alarma casa","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":235.94052505493164,"y":210.92860174179077,"wires":[["5975772b.bee358"]]},{"id":"f62131e9.568df","type":"blynk-ws-in-write","z":"e364a467.07a6a8","name":"","pin":"58","pin_all":0,"client":"2c18e412.5f5cbc","x":244.2777328491211,"y":170.49999904632568,"wires":[["393719e5.4bc726"]]},{"id":"80065b77.186188","type":"debug","z":"e6e33852.2495f8","name":"Fibertel","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":666.3333358764648,"y":294.55553817749023,"wires":[]},{"id":"6f1ac0c9.21d27","type":"debug","z":"e6e33852.2495f8","name":"FastNet","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":670.7777328491211,"y":150.11110591888428,"wires":[]},{"id":"9213ac6d.4cfe2","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"crepMQTT","qos":"2","broker":"c339edbf.39572","x":1452.3807945251465,"y":112.14294338226318,"wires":[[]]},{"id":"8af6ec86.c2889","type":"blynk-ws-out-write","z":"50119c6e.6ff584","name":"","pin":"22","pinmode":0,"client":"2c18e412.5f5cbc","x":730,"y":420,"wires":[]},{"id":"37d229b6.e29ba6","type":"function","z":"50119c6e.6ff584","name":"","func":"var date = new Date();\nvar mm = date.getMinutes();\nvar ss = date.getSeconds();\nvar tiempo = mm%5;\nnode.status({text: global.get(\"hsCpu\")});\nif (tiempo === 0 && ss === 1 || msg.topic == \"tomarMedicion\"){\n    // msg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"tempExt\\\",\\\"payload\\\":1}\"}; node.send(msg);\n    msg = {topic: \"ESP/Lavadero/Recibo\", payload: \"pedidoTemp\"}; node.send(msg);\n    msg = {topic: \"ESP/Pasillo/Sens/Temp/Pedido\", payload: 1}; node.send(msg);\n    msg = {topic: \"ESP/Living/Sens/Temp/Pedido\", payload: 1}; node.send(msg);\n    msg = {topic: \"ESP/TermoSolar/Recibo\", payload: 1}; node.send(msg);\n    msg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"Baterias/Est/Pedido\\\",\\\"payload\\\":1}\"}; node.send(msg);\n    msg = {topic: \"ESP/TanqueAgua/Recibo\", payload: 1}; node.send(msg);\n}\n","outputs":1,"noerr":0,"x":372.142915725708,"y":85.71426486968988,"wires":[["21296bc1.2ea0d4","5668c207.79ddec"]]},{"id":"c6c1ec1b.22ba2","type":"blynk-ws-out-write","z":"3ce5b54a.127d6a","name":"","pin":0,"pinmode":"1","client":"2c18e412.5f5cbc","x":2076.381134033203,"y":183.5357119696481,"wires":[]},{"id":"c3f2f383.ad5a7","type":"debug","z":"e6e33852.2495f8","name":"FastNet","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":589.6666488647461,"y":474.55553817749023,"wires":[]},{"id":"89e0166f.74bba8","type":"exec","z":"e6e33852.2495f8","command":" speedtest --share --server 18725","addpay":false,"append":"","useSpawn":"true","timer":"","oldrc":true,"name":"Server Bahia (Fibertel)","x":430.7777633666992,"y":315.66665267944336,"wires":[["80065b77.186188","8f6bdb58.8e4158"],[],[]]},{"id":"65ba529c.420b9c","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"{\"topic\":\"Baterias/Estado/Completo\",\"payload\":1}","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"65","x":380,"y":680,"wires":[["15c00bc2.e4ea64"]]},{"id":"164c686f.fee268","type":"function","z":"f682d492.22a758","name":"","func":"msg.payload = \"Ser reinicio servidor\";\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":420,"wires":[["12fe5170.f844af"]]},{"id":"838dedf0.be8cd","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2365.547550201416,"y":569.9761947904317,"wires":[["e1c6ae7.a9dd95"]]},{"id":"55b494c8.fab0dc","type":"blynk-ws-out-write","z":"50119c6e.6ff584","name":"","pin":"20","pinmode":0,"client":"2c18e412.5f5cbc","x":720,"y":200,"wires":[]},{"id":"40cbd7ce.d528d8","type":"function","z":"e6e33852.2495f8","name":"","func":"var payload = msg.payload;\nvar resultado;\n\nif(payload == \".\")payload = \"Realizando medicion\";\nnode.status({text: \"Estado actual: \" + msg.payload});\nif (payload.includes(\"Download\")){\n    global.set(\"DescargaFast\", parseFloat(payload.substring(payload.indexOf(\"Download: \")+10, payload.indexOf(\"Mbit/s\"))));\n    // msg = {topic: \"DescargaFast\", payload: context.descarga}; node.send([null, null, msg, null]);\n    // node.status({text: resultado});\n    }\n\nif (payload.includes(\"Upload\")){\n    global.set(\"SubidaFast\", parseFloat(payload.substring(payload.indexOf(\"Upload: \")+8, payload.indexOf(\"Mbit/s\"))));\n    // msg = {topic: \"SubidaFast\", payload: context.subida}; node.send([null, null, msg, null]);\n    // node.status({text: resultado});\n    }    \nif (payload.includes(\"Share results\")){\n    resultado = payload.substring(payload.indexOf(\"Share results\")+15);\n    node.status({text: resultado});\n    msg = {pin: 70, payload: context.descarga + \" -- \" + context.subida}; node.send([null, null, null, msg]);\n    msg.payload = global.get(\"fechaCompleta\") + \" -- \" + resultado; return msg;\n}\nif (payload.includes(\"error\") || payload.includes(\"Error\")){\n    msg.payload = global.get(\"fechaCompleta\") + \" -- \" + \"Falla de conexion\"; \n    node.send([msg, null]);\n    return ([null, msg])\n}\n","outputs":4,"noerr":0,"x":494.1111136542426,"y":204.55555513170032,"wires":[["6f1ac0c9.21d27","89e0166f.74bba8","df0fdba0.2a4e58"],["f0069ce0.a32ee"],[],[]]},{"id":"ac2c785f.fac748","type":"function","z":"3ce5b54a.127d6a","name":"","func":"var dato = JSON.parse(msg.payload);\nif (global.get(\"tiempoEspera\") === undefined)global.set(\"tiempoEspera\", 0);\nif (global.get(\"tiempoCargando\") === undefined)global.set(\"tiempoCargando\", 0);\n// context.cont = context.cont || 0;\n// context.voltaje = context.voltaje || 0;\n// context.nivTanque = context.nivTanque || 0;\n// context.tempAmb = context.tempAmb || 0;\n// context.tempCPU = context.tempCPU || 0;\n// context.PWMCooler = context.PWMCooler || 0;\n// context.Crep = context.Crep || 0;\n\n// context.cont++;\n// context.voltaje += parseFloat(global.get(\"voltajeBaterias\"));\n// context.nivTanque += parseFloat(global.get(\"nivTanque\"));\n// context.tempAmb += parseFloat(global.get(\"tempAmbienteBat\"));\n// context.tempCPU += parseFloat(global.get(\"tempCPU\"));\n// context.PWMCooler += parseFloat(global.get(\"PWM-Cooler\"));\n// context.Crep += parseFloat(global.get(\"LDR\"));\n\n// node.status({text: context.cont});\n// if (context.cont >= 10){\n// \tcontext.voltaje = context.voltaje / context.cont;\n// \tcontext.nivTanque = context.nivTanque / context.cont;\n// \tcontext.tempAmb = context.tempAmb / context.cont;\n// \tcontext.tempCPU = context.tempCPU / context.cont;\n// \tcontext.PWMCooler = context.PWMCooler / context.cont;\n// \tcontext.Crep = context.Crep / context.cont;\nif (dato.topic == \"Baterias/Est/Pedido/Resp\"){\n\n\tmsg= {topic: \"voltajeBat\", payload: global.get(\"voltajeBaterias\")}; node.send(msg);\n\tmsg= {topic: \"corrienteCarga\", payload: global.get(\"corrienteCarga\")}; node.send(msg);\n\tmsg= {topic: \"cargador\", payload: global.get(\"estadoCargador\")}; node.send(msg);\n\tmsg= {topic: \"tiempoCargando\", payload: global.get(\"tiempoCargando\").toFixed(2)}; node.send(msg);\n\tmsg= {topic: \"tiempoEspera\", payload: global.get(\"tiempoEspera\").toFixed(2)}; node.send(msg);\n\tmsg= {topic: \"nivTanque\", payload: global.get(\"nivTanque\")}; node.send(msg);\n\tmsg= {topic: \"tasaLlenado\", payload: parseFloat(global.get(\"tasaLlenadoTanque\")).toFixed(2)}; node.send(msg);\n// \tmsg= {topic: \"tempAmb\", payload: global.get(\"tempAmbienteBat\")}; node.send(msg);\n// \tnode.status ({text: global.get(\"tempAmbienteBat\")});\n// \tmsg= {topic: \"tempBat1\", payload: global.get(\"tempBat1\")}; node.send(msg);\n}\nif (dato.topic === \"Cargador\"){\n\tglobal.set(\"voltajeBaterias\", dato.volt);\n\tglobal.set(\"voltajeBat\", dato.voltajeBat);\n\tglobal.set(\"cargador\", dato.payload);\n\t\n\tmsg= {topic: \"voltajeBat\", payload: global.get(\"voltajeBaterias\")}; node.send(msg);\n\tmsg= {topic: \"corrienteCarga\", payload: global.get(\"corrienteCarga\")}; node.send(msg);\n\tmsg= {topic: \"cargador\", payload: global.get(\"estadoCargador\")}; node.send(msg);\n\n\t// msg= {topic: \"cargador\", payload: dato.payload}; node.send(msg);\n\t// global.set(\"voltajeBaterias\", dato.volt);\n\t// msg= {topic: \"voltajeBat\", payload: global.get(\"voltajeBaterias\")}; node.send(msg);\n}\n\n\t// msg= {topic: \"voltajeBat\", payload: context.voltaje.toFixed(2)}; node.send(msg);\n\t// msg= {topic: \"nivTanque\", payload: context.nivTanque.toFixed(2)}; node.send(msg);\n\t// msg= {topic: \"tempAmb\", payload: context.tempAmb.toFixed(2)}; node.send(msg);\n\t// msg= {topic: \"tempCPU\", payload: context.tempCPU.toFixed(2)}; node.send(msg);\n\t// msg= {topic: \"PWM-Cooler\", payload: context.PWMCooler.toFixed(2)}; node.send(msg);\n\t// msg= {topic: \"Crep\", payload: context.Crep.toFixed(2)}; node.send(msg);\n\n// \tcontext.cont = 0;\n// \tcontext.voltaje = 0;\n// \tcontext.nivTanque = 0;\n// \tcontext.tempAmb = 0;\n// \tcontext.tempCPU = 0;\n// \tcontext.PWMCooler = 0;\n// \tcontext.Crep = 0;\n// }","outputs":1,"noerr":0,"x":490,"y":830,"wires":[["d16ed06d.66af","4d605608.32c4f8"]]},{"id":"874ef0ca.0d4c8","type":"function","z":"50119c6e.6ff584","name":"tempLiving","func":"var dato = JSON.parse(msg.payload);\nvar temp = parseFloat(JSON.parse(dato.temp)) + 3.6;\nvar hum = parseFloat(JSON.parse(dato.hum)).toFixed(1);\n\nglobal.set(\"tempLiving\", temp.toFixed(1));\nglobal.set(\"humLiving\", hum);\nmsg= {topic: \"tempLiving\", payload: global.get(\"tempLiving\")}; node.send(msg);\nmsg= {topic: \"humLiving\", payload: hum}; node.send(msg);\nmsg = {payload: global.get(\"tempLiving\")}; node.send([null,msg]);\nnode.status({text: \"temp: \" + global.get(\"tempLiving\") + \" hum:\" + hum + \" -- \" + global.get(\"hsCpu\")});","outputs":2,"noerr":0,"x":500,"y":370,"wires":[["3fde6b72.65b1a4"],[]]},{"id":"9641fbd0.64c858","type":"mqtt out","z":"3ce5b54a.127d6a","name":"","topic":"USBin","qos":"","retain":"","broker":"c339edbf.39572","x":410,"y":510,"wires":[]},{"id":"8f356ea8.5ecc6","type":"file in","z":"f682d492.22a758","name":"flows_vps.json","filename":"/home/gaston/.node-red/projects/Node-Red-Mi-Casa/flow.json","format":"utf8","sendError":true,"x":363,"y":66,"wires":[["29c810f2.f893f"]]},{"id":"b31fbc78.d2c28","type":"debug","z":"50119c6e.6ff584","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":530,"y":520,"wires":[]},{"id":"5cfe80d2.17592","type":"ui_gauge","z":"3ce5b54a.127d6a","name":"","group":"1134b585.4c9e0a","order":5,"width":"2","height":"2","gtype":"gage","title":"Niv Tanque","label":"units","format":"{{value}}","min":"100","max":"550","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":2816.4999389648438,"y":564.976184027536,"wires":[]},{"id":"5ad8f742.dc85e8","type":"delay","z":"7ac92c99.66ea94","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":779.4642906188965,"y":526.7857308387756,"wires":[["9f161dbe.8b3fe"]]},{"id":"89eeadd0.e0f45","type":"mqtt in","z":"a89e305a.c50bb","name":"","topic":"crepMQTT","qos":"2","broker":"6b36e4a.1d30b1c","x":200,"y":170,"wires":[["8bd456c6.07d1e8"]]},{"id":"e49e7f05.d89db","type":"function","z":"3ce5b54a.127d6a","name":"toldo andando","func":"\tvar topic = msg.topic;\n\tvar payload = parseInt(msg.payload);\n\tcontext.estadoToldo = context.estadoToldo || 0;  // estToldo:  0= parado, 1= abriendo, 2= abierto, 3= cerrando, 4= cerrado\n\tcontext.estAnt = context.estAnt || 0; // =0 parado, =1 abriendo, = 2 cerrando\n\tvar tiempoMover = 15;\n\tvar diffAmanecer = 1.5;\n\tvar date = new Date();\n\tvar hh = global.get(\"hh\");\n\tvar mm = global.get(\"mm\");\n\tvar ss = global.get(\"ss\");\n\tif (global.get(\"tiempoEsperaRociador\") === undefined)global.set(\"tiempoEsperaRociador\", 30);\n\tif (global.get(\"tiempoMojandoRociador\") === undefined)global.set(\"tiempoMojandoRociador\", 0.8);\n\n\t// context.tiempoToldo = context.tiempoToldo || date.getTime();\n\tcontext.datoAmanecer = context.datoAmanecer || date.getTime()+5000;\n\tcontext.CerrarToldoAuto = context.CerrarToldoAuto || 0; \n\tcontext.AbrirToldoAuto = context.AbrirToldoAuto || 0;\n\tcontext.hsAnterior =context.hsAnterior || hh-1;\n\tcontext.ssAnterior = context.ssAnterior || 0;\n\tcontext.inicio = context.inicio || 0;\n\tcontext.error = context.error || 0;\n\n\tcontext.avisoAuto = context.avisoAuto || 0;\n\tcontext.avisoRociador = context.avisoRociador || 0;\n\tcontext.condicionEstadoToldo = context.condicionEstadoToldo || 0;\n\tcontext.aperturaAmanecer = context.aperturaAmanecer || 0;\n\tcontext.cerradoManual = context.cerradoManual || 0;// =1 lo cerre manual se habilita pone a 0 cuando se cierra de forma automatica\n\tcontext.abiertoManual = context.abiertoManual || 0;// =1 lo habri manual se habilita pone a 0 cuando se habre de forma automatica\n\n\tif (global.get(\"tiempoMoviendo\") === undefined)global.set(\"tiempoMoviendo\", 0);\n\tif (global.get(\"enfriarToldo\") === undefined)global.set(\"enfriarToldo\", 0);\n\tif (global.get(\"mojandoToldo\") === undefined)global.set(\"mojandoToldo\", 0);\n\tif (global.get(\"estadoToldo\") === undefined)global.set(\"estadoToldo\", \"nulo\");\n\tif (global.get(\"Dia\") === undefined)global.set(\"Dia\", 0);\n\tif (global.get(\"datoAmanecer\") === undefined)global.set(\"datoAmanecer\", \"nulo\");\n\tif (global.get(\"tempPatioLuz\") === undefined)global.set(\"tempPatioLuz\", 0);\n\tif (global.get(\"hsAmanecer\") === undefined)global.set(\"hsAmanecer\", \"nulo\");\n\tif (global.get(\"hsAnochecer\") === undefined)global.set(\"hsAnochecer\", \"nulo\");\n\n\tvar dato = JSON.parse(msg.payload);\n\n\tvar tiempo = hh + \":\" + mm + \":\" + ss;\n\n\tif (dato.topic === \"Toldo\")comprobarToldo();\n\n\tif (msg.topic === \"USBin/Toldo\"){\n\t\tif (dato.topic === \"tiempoEsperaRociador\"){global.set(\"tiempoEsperaRociador\", parseFloat(dato.payload).toFixed(1)); return;}\n\t\tif (dato.topic === \"tiempoMojandoRociador\"){global.set(\"tiempoMojandoRociador\", parseFloat(dato.payload).toFixed(1)); return;}\n\t}\n\n\n\tif (global.get(\"estadoToldo\") !== \"Abriendo\" || global.get(\"estadoToldo\") !== \"Cerrando\")node.status({text: global.get(\"hsCpu\") + \"  \" + context.CerrarToldoAuto + \" -- \" + hh});\t\t\n\n\tif(context.inicio === 0){\n\t\tif (global.get(\"Dia\") === 1)context.aperturaAmanecer = 1;\n\n\tcontext.inicio = 1;\t\n\t}\n\n\tif (hh === 0 && mm === 0 && ss === 0){\n\t\tcontext.CerrarToldoAuto = 0;\n\t\tcontext.AbrirToldoAuto = 0;\t\n\t\tcontext.cerradoManual = 0;\n\t}\n\n\tif (topic === \"resetAutos\"){\n\t\tcontext.CerrarToldoAuto = 0;\n\t\tcontext.AbrirToldoAuto = 0;\t\n\t\tglobal.set(\"CerrarToldoAuto\", context.CerrarToldoAuto);\n\t\tglobal.set(\"AbrirToldoAuto\", context.AbrirToldoAuto);\n\t\treturn;}\n\n\tif (topic === \"toldoBlynk\"){\n\t\tglobal.set(\"estadoToldo\", \"Error Borrado\");\n\t\tglobal.set(\"toldoManual\", 1);\n\t\tif (payload === 1 && context.estAnt === 0){\n\t\t\t// context.abiertoManual = 0;\n\t\t\tcontext.abiertoManual = 1;\n\t\t\tcontext.condicionEstadoToldo = 0;\n\t\t\tcontext.CerrarToldoAuto = 0;\n\t\t\tglobal.set(\"estadoToldoLCD\", \"Abriendo toldo modo manual (Blynk)\");\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`) VALUES (now(),\\\"Abriendo Toldo Manual Blynk\\\")\"};\n\t\t\tnode.send([null, null, msg]);\t\t\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"toldo\\\",\\\"payload\\\":2}\"};\n\t\t\tnode.send([msg, null, null]); \n\t\t\treturn;}\n\n\t\tif (payload === 1 && context.estAnt === 1){\n\t\t\tcontext.cerradoManual = 1;\n\t\t\t// context.cerradoManual = 0;\n\t\t\tcontext.condicionEstadoToldo = 0;\n\t\t\tcontext.AbrirToldoAuto = 0;\n\t\t\tglobal.set(\"estadoToldoLCD\", \"Cerrando toldo modo manual (Blynk)\");\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`) VALUES (now(),\\\"Cerrando Toldo Manual Blynk\\\")\"};\n\t\t\tnode.send([null, null, msg]);\t\t\t\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"toldo\\\",\\\"payload\\\":4}\"};\n\t\t\tnode.send([msg, null, null]); \n\t\t\treturn;}\n\n\t\tif (payload === 0 && context.estadoToldo === 2){\n\t\t\tcontext.cerradoManual = 1;\n\t\t\t// context.cerradoManual = 0;\n\t\t\tcontext.condicionEstadoToldo = 0;\n\t\t\tglobal.set(\"estadoToldoLCD\", \"Cerrando toldo modo manual (Blynk)\");\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`) VALUES (now(),\\\"Cerrando Toldo Manual Blynk\\\")\"};\n\t\t\tnode.send([null, null, msg]);\t\t\t\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"toldo\\\",\\\"payload\\\":4}\"};\n\t\t\tnode.send([msg, null, null]); \n\t\t\treturn;}\n\n\t\tif (payload === 0){\n\t\t\tcontext.abiertoManual = 0;\n\t\t\tcontext.cerradoManual = 0;\t\t\n\t\t\tglobal.set(\"estadoToldoLCD\", \"Toldo Parado\");\n\t\t\tcontext.cerradoManual = 0;\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"toldo\\\",\\\"payload\\\":0}\"};\n\t\t\tnode.send([msg, null, null]); \n\t\t\tglobal.set(\"estadoToldoLCD\", \"Toldo parado de forma manual (Blynk)\");\n\t\t\treturn;}\n\t\t}\n\n\tif (global.get(\"Dia\") === 0){context.aperturaAmanecer = 0; context.datoAmanecer = date.getTime() + 1000;}\n\n\t// global.set(\"datoAmanecer\", context.datoAmanecer);\t\n\tif (global.get(\"tempPatioLuz\") > 19 && global.get(\"estadoToldo\") === \"Abierto\")context.CerrarToldoAuto = 0;\n\tif (topic === \"crepMQTT\" && payload === 0){context.CerrarToldoAuto = 0;}\n\n\tglobal.set(\"CerrarToldoAuto\", context.CerrarToldoAuto);\n\tglobal.set(\"AbrirToldoAuto\", context.AbrirToldoAuto);\n\tglobal.set(\"aperturaAmanecer\", context.aperturaAmanecer);\t\n\tglobal.set(\"diff\", date.getTime() - (context.datoAmanecer + (1000 * 2)));\n\n\tif (global.get(\"mes\") >= 3 && global.get(\"mes\") <= 8 && hh === 22 && mm < 5 && context.CerrarToldoAuto === 0 && global.get(\"estadoToldo\") !== \"Cerrado\"){\n\t\tcontext.abiertoManual = 0;\t\n\t\tcontext.AbrirToldoAuto = 0;\t\n\t\tcontext.condicionEstadoToldo = 1;\n\t\tvar datoMsg = \"Cerrando toldo por oscurcer en invierno\";\n\t\tglobal.set(\"estadoToldoLCD\", datoMsg);\n\n\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`, \\`tempPatioLuz\\`) VALUES (now(),\\\"\" + datoMsg + \"\\\", \" + global.get(\"tempPatioLuz\") + \")\"};\n\t\tnode.send([null, null, msg]);\t\t\n\n\t\tmsg = {topic: \"notifyBlynk\", payload: datoMsg}; node.send([msg, null, null]);\n\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"toldo\\\",\\\"payload\\\":4}\"}; node.send([msg, null, null]);  \n\t\tglobal.set(\"CerrarToldoAuto\", context.CerrarToldoAuto);\n\t\tglobal.set(\"AbrirToldoAuto\", context.AbrirToldoAuto);\n\t\t// return;\t\n\t}\n\n\t//Cerrar\t\n\tif (global.get(\"tempPatioLuz\") > 24 && global.get(\"Dia\") === 1 || global.get(\"tempPatioLuz\") < 15 && global.get(\"Dia\") === 0  && context.abiertoManual === 0){\n\t\tif (context.CerrarToldoAuto === 0 && global.get(\"estadoToldo\") !== \"Cerrado\"){\n\t\t\tcontext.cerradoManual = 0;\n\t\t\tcontext.AbrirToldoAuto = 0;\t\t\n\t\t\tcontext.condicionEstadoToldo = 2;\n\t\t\t// global.set(\"estadoToldo\", \"Cerrando\");\n\t\t\tvar datoMsg = \"Cerrando toldo por temperatura (24<\" + global.get(\"tempPatioLuz\") + \"<15)\";\n\t\t\tglobal.set(\"estadoToldoLCD\", datoMsg);\n\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`, \\`tempPatioLuz\\`) VALUES (now(),\\\"\" + datoMsg + \"\\\", \" + global.get(\"tempPatioLuz\") + \")\"};\n\t\t\tnode.send([null, null, msg]);\t\t\n\n\t\t\tmsg = {topic: \"notifyBlynk\", payload: datoMsg}; node.send([msg, null, null]);\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"toldo\\\",\\\"payload\\\":4}\"};\n\t\t\tnode.send([msg, null, null]);  \n\t\t\tglobal.set(\"CerrarToldoAuto\", context.CerrarToldoAuto);\n\t\t\tglobal.set(\"AbrirToldoAuto\", context.AbrirToldoAuto);\n\t\t\treturn;}\t\t\t\n\t\t}\t\n\n\t//Abrir anochecer\n\tif (topic === \"crepMQTT\" && payload === 0){\n\t\tcontext.aperturaAmanecer = 0;\n\t\tif(global.get(\"tempPatioLuz\") < 23 && global.get(\"tempPatioLuz\") >= 18 && global.get(\"estadoToldo\") !== \"Abierto\" && context.cerradoManual === 0){\n\t\t\tcontext.CerrarToldoAuto = 0;\n\t\t\tcontext.abiertoManual = 0\n\t\t\tcontext.condicionEstadoToldo = 2;\n\t\t\tvar datoMsg = \"Abriendo toldo por hacerse de noche\";\n\t\t\tglobal.set(\"estadoToldoLCD\", datoMsg);\n\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`, \\`tempPatioLuz\\`, \\`crepuscular\\`) VALUES (now(),\\\"Abriendo toldo por oscurecer\\\", \" + global.get(\"tempPatioLuz\") + \", \\\"\" + global.get(\"hsAnochecer\") + \"\\\")\"};\n\t\t\tnode.send([null, null, msg]);\n\n\t\t\tmsg = {topic: \"notifyBlynk\", payload: datoMsg}; node.send([msg, null, null]);\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"toldo\\\",\\\"payload\\\":2}\"};\n\t\t\tnode.send([msg, null, null]);  \n\t\t\tglobal.set(\"CerrarToldoAuto\", context.CerrarToldoAuto);\n\t\t\tglobal.set(\"AbrirToldoAuto\", context.AbrirToldoAuto);\n\t\t}}\t\t\n\n\t//Abrir por temp\n\tif (global.get(\"tempPatioLuz\") < 17 && global.get(\"tempPatioLuz\") > 15 && global.get(\"Dia\") === 1 && context.AbrirToldoAuto === 0 && global.get(\"estadoToldo\") !== \"Abierto\" && context.cerradoManual === 0){\n\t\tcontext.condicionEstadoToldo = 1;\n\t\tcontext.abiertoManual = 0\n\t\tvar datoMsg = \"Abriendo toldo por temperatura (19<\" + global.get(\"tempPatioLuz\") + \">17)\";\n\t\tglobal.set(\"estadoToldoLCD\", datoMsg); \n\n\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`, \\`tempPatioLuz\\`, \\`crepuscular\\`) VALUES (now(),\\\"\" + datoMsg + \"\\\", \" + global.get(\"tempPatioLuz\") + \", \\\"\" + datoAmanecer + \"\\\")\"};\n\t\tnode.send([null, null, msg]);\t\n\n\t\tmsg = {topic: \"notifyBlynk\", payload: datoMsg}; node.send([msg, null, null]);\n\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"toldo\\\",\\\"payload\\\":2}\"}; node.send([msg, null, null]); \n\t\tglobal.set(\"CerrarToldoAuto\", context.CerrarToldoAuto);\n\t\tglobal.set(\"AbrirToldoAuto\", context.AbrirToldoAuto);\n\t\treturn;}\n\n\t//Abrir amanecer     * 60 * diffAmanecer\n\tif (date.getTime() > (context.datoAmanecer + (1000 * 60 * 60 * diffAmanecer)) && global.get(\"tempPatioLuz\") < 23  && context.aperturaAmanecer === 0){   //Abrir Auto por Hora, hs= 23:15:25\n\t\tcontext.aperturaAmanecer = 1;\n\t\tif(context.AbrirToldoAuto === 0 && global.get(\"estadoToldo\") !== \"Abierto\"){\n\t\t\tcontext.condicionEstadoToldo = 3;\n\t\t\tcontext.aperturaAmanecer = 1;\n\t\t\tcontext.abiertoManual = 0;\t\t\n\t\t\tcontext.CerrarToldoAuto = 0;\n\t\t\tvar datoAmanecer = global.get(\"hsAmanecer\"); if (datoAmanecer === undefined)datoAmanecer = null;\n\t\t\tvar datoMsg = \"Abriendo toldo por Amanecer, hs amanecer: \" + global.get(\"hsCpu\");\n\t\t\tglobal.set(\"estadoToldoLCD\", datoMsg);\n\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`, \\`tempPatioLuz\\`, \\`crepuscular\\`) VALUES (now(),\\\"\" + datoMsg + \"\\\", \" + global.get(\"tempPatioLuz\") + \", \\\"\" + datoAmanecer + \"\\\")\"};\n\t\t\tnode.send([null, null, msg]);\n\n\t\t\tmsg = {topic: \"notifyBlynk\", payload: datoMsg}; node.send([msg, null, null]);\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"toldo\\\",\\\"payload\\\":2}\"}; node.send([msg, null, null]); \n\t\t\tglobal.set(\"CerrarToldoAuto\", context.CerrarToldoAuto);\n\t\t\tglobal.set(\"AbrirToldoAuto\", context.AbrirToldoAuto);\n\t\t\treturn;}\t}\n\n\t//60 * 60 * 1.5\n\n\tif (msg.topic === \"enfriarToldoBlynk\"){global.set(\"enfriarToldo\", msg.apyload);}\n\n\tif (global.get(\"tempPatioLuz\") >= 25 && global.get(\"estadoToldo\") === \"Cerrado\"  && global.get(\"enfriarToldo\") === 0){\n\t\t\tcontext.esperaMojando = date.getTime() - 1000; global.set(\"mojandoToldo\",0);\n\t\t\tvar datoEnfriador = \"Enfriador habilitado (\" + global.get(\"hsCel\") + \" temp: \" + global.get(\"tempPatioLuz\") + \")\";\n\t\t\tmsg = {pin: 9, payload: 1}; node.send([null, msg, null]);\n\t\t\tglobal.set(\"enfriadorToldo\", datoEnfriador);\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`) VALUES (now(), \\\"\" + datoEnfriador + \"\\\")\"}; node.send([null, null, msg]);\t\n\t\t\t// msg = {topic: \"notifyBlynk\", payload: datoEnfriador}; node.send([msg, null, null]);\n\t\t\tglobal.set(\"enfriarToldo\", 1);\n\t\t\tcontext.avisoRociador = 0;}\n\n\tif (global.get(\"tempPatioLuz\") <= 18 && global.get(\"enfriarToldo\") === 1 || global.get(\"estadoToldo\") !== \"Cerrado\" && global.get(\"enfriarToldo\") === 1){\n\t\t\tvar datoEnfriador = \"Enfriador deshabilitado (\" + global.get(\"hsCel\") + \" temp: \" + global.get(\"tempPatioLuz\") + \")\";\n\t\t\tmsg = {topic: \"notifyBlynk\", payload: datoEnfriador}; node.send([msg, null, null]);\n\t\t\tglobal.set(\"enfriadorToldo\", datoEnfriador);\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`) VALUES (now(), \\\"\" + datoEnfriador + \"\\\")\"}; node.send([null, null, msg]);\t\n\t\t\tglobal.set(\"enfriarToldo\", 0);\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"rele1\\\",\\\"payload\\\": 0}\"};\t\n\t\t\tnode.send([msg, null, null]);\n\t\t\tmsg = {pin: 9, payload: 0}; node.send([null, msg, null]);\n\t\t}\n\n\tif (global.get(\"enfriarToldo\") === 1){\n\t\tif (global.get(\"mojandoToldo\") === 0 && date.getTime() > context.esperaMojando && global.get(\"tempPatioLuz\") >= 22){\n\t\t\tcontext.tiempoMojando = date.getTime() + (1000*60*global.get(\"tiempoMojandoRociador\"));//3'\n\t\t\tglobal.set(\"mojandoToldo\", 1);\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"rele1\\\",\\\"payload\\\": 1}\"};\t\n\t\t\tnode.send([msg, null, null])\n\t\t\tmsg = {pin: 9, payload: 1}; node.send([null, msg, null]);\n\n\t\t\tvar datoEnfriador = \"rociador mojando desde las \" + global.get(\"hsCel\") ;\n\t\t\tglobal.set(\"rociadorToldo\", datoEnfriador);\n\t\t\tmsg = {topic: \"notifyBlynk\", payload: \"Rociador mojando desde las \" + global.get(\"hsCel\") }; node.send([msg, null, null]);\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`) VALUES (now(), \\\"\" + msg.payload + \"\\\")\"}; \n\t\t\tnode.send([null, null, msg]);\n\t\t\tmsg = {topic: \"ESP/Lavadero/Presurizadora\", payload: 1}; node.send([msg, null, null])\t\t\t\t\t\n\t\t}\n\t\tif (global.get(\"mojandoToldo\") === 1 && date.getTime() > context.tiempoMojando){\n\t\t\tcontext.esperaMojando = date.getTime() + (1000*60*global.get(\"tiempoEsperaRociador\"));//30'\n\t\t\tglobal.set(\"mojandoToldo\", 0);\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"rele1\\\",\\\"payload\\\": 0}\"};\t\n\t\t\tnode.send([msg, null, null]);\n\t\t\tmsg = {pin: 9, payload: 0}; node.send([null, msg, null]);\n\t\t\tvar datoEnfriador = \"rociador en espera desde las \" + global.get(\"hsCel\") ;\n\t\t\tglobal.set(\"rociadorToldo\", datoEnfriador);\n\t\t\tmsg = {topic: \"notifyBlynk\", payload: \"Rociador en espera desde las \" + global.get(\"hsCel\")}; node.send([msg, null, null]);\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`) VALUES (now(), \\\"\" + msg.payload + \"\\\")\"}; \n\t\t\tnode.send([null, null, msg]);\t\t\n\t\t}\n\t}//Cerrando toldo por temperatura (24<\n\tif (global.get(\"enfriarToldo\") === 0 && context.avisoRociador === 0){\t\t\n\t\tvar datoEnfriador = \"Enfriador deshabilitado, \" + global.get(\"hsCel\") + \" temp: \" + global.get(\"tempPatioLuz\");\n\t\tmsg = {topic: \"notifyBlynk\", payload: datoEnfriador}; node.send([msg, null, null]);\n\t\tcontext.avisoRociador = 1;\t\t\n\t\tglobal.set(\"mojandoToldo\" , 0);\n\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"rele1\\\",\\\"payload\\\": 0}\"};\t\n\t\tnode.send([msg, null, null]);}\t\t\n\n\tfunction comprobarToldo(){\n\tswitch (dato.payload){\n\t\tcase 0:\n\t\t\tglobal.set(\"estadoToldo\", \"Parado\");\t\t\n\t\t\tcontext.estadoToldo = 0;\t\n\t\t\tif (context.error !== 0)global.set(\"estadoToldoLCD\", \"Toldo parado de forma manual (Blynk)\");\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`, \\`tiempoMov\\`) VALUES (now(),\\\"\" + global.get(\"estadoToldoLCD\") + \"\\\",\" + global.get(\"tiempoMoviendo\") + \")\"};\t\t\n\t\t\tmsg = {topic: \"Blynk/actualizar/estado\", payload: 1}; node.send([msg, null, null]);\n\t\t\tif (context.estAnt === 0){msg = {payload: 0, color: \"#ffbc26\", label: \"Toldo Parado\", offlabel: \"Abrir\", pin: 3}; node.send([null, msg, null]); return;}\n\t\t\tif (context.estAnt === 1){msg = {payload: 0, color: \"#ffbc26\", label: \"Toldo Parado\", offlabel: \"Cerrar\", pin: 3}; node.send([null, msg, null]); return;}\n\t\tbreak;\n\t\tcase 1:\t\n\t\t    // if (global.get(\"estadoToldo\") === \"Abierto\") return;\n\t\t\tcontext.AbrirToldoAuto = 1;\n\t\t\tcontext.error = 0;\n\t\t\tif (global.get(\"estadoToldo\") === \"Cerrado\" || global.get(\"estadoToldo\") === \"Error Toldo abriendo\" || global.get(\"estadoToldo\") === \"Error Toldo cerrando\")global.set(\"tiempoMoviendo\", 0);\n\t\t\tmsg = {payload: 1, color: \"#ffbc26\", label: \"Tol. Abriendo\", onlabel: \"Parar\", pin: 3}; node.send([null, msg, null]);\n\t\t\tcontext.estadoToldo = 1;\n\t\t\tcontext.estAnt = 1;\n\t\t\tglobal.set(\"estadoToldo\", \"Abriendo\");\n\t\t\tnode.status({text: global.get(\"estadoToldo\") + \" \" + context.tiempoToldo});//toldo abierto\n\t\tbreak;\n\t\tcase 2:\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"abiertoOK\\\",\\\"payload\\\":0}\"}; node.send([msg, null, null]);\n\t\t\tif (global.get(\"estadoToldo\") == \"Abierto\")return;\n\t\t\tglobal.set(\"estadoToldo\", \"Abierto\");\t\t\n\t\t\tglobal.set(\"toldoManual\", 0);\n\t\t\tif (context.condicionEstadoToldo === 0)global.set(\"estadoToldoLCD\", \"Toldo Abierto de forma manual (Blynk)\" + global.get(\"hsCpu\"));\n\t\t\tif (context.condicionEstadoToldo === 1)global.set(\"estadoToldoLCD\", \"Toldo Abierto por temp (\" + global.get(\"hsCpu\") + \", temp: \" + global.get(\"tempPatioLuz\") + \")\");\n\t\t\tif (context.condicionEstadoToldo === 2)global.set(\"estadoToldoLCD\", \"Toldo Abierto por Oscurecer(\"  + global.get(\"hsCpu\") + \")\");\n\t\t\tif (context.condicionEstadoToldo === 3)global.set(\"estadoToldoLCD\", \"Toldo Abierto por Amanecer(\"  + global.get(\"hsCpu\") + \")\");\n\t\t\tvar moviendo = Math.abs(tiempoMover - global.get(\"tiempoMoviendo\"));\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`, \\`tiempoMov\\`, \\`tempPatioLuz\\`) VALUES (now(),\\\"\" + global.get(\"estadoToldoLCD\") + \"\\\",\" + moviendo + \",\" + global.get(\"tempPatioLuz\") + \")\"};\n\t\t\tnode.send([null, null, msg]);\t\n\t\t\tmsg = {pin: 3, payload: 1, color: \"#23C48E\", label: \"Toldo Abierto\", onlabel: \"Cerrar\"}; node.send([null, msg, null]);\n\t\t\tmsg = {topic: \"notifyBlynk\", payload: \"Toldo Abierto\"}; node.send([msg, null, null]);\n\t\t\tcontext.estadoToldo = 2;\n\t\t\tcontext.estAnt = 1;\n\t\t\tmsg = {topic: \"Blynk/actualizar/estado\", payload: 1}; node.send([msg, null, null]);\n\t\t\treturn;\n\t\tcase 3:\n\t\t\t// if (global.get(\"estadoToldo\") === \"Cerrado\") return;\t\t\n\t\t\tcontext.CerrarToldoAuto = 1;\t\n\t\t\tcontext.error = 0;\n\t\t\tif (global.get(\"estadoToldo\") === \"Abierto\" || global.get(\"estadoToldo\") === \"Error Toldo abriendo\" || global.get(\"estadoToldo\") === \"Error Toldo cerrando\")global.set(\"tiempoMoviendo\", 0);\n\t\t\tmsg = {payload: 1, color: \"#ffbc26\", label: \"Tol. Cerrando\", onlabel: \"Parar\", pin: 3}; node.send([null, msg, null]);\n\t\t\tcontext.estadoToldo = 3;\n\t\t\tcontext.estAnt = 0;\n\t\t\tglobal.set(\"estadoToldo\", \"Cerrando\");\n\t\t\tnode.status({text: global.get(\"estadoToldo\") + \" \" + context.tiempoToldo});\n\t\tbreak;\n\t\tcase 4://Cerrando toldo por temperatura (24<\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"cerradoOK\\\",\\\"payload\\\":0}\"}; node.send([msg, null, null]);\n\t\t\tif (global.get(\"estadoToldo\") == \"Cerrado\")return;\n\t\t\tglobal.set(\"estadoToldo\", \"Cerrado\");\n\t\t\tglobal.set(\"toldoManual\", 0);\n\t\t\tif (context.condicionEstadoToldo === 0)global.set(\"estadoToldoLCD\", \"Toldo Cerrado de forma manual (Blynk \" + global.get(\"hsCpu\") + \")\");\n\t\t\tif (context.condicionEstadoToldo === 1)global.set(\"estadoToldoLCD\", \"Toldo Cerrado por oscurcer en invierno (\" + global.get(\"hsCpu\") + \", temp: \" + global.get(\"tempPatioLuz\") + \")\");\n\t\t\tif (context.condicionEstadoToldo === 2)global.set(\"estadoToldoLCD\", \"Toldo Cerrado por temp. (\" + global.get(\"hsCpu\") + \", temp: \" + global.get(\"tempPatioLuz\") + \")\");\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`, \\`tiempoMov\\`, \\`tempPatioLuz\\`) VALUES (now(),\\\"\" + global.get(\"estadoToldoLCD\") + \"\\\",\" + global.get(\"tiempoMoviendo\") + \",\" + global.get(\"tempPatioLuz\") + \")\"};\n\t\t\tnode.send([null, null, msg]);\n\t\t\tmsg = {pin: 3, payload: 0, color: \"#23C48E\", label: \"Toldo Cerrado\", offlabel: \"Abrir\"}; node.send([null, msg, null]);\n\t\t\tmsg = {topic: \"notifyBlynk\", payload: \"Toldo Cerrado\"}; node.send([msg, null, null]);\t\n\t\t\tcontext.estadoToldo = 4;\t\t\n\t\t\tcontext.estAnt = 0;\n\t\t\tmsg = {topic: \"Blynk/actualizar/estado\", payload: 1}; node.send([msg, null, null]);\n\t\t\treturn;}\n\tmsg = {topic: \"Blynk/actualizar/toldo\", payload: 1}; node.send([msg, null, null]);}\n\n\t//\"Toldo Cerrado (9:11:13)9:11:12)por temperatura (24<14.0<15)\"\n\n\tif (context.ssAnterior !== ss){\n\t\tcontext.ssAnterior = ss;\n\t\tif (global.get(\"estadoToldo\") === \"Cerrando\" || global.get(\"estadoToldo\") === \"Abriendo\"){\n\t\tvar porcentaje;\n\t\tif (global.get(\"estadoToldo\") === \"Abriendo\"){\n\t\t\tmsg = {pin: 4, payload: \" Abriendo Toldo \"};\n\t\t\ttiempoMoviendo = global.get(\"tiempoMoviendo\") - 1; \n\t\t\tglobal.set(\"tiempoMoviendo\", tiempoMoviendo);}\n\n\t\tif (global.get(\"estadoToldo\") === \"Cerrando\"){\n\t\t\tmsg = {pin: 4, payload: \" Cerrando Toldo \"};\n\t\t\ttiempoMoviendo = global.get(\"tiempoMoviendo\") + 1; \n\t\t\tglobal.set(\"tiempoMoviendo\", tiempoMoviendo);}\n\t\tnode.send([null, msg, null]);\n\n\t\tporcentaje = Math.abs(((parseFloat((tiempoMoviendo * 100)/tiempoMover))).toFixed(1));\n\t\tif (global.get(\"estadoToldo\") === \"Cerrando\")porcentaje = (Math.abs(100 - porcentaje)).toFixed(1);\n\t\tif (porcentaje < 10)porcentaje = \"  \" + porcentaje;\n\t\tif (porcentaje < 100 && porcentaje >= 10)porcentaje = \" \" + porcentaje;\t\n\n\t\tmsg = {pin: 5, payload: \" Avance= \" + porcentaje + \"% \"};// Avance= 100.1%\n\t\tnode.send([null, msg, null]); \n\t\tnode.status({text: tiempoMoviendo + \"  Avance: \" + porcentaje+ \"%\"});\n\t\t}}\n\n\tif (global.get(\"estadoToldo\") === \"Abriendo\" && global.get(\"toldoManual\") === 0){\n\t\tif(Math.abs(global.get(\"tiempoMoviendo\")) > tiempoMover * 1.2){\n\t\t\tcontext.estadoToldo = 0;\n\t\t\tcontext.error = 1;\n\t\t\tglobal.set(\"estadoToldo\", \"Error Toldo abriendo\");\n\t\t\tglobal.set(\"estadoToldoLCD\", \"Error al abrir toldo\");\n\t\t\tvar moviendo = Math.abs(tiempoMover - global.get(\"tiempoMoviendo\"))/2;\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`, \\`tiempoMov\\`, \\`tempPatioLuz\\`) VALUES (now(),\\\"\" + global.get(\"estadoToldoLCD\") + \"\\\",\" + moviendo + \",\" + global.get(\"tempPatioLuz\") + \")\"};\n\t\t\tnode.send([null, null, msg]);\t\t\n\t\t\tmsg = {topic: \"notifyBlynk\", payload: global.get(\"estadoToldoLCD\")}; node.send([msg, null, null]);\n\t\t\tmsg = {payload: 1, color: \"#D3435C\", onlabel: \"Error\", pin: 3}; node.send([null, msg, null]);\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"toldo\\\",\\\"payload\\\":0}\"};node.send([msg, null, null]);\n\t\t\treturn;\t\n\t\t}//error al abrir//error al abrir\n\t}\n\tif (global.get(\"estadoToldo\") === \"Cerrando\" && global.get(\"toldoManual\") === 0){\n\t\tif(Math.abs(global.get(\"tiempoMoviendo\")) > tiempoMover * 1.2){\n\t\t\tcontext.estadoToldo = 0;\n\t\t\tcontext.error = 1;\n\t\t\tglobal.set(\"estadoToldo\", \"Error Toldo cerrando\");\n\t\t\tglobal.set(\"estadoToldoLCD\", \"Error al cerrar toldo\");\n\t\t\tvar moviendo = Math.abs(global.get(\"tiempoMoviendo\"));\n\t\t\tmsg = {topic: \"INSERT INTO \\`toldo\\`(\\`fecha\\`, \\`estado\\`, \\`tiempoMov\\`, \\`tempPatioLuz\\`) VALUES (now(),\\\"\" + global.get(\"estadoToldoLCD\") + \"\\\",\" + moviendo + \",\" + global.get(\"tempPatioLuz\") + \")\"};\n\t\t\tnode.send([null, null, msg]);\t\t\n\t\t\tmsg = {topic: \"notifyBlynk\", payload: global.get(\"estadoToldoLCD\")}; node.send([msg, null, null]);\n\t\t\tmsg = {payload: 1, color: \"#D3435C\", onlabel: \"Error\", pin: 3}; node.send([null, msg, null]);\n\t\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"toldo\\\",\\\"payload\\\":0}\"};node.send([msg, null, null]);\n\t\t\treturn;\t\n\t\t}//error al cerrar\n\t}\n\n\n","outputs":3,"noerr":0,"x":1660,"y":190,"wires":[[],[],[]]},{"id":"41ab1fab.3b2fb","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"mandarMail","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":270,"y":200,"wires":[["f1697d45.0cc3b"]]},{"id":"9f161dbe.8b3fe","type":"mqtt out","z":"7ac92c99.66ea94","name":"","topic":"ESP/living/Iluminacion/beep","qos":"","retain":"","broker":"43555c62.30ed34","x":988.0357398986816,"y":526.785807132721,"wires":[]},{"id":"3512364.5d54eca","type":"delay","z":"e364a467.07a6a8","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":292.6944007873535,"y":467.4285914301872,"wires":[["4603fbcf.274954"]]},{"id":"5668c207.79ddec","type":"debug","z":"50119c6e.6ff584","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":520,"y":60,"wires":[]},{"id":"b8f71abc.973838","type":"function","z":"7ac92c99.66ea94","name":"Cambiar color (Nuevo)","func":"var payload = msg.payload;\n\n// if (global.get(\"estIslaRGB\") === 0)return;\nif (payload.includes(\"living\") && payload.includes(\"color\")){\n\tglobal.set(\"estIslaRGB\", 1);\n\n\tif ((payload.includes(\"azul\") && payload.includes(\"muy\") && payload.includes(\"oscuro\")) || payload.includes(\"1\")){\n\t\tglobal.set(\"IslaR\",  0); global.set(\"IslaG\", 0);\tglobal.set(\"IslaB\", 102);\n\t\tmsg.payload = \"1\"; node.send([null, msg]);\n\t}\n\tif ((payload.includes(\"azul\") && payload.includes(\"oscuro\")) || payload.includes(\"2\")){\n\t\tglobal.set(\"IslaR\", 0);\tglobal.set(\"IslaG\", 0);\tglobal.set(\"IslaB\", 150);\n\t\tmsg.payload = \"2\"; node.send([null, msg]);\n\t}\n\tif (payload.includes(\"azul\")  || payload.includes(\"3\")){\n\t\tglobal.set(\"IslaR\", 0);\tglobal.set(\"IslaG\", 0);\tglobal.set(\"IslaB\", 255);\n\t\tmsg.payload = \"3\"; node.send([null, msg]);\n\t}\n\tif (payload.includes(\"rojo\")  || payload.includes(\"4\")){\n\t\tglobal.set(\"IslaR\", 255); global.set(\"IslaG\", 0); global.set(\"IslaB\", 0);\n\t\tmsg.payload = \"4\"; node.send([null, msg]);\n\t}\n\tif (payload.includes(\"verde\")  || payload.includes(\"5\")){\n\t\tglobal.set(\"IslaR\", 0);\tglobal.set(\"IslaG\", 255); global.set(\"IslaB\", 0);\n\t\tmsg.payload = \"5\"; node.send([null, msg]);\n\t}\n\tif (payload.includes(\"blanco\") || payload.includes(\"6\")){\n\t\tglobal.set(\"IslaR\", 255); global.set(\"IslaG\", 255);\tglobal.set(\"IslaB\", 255);\n\t\tmsg.payload = \"6\"; node.send([null, msg]);\n\t}\n\tif (payload.includes(\"amarillo\")  || payload.includes(\"7\")){\n\t\tglobal.set(\"IslaR\", 255); global.set(\"IslaG\", 255);\tglobal.set(\"IslaB\", 0);\n\t\tmsg.payload = \"7\"; node.send([null, msg]);\n\t}\n\tif (payload.includes(\"lila\") || payload.includes(\"8\")){\n\t\tglobal.set(\"IslaR\", 153); global.set(\"IslaG\", 0);\tglobal.set(\"IslaB\", 204);\n\t\tmsg.payload = \"8\"; node.send([null, msg]);\n\t}\n\tif (payload.includes(\"gris\") || payload.includes(\"9\")){\n\t\tglobal.set(\"IslaR\", 90); global.set(\"IslaG\", 90);\tglobal.set(\"IslaB\", 90);\n\t\tmsg.payload = \"9\"; node.send([null, msg]);\n\t}\t\n\tif ((payload.includes(\"gris\") && payload.includes(\"claro\")) || payload.includes(\"10\")){\n\t\tglobal.set(\"IslaR\", 50); global.set(\"IslaG\", 50);\tglobal.set(\"IslaB\", 50);\n\t\tmsg.payload = \"10\"; node.send([null, msg]);\n\t}\n\tif ((payload.includes(\"gris\") && payload.includes(\"oscuro\")) || payload.includes(\"11\")){\n\t\tglobal.set(\"IslaR\", 15); global.set(\"IslaG\", 15);\tglobal.set(\"IslaB\", 15);\n\t\tmsg.payload = \"11\"; node.send([null, msg]);\n\t}\n\tmsg = {topic: \"google/Living\", payload: \"blanco\"}; return msg;\t\t\n}","outputs":2,"noerr":0,"x":572.7978210449219,"y":496.7857856750488,"wires":[["651c6da5.a31dd4","5ad8f742.dc85e8","b2dcf0c4.a8898"],[]]},{"id":"7e2dc0ad.e7129","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg = {topic: \"tempAmbiente\", payload: global.get(\"tempAmbienteBat\")}; node.send(msg);","outputs":1,"noerr":0,"x":2595.023780822754,"y":468.30952807835183,"wires":[["8794c1f0.2f8c1"]]},{"id":"66a0838f.15ccac","type":"debug","z":"e364a467.07a6a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":406.2221927642822,"y":594.6666412353516,"wires":[]},{"id":"92181c24.986ae","type":"blynk-ws-in-write","z":"e364a467.07a6a8","name":"","pin":"52","pin_all":0,"client":"2c18e412.5f5cbc","x":244.27776336669922,"y":220.49999809265137,"wires":[["e9640668.b315e8"]]},{"id":"95ff630c.c1ed8","type":"ui_gauge","z":"3ce5b54a.127d6a","name":"","group":"177e0064.22348","order":4,"width":"2","height":"2","gtype":"gage","title":"Temp Bat2","label":"units","format":"{{value}}","min":"0","max":"50","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":2800,"y":260,"wires":[]},{"id":"7d2e1271.afd57c","type":"blynk-ws-out-write","z":"3ce5b54a.127d6a","name":"","pin":0,"pinmode":"1","client":"2c18e412.5f5cbc","x":2019.7374954223633,"y":930.8214833395822,"wires":[]},{"id":"4a46a6ec.1d9e38","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"{\"topic\":\"Crep\",\"payload\":\"1\"}","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":260,"y":470,"wires":[["9641fbd0.64c858"]]},{"id":"bc158034.05b6","type":"ui_text","z":"3ce5b54a.127d6a","group":"177e0064.22348","order":6,"width":0,"height":0,"name":"","label":"info arduino","format":"{{msg.payload}}","layout":"row-spread","x":720,"y":550,"wires":[]},{"id":"483d3434.43ff8c","type":"function","z":"3ce5b54a.127d6a","name":"Alarma","func":"var dato = JSON.parse(msg.payload);\npayload = parseInt(dato.payload);\n\n\nif (msg.topic === \"google/Alarma\" || msg.topic === \"alarmaBlynk\"){\n\tmsg = {topic: \"USBout\", payload:\"{\\\"topic\\\":\\\"Alarma\\\",\\\"payload\\\":\" + msg.payload + \"}\"};\n\tnode.send([null, msg]);\n}\n\n// if (msg.topic === \"google/Alarma\" || msg.topic === \"alarmaBlynk\"){\n// \tif (parseInt(msg.payload) === 1 && global.get(\"estadoAlarma\") === 0){msg = {topic: \"USBout\", payload:\"{\\\"topic\\\":\\\"Alarma\\\",\\\"payload\\\": 1}\"}; return([null, msg]);}\n// \tif (parseInt(msg.payload) === 0 && global.get(\"estadoAlarma\") === 1){msg = {topic: \"USBout\", payload:\"{\\\"topic\\\":\\\"Alarma\\\",\\\"payload\\\": 0}\"}; return([null, msg]);}\n\t\n// }\n\nif (dato.topic === \"Alarma/Activacion\"){\n\tglobal.set(\"estadoAlarma\", payload); \n\tmsg = {topic: \"terminalBlynk\", payload: global.get(\"hsCpu\") + \", top: \" + dato.topic + \", payload:\" + msg.payload + \"\\n\"}; node.send([null, msg]);\n\tmsg = {topic: \"aviso/Alarma\", payload: 1}; node.send([null, msg]);\n\tif (global.get(\"estadoAlarma\") === 1){\n\t    msg = {payload: 1, color: \"#f5d86b\", pin: 1}; node.send([msg, null]);\t    \n\t    // msg = {payload: 140, color: \"#f5d86b\", pin: 0}; node.send([null, null, msg, null, null, null]);\n\t\t}\n    if (global.get(\"estadoAlarma\") === 0){\n\t    msg = {payload: 0, color: \"#23C48E\", pin: 1}; node.send([msg, null]);\n\t    // msg = {payload: 128, color: \"#23C48E\", pin: 0}; node.send([null, null, msg,null, null, null]);\n\t    }\n}\n\nif (dato.topic === \"Alarma/Disparo\"){\n\tif (payload === 1){\n\t\tmsg = {payload: 1, color: \"#cc0000\", pin: 1}; node.send([msg, null]);\n\t\tglobal.set(\"disparoAlarma\", 1);\n\t\tmsg = {topic: \"notifyBlynk\", payload: \"Se disparo Alarma en casa\"};\n\n\t}\n\tif (payload === 0){\n\t\tglobal.set(\"disparoAlarma\", 0);\n\t\tmsg = {payload: 0, color: \"#23C48E\", pin: 1}; node.send([msg, null]);\t\t\n\t\t// msg = {payload: 0, pin: 10}; node.send([null, null, msg, null, null, null]);\n\t\tmsg = {topic: \"notifyBlynk\", payload: \"Se normalizo Alarma en casa\"};\n\t}\n\tnode.send([null, msg]);\n}","outputs":2,"noerr":0,"x":1657.951156616211,"y":947.7857501166208,"wires":[["7b8f8d35.3a0bc4","312bb425.81a66c","d457b681.39d968"],["d457b681.39d968","a9ae9e1e.01ed5"]]},{"id":"cd0a799.4e81988","type":"debug","z":"e6e33852.2495f8","name":"Fibertel","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":772.9999618530273,"y":533.4444236755371,"wires":[]},{"id":"785d7d1d.673d94","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"google/Alarma","qos":"2","broker":"c339edbf.39572","x":1480,"y":880,"wires":[["483d3434.43ff8c"]]},{"id":"4dc0dae4.50ccb4","type":"delay","z":"a89e305a.c50bb","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":763.0952224731445,"y":345.2142400741577,"wires":[["a3832c3f.01897"]]},{"id":"893a6b3c.fdb088","type":"function","z":"3ce5b54a.127d6a","name":"","func":"if (global.get(\"estadoAlarma\") === 1)msg = {topic: \"alarmaBlynk\", payload: 0};\nif (global.get(\"estadoAlarma\") === 0)msg = {topic: \"alarmaBlynk\", payload: 1};\n// msg = {topic: \"alarmaBlynk\", payload: msg.payload};\n\nreturn msg;","outputs":1,"noerr":0,"x":1500,"y":920,"wires":[["483d3434.43ff8c"]]},{"id":"be4bba1b.4d9d28","type":"mqtt out","z":"e364a467.07a6a8","name":"","topic":"","qos":"","retain":"","broker":"637ff0bd.3c84b","x":754.1943969726562,"y":471.6785936355591,"wires":[]},{"id":"d6fb78fe.613a98","type":"inject","z":"e364a467.07a6a8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":115.05157852172852,"y":601.3333368301392,"wires":[["57099265.b5d4fc"]]},{"id":"ddd8882e.f587d8","type":"debug","z":"7ac92c99.66ea94","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":756.9881582260132,"y":336.92860174179077,"wires":[]},{"id":"3773d6a9.9717ca","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"2","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1325.7144241333008,"y":568.5713939666748,"wires":[["c8be9ca.b68de6"]]},{"id":"1c00a8ed.d8b847","type":"debug","z":"3ce5b54a.127d6a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":700,"y":470,"wires":[]},{"id":"7a97404c.8809e","type":"blynk-ws-in-write","z":"e364a467.07a6a8","name":"","pin":"57","pin_all":0,"client":"2c18e412.5f5cbc","x":244.27777862548828,"y":54.25,"wires":[["435e80ad.e17c8"]]},{"id":"37d15e3c.0a1382","type":"debug","z":"3ce5b54a.127d6a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1680.5358047485352,"y":533.5715401513236,"wires":[]},{"id":"57099265.b5d4fc","type":"http request","z":"e364a467.07a6a8","name":"","method":"GET","ret":"txt","url":"https://ebankpersonas.bancopatagonia.com.ar/eBanking/usuarios/cotizacionMonedaExtranjera.htm","tls":"","x":193.44442749023438,"y":540.0832986831665,"wires":[["290cd25a.fc6afe","66a0838f.15ccac"]]},{"id":"829179ac.7a1158","type":"comment","z":"50119c6e.6ff584","name":"Blynk privado","info":"wss://192.168.6.40:9443/websockets\n5e076af9bf8d46abb21c1e29066899b7","x":749.9999536786759,"y":52.85714517320912,"wires":[]},{"id":"169a443b.7a749c","type":"blynk-ws-out-write","z":"e364a467.07a6a8","name":"","pin":"55","pinmode":"1","client":"2c18e412.5f5cbc","x":798.2777633666992,"y":575.4999980926514,"wires":[]},{"id":"d16ed06d.66af","type":"thingspeak42","z":"3ce5b54a.127d6a","name":"YJCFSNIEZMNH6U0G","delay":"15","topic1":"voltajeBat","topic2":"corrienteCarga","topic3":"cargador","topic4":"tiempoCargando","topic5":"tiempoEspera","topic6":"nivTanque","topic7":"tasaLlenado","topic8":"","endpoint":"https://thingspeak.com","x":690,"y":790,"wires":[]},{"id":"48a3829c.87478c","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"[]","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2581.130844116211,"y":61.14285727909635,"wires":[["13adbc11.4ab694"]]},{"id":"a912aad4.45fd28","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg = {topic: \"temp Termo\", payload: global.get(\"tempTermoFin\")}; node.send(msg);//global.set(\"tempTermoFin\"\n","outputs":1,"noerr":0,"x":2592.166603088379,"y":344.02379199436746,"wires":[["3ca76747.edf4b8"]]},{"id":"9db1d0a2.a6978","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2372.2141761779785,"y":614.9761947904317,"wires":[["6b8f267f.3678e8"]]},{"id":"88336c7c.fb758","type":"inject","z":"e6e33852.2495f8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":133,"y":582.3333549499512,"wires":[["a5dff34f.89fa6","41de7b73.054844"]]},{"id":"702341e5.2cb2e","type":"function","z":"50119c6e.6ff584","name":"","func":"node.status({text: \"niv: \" + global.get(\"nivTanque\") + \" -- \" + \"volt: \" + global.get(\"voltajeBaterias\") + \" -- \" + global.get(\"hsCpu\")});\nmsg = {pin: 26, payload: global.get(\"nivTanque\")}; node.send(msg);\nmsg = {pin: 27, payload: parseFloat(global.get(\"voltajeBaterias\"))}; node.send(msg);\nreturn \n\n","outputs":1,"noerr":0,"x":510,"y":480,"wires":[["355077e0.49f888"]]},{"id":"d1094e09.0048f","type":"file","z":"e6e33852.2495f8","name":"","filename":"/home/gaston/BackUp-Node-Red/Fibertel.txt","appendNewline":true,"createDir":true,"overwriteFile":"false","x":758.5555038452148,"y":354.55553817749023,"wires":[[]]},{"id":"67684865.9d0948","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"USBin/Baterias","qos":"2","broker":"c339edbf.39572","x":200,"y":820,"wires":[["a594e6b.0d98718"]]},{"id":"cce091cd.a69e5","type":"function","z":"a89e305a.c50bb","name":"recibo2","func":" var timerLuces = 12000;\nif (global.get(\"estLiving\") === undefined)global.set(\"estLiving\", 0);\nif (global.get(\"estIsla\") === undefined)global.set(\"estIsla\", 0);\nif (global.get(\"estCielorrazo\") === undefined)global.set(\"estCielorrazo\", 0);\nif (global.get(\"potLiving\") === undefined)global.set(\"potLiving\", 0);\nif (global.get(\"estIslaRGB\") === undefined)global.set(\"estIslaRGB\", 0);\nif (global.get(\"potIsla\") === undefined)global.set(\"potIsla\", 255);\nif (global.get(\"potCielorrazo\") === undefined)global.set(\"potCielorrazo\", 128);\nif (global.get(\"IslaR\") === undefined)global.set(\"IslaR\", 255);\nif (global.get(\"IslaG\") === undefined)global.set(\"IslaG\", 255);\nif (global.get(\"IslaB\") === undefined)global.set(\"IslaB\", 255);\n\nif (global.get(\"dimmerLeds\") === undefined)global.set(\"dimmerLeds\", 200);\nif (global.get(\"minTeclas\") === undefined)global.set(\"minTeclas\", 15);\nif (global.get(\"maxTeclas\") === undefined)global.set(\"maxTeclas\", 600);\nif (global.get(\"doblePuls\") === undefined)global.set(\"doblePuls\", 1);\nif (global.get(\"fallasLivingIluminacion\") === undefined)global.set(\"fallasLivingIluminacion\", 0);\nif (global.get(\"pwmPatioLuz\") === undefined)global.set(\"pwmPatioLuz\", 33);\ncontext.item = context.item || 0;\nvar pin = parseInt(msg.pin);\nvar topic = msg.topic;\nvar payload = parseInt(msg.payload);\nvar dato;\n\nif (topic == \"ESP/living/Iluminacion/Inicio\"){  \n    var fallasLivingIluminacion = global.get(\"fallasLivingIluminacion\") + 1;\n    global.set(\"fallasLivingIluminacion\", fallasLivingIluminacion);\n    global.set(\"tipoFallaIlLiving\", payload); msg = {topic: \"fallas_MQTT\", payload: 1}; node.send([msg, null]);\n    enviarMQTT();\n    return;\n}\n\nif (topic == \"aviso/Alarma\"){\n    if (global.get(\"estadoAlarma\") === 0 && global.get(\"Dia\") === 0){\n    msg = {topic: \"USBout\", payload: \"Noche\" + global.get(\"pwmPatioLuz\")}; node.send([msg, null]);\n    global.set(\"estLiving\", 1); \n    global.set(\"estIsla\", 1); \n    global.set(\"estCielorrazo\", 1); \n    global.set(\"estIslaRGB\", 1);\n    enviarMQTT();\n    return;\n    }\n    if (global.get(\"estadoAlarma\") === 1 && global.get(\"estLiving\") === 1){setTimeout(apagadoLuces, timerLuces);}\n    if (global.get(\"estadoAlarma\") === 1 && global.get(\"Dia\") === 1){\n        // msg = {topic: \"USBout\", payload: \"Dia\"}; node.send([msg, null]);\n        apagadoLuces();}\n}\n\n\nif (topic == \"crepMQTT\"){\n    if (global.get(\"Dia\") === 1) {msg = {topic: \"USBout\", payload: \"Dia\"}; node.send([msg, null]);}\n    if (global.get(\"Dia\") === 0) {msg = {topic: \"USBout\", payload: \"Noche\" + global.get(\"pwmPatioLuz\")}; node.send([msg, null]);}\n    // enviarMQTT();\n}\n\n\nif (topic == \"google/Living\") {enviarMQTT(); return;}\n\nif (topic == \"ESP/living/Iluminacion/Envio\" && !topic.includes(\"Recibo de ESP\")){\n    dato = msg.payload.split(\"#\");\n    global.set(\"estIsla\", dato[0]); \n    global.set(\"estCielorrazo\", dato[1]); \n    global.set(\"estIslaRGB\", dato[2]); \n    enviarMQTT();\n    return;\n}\n\nswitch (pin){\n\n  case 8:\n    global.set(\"IslaR\", msg.arrayOfValues[0]);\n    global.set(\"IslaG\", msg.arrayOfValues[1]);\n    global.set(\"IslaB\", msg.arrayOfValues[2]);\n    msg = {pin: 32, payload: \"12\"}; node.send([null, msg]);\n    global.set(\"estIslaRGB\", 1);\n    enviarMQTT();\n  break;\n\n  case 14:\n    global.set(\"estLiving\", payload);  \n    global.set(\"estIsla\", payload);\n    global.set(\"estCielorrazo\", payload);\n    global.set(\"estIslaRGB\", payload);\n    enviarMQTT();\n  break;\n\n  case 16:\n    global.set(\"estIsla\", payload);\n    enviarMQTT();\n  break;\n\n  case 17:\n    global.set(\"estCielorrazo\", payload); \n    enviarMQTT();\n  break;\n\n  case 29:\n    global.set(\"estIslaRGB\", payload); \n    enviarMQTT();\n  break;\n\n  // case 18:\n  //   global.set(\"itemPotencia\", msg.payload);\n  //   if (parseInt(global.get(\"itemPotencia\")) > 0 && parseInt(global.get(\"itemPotencia\")) <= 4){\n  //     context.item = parseInt(msg.payload);\n  //     switch(parseInt(msg.payload)){\n  //         case 1:\n  //             msg = {pin: 19, min: 4, max: 255, label: \"Living\", payload: global.get(\"potLiving\")};\n  //         break;\n  //         case 2:\n  //             msg = {pin: 19, min: 4, max: 255, label: \"Isla\", payload: global.get(\"potIsla\")};\n  //         break;\n  //         case 3:\n  //             msg = {pin: 19, min: 4, max: 255, label: \"Cielorrazo\", payload: global.get(\"potCielorrazo\")};\n  //         break;\n  //         case 4:\n  //             msg = {pin: 19, min: 1, max: 100, label: \"Patio Luz\", payload: global.get(\"pwmPatioLuz\")};\n  //         break;\n  //         case 5:\n  //             msg = {pin: 19, min: 1, max: 254, label: \"Ducha de baño\", payload: global.get(\"pwmDucha\")};\n  //         break;          \n  //     }\n  //     node.send([null, msg]);\n  //   }\n  // break;\n\n  // case 19:\n  //   if (parseInt(global.get(\"itemPotencia\")) > 0 && parseInt(global.get(\"itemPotencia\")) <= 4){\n  //     var valor = parseInt(msg.payload);\n  //     switch(context.item){\n  //         case 1:\n  //             if (global.get(\"estLiving\") === 0)return;\n  //             global.set(\"potLiving\", valor);\n  //             global.set(\"potIsla\", valor);\n  //             global.set(\"potCielorrazo\", valor);\n  //         break;\n  //         case 2:\n  //             if (global.get(\"estIsla\") === 0)return;\n  //             global.set(\"potIsla\", valor);\n  //         break;\n  //         case 3:\n  //             if (global.get(\"estCielorrazo\") === 0)return;\n  //             global.set(\"potCielorrazo\", valor);\n  //         break;\n  //         case 4:\n  //             if (global.get(\"Dia\") === 1)return;\n  //             global.set(\"pwmPatioLuz\", valor);\n  //             msg = {topic: \"USBout\", payload: \"Noche\" + global.get(\"pwmPatioLuz\")}; node.send([msg, null]); return;\n  //         break;\n  //         case 5:\n  //             global.set(\"pwmDucha\", valor);\n  //             var dato = global.get(\"modoDucha\") + \"#\" + global.get(\"pedidoDucha\") + \"#\" + global.get(\"pwmDucha\");\n  //             msg = {topic: \"ESP/Bano/Recibo\", payload: dato}; node.send([msg, null]); return;\n  //         break;          \n  //     }\n  //     enviarMQTT();\n  //   }\n  break;\n}\nreturn;\n\nfunction apagadoLuces(){\n    msg = {topic: \"USBout\", payload: \"Dia\"}; node.send([msg, null]);\n    global.set(\"estLiving\", 0);\n    global.set(\"estIsla\", 0); \n    global.set(\"estCielorrazo\", 0); \n    global.set(\"estIslaRGB\", 0);\n    msg.topic = \"apagadoAuto\";\n    enviarMQTT();\n}\n\nfunction enviarMQTT(){\n    var topicNuevo = msg.topic;\n    //msg = {pin: 127, payload: global.get(\"hsCpu\") + \", top: \" + topicNuevo + \", D:\" + global.get(\"Dia\") + \", Al:\" + global.get(\"estadoAlarma\") + \"\\n\"}; node.send([null, msg]);\n    // if (global.get(\"estIsla\") === 0 && global.get(\"estCielorrazo\") === 0 && global.get(\"estIslaRGB\") === 0)global.set(\"estLiving\", 0);\n    // if (global.get(\"estIsla\") === 1 || global.get(\"estCielorrazo\") === 1){\n    //     if(topic !== \"Blink/estLiving\" && topicNuevo !== \"fallas_MQTT\")\n    //       if (payload !== 0) global.set(\"estLiving\", 1);\n    //     }\n    // if (topicNuevo !== \"fallas_MQTT\"){\n    msg = {pin: 14, payload: global.get(\"estLiving\")}; node.send([null, msg]);\n    msg = {pin: 16, payload: global.get(\"estIsla\")}; node.send([null, msg]);\n    msg = {pin: 17, payload: global.get(\"estCielorrazo\")}; node.send([null, msg]);\n    msg = {pin: 29, payload: global.get(\"estIslaRGB\")}; node.send([null, msg]);//}\n    if(topicNuevo == \"ESP/living/Iluminacion/Envio\")return;\n    \n    // if (parseInt(global.get(\"estLiving\")) === 0) {\n    //         msg = {pin: 16, payload: \"0\"}; node.send([null, msg]);\n    //         dato = \"0,\"}\n    //     else{\n    //         dato = global.get(\"estIsla\") + \",\";}\n    // dato += global.get(\"potIsla\") + \"#\";\n\n    // if (parseInt(global.get(\"estLiving\")) === 0) {\n    //         msg = {pin: 17, payload: \"0\"}; node.send([null, msg]);\n    //         dato += \"0,\"}\n    //     else{\n    //         dato += global.get(\"estCielorrazo\") + \",\";}\n\n    dato = global.get(\"estIsla\") + \",\";\n    dato += global.get(\"potIsla\") + \"#\";\n    dato += global.get(\"estCielorrazo\") + \",\";\n    dato += global.get(\"potCielorrazo\") + \"#\";  \n    dato += global.get(\"estIslaRGB\") + \",\";\n    dato += global.get(\"IslaR\") + \",\";\n    dato += global.get(\"IslaG\") + \",\";      \n    dato += global.get(\"IslaB\") + \"#\";\n\n  dato += global.get(\"pwmMaxLed\") + \"#\";\n  dato += global.get(\"pwmMinLed\") + \"#\";\n    // dato += global.get(\"dimmerLeds\") + \"#\";\n\n    dato += global.get(\"minTeclas\") + \"#\";\n    dato += global.get(\"maxTeclas\") + \"#\";\n    dato += global.get(\"doblePuls\");\n    dato += \"#\" + global.get(\"Dia\");\n    if (topicNuevo == \"crepMQTT\")dato += \"#\";\n\n//  msg = {topic: \"ESP/living/Iluminacion/Recibo2\", payload: topicNuevo + \"&\" + global.get(\"estadoAlarma\") + \"&\" + global.get(\"Dia\") + \"\\n\" + dato};    node.send([msg, null]);\n    msg = {topic: \"ESP/living/Iluminacion/Recibo\", payload: dato};\n    node.send([msg, null]);     \n}","outputs":2,"noerr":0,"x":605.9524154663086,"y":303.78568840026855,"wires":[["9059c158.93b98","c2a0d286.2ba8f","fdb236.1e712dc8"],["4dc0dae4.50ccb4","d6c2fdea.31e4e","57650f5c.b4ca7"]]},{"id":"929f47d2.7de2f8","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"Blynk/actualizar/estado","qos":"2","broker":"c339edbf.39572","x":1264.0243225097656,"y":456.452394757952,"wires":[["29c9ac88.41f9b4","37d15e3c.0a1382","389a6415.87bb6c"]]},{"id":"ec2023ef.f347f","type":"blynk-ws-out-set-property","z":"3ce5b54a.127d6a","name":"","pin":0,"pinmode":"1","prop":"bycode","client":"2c18e412.5f5cbc","x":930,"y":220,"wires":[]},{"id":"ba4a1cc3.21282","type":"inject","z":"a89e305a.c50bb","name":"","topic":"Pedido/Living/Iluminacion","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":360,"y":50,"wires":[["cce091cd.a69e5"]]},{"id":"e7016801.01fa68","type":"blynk-ws-out-write","z":"50119c6e.6ff584","name":"","pin":"21","pinmode":0,"client":"2c18e412.5f5cbc","x":730,"y":360,"wires":[]},{"id":"eaaae07.822762","type":"debug","z":"e364a467.07a6a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":625.6467971801758,"y":264.6666895747185,"wires":[]},{"id":"afe4dc5b.fc5bd","type":"delay","z":"3ce5b54a.127d6a","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1878.1667404174805,"y":183.64285346439908,"wires":[["c6c1ec1b.22ba2"]]},{"id":"8bd456c6.07d1e8","type":"delay","z":"a89e305a.c50bb","name":"","pauseType":"delay","timeout":"20","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":350,"y":170,"wires":[["cce091cd.a69e5"]]},{"id":"e2e5e6f6.429198","type":"inject","z":"e364a467.07a6a8","name":"","topic":"prueba","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":207.44440841674805,"y":398.42859172821045,"wires":[["458559fe.24ae48"]]},{"id":"f9541629.663dc8","type":"blynk-ws-in-write","z":"a89e305a.c50bb","name":"","pin":"29","pin_all":false,"client":"2c18e412.5f5cbc","x":320,"y":410,"wires":[["cce091cd.a69e5"]]},{"id":"3b30e656.644aca","type":"function","z":"f682d492.22a758","name":"","func":"msg.payload = \"{\\\"topic\\\":\\\"corrMinima\\\",\\\"payload\\\":\" + global.get(\"corrMinimaBaterias\") + \"}\";\nnode.send(msg);\n","outputs":1,"noerr":0,"x":390,"y":320,"wires":[["c6ce670d.77b0d8"]]},{"id":"8f7d1150.7be34","type":"file in","z":"e6e33852.2495f8","name":"lectura archivo","filename":"/home/gaston/BackUp-Node-Red/FastNet.txt","format":"utf8","chunk":false,"sendError":false,"x":391.88888931274414,"y":472.33331298828125,"wires":[["9dc175d5.17a7e8","c3f2f383.ad5a7"]]},{"id":"312bb425.81a66c","type":"blynk-ws-out-set-property","z":"3ce5b54a.127d6a","name":"","pin":0,"pinmode":"1","prop":"bycode","client":"2c18e412.5f5cbc","x":1887.951431274414,"y":892.0714795248849,"wires":[]},{"id":"a295c51.e493e38","type":"file","z":"f682d492.22a758","name":"","filename":"","appendNewline":false,"createDir":true,"overwriteFile":"true","x":743.5000915527344,"y":58,"wires":[[]]},{"id":"1232267d.1dfd9a","type":"debug","z":"3ce5b54a.127d6a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":720,"y":250,"wires":[]},{"id":"bea906dd.514758","type":"mqtt out","z":"3ce5b54a.127d6a","name":"","topic":"","qos":"","retain":"","broker":"c339edbf.39572","x":720,"y":130,"wires":[]},{"id":"300d9a91.71b0b6","type":"inject","z":"7ac92c99.66ea94","name":"","topic":"","payload":" gris muy oscuro","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":254.08337783813477,"y":464.07144594192505,"wires":[["b8f71abc.973838"]]},{"id":"adcdcc.ef00c238","type":"inject","z":"f682d492.22a758","name":"","topic":"","payload":"restarted","payloadType":"str","repeat":"","crontab":"","once":true,"x":153,"y":66,"wires":[["8f356ea8.5ecc6","ae138e5d.50e71"]]},{"id":"540adc68.85f1a4","type":"thingspeak42","z":"1b403a13.0ec8c6","name":"4EICHLJL446HHU1Z","delay":"15","topic1":"temperaturaTermo","topic2":"temperaturaExterior","topic3":"crepuscular","topic4":"estBomba","topic5":"tiempoLlenado","topic6":"estResistencia","topic7":"tiempoEncResis","topic8":"potResistencia","endpoint":"https://thingspeak.com","x":730,"y":150,"wires":[]},{"id":"43459861.0f6aa8","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"Actualizacion/Baterias","qos":"2","broker":"c339edbf.39572","x":2363.594997406006,"y":324.0238041196553,"wires":[["8ac2932b.0cf64","13d24f97.6f3b5","bbcc7f70.46ebd","d9044cfd.00888","a912aad4.45fd28","c78fc939.967d08","f05099a2.864658","7e2dc0ad.e7129","86b7f194.f79ea","e1c6ae7.a9dd95","6b8f267f.3678e8","7bb3c4b2.0914ac","7eab163e.6214c8"]]},{"id":"ae746686.8cad28","type":"function","z":"3ce5b54a.127d6a","name":"toldoBlynk","func":"msg = {topic: \"toldoBlynk\", payload: parseInt(msg.payload)};\nreturn msg;","outputs":1,"noerr":0,"x":1466.428554534912,"y":200.95246124267578,"wires":[[]]},{"id":"f1697d45.0cc3b","type":"function","z":"3ce5b54a.127d6a","name":"Baterias y Crep","func":"\tcontext.pruebas = context.pruebas || 0;\n\tvar haciendoPruebas;\n// \tvar offsetCorriente = 0.6;\n\n\tvar frecuenciaDatos = 5;\n\tvar vEmergMax = 17;\n\tvar vEmergMin = 9.6;\n\t// {\"topic\":\"Baterias/Est/Pedido/Resp\",\"bat1\":-127.00,\"bat2\":-127.00,\"bat3\":-127.00,\"bat4\":-127.00,\"bat5\":38.50,\"ambBat\":38.92,\"nivTanque\":0,\"volt\":3.72}\n\t//{\"topic\":\"Crep\",\"payload\":1}.\n\t//{\"topic\":\"Alarma/Disparo\",\"payload\":0}\n\t//{\"topic\":\"{\"topic\":\"Baterias/Est/Pedido/Resp\",\"bat1\":-127.00,\"bat2\":-127.00,\"bat3\":-127.00,\"bat4\":-127.00,\"bat5\":38.50,\"ambBat\":38.92,\"nivTanque\":0,\"volt\":3.72}\n\t//{\"topic\":\"Crep\",\"payload\":1}.\n\t//{\"topic\":\"Alarma/Disparo\",\"payload\":0}\n\t//{\"topic\":\"Toldo\",\"payload\":0}\n\t//{\"topic\":\"Alarma/Activacion\",\"payload\":1}\n\t// salida 1 serial\n\t// salida 2 blynk  pin = 0 notificaciones  --  pin 1= led alarma  --  pin2= boton alarma  --  pin3= linea 1 LCD -- pin4= linea 2 LCD\n\t// salida 3 mysql\n\tvar dato = JSON.parse(msg.payload);\n\tcontext.inicioCrep = context.inicioCrep || 0;\n\tcontext.inicioCargador = context.inicioCargador || 0;\n\n\tvar difTempEmergencia = 25;\n\tvar avisoBat = [];\n\tvar date = new Date();\n\tvar hh = date.getHours(); \n\tvar mm = date.getMinutes(); \n\tvar ss = date.getSeconds(); \n\tvar dia = date.getDate(); \n\tvar mes = date.getMonth()+1; global.set(\"mes\", mes);\n\tvar ano = date.getFullYear();\n\tglobal.set(\"fechaDia\", date.getDay());\n\n\tif (hh < 10)(hh = \"0\" + hh); if (mm < 10)(mm = \"0\" + mm); if (ss < 10)(ss = \"0\" + ss);\n\tglobal.set(\"hh\", hh); global.set(\"mm\", mm); global.set(\"ss\", ss);\n\n\tglobal.set(\"fechaCompleta\", hh + \":\" + mm + \":\" + ss + \" - \" + dia + \"/\" + mes + \"/\" + ano);\n\tcontext.hsAnterior = context.hsAnterior || 0;\n\tcontext.enviado = context.enviado || 0;\n\n\tcontext.Voltaje = context.Voltaje || null;\n\tcontext.Bat1 = context.Bat1 || null;\n\tcontext.Bat2 = context.Bat2 || null;\n\tcontext.Bat3 = context.Bat3 || null;\n\tcontext.Bat4 = context.Bat4 || null;\n\tcontext.Bat5 = context.Bat5 || null;\n\tcontext.Bat6 = context.Bat6 || null;\n\tcontext.tempAmbienteBat = context.tempAmbienteBat || null;\n\tcontext.nivelTanque = context.nivelTanque || null;\n\tcontext.contador = context.contador ||0;\n\tcontext.avisoMail = context.avisoMail ||0;\n\tcontext.avisoTanque = context.avisoTanque ||0;\n\tcontext.minAnt = context.minAnt || 0;\n\tcontext.mesAnt = context.mesAnt || mes - 1;\n\tcontext.diaAnt = context.diaAnt || dia;\n\tcontext.estadoCargador = context.estadoCargador || 0;\n\tcontext.cargarToldo = context.cargarToldo || 0;\n\tcontext.tiempoCarga = context.tiempoCarga || 0;\n\n\tvar dateCel = new Date(date.getTime() + 960000); \n\tvar hhCel = dateCel.getHours(); \n\tvar mmCel = dateCel.getMinutes();\n\tvar ssCel = dateCel.getSeconds();\n\n\tglobal.set(\"hsCpu\", hh + \":\" + mm + \":\" + ss);\n\tif (hhCel < 10)(hhCel = \"0\" + hhCel); if (mmCel < 10)(mmCel = \"0\" + mmCel); if (ssCel < 10)(ssCel = \"0\" + ssCel);\n\tglobal.set(\"hsCel\", hhCel + \":\" + mmCel + \":\" + ssCel);\n\n\tvar tiempo = mm % frecuenciaDatos;\n\tnode.status({text: hh + \":\" + mm + \":\" + ss + \"   \"  + hhCel + \":\" + mmCel + \":\" + ss + \" || \" + context.mesAnt  + \" || \" + mes  + \" || \" +  context.avisoMail});\n\n\tif (dato.topic === \"Alarma\"){\n\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"Alarma\\\",\\\"payload\\\":\" + dato.payload + \"\\\"}\"}; \n\t\tnode.send([msg, null, null, null])}\n\n\tif (msg.topic === \"mandarMail\")mandarBackUpMail();\n\n\tif (ss === 2){\n\t\tif (context.mesAnt !== mes && hh === 0 && mm === 0  && context.avisoMail === 0){mandarBackUpMail(); context.mesAnt = mes;}\n\t}else{context.avisoMail = 0;}\n\n\n\t// if (parseInt(ss) === 0){\n\t// \t// msg = {pin: 6, payload: global.get(\"hsCel\")}; node.send(msg);\n\t// \t// global.set(\"hsGlobal\", hh + \":\" + mm);\n\t// \t// if (context.minAnt !== mm){\n\t// \t// \tcontext.minAnt = mm;\n\t// \t// \tmsg = {topic: \"Blynk/actualizar/estado\", payload: 1}; \n\t// \t// \tactualizarEstado();\n\t// \t// }\tavio\n\t// \tif (parseInt(tiempo) === 0 && context.enviado === 0){\n\t// \t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"Baterias/Est/Pedido\\\",\\\"payload\\\":1}\"}; \n\t// \t\tnode.send([msg, null, null, null]); \n\t// \t\tcontext.enviado = 1;}\n\t// \t\t// return;}\n\t// }\n\t// else{\n\t// \tcontext.enviado = 0;\n\t// }\n\n\t// if (msg.topic === \"consultaCrep\"){msg = {topic : \"SELECT * FROM crepuscular ORDER BY hora Asc\"}; return ([null, null, msg, null]);}\n\t// if (msg.topic === \"borrarCrep\"){msg = {topic : \"DELETE FROM `crepuscular` WHERE 1\"}; return ([null, null, msg, null]);}\n\n\tif (msg.topic === \"alarmaBlynk\"){\n\t\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"Alarma\\\",\\\"payload\\\":\" + msg.payload + \"}\"};\n\t\tnode.send([msg, null, null, null]);\n\t}\n\n\tif (dato.topic === \"Baterias/Est/Pedido/Resp\"){\n\t\tcontext.contador++;\t\n\t\tglobal.set(\"tempBat1\", dato.bat1.toFixed(1)); context.Bat1 += dato.bat1; if (global.get(\"tempBat1\") > difTempEmergencia + dato.tempAmb){avisoBat[1] = 1; avisoBaterias(1);}\n\t\tglobal.set(\"tempBat2\", dato.bat2.toFixed(1)); context.Bat2 += dato.bat2; if (global.get(\"tempBat2\") > difTempEmergencia + dato.tempAmb){avisoBat[2] = 1; avisoBaterias(2);}\n\t\t// global.set(\"tempBat3\", dato.bat3.toFixed(1)); context.Bat3 += dato.bat3; if (global.get(\"tempBat3\") > difTempEmergencia + dato.tempAmb){avisoBat[3] = 1; avisoBaterias(3);}\n\t\t// global.set(\"tempBat4\", dato.bat4.toFixed(1)); context.Bat4 += dato.bat4; if (global.get(\"tempBat4\") > difTempEmergencia + dato.tempAmb){avisoBat[4] = 1; avisoBaterias(4);}\n\t\t// global.set(\"tempBat5\", dato.bat5.toFixed(1)); context.Bat5 += dato.bat5; if (global.get(\"tempBat5\") > difTempEmergencia + dato.tempAmb){avisoBat[5] = 1; avisoBaterias(5);}\n\t\tglobal.set(\"tempAmbienteBat\", dato.ambBat.toFixed(1)); context.tempAmbienteBat += dato.ambBat; \n\t\tnode.status({text: global.get(\"tempAmbienteBat\")});\n\t\t// global.set(\"voltajeBaterias\", dato.volt.toFixed(2)); context.Voltaje += dato.volt;// controlarVoltaje(global.get(\"voltajeBaterias\")); \n\t\t// var corrienteCarga = parseFloat(dato.corriente) - offsetCorriente;\n\t\t// global.set(\"corrienteCarga\", corrienteCarga.toFixed(2));\n\n\t\t// if (global.get(\"voltajeBaterias\") > vEmergMax) {avisoBat[6] = 1; avisoBaterias(6);}\t\n\t\t// if (global.get(\"voltajeBaterias\") < vEmergMin) { avisoBat[6] = 1; avisoBaterias(6);}\n\t\tactualizarEstado();\n\t\t// mostrarLcd();\n\n\t\tif (context.contador === 6){\n\t\t\tvar mysql = \"INSERT INTO \\`Baterias\\`(\\`Fecha\\`, \\`Voltaje\\`, \\`tempBat1\\`, \\`tempBat2\\`, \\`tempBat3\\`, \\`tempBat4\\`, \\`tempBat5\\`, \\`tempBat6\\`, \\`tempAmbienteBaterias\\`)\"; \n\t\t\tmysql += \"VALUES (now() ,\" + context.Voltaje / context.contador + \",\" + context.Bat1 / context.contador + \",\" + context.Bat2 / context.contador + \",\";\n\t\t\tmysql += context.Bat3 / context.contador + \",\" + context.Bat4 / context.contador + \",\";\n\t\t\tmysql += context.Bat5 / context.contador + \", \" + context.Bat6 / context.contador + \", \";\n\t\t\tmysql += context.tempAmbienteBat / context.contador + \")\";\n\t\t\tmsg.topic = mysql;\n\t\t\tnode.send([ null, null, msg, null]);\n\t\t\tcontext.Voltaje = 0; context.Bat1 = 0; context.Bat2 = 0; context.Bat3 = 0; context.Bat4 = 0; context.Bat5 = 0;\n\t\t\tcontext.tempAmbienteBat = 0; context.nivTanque = 0; context.contador = 0;\n\t\t}\n\t\tmsg = {topic: \"Actualizacion/Baterias\", payload:\"\"}; node.send([msg, null, null, null]);\n\t}\n\n\tif (dato.topic === \"Cargador\"){\n\t\tglobal.set(\"estadoCargador\", dato.payload);\n\t\tglobal.set(\"voltajeBaterias\", dato.volt);\n\t\tvar corrienteCarga = parseFloat(dato.corriente);\n\t\tglobal.set(\"corrienteCarga\", corrienteCarga);\n\n\t\tif (global.get(\"voltajeBaterias\") > vEmergMax) {avisoBat[6] = 1; avisoBaterias(6);}\t\n\t\tif (global.get(\"voltajeBaterias\") < vEmergMin) { avisoBat[6] = 1; avisoBaterias(6);}\t\n\t\t\n\t\tif (parseInt(dato.payload) === 1 && context.estadoCargador === 0) {\n\t\t\tcontext.estadoCargador = 1;\n\t\t\tvar date1 = new Date(date.getTime() - context.tiempoCarga); \n\t\t\tglobal.set(\"tiempoEspera\", (date.getTime() - context.tiempoCarga)/(60*1000));\n\t\t\tmsg = {topic: \"\", payload: \"tiempo espera: \" + global.get(\"tiempoEspera\")}; node.send(msg);\n\t\t\t// if (context.inicioCargador === 1)global.set(\"tiempoEspera\", (date.getTime() - context.tiempoCarga)/(60*1000));\n\t\t\t// if (context.inicioCargador === 0)context.inicioCargador = 1;\n\n\t\t\tvar minCarg = date1.getMinutes(); var segCarg = date1.getSeconds();\n\t\t\tif (minCarg < 10)(minCarg = \"0\" + minCarg); if (segCarg < 10)(segCarg = \"0\" + segCarg);\n\t\t\tvar mostrarTiempoCarga = minCarg + \":\" + segCarg;\t\n\t\t\tcontext.tiempoCarga = date.getTime();\n\n\t\t\tmsg = {topic: \"estadoFallas\", payload: 1}; node.send(msg);\n\t\t\t// msg = {topic: \"notifyBlynk\", payload: \"Iniciando carga baterias (tiempo espera= \" + mostrarTiempoCarga + \")\"}; node.send(msg); \n\n\t\t\tglobal.set(\"estadocargadorTexto\", \"cargando desde \" + dia + \"/\" + (mes+1) + \"/\" + ano + \" \" + hh + \":\" + mm + \":\" + ss);}\n\n\t\tif (parseInt(dato.payload) === 0 && context.estadoCargador === 1) {\n\t\t\tcontext.estadoCargador = 0;\n\t\t\tvar date1 = new Date(date.getTime() - context.tiempoCarga); \n\t\t\tglobal.set(\"tiempoCargando\", (date.getTime() - context.tiempoCarga)/(60*1000));\n\t\t\tmsg = {topic: \"\", payload: \"tiempo cargand: \" + global.get(\"tiempoCargando\")}; node.send(msg);\n\t\t\t\n\t\t\t// if (context.inicioCargador === 1)global.set(\"tiempoCargando\", (date.getTime() - context.tiempoCarga)/(60*1000));\n\t\t\t// if (context.inicioCargador === 0)context.inicioCargador = 1;\n\n\t\t\tvar minCarg = date1.getMinutes(); var segCarg = date1.getSeconds();\n\t\t\tif (minCarg < 10)(minCarg = \"0\" + minCarg); if (segCarg < 10)(segCarg = \"0\" + segCarg);\n\t\t\tvar mostrarTiempoCarga = minCarg + \":\" + segCarg;\t\n\t\t\tcontext.tiempoCarga = date.getTime();\n\t\t\tmsg = {topic: \"estadoFallas\", payload: 1}; node.send(msg);\n\t\t\t// msg = {topic: \"notifyBlynk\", payload: \"Terminando carga baterias (tiempo cargando= \" + mostrarTiempoCarga + \")\"}; node.send(msg);\n\n\t\t\tglobal.set(\"estadocargadorTexto\", \"OK desde \" + dia + \"/\" + (mes+1) + \"/\" + ano + \" \" + hh + \":\" + mm + \":\" + ss);\n\t\t}\n\t\tmsg = {topic: \"Blynk/actualizar/estado\", payload: \"\"}; node.send([msg, null, null, null, null]);\n\t}\n\n\tfunction avisoBaterias(numBat){\n\t\tif (numBat > 0 && numBat <= 5){\n\t\t\tmsg = {topic: \"notifyBlynk\", payload: \"Atencion baterias numero: \" + numBat + \" sobrecalentada\"};//, pin: 0};\n\t\t\tnode.send([msg, null, null, null]);\n\t\t}\n\t\tif (numBat === 6){\n\t\t\tmsg = {topic: \"notifyBlynk\", payload: \"Atencion voltaje de baterias fuera de rango, voltaje: \" + dato.volt + \"V\"};//, pin: 0};\n\t\t\tnode.send([msg, null, null, null]);\n\t\t}\n\t}\n\n\tfunction mandarBackUpMail(){\n\t\tvar nombre = mes + \"_\" + ano;\n\t\tvar directorio = \"/home/gaston/BackUp-Node-Red/\";\n\t\tmsg = {topic : \"SELECT * FROM crepuscular ORDER BY hora Asc\"};\n\t\tnode.send([null, null, msg, null]);\n\t\tmsg = {topic : \"SELECT \\\"hora\\\", \\\"valor\\\" UNION  SELECT \\`hora\\`, \\`valor\\` INTO OUTFILE \\'\" + directorio + nombre + \".csv\\' FIELDS TERMINATED BY \\';\\' OPTIONALLY ENCLOSED BY '\\\"' LINES TERMINATED BY '\\r\\n' FROM \\`crepuscular\\`\"};\n\t\tnode.send([null, null, msg, null]);\n\t\tmsg = {topic : \"DELETE FROM \\`crepuscular\\` WHERE 1\"};\n\t\tnode.send([null, null, msg, null]);\n\n\t\tmsg.topic = \"BackUp crepuscular\";\n\t\tmsg.payload = \"BackUp crepuscular\";\n\t\tmsg.attachments = [{\n\t\t    filename: nombre + '.csv',\n\t\t    path: directorio + nombre + '.csv',\n\t\t    content: msg.payload\n\t\t}];\n\t\tnode.send([null, null, null, msg]);\n\t\tcontext.avisoMail = 1;\n\t}\n\n\tfunction actualizarEstado(){\n\t\tif (global.get(\"estadoToldo\") !== \"Abriendo\" && global.get(\"estadoToldo\") !== \"Cerrando\"){\n\t\t\tmsg = {topic: \"Blynk/actualizar/estado\", payload: 1};\n\t\t\tnode.send([msg, null, null, null, null]);}\t\n\t}\n\t//Serial.println(alturaTanque - valorAcumulado);\n\t// alturaAgua = alturaAgua + (alturaTanque - valorAcumulado);//Serial.println(alturaTanque - valorAcumulado);","outputs":4,"noerr":0,"x":480,"y":230,"wires":[["bea906dd.514758","283c31f.9655ece"],["cfe7da5b.0b0058","ec2023ef.f347f","4a51d0e8.24515"],[],["2428a89d.746c48","1232267d.1dfd9a"]]},{"id":"389a6415.87bb6c","type":"debug","z":"3ce5b54a.127d6a","name":"salida2 lcd blynk","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1571.809455871582,"y":491.3929204940796,"wires":[]},{"id":"7bb3c4b2.0914ac","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg = {topic: \"nivTanque\", payload: global.get(\"nivTanque\")}; node.send(msg);\nreturn;","outputs":1,"noerr":0,"x":2581.1310119628906,"y":137.035699571882,"wires":[["13adbc11.4ab694"]]},{"id":"355077e0.49f888","type":"blynk-ws-out-write","z":"50119c6e.6ff584","name":"","pin":"26","pinmode":"1","client":"2c18e412.5f5cbc","x":742.2222099304199,"y":483.3333339691162,"wires":[]},{"id":"a1d62969.c9d1f8","type":"blynk-ws-in-write","z":"a89e305a.c50bb","name":"","pin":"17","pin_all":false,"client":"2c18e412.5f5cbc","x":320,"y":370,"wires":[["cce091cd.a69e5"]]},{"id":"f05099a2.864658","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg = {topic: \"tempBat6\", payload: global.get(\"tempBat6\")}; node.send(msg);\n","outputs":1,"noerr":0,"x":2592.166603088379,"y":428.30952807835183,"wires":[[]]},{"id":"35b5038b.76c79c","type":"ui_chart","z":"3ce5b54a.127d6a","name":"","group":"177e0064.22348","order":8,"width":"16","height":"10","label":"Temperaturas","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"bezier","nodata":"","dot":false,"ymin":"-10","ymax":"30","removeOlder":"3","removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":true,"x":2815.0238723754883,"y":181.16658374241422,"wires":[[],[]]},{"id":"3c0f64c7.dcf05c","type":"function","z":"50119c6e.6ff584","name":"tempExterior","func":"if (global.get(\"tempMaxExtValor\") === undefined)global.set(\"tempMaxExtValor\", -255);\nif (global.get(\"tempMinExtValor\") === undefined)global.set(\"tempMinExtValor\", 255);\nif (global.get(\"tempMaxExtAnt\") === undefined)global.set(\"tempMaxExtAnt\", -255);\nif (global.get(\"tempMinExtAnt\") === undefined)global.set(\"tempMinExtAnt\", 255);\nvar temp;\nvar date = new Date();\nvar dia = date.getDate();\ncontext.temp = context.temp || 0;//hola\ncontext.diaAnt = context.diaAnt || dia - 1;\n\n\nif (context.diaAnt !== dia){\ncontext.diaAnt = dia;\n\tglobal.set(\"tempMaxExtAnt\", global.get(\"tempMaxExt\"));\n\tglobal.set(\"tempMinExtAnt\", global.get(\"tempMinExt\"));\n\tglobal.set(\"tempMinExtValor\", 255);\n\tglobal.set(\"tempMaxExtValor\", -255);\n}\n\n// msg.payload = global.get(\"tempExterior\"); node.send(msg);\n\nvar tempExterior = parseFloat(global.get(\"tempExterior\"));\nvar tempmax = parseFloat(global.get(\"tempMaxExtValor\"));\nvar tempmin = parseFloat(global.get(\"tempMinExtValor\"));\n\n\nif (parseFloat(tempExterior) > parseFloat(tempmax)){\n\tglobal.set(\"tempMaxExt\", parseFloat(tempExterior).toFixed(1) + \" (\" + global.get(\"hsCpu\") + \")\");\n\tglobal.set(\"tempMaxExtValor\", global.get(\"tempExterior\"));\n}\nif (parseFloat(tempExterior) < parseFloat(tempmin)){\n\tglobal.set(\"tempMinExt\", parseFloat(tempExterior).toFixed(1) + \" (\" + global.get(\"hsCpu\") + \")\");\n\tglobal.set(\"tempMinExtValor\", global.get(\"tempExterior\"));\n}\n\nnode.status({text: \"temp: \" + parseFloat(tempExterior).toFixed(1) + \" -- \" + global.get(\"hsCpu\")});\t\nmsg = {topic: \"tempExterior\", payload: parseFloat(tempExterior).toFixed(1)}; \t\nreturn msg;\n\n","outputs":1,"noerr":0,"x":490,"y":200,"wires":[["3fde6b72.65b1a4","55b494c8.fab0dc","ef327ef2.6c0f6"]]},{"id":"1ab89d06.27fd03","type":"inject","z":"7ac92c99.66ea94","name":"","topic":"","payload":"color living gris muy oscuro","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":229.46429824829102,"y":531.0714249610901,"wires":[["b8f71abc.973838"]]},{"id":"426f4797.676a48","type":"inject","z":"e364a467.07a6a8","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":123.6229476928711,"y":342.7024116516113,"wires":[["2d13b22d.35e53e"]]},{"id":"8d26d38b.32374","type":"mqtt in","z":"50119c6e.6ff584","name":"tempExterior","topic":"ESP/TermoSolar/Envio","qos":"2","broker":"e779f8d6.7bc2c8","x":200,"y":220,"wires":[["958c3f89.0f016"]]},{"id":"4bbcff4e.de9ea","type":"blynk-ws-out-write","z":"3ce5b54a.127d6a","name":"","pin":"6","pinmode":0,"client":"2c18e412.5f5cbc","x":1695.9761123657227,"y":577.6429290771484,"wires":[]},{"id":"86b7f194.f79ea","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg = {topic: \"voltajeBaterias\", payload: global.get(\"voltajeBaterias\")}; node.send(msg);","outputs":1,"noerr":0,"x":2597.880958557129,"y":509.73811476571245,"wires":[["2ff411a2.ce3fce"]]},{"id":"c135bb3f.7eae98","type":"function","z":"50119c6e.6ff584","name":"tempPasillo","func":"var temp = parseFloat(msg.payload) + (-1.5);\nglobal.set(\"tempPasillo\", temp.toFixed(1));\nmsg= {topic: \"tempPasillo\", payload: global.get(\"tempPasillo\")}; node.send(msg);\nnode.status({text: \"temp: \" + global.get(\"tempPasillo\") + \" -- \" + global.get(\"hsCpu\")});","outputs":1,"noerr":0,"x":500,"y":420,"wires":[["3fde6b72.65b1a4","8af6ec86.c2889"]]},{"id":"ca93e748.b2afe8","type":"debug","z":"3ce5b54a.127d6a","name":"USB/Alarma","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1660,"y":980,"wires":[]},{"id":"dda6ed4.6b72d1","type":"inject","z":"7ac92c99.66ea94","name":"","topic":"","payload":"activar alarma casa","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":201.94052505493164,"y":93.92860174179077,"wires":[["f80091fc.1ea"]]},{"id":"7b57bbf2.a205a4","type":"inject","z":"7ac92c99.66ea94","name":"alacena","topic":"","payload":"luces del lavadero alacena","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":178.03570556640625,"y":271.6071357727051,"wires":[["e06c23ee.4ad0f"]]},{"id":"e1c6ae7.a9dd95","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg = {topic: \"nivTanque\", payload: global.get(\"nivTanque\")}; node.send(msg);","outputs":1,"noerr":0,"x":2596.4999389648438,"y":562.119038990566,"wires":[["5cfe80d2.17592"]]},{"id":"f682d5fc.df5b28","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"USBin/Toldo","qos":"2","broker":"c339edbf.39572","x":1446.095043182373,"y":160.42863273620605,"wires":[[]]},{"id":"338fa6cc.48bf2a","type":"debug","z":"e364a467.07a6a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":766.6944007873535,"y":428.4285914301872,"wires":[]},{"id":"a5dff34f.89fa6","type":"file","z":"e6e33852.2495f8","name":"borrar archivo","filename":"/home/gaston/BackUp-Node-Red/FastNet.txt","appendNewline":true,"createDir":false,"overwriteFile":"delete","x":359.66665267944336,"y":560.111123085022,"wires":[[]]},{"id":"29c9ac88.41f9b4","type":"function","z":"3ce5b54a.127d6a","name":"LCD Blynk","func":"var velocidadTexto = 191;\nvar velocidadTexto1 = 140;\nvar payload = msg.payload;\nvar largo;\nvar estadoCarg;\nvar cont = -1;\nvar timer1;\nvar timer2;\nvar timer3;\nvar Baterias;\nvar Toldo;\nvar datosTemp;\nvar crepuscular;\nvar tempMaxMinAyer;\nvar tempMaxMinHoy;\n\nif (global.get (\"estadoCargador\") === 1) {estadoCarg = \"V Carg\";} else {estadoCarg = \"V OK\";}\n\nBaterias = global.get(\"estadocargadorTexto\") + \"   Volt=\" + global.get(\"voltajeBaterias\");// + estadoCarg + \" Tanque=\" + global.get(\"nivTanque\") + \"mm\" + \" Temp. Alt=\" + global.get(\"tempAmbienteBat\"); \n// Baterias += \" Bat1=\" + global.get(\"tempBat1\") + \" Bat2=\" + global.get(\"tempBat2\") + \" Bat3=\" + global.get(\"tempBat3\");\n// Baterias +=  \" Bat4=\" + global.get(\"tempBat4\") + \" Bat5=\" + global.get(\"tempBat5\");\n\n\nToldo = \"   \" + global.get(\"estadoToldoLCD\") + \", \" + global.get(\"enfriadorToldo\");// + global.get(\"enfriadorToldo\");\nif (global.get(\"enfriarToldo\") === 1){Toldo = Toldo + \", \" + global.get(\"rociadorToldo\");}\n\ndatosTemp = \"   Living=\" + parseFloat(global.get(\"tempLiving\")).toFixed(1) + \" Hum. Living=\" + parseFloat(global.get(\"humLiving\")).toFixed(1);\ndatosTemp += \"% Pasillo=\" + parseFloat(global.get(\"tempPasillo\")).toFixed(1) + \" PatioLuz=\" + parseFloat(global.get(\"tempPatioLuz\")).toFixed(1);\ndatosTemp += \" Exterior=\" + parseFloat(global.get(\"tempExterior\")).toFixed(1);\ndatosTemp +=\" Lavadero=\" + parseFloat(global.get(\"tempLavadero\")).toFixed(1) + \" Tanque=\" + global.get(\"nivTanque\") + \"mm\";\n\ntempMaxMinAyer = \"   Min ayer \" + global.get(\"tempMinExtAnt\") + \", Max ayer \" + global.get(\"tempMaxExtAnt\");\n \ntempMaxMinHoy =  \"   Min hoy \" + global.get(\"tempMinExt\") + \", Max hoy \" + global.get(\"tempMaxExt\") + \", actual \" + global.get(\"tempExterior\");\n\nif (global.get(\"Dia\") === 0){\n\tcrepuscular = \"   Oscurecio a las \" + global.get(\"hsAnochecer\") +  \", Amanecio a las \" + global.get(\"hsAmanecer\") + \", sensorCrep \" + global.get(\"sensorCrep\");}\n\telse{\n\tcrepuscular = \"   Amanecio a las \" + global.get(\"hsAmanecer\") + \", Oscurecio a las \" + global.get(\"hsAnochecer\") + \", sensorCrep \" + global.get(\"sensorCrep\");}\n\n\n\nmsg.payload = Baterias; node.send([null,msg]);\nmsg.payload = datosTemp; node.send([null,msg]);\nmsg.payload = Toldo; node.send([null,msg]);\nmsg.payload = crepuscular; node.send([null,msg]);\nmsg.payload = tempMaxMinAyer; node.send([null,msg]);\nmsg.payload = tempMaxMinHoy; node.send([null,msg]);\n\ncontext.mostrando = context.mostrando || 0;\ncontext.pedido = context.pedido || 0;\n\n\n// var largoTemperaturas = Temperaturas.length;\nvar largoBaterias = Baterias.length;\nvar largoToldo = Toldo.length;\nvar largoDatosTemp = datosTemp.length;\nvar largoCrepuscular = crepuscular.length;\nvar largotempMaxMinAyer = tempMaxMinAyer.length;\nvar largotempMaxMinHoy = tempMaxMinHoy.length;\n// node.status({text: context.mostrando});\nif (context.mostrando === 1)return;\n\n// if (msg.topic === \"pedidoActualizacion\")payload = context.pedido;\n\nif (msg.topic === \"Blynk/actualizar/estado\")actualizarEstado();\nif (global.get(\"estadoToldo\") !== \"Abriendo\" || global.get(\"estadoToldo\") !== \"Cerrando\"){\n\tif (payload === \"2\") velocidadTexto = velocidadTexto1;\n\tif (msg.topic === \"Blynk/actualizar/infos\"){\n\t\tpayload = context.pedido; \n\t\t// if (payload === \"1\") velocidadTexto = 190;\n\t\ttimer1 = setInterval(infoCompleta, velocidadTexto1);}\n\t\t\t\t\t//timer2 = setInterval(mostrarDatosTemp, velocidadTexto2);\n\tif (msg.topic === \"Blynk/mostrar/infos\")timer1 = setInterval(infoCompleta, velocidadTexto);\n\t// if (msg.topic === \"Blynk\")var timer1 = setInterval(datosTemp, velocidadTexto2);\n}\n\nreturn;\nfunction infoCompleta(){\n\tcontext.mostrando = 1;\n\tcont++;\n\tswitch (parseInt(payload)){\n\t\tcase 1:\n\t\t\tcontext.pedido = \"1\";\n\t\t\tlargo = largoDatosTemp;\n\t\t\tmsg = {pin: 4, payload: \" Temp Ambientes \"}; node.send(msg);\n\t\t\tif (cont < largoDatosTemp-15){msg = {pin: 5, payload: datosTemp.substring(cont)}; node.send(msg);}\n\t\tbreak;\n\n\t\tcase 2:\n\t\t\tcontext.pedido = \"2\";\n\t\t\tlargo = largoBaterias;\n\t\t\tmsg = {pin: 4, payload: \"Info de Baterias\"}; node.send(msg);\n\t\t\tif (cont < largoBaterias-15){msg = {pin: 5, payload: Baterias.substring(cont)}; node.send(msg);}\n\t\tbreak;\n\n\t\tcase 3:\n\t\t\tcontext.pedido = \"3\";\n\t\t\tlargo = largoToldo;\n\t\t\tmsg = {pin: 4, payload: \" Info del Toldo \"}; node.send(msg);\n\t\t\tif (cont < largoToldo-15){msg = {pin: 5, payload: Toldo.substring(cont)}; node.send(msg);}\n\t\tbreak;\n\t\tcase 4:\n\t\t\tcontext.pedido = \"4\";\n\t\t\tlargo = largoCrepuscular;\n\t\t\tmsg = {pin: 4, payload: \"Info crepuscular\"}; node.send(msg);\n\t\t\tif (cont < largoCrepuscular-15){msg = {pin: 5, payload: crepuscular.substring(cont)}; node.send(msg);}\n\t\tbreak;\t\n\t\tcase 5:\n\t\t\tcontext.pedido = \"5\";\n\t\t\tlargo = largotempMaxMinAyer;\n\t\t\tmsg = {pin: 4, payload: \"  Temp Max/Min  \"}; node.send(msg);\n\t\t\tif (cont < largotempMaxMinAyer-15){msg = {pin: 5, payload: tempMaxMinAyer.substring(cont)}; node.send(msg);}\n\t\tbreak;\n\t\tcase 6:\n\t\t\tcontext.pedido = \"6\";\n\t\t\tlargo = largotempMaxMinHoy;\n\t\t\tmsg = {pin: 4, payload: \"  Temp Max/Min  \"}; node.send(msg);\n\t\t\tif (cont < largotempMaxMinHoy-15){msg = {pin: 5, payload: tempMaxMinHoy.substring(cont)}; node.send(msg);}\n\t\tbreak;\t\t\n\t}\n\tif (cont > largo-16){clearInterval(timer1); timer3 = setInterval(pantallaPrincipal, 1000);}\n}\n\n// function mostrarDatosTemp(){\n// \tcontext.mostrando = 1;\n// \t// cont++;\n// \tlargo = largoDatosTemp;\n// \tmsg = {pin: 4, payload: \" Temp Ambientes \"}; node.send(msg);\n// \tif (cont < largoDatosTemp-15){msg = {pin: 5, payload: datosTemp.substring(cont)}; node.send(msg);}\n// \tif (cont > largo-16){clearInterval(timer2); timer3 = setInterval(pantallaPrincipal, 1000);}\n// }\n\nfunction pantallaPrincipal(){\n\tcontext.mostrando = 0;\n\tactualizarEstado();\n\tclearInterval(timer3);\t\t\n}\n\nfunction actualizarEstado(){\n\tnode.status({text: global.get(\"hsCel\")}); \n\t// msg = {pin: 6, payload: global.get(\"hsCel\")}; node.send(msg);\n\tif (global.get(\"estadoToldo\") !== \"Abriendo\" || global.get(\"estadoToldo\") !== \"Cerrando\"){\n\t\tif (global.get(\"estadoCargador\") == \"1\"){msg = {pin: 15, label: \"Estado Baterias: Cargando\", color: \"#fcaf17\", payload: parseFloat(global.get(\"voltajeBaterias\")).toFixed(2) + \"v  \" + global.get(\"corrienteCarga\") + \"A  \" + parseFloat((global.get(\"voltajeBaterias\") * global.get(\"corrienteCarga\"))/1000).toFixed(2) + \"Kw\"}; node.send(msg);}\n\t\tif (global.get(\"estadoCargador\") == \"0\"){msg = {pin: 15, label: \"Estado Baterias: Cargada\", color: \"#23C48E\", payload: parseFloat(global.get(\"voltajeBaterias\")).toFixed(2) + \"v    \" + global.get(\"corrienteCarga\") + \"A\"}; node.send(msg);}\t\t\n\t\tmsg = {pin: 4, payload: \"Temp= \" + global.get(\"tempExterior\")}; node.send(msg);\n\t\tmsg = {pin: 5, payload: \"Tq= \" + global.get(\"nivTanque\") + \"mm T=\" + global.get(\"tempPatioLuz\")}; node.send(msg);\n\t}\nreturn;}\n\n\n//temp= 21.5  ll55\n//Mi=10.5  Ma=21.5\n//Act=15.2 Tq=365mm","outputs":2,"noerr":0,"x":1715.5752067565918,"y":636.3690500259399,"wires":[["955a8862.016a38","e4bbd9b5.cf9f18","29b9e573.32e7ca"],["288336d4.991aaa"]]},{"id":"34ae7c41.536534","type":"function","z":"1b403a13.0ec8c6","name":"","func":"// Sal1  thingspeak\n// Sal2  mqtt\n// Sal3  blynk\n// Sal4  mysql\n\ncontext.llenandoTermo = context.llenandoTermo || 0;\ncontext.encendidoResistencia = context.encendidoResistencia || 0;\ncontext.estAnteriorResistencia = context.estAnteriorResistencia || 0;\ncontext.tiempoInicioResistencia = context.tiempoInicioResistencia || 0;\n\nvar topic = msg.topic;\nvar payload = msg.payload;\nvar comienzoLlenado;\nvar terminoLlenado;\nvar valorDia = global.get(\"valorDia\");\nvar valorNoche = global.get(\"valorNoche\");\nvar pin = parseInt(msg.pin);\n\n\nif (topic == \"timer\"){\n if (parseInt(global.get(\"hh\")) === 22 && parseInt(global.get(\"mm\")) === 0 && parseInt(global.get(\"autoBomba\")) === 1 && parseInt(global.get(\"estBomba\")) === 0){\n   msg = {pin: 127, payload: global.get(\"hsCpu\") + \", paso a manual bomba termo \\n\"}; node.send([null, null, msg]);\n   global.set(\"autoBomba\", 0);\n   global.set(\"pedBomba\", 0);\n   enviarBlynk();\n   enviarMQTT();\n }\n\n if (parseInt(global.get(\"hh\")) === 9 && parseInt(global.get(\"mm\")) === 0 && parseInt(global.get(\"autoBomba\")) === 0){\n  msg = {pin: 127, payload: global.get(\"hsCpu\") + \", paso a automatico bomba termo por hora \\n\"}; node.send([null, null, msg]);\n  global.set(\"autoBomba\", 1); \n  // msg = {pin: 102, payload: global.get(\"autoBomba\")}; node.send([null, null, msg, null]);\n  enviarBlynk();\n  enviarMQTT();\n } \n // return;\n}\n\nswitch (pin){\n  case 101:\n    if (parseInt(payload) === 0)global.set(\"pedBomba\", 0); \n    global.set(\"autoBomba\", payload); \n    enviarMQTT();\n  break;\n\n  case 102:\n    if (parseInt(global.get(\"autoBomba\")) === 0){\n      global.set(\"pedBomba\", payload); \n      enviarMQTT();\n    }\n  break;\n\n  case 103:\n    if (parseInt(payload) === 0)global.set(\"pedResistencia\", 0);\n    global.set(\"autoResistencia\", payload); \n    enviarMQTT();\n  break;\n  case 104:\n    if (parseInt(global.get(\"autoResistencia\")) === 0){\n        global.set(\"pedResistencia\", payload); \n        enviarMQTT();}\n  break;\n}\n\nif (topic == \"ESP/TermoSolar/Envio\"){\n  //0#0#0#15.55#25.55#1020\n  var dato = payload.split(\"#\");\n  global.set(\"estBomba\", parseInt(dato[0])); \n  global.set(\"estResistencia\", parseInt(dato[1])); \n  global.set(\"estToldo\", parseInt(dato[2]));  \n  global.set(\"tempTermoFin\", dato[3]); \n  global.set(\"tempExterior\", dato[4]); \n  global.set(\"sensorCrep\", parseInt(dato[5])); \n\n  msg= {topic: \"temperaturaTermo\", payload: global.get(\"tempTermoFin\")}; node.send([msg, null, null]);\n  msg= {topic: \"crepuscular\", payload: global.get(\"sensorCrep\")}; node.send([msg, null, null]);\n  msg= {topic: \"temperaturaExterior\", payload: global.get(\"tempExterior\")}; node.send([msg, null, null]);\n\n  if(global.get(\"estResistencia\") === 1){\n      if (context.estAnteriorResistencia === 0){\n      context.encendidoResistencia = 1;\n      context.estAnteriorResistencia = 1;\n      // global.set(\"resistenciaEncendida\", new Date().getTime());\n      context.tiempoInicioResistencia = new Date().getTime();}\n\n      var tiempo = (new Date().getTime() - context.tiempoInicioResistencia) / 60000;\n      var potencia = ((1.5/60) * tiempo).toFixed(5);\n      global.set(\"potenciaResistencia\", potencia);\n  // msg = {topic: \"potResistencia\", payload: global.get(\"potenciaResistencia\")}; node.send([msg, null, null, null]);\n  }\n\n  if (global.get(\"estResistencia\") === 0 && context.encendidoResistencia === 1){\n      context.estAnteriorResistencia = 0;\n      context.encendidoResistencia = 0;\n      var tiempo = (new Date().getTime() - context.tiempoInicioResistencia) / 60000;\n      var potencia = ((1.5/60) * tiempo).toFixed(5);\n      tiempo = parseFloat(tiempo).toFixed(2);\n      global.set(\"tiempoEncResis\", tiempo);\n      global.set(\"potenciaResistencia\", potencia);\n    }\n    enviarBlynk();\n}\n  \n\nif (topic == \"ESP/TermoSolar/EstadoBomba\"){\n  if (payload.substring(0, 11) == \"bombaMarcha\"){\n    global.set(\"estBomba\", parseInt(payload.substring(11)));\n    if (global.get(\"autoBomba\") === 1){estadoBomba = \"Automatico\";}else{estadoBomba = \"Manual\";}\n    msg = {pin: 102, label: estadoBomba, payload: global.get(\"estBomba\")}; node.send([null, null, msg]);\n    controlBomba();\n  }\n}\n\n// var status = new Date().getTime() - global.get(\"comienzoLlenado\")\n// node.status({text: global.get(\"estBomba\") + \" -- \" + status}) ; \n\nif (global.get(\"estBomba\") === 1 && new Date().getTime() - global.get(\"comienzoLlenado\") > 120000){\n  msg = {topic: \"notifyBlynk\", payload: global.get(\"fechaCompleta\") + \" - ERROR bomba termo paso a manual\"}; node.send([null, msg, null]);\n  msg = {topic: \"terminalBlynk\", payload: global.get(\"fechaCompleta\") + \" - ERROR bomba termo paso a manual\"}; node.send([null, msg, null]);\n  global.set(\"autoBomba\", 0);\n  global.set(\"pedBomba\", 0);\n  enviarBlynk();\n  enviarMQTT();\n}\n\nif (topic == \"ESP/TermoSolar/Inicio\"){\n    var fallasLivingIluminacion = global.get(\"fallasLivingIluminacion\") + 1;\n    global.set(\"fallasLivingIluminacion\", fallasLivingIluminacion);\n    global.set(\"tipoFallaIlLiving\", msg.payload); \n    enviarMQTT();}\n\n\n\nfunction controlBomba(){\n  msg = {topic: \"estBomba\", payload: global.get(\"estBomba\")}; node.send([msg, null, null]);\n  if (global.get(\"estBomba\")=== 1 && context.llenandoTermo === 0){\n    context.llenandoTermo = 1;\n    global.set(\"comienzoLlenado\", new Date().getTime());}\n  if (global.get(\"estBomba\") === 0 && context.llenandoTermo === 1){\n    context.llenandoTermo = 0;\n    var tiempo = new Date().getTime() - global.get(\"comienzoLlenado\");\n    tiempo = parseFloat(tiempo / 1000).toFixed(2);\n    global.set(\"tiempoLlenado\", tiempo);\n    msg = {topic: \"tiempoLlenado\", payload: global.get(\"tiempoLlenado\")}; node.send([msg, null, null]);\n    enviarBlynk();\n  } \n}    \n\nfunction enviarBlynk(){\n    msg = {pin: 101, payload: global.get(\"autoBomba\")}; node.send([null, null, msg]);\n    msg = {pin: 102, payload: global.get(\"estBomba\")}; node.send([null, null, msg]);\n    msg = {pin: 104, payload: global.get(\"estResistencia\")}; node.send([null, null, msg]);\n    msg = {pin: 105, payload: global.get(\"tiempoLlenado\")}; node.send([null, null, msg]);\n    msg = {pin: 110, payload: global.get(\"tempTermoFin\") + \"  --  \" + global.get(\"tempExterior\")}; node.send([null, null, msg]);  \n    msg = {pin: 111, payload: global.get(\"sensorCrep\")}; node.send([null, null, msg]);\n    msg = {pin: 112, payload: global.get(\"tempExterior\")}; node.send([null, null, msg]);\n    msg = {pin: 113, payload: global.get(\"tempTermoFin\")}; node.send([null, null, msg]);\n    msg = {pin: 114, payload: global.get(\"tiempoLlenado\")}; node.send([null, null, msg]);\n}\n\nfunction enviarMQTT(){   \n    payload = global.get(\"autoBomba\") + \"#\"; payload += global.get(\"autoResistencia\") + \"#\"; payload += global.get(\"autoToldo\") + \"#\"; \n    payload += global.get(\"pedBomba\") + \"#\"; payload += global.get(\"pedResistencia\") + \"#\"; payload += global.get(\"pedToldo\") + \"#\"; \n    payload += global.get(\"tempMaximaTermo\") + \"#\"; payload += global.get(\"tempMaxResistencia\") + \"#\"; \n    payload += global.get(\"tempMaxResistenciaManual\") + \"#\"; payload += global.get(\"tempMinimaResistencia\") + \"#\";\n    payload += global.get(\"valorDia\")  + \"#\"; payload += global.get(\"valorNoche\") + \"#\" + global.get(\"segundosMarchaBomba\");\n    payload += \"#\" + global.get(\"offsetDia\")  + \"#\"; payload += global.get(\"offsetNoche\");\n    msg.payload = payload;  \n    msg = {topic: \"ESP/TermoSolar/Config\", payload: payload}; node.send([null, msg, null]);\n}","outputs":3,"noerr":0,"x":500,"y":230,"wires":[["43e727a2.f0f9e8","540adc68.85f1a4"],["405016a2.5b5178","2ef0894a.4f29a6"],["fc135b52.7e6988","1dc8024d.34cc0e","924d6af6.9752b8"]]},{"id":"9cbc0b2c.31d848","type":"mqtt in","z":"50119c6e.6ff584","name":"","topic":"ESP/Pasillo/Sens/Temp/Resp","qos":"2","broker":"e779f8d6.7bc2c8","x":260,"y":420,"wires":[["c135bb3f.7eae98"]]},{"id":"5fae0180.0724f","type":"function","z":"f682d492.22a758","name":"","func":"msg.filename = \"/home/gaston/BackUp-Node-Red/flow_cred.json\";\nreturn msg;\n","outputs":1,"noerr":0,"x":593,"y":126,"wires":[["9e25b334.c4563"]]},{"id":"458559fe.24ae48","type":"http request","z":"e364a467.07a6a8","name":"","method":"GET","ret":"txt","url":"https://banco.santanderrio.com.ar/exec/cotizacion/index.jsp","tls":"","x":415.7896270751953,"y":345.66669434309006,"wires":[["eaaae07.822762","ab59ea94.49c4f8","3512364.5d54eca","57099265.b5d4fc"]]},{"id":"482b7a57.e2a944","type":"blynk-ws-out-set-property","z":"3ce5b54a.127d6a","name":"","pin":0,"pinmode":"1","prop":"bycode","client":"2c18e412.5f5cbc","x":1927.4522857666016,"y":137.64284678867887,"wires":[]},{"id":"ade9be8d.171c7","type":"http in","z":"7ac92c99.66ea94","name":"Request","url":"/activar","method":"post","upload":false,"swaggerDoc":"","x":191.94052505493164,"y":128.59526586532593,"wires":[["f80091fc.1ea"]]},{"id":"8f6bdb58.8e4158","type":"function","z":"e6e33852.2495f8","name":"","func":"var payload = msg.payload;\nvar resultado;\ncontext.descarga = context.descarga || 0;\ncontext.subida = context.subida || 0;\n\nif(payload == \".\")payload = \"Realizando medicion\";\nnode.status({text: \"Estado actual: \" + msg.payload});\nif (payload.includes(\"Download\")){\n    context.descarga = parseFloat(payload.substring(payload.indexOf(\"Download: \")+10, payload.indexOf(\"Mbit/s\")));\n    // msg = {topic: \"DescargaFast\", payload: context.descarga}; node.send([null, null, msg, null]);\n    // node.status({text: resultado});\n    }\n\nif (payload.includes(\"Upload\")){\n    context.subida = parseFloat(payload.substring(payload.indexOf(\"Upload: \")+8, payload.indexOf(\"Mbit/s\")));\n    // msg = {topic: \"SubidaFast\", payload: context.subida}; node.send([null, null, msg, null]);\n    // node.status({text: resultado});\n    }    \nif (payload.includes(\"Share results\")){\n    resultado = payload.substring(payload.indexOf(\"Share results\")+15);\n    node.status({text: resultado});\n    msg = {pin: 70, payload: global.get(\"DescargaFast\") + \" -- \" + global.get(\"SubidaFast\")}; node.send([null, null, null, msg]);\n    msg = {pin: 71, payload: context.descarga + \" -- \" + context.subida}; node.send([null, null, null, msg]);\n    msg = {pin: 72, payload: global.get(\"DescargaFast\")}; node.send([null, null, null, msg]);\n    msg = {pin: 73, payload: global.get(\"SubidaFast\")}; node.send([null, null, null, msg]);\n    msg = {pin: 74, payload: context.descarga}; node.send([null, null, null, msg]);\n    msg = {pin: 75, payload: context.subida}; node.send([null, null, null, msg]);\n    msg = {topic: \"DescargaFast\", payload: global.get(\"DescargaFast\")}; node.send([null, null, msg, null]);\n    msg = {topic: \"SubidaFast\", payload: global.get(\"SubidaFast\")}; node.send([null, null, msg, null]);\n    msg = {topic: \"DescargaFiber\", payload: context.descarga}; node.send([null, null, msg, null]);\n    msg = {topic: \"SubidaFiber\", payload: context.subida}; node.send([null, null, msg, null]);\n    msg.payload = global.get(\"fechaCompleta\") + \" -- \" + resultado; return msg;\n}\nif (payload.includes(\"error\") || payload.includes(\"Error\")){\n    msg.payload = global.get(\"fechaCompleta\") + \" -- \" + \"Falla de conexion\"; \n    node.send([msg, null]);\n    return ([null, msg])\n}// return msg;","outputs":4,"noerr":0,"x":497.44441986083984,"y":383.4444236755371,"wires":[["d1094e09.0048f","94219c12.04844"],["89e0166f.74bba8"],["6e949be8.c70644"],["cfe8aa20.5a0e18","ba239006.7d4a6"]]},{"id":"c6ce670d.77b0d8","type":"delay","z":"f682d492.22a758","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":560,"y":320,"wires":[["eef57e3.f227e8","b1811f6e.55c69","56c14218.0b2ebc"]]},{"id":"895329af.f7c068","type":"mqtt out","z":"7ac92c99.66ea94","name":"","topic":"","qos":"","retain":"","broker":"43555c62.30ed34","x":701.6072196960449,"y":148.92859745025635,"wires":[]},{"id":"12fe5170.f844af","type":"blynk-ws-out-notify","z":"f682d492.22a758","name":"","client":"2c18e412.5f5cbc","queue":false,"rate":15,"x":500,"y":420,"wires":[]},{"id":"3c3e448b.d778bc","type":"debug","z":"e364a467.07a6a8","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":756.5277633666992,"y":528.9999980926514,"wires":[]},{"id":"e0c7593f.c89d28","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"","payloadType":"str","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":1322.2261047363281,"y":498.05963448115756,"wires":[["16c661b6.92124e"]]},{"id":"cdcb7476.bfa268","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"USBout","qos":"2","broker":"c339edbf.39572","x":380,"y":600,"wires":[["22061400.194d3c","15c00bc2.e4ea64"]]},{"id":"a5c52eba.0fcbf","type":"blynk-ws-out-write","z":"50119c6e.6ff584","name":"","pin":"23","pinmode":0,"client":"2c18e412.5f5cbc","x":720,"y":260,"wires":[]},{"id":"fef1bdab.7dba","type":"function","z":"7ac92c99.66ea94","name":"regula potencia (Nuevo)","func":"var payload = msg.payload;\nvar estado = msg.estado;\nvar minimo = 6;\nvar maximo = 255;\n\n// if (!payload.includes(\"living\")) return;\nif (payload.includes(\"luces\") || payload.includes(\"luz\")){\n\tif (payload.includes(\"living\")){\n\t\tvar potencia;\n\t\tpotencia = payload.replace(/\\D/g,'');\n\t\tpotencia = parseInt(potencia * 255 / 100);\n\t\tif (payload.includes(\"minimo\") || payload.includes(\"mínimo\"))var potencia = minimo;\n\t\tif (payload.includes(\"maximo\") || payload.includes(\"máximo\"))var potencia = maximo;\n\t\tif (payload.includes(\"isla\")){\n\t\t\tglobal.set(\"potIsla\", potencia);\n\t\t\tmsg = {topic: \"google/Living\", payload: \"estIsla= \" + global.get(\"estIsla\")};\n\t\t\treturn msg;\n\t\t}\n\t\tif (payload.includes(\"cielo raso\")){\n\t\t\tglobal.set(\"potCielorrazo\", potencia);\n\t\t\tmsg = {topic: \"google/Living\", payload: \"estCielorrazo= \" + global.get(\"estCielorrazo\")};\n\t\t\treturn msg;\n\t\t}\n\t\tglobal.set(\"potLiving\", potencia);\n\t\tglobal.set(\"potIsla\", potencia);\n\t\tglobal.set(\"potCielorrazo\", potencia);\n\t\tmsg = {topic: \"google/Living\", payload: \"estCielorrazo= \" + global.get(\"estCielorrazo\")};\n\t\treturn msg;\n\t}\n}\n","outputs":1,"noerr":0,"x":401.51206493377686,"y":664.7977213859558,"wires":[["69d71644.c47cf8","9600b95a.280848"]]},{"id":"11066e30.40f7a2","type":"inject","z":"3ce5b54a.127d6a","name":"pulso","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":true,"onceDelay":"2","x":1461.4284477233887,"y":78.71432304382324,"wires":[[]]},{"id":"6b8f267f.3678e8","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg.payload = global.get(\"estadocargadorTexto\");\nreturn msg;","outputs":1,"noerr":0,"x":2599.8331909179688,"y":613.7856649671285,"wires":[["553e2b0e.e02dc4"]]},{"id":"bd6b96af.2bd918","type":"blynk-ws-out-write","z":"3ce5b54a.127d6a","name":"","pin":0,"pinmode":"1","client":"2c18e412.5f5cbc","x":930,"y":170,"wires":[]},{"id":"ba239006.7d4a6","type":"debug","z":"e6e33852.2495f8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":680.2222518920898,"y":425.11111068725586,"wires":[]},{"id":"b2dcf0c4.a8898","type":"debug","z":"7ac92c99.66ea94","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":783.3928718566895,"y":441.42860746383667,"wires":[]},{"id":"653c1297.2d7cbc","type":"http in","z":"7ac92c99.66ea94","name":"Request","url":"/desactivar","method":"post","upload":false,"swaggerDoc":"","x":196.6071891784668,"y":177.26192045211792,"wires":[["5975772b.bee358"]]},{"id":"8512c42f.121218","type":"http in","z":"7ac92c99.66ea94","name":"regular luces","url":"/regularluces","method":"post","upload":false,"swaggerDoc":"","x":158.98815822601318,"y":666.78573179245,"wires":[["fef1bdab.7dba","b9da22c6.5cd6f"]]},{"id":"2d13b22d.35e53e","type":"function","z":"e364a467.07a6a8","name":"root","func":"var date = new Date();\nvar frecuencia = 5;\nvar dia = date.getDay();\nvar hh = date.getHours();\nvar mm = date.getMinutes();\nvar ss = date.getSeconds();\nvar tiempo = mm % frecuencia;\nnode.status({text: hh + \":\" + mm + \":\" + ss + \" - \" + tiempo + \" - \" + dia});\nif (dia !== 0 && dia !== 6 && ss === 0 && tiempo === 0){\n\tif (hh > 9 && hh < 18) return msg;\n} \n// if (ss === 0 && tiempo === 0) return msg;\n//){//hh > 9 && hh < 17 && \n //   if (ss === 0 && tiempo === 0) return msg;\n    // if (ss === 0 && tiempo === 0) return msg;\n// }","outputs":1,"noerr":0,"x":262.194393157959,"y":343.17859172821045,"wires":[["458559fe.24ae48"]]},{"id":"a9ae9e1e.01ed5","type":"mqtt out","z":"3ce5b54a.127d6a","name":"","topic":"","qos":"","retain":"","broker":"c339edbf.39572","x":1865.0942497253418,"y":986.357154573713,"wires":[]},{"id":"d9044cfd.00888","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg = {topic: \"tempBat2\", payload: global.get(\"tempBat2\")}; node.send(msg);\n","outputs":1,"noerr":0,"x":2589.3095474243164,"y":258.3094975607736,"wires":[["95ff630c.c1ed8"]]},{"id":"dc1874f6.726c08","type":"mqtt in","z":"50119c6e.6ff584","name":"","topic":"USBin/temExterior","qos":"2","broker":"e779f8d6.7bc2c8","x":260,"y":480,"wires":[["702341e5.2cb2e","b31fbc78.d2c28"]]},{"id":"f22de0a2.1bb7f","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1311.0951347351074,"y":340.85718154907227,"wires":[["ae746686.8cad28"]]},{"id":"b9da22c6.5cd6f","type":"debug","z":"7ac92c99.66ea94","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":384.44052505493164,"y":709.4286017417908,"wires":[]},{"id":"702d90f7.a39cd","type":"blynk-ws-in-write","z":"a89e305a.c50bb","name":"","pin":"8","pin_all":false,"client":"2c18e412.5f5cbc","x":330,"y":530,"wires":[["cce091cd.a69e5"]]},{"id":"525b92db.7e668c","type":"mqtt in","z":"50119c6e.6ff584","name":"","topic":"ESP/Living/Sens/Temp/Resp","qos":"2","broker":"e779f8d6.7bc2c8","x":260,"y":370,"wires":[["874ef0ca.0d4c8"]]},{"id":"879ba33.ca0c96","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"USBin/Alarma","qos":"2","broker":"c339edbf.39572","x":1480,"y":960,"wires":[["483d3434.43ff8c","ca93e748.b2afe8"]]},{"id":"435e80ad.e17c8","type":"function","z":"e364a467.07a6a8","name":"","func":"msg.payload = msg.payload.replace(\",\", \".\");\nglobal.set(\"MinimoComprar\", parseFloat(msg.payload).toFixed(2));\nnode.status({text: \"MinimoComprar:\" + global.get(\"MinimoComprar\")});\nreturn msg;","outputs":1,"noerr":0,"x":445.5277404785156,"y":53,"wires":[[]]},{"id":"c2e9aa8f.549168","type":"blynk-ws-out-write","z":"1b403a13.0ec8c6","name":"","pin":0,"pinmode":"1","client":"2c18e412.5f5cbc","x":880,"y":280,"wires":[]},{"id":"22061400.194d3c","type":"debug","z":"3ce5b54a.127d6a","name":"Serial out","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":580,"y":600,"wires":[]},{"id":"16b67857.ba97a8","type":"function","z":"e6e33852.2495f8","name":"","func":"if (msg.payload == \"1\")return msg;","outputs":1,"noerr":0,"x":323.0000025431316,"y":193.44444402058923,"wires":[["f0069ce0.a32ee"]]},{"id":"a9f3050a.052758","type":"thingspeak42","z":"e364a467.07a6a8","name":"NBKVMGLFCL4MD6XC","delay":"5","topic1":"DolarVenta","topic2":"DolarCompra","topic3":"BitCoinUSD","topic4":"BitCoinPesos","topic5":"","topic6":"","topic7":"","topic8":"","endpoint":"https://thingspeak.com","x":771.6467247009277,"y":304.4285838007927,"wires":[]},{"id":"ab4c9a86.d13818","type":"inject","z":"3ce5b54a.127d6a","name":"pulso","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":282.6429634094238,"y":290.2738253729684,"wires":[["f1697d45.0cc3b","2ecde4d0.0750bc"]]},{"id":"a110d805.3e0758","type":"mqtt out","z":"7ac92c99.66ea94","name":"","topic":"","qos":"","retain":"","broker":"43555c62.30ed34","x":766.9881582260132,"y":286.92860174179077,"wires":[]},{"id":"810bcbed.14fc78","type":"blynk-ws-in-write","z":"a89e305a.c50bb","name":"","pin":"18","pin_all":false,"client":"2c18e412.5f5cbc","x":320,"y":450,"wires":[[]]},{"id":"41de7b73.054844","type":"file","z":"e6e33852.2495f8","name":"borrar archivo","filename":"/home/gaston/BackUp-Node-Red/Fibertel.txt","appendNewline":true,"createDir":false,"overwriteFile":"delete","x":359.6666717529297,"y":597.888861656189,"wires":[[]]},{"id":"a2ae1c14.e354a","type":"e-mail","z":"e364a467.07a6a8","server":"smtp.mail.yahoo.com","port":"465","secure":true,"name":"gdietrich22@yahoo.com.ar","dname":"gd28722563","x":765.6944007873535,"y":389.92859172821045,"wires":[]},{"id":"37becc30.948424","type":"function","z":"f682d492.22a758","name":"","func":"var date = new Date();\nvar hh = date.getHours(); global.set(\"hh\", hh);\nvar mm = date.getMinutes(); global.set(\"mm\", mm);\nvar ss = date.getSeconds(); global.set(\"ss\", ss);\nvar dia = date.getDate(); \nvar mes = date.getMonth()+1;\nvar ano = date.getFullYear(); \n\nvar reinicio = hh + \":\" +mm + \":\" + ss + \" -- \"+ dia + \"/\"+mes+ \"\\n\";\n\n\nmsg.payload = reinicio;\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":500,"wires":[["3a857b5b.2a0b94","1a3dc3d4.31786c"]]},{"id":"3a857b5b.2a0b94","type":"file","z":"f682d492.22a758","name":"reinicios","filename":"/home/gaston/BackUp-Node-Red/reinicios.txt","appendNewline":true,"createDir":false,"overwriteFile":"true","x":500,"y":470,"wires":[["1a3dc3d4.31786c"]]},{"id":"1a3dc3d4.31786c","type":"debug","z":"f682d492.22a758","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":700,"y":500,"wires":[]},{"id":"402ed674.49be08","type":"inject","z":"f682d492.22a758","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":510,"wires":[["37becc30.948424"]]},{"id":"a594e6b.0d98718","type":"delay","z":"3ce5b54a.127d6a","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":370,"y":830,"wires":[["ac2c785f.fac748","75432a7.2b2c4d4"]]},{"id":"bdbd6b84.b74708","type":"exec","z":"3ce5b54a.127d6a","command":"acpi -t","addpay":true,"append":"","useSpawn":"true","timer":"","oldrc":true,"name":"","x":300,"y":930,"wires":[["34c194e1.df57ac","9e35998b.99f3d8"],[],[]]},{"id":"34c194e1.df57ac","type":"function","z":"3ce5b54a.127d6a","name":"","func":"var temp = msg.payload;\ncontext.temp = context.temp || 0;\ncontext.cont = context.cont || 0;\n\ntemp = temp.substring(temp.indexOf(\"ok\")+4);\ntemp = temp.substring(0, temp.indexOf(\"degrees \"));\ntemp = parseFloat(temp).toFixed(1);\ncontext.cont++;\ncontext.temp = parseFloat(temp) + parseFloat(context.temp);\nvar dato = context.temp / context.cont;\nnode.status({text: \"cont: \" + context.cont + \"  temp: \"+ temp + \"  tempAc: \"+ context.temp});\n\nif (context.cont >= 10){\n    global.set(\"tempCPU\", context.temp / context.cont);\n    node.status({text: \"cont: \" + context.cont + \"  temp: \" + global.get(\"tempCPU\")});    \n    node.status({text: \"Temp CPU: \" + global.get(\"tempCPU\")});\n    context.cont = 0;\n    context.temp = 0;\n    if (global.get(\"tempCPU\") > 80){\n        msg = {topic: \"notifyBlynk\", payload: \"Atencion, Servidor muy caliente\"};\n        node.send(msg);\n    }    \n}\n\n","outputs":1,"noerr":0,"x":440,"y":960,"wires":[["6f2a559f.704f9c"]]},{"id":"38b4b89a.0d7d18","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"Baterias/Est/Pedido/Resp","payload":"","payloadType":"date","repeat":"30","crontab":"","once":true,"onceDelay":0.1,"x":140,"y":930,"wires":[["bdbd6b84.b74708"]]},{"id":"6f2a559f.704f9c","type":"mqtt out","z":"3ce5b54a.127d6a","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":700,"y":960,"wires":[]},{"id":"7eab163e.6214c8","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg.payload = global.get(\"tempCPU\");\nreturn msg;","outputs":1,"noerr":0,"x":2600,"y":660,"wires":[["c1dd659e.9aa308"]]},{"id":"9dd426e8.23c508","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"","payloadType":"date","repeat":"5","crontab":"","once":true,"onceDelay":"1","x":2390,"y":660,"wires":[["7eab163e.6214c8"]]},{"id":"83ad7853.380cc8","type":"mqtt in","z":"a89e305a.c50bb","name":"Debug esp","topic":"Debug/ESP/Living/Iluminacion","qos":"2","broker":"e779f8d6.7bc2c8","x":740,"y":40,"wires":[["830705e1.f38088"]]},{"id":"830705e1.f38088","type":"debug","z":"a89e305a.c50bb","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":900,"y":40,"wires":[]},{"id":"d9e58002.9fc1c","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":1210,"y":1430,"wires":[["3170a08f.1813b"]]},{"id":"88d7a18f.f34ef","type":"http request","z":"deff4396.4722a","name":"770523","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=770523","tls":"","x":605.1428833007812,"y":1532.0000305175781,"wires":[["e6127662.487908"]]},{"id":"690fa2ad.6e899c","type":"http request","z":"deff4396.4722a","name":"227142","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=227142","tls":"","x":615.0000038146973,"y":837.8572373390198,"wires":[["cb65d1fd.cb53f"]]},{"id":"53abf513.752d6c","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 2;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":778.1429176330566,"y":385.00007009506226,"wires":[["3170a08f.1813b"]]},{"id":"16efb32e.155fed","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":763.8572120666504,"y":1459.2857298851013,"wires":[["3170a08f.1813b"]]},{"id":"4099b57f.38846c","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":781.1428871154785,"y":53.42862033843994,"wires":[["3170a08f.1813b"]]},{"id":"55c124d2.62ee1c","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":781.0000953674316,"y":202.14290761947632,"wires":[["3170a08f.1813b"]]},{"id":"34f3b0c2.8833c","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":779.428653717041,"y":506.5715045928955,"wires":[["3170a08f.1813b"]]},{"id":"458d00b4.bb81a","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":775.1429481506348,"y":799.4286670684814,"wires":[["3170a08f.1813b"]]},{"id":"44e592ad.9a6ddc","type":"debug","z":"deff4396.4722a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1529.4286346435547,"y":607.7143774032593,"wires":[]},{"id":"fee2fc02.661cb","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 3;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":768.0001258850098,"y":1222.2858142852783,"wires":[["3170a08f.1813b"]]},{"id":"171b314a.622d6f","type":"http request","z":"deff4396.4722a","name":"234231","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=243231","tls":"","x":1054.1428489685059,"y":1319.8571381568909,"wires":[["7dea07a4.eb3178"]]},{"id":"c24bc84a.594568","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 2;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno + \"B\", payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":1210,"y":1501.4285888671875,"wires":[["3170a08f.1813b","5bf1036e.b90b1c"]]},{"id":"4ff7c4b4.6171dc","type":"http request","z":"deff4396.4722a","name":"243236","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=243236","tls":"","x":613.5715026855469,"y":1003.5715107917786,"wires":[["6002d625.d89ac8"]]},{"id":"4986495d.c7ee08","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 2;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n\n","outputs":1,"noerr":0,"x":768.1429176330566,"y":1310.7143034934998,"wires":[["3170a08f.1813b"]]},{"id":"1b6d2ac5.036c35","type":"http request","z":"deff4396.4722a","name":"231583","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=231583","tls":"","x":1055.571376800537,"y":1282.7142853736877,"wires":[["1a443eaf.be41f1"]]},{"id":"2313909a.a4c4d","type":"http request","z":"deff4396.4722a","name":"222387","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=222387","tls":"","x":616.4286193847656,"y":729.2857899665833,"wires":[["b86bd3da.92551"]]},{"id":"f772061b.e1cad8","type":"http request","z":"deff4396.4722a","name":"256659","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=256659","tls":"","x":1051.2856712341309,"y":1502.7143006324768,"wires":[["c24bc84a.594568"]]},{"id":"9677ee79.5bdcc","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":1214.1429138183594,"y":1155.8572010993958,"wires":[["3170a08f.1813b"]]},{"id":"76e899ab.f8ae08","type":"http request","z":"deff4396.4722a","name":"700558","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=700558","tls":"","x":608.0000610351562,"y":1349.1428680419922,"wires":[["8667b91f.fdc0b8"]]},{"id":"e0f6cdfd.a62bf","type":"http request","z":"deff4396.4722a","name":"215557","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=215557","tls":"","x":617.9999732971191,"y":423.4286403656006,"wires":[["f81f56b3.959ef8"]]},{"id":"def30510.94f998","type":"http request","z":"deff4396.4722a","name":"920550","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=920550","tls":"","x":603.7142677307129,"y":1569.1428890228271,"wires":[["149647c7.c11978"]]},{"id":"7e85e10b.d1b0b","type":"debug","z":"deff4396.4722a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1046.5714460100446,"y":1062.0000501360212,"wires":[]},{"id":"9a5d1616.d83a58","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 0.5;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":778.1429176330566,"y":467.85721731185913,"wires":[["3170a08f.1813b"]]},{"id":"22131597.af008a","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":775.1429481506348,"y":762.2857837677002,"wires":[["3170a08f.1813b"]]},{"id":"dfd3ea5e.dff698","type":"http response","z":"deff4396.4722a","name":"","statusCode":"","headers":{},"x":1505.214370727539,"y":695.333384513855,"wires":[]},{"id":"b42376a.e111f88","type":"http request","z":"deff4396.4722a","name":"700019","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=700019","tls":"","x":609.4285888671875,"y":1312.000015258789,"wires":[["4986495d.c7ee08"]]},{"id":"2b5dc58.8b2eb3a","type":"inject","z":"deff4396.4722a","name":"reset contador","topic":"reset","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1218.0002746582031,"y":673.4286546707153,"wires":[["6581ffca.63a8d"]]},{"id":"8667b91f.fdc0b8","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 5;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":766.7143898010254,"y":1347.8571562767029,"wires":[["3170a08f.1813b"]]},{"id":"3b210264.5f0bee","type":"http request","z":"deff4396.4722a","name":"244498","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=244498","tls":"","x":1052.7142601013184,"y":1391.2857117652893,"wires":[["1b708a40.bc22e6"]]},{"id":"b3a7fbf3.922e48","type":"http request","z":"deff4396.4722a","name":"234812","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=234812","tls":"","x":613.5715026855469,"y":930.7143635749817,"wires":[["7e267bbe.156c74"]]},{"id":"4cbcbf45.90a3e","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":1212.714298248291,"y":1230.142942905426,"wires":[["3170a08f.1813b"]]},{"id":"9fff4fff.b3553","type":"http request","z":"deff4396.4722a","name":"244227","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=244227","tls":"","x":614.642951965332,"y":1072.5001525878906,"wires":[["fdec048a.e11958"]]},{"id":"d1f7dd08.140b9","type":"http request","z":"deff4396.4722a","name":"175408","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=175408","tls":"","x":619.4285888671875,"y":349.1428985595703,"wires":[["ee6afd61.4e7cf"]]},{"id":"9130ce49.eaa87","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":778.0001258850098,"y":616.5715045928955,"wires":[["3170a08f.1813b"]]},{"id":"cb65d1fd.cb53f","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":773.7143325805664,"y":836.5715255737305,"wires":[["3170a08f.1813b"]]},{"id":"4ae8fbed.dbc814","type":"http request","z":"deff4396.4722a","name":"216449","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=216449","tls":"","x":620.7143249511719,"y":507.8572163581848,"wires":[["34f3b0c2.8833c"]]},{"id":"5bf1036e.b90b1c","type":"debug","z":"deff4396.4722a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1403.7143031529017,"y":1507.7143358503067,"wires":[]},{"id":"bc0ed3c2.0b241","type":"http request","z":"deff4396.4722a","name":"214145","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=214145","tls":"","x":619.4285888671875,"y":386.28578186035156,"wires":[["53abf513.752d6c"]]},{"id":"59a29fe5.2caf4","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":1212.857177734375,"y":1352.8571472167969,"wires":[["3170a08f.1813b"]]},{"id":"1145a554.3866db","type":"http request","z":"deff4396.4722a","name":"256659","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=256659","tls":"","x":607.8571815490723,"y":1260.7143845558167,"wires":[["ee1898c6.e49f28"]]},{"id":"a8012455.e32078","type":"http request","z":"deff4396.4722a","name":"253486","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=253486","tls":"","x":609.2857971191406,"y":1223.5715260505676,"wires":[["fee2fc02.661cb"]]},{"id":"98a4cda.2e0543","type":"thingspeak42","z":"deff4396.4722a","name":"5RA8YTAP1AURPAKD","delay":"2","topic1":"caja","topic2":"boucher","topic3":"total","topic4":"","topic5":"","topic6":"","topic7":"","topic8":"","endpoint":"https://thingspeak.com","x":1581.839412689209,"y":768.6071662902832,"wires":[]},{"id":"c9edb946.55d838","type":"http request","z":"deff4396.4722a","name":"135003","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=135003","tls":"","x":623.7142944335938,"y":127.71434020996094,"wires":[["7df23347.bffebc"]]},{"id":"6581ffca.63a8d","type":"function","z":"deff4396.4722a","name":"","func":"var payload;\nvar dato;\nvar valor = 0;\nvar valor1;\nvar valor2;\n\nif (msg.topic == \"reset\"){\n    global.set(\"cont_coop\", 0);\n    node.status({text: \"consultas: \" + global.get(\"cont_coop\")});\n    msg.payload = global.get(\"cont_coop\"); \n    return([null, null, msg]);\n}\n\nmsg.payload = \"<table align=\\\"center\\\" border=\\\"1\\\" style=\\\"width:auto; height:20px;\\\" class=\\\"table table-condensed table-bordered table-hover\\\">\";\nmsg.payload +=   \"<tr align=\\\"center\\\" class=\\\"active\\\" bgcolor= \\\"#00FFFF\\\" >\";\n// msg.payload +=  \" <tr  bgcolor= \\\"#00FFFF\\\" >\";\nmsg.payload +=   \"<td colspan=\\\"6\\\">Articulos Caja (resaltados en <b><big>AMARILLO</b></big> estan en <b><big>OFERTA</b></big>)</td>\";\n// msg.payload +=  \" <tr  bgcolor= \\\"#00FFFF\\\" >\";\nmsg.payload +=   \"<tr align=\\\"center\\\" class=\\\"active\\\" bgcolor= \\\"#00FFFF\\\" >\";\nmsg.payload +=    \" <td width=\\\"50\\\">Codigo</td>\";\n\nmsg.payload +=    \" <td width=\\\"200\\\">Descripcion</td>\";\n// msg.payload +=    \" <td width=\\\"80\\\">Gramaje</td>\";\nmsg.payload +=    \" <td width=\\\"50\\\">Cantidad</td>\";\nmsg.payload +=    \" <td width=\\\"80\\\">Precio Lista</td>\";\nmsg.payload +=    \" <td width=\\\"80\\\">Precio Final</td>\";\nmsg.payload +=    \" <td width=\\\"80\\\">Total</td>\";\nmsg.payload +=  \" </tr>\";\n\n\ntabla(flow.get(\"105113\"));\ntabla(flow.get(\"131067\"));\ntabla(flow.get(\"135003\"));\ntabla(flow.get(\"140220\"));\ntabla(flow.get(\"151793\"));\ntabla(flow.get(\"152999\"));\ntabla(flow.get(\"169188\"));\ntabla(flow.get(\"170872\"));\ntabla(flow.get(\"175408\"));\ntabla(flow.get(\"214145\"));\ntabla(flow.get(\"215557\"));\ntabla(flow.get(\"216172\"));\ntabla(flow.get(\"216449\"));\ntabla(flow.get(\"216450\"));\ntabla(flow.get(\"216677\"));\ntabla(flow.get(\"216699\"));\ntabla(flow.get(\"217334\"));\ntabla(flow.get(\"218136\"));\ntabla(flow.get(\"222387\"));\ntabla(flow.get(\"224097\"));\ntabla(flow.get(\"224363\"));\ntabla(flow.get(\"227142\"));\ntabla(flow.get(\"230515\"));\ntabla(flow.get(\"234812\"));\ntabla(flow.get(\"242835\"));\ntabla(flow.get(\"243236\"));\ntabla(flow.get(\"243905\"));\ntabla(flow.get(\"244227\"));\ntabla(flow.get(\"244495\"));\n\ntabla(flow.get(\"248167\"));\ntabla(flow.get(\"250602\"));\ntabla(flow.get(\"253486\"));\n\ntabla(flow.get(\"256659C\"));\ntabla(flow.get(\"700019\"));\ntabla(flow.get(\"700558\"));\ntabla(flow.get(\"705207\"));\ntabla(flow.get(\"730467\"));\ntabla(flow.get(\"740390\"));\ntabla(flow.get(\"756687\"));\ntabla(flow.get(\"770523\"));\ntabla(flow.get(\"920550\"));\n\nvar valor_caja = parseFloat(valor).toFixed(2);\n\nmsg.payload +=  \" </tr>\";\nmsg.payload +=  \" <tr align=\\\"right\\\" bgcolor= \\\"#00FFFF\\\">\";\nmsg.payload +=   \"<td colspan=\\\"5\\\"><b><big>Total= </b></big/td>\";\nmsg.payload +=    \" <td><b><big>\" + valor_caja + \"</b></big>\";\nmsg.payload += \"</table>\";\nvar caja = msg.payload;\n\nmsg.payload = \"</br></br><table align=\\\"center\\\" border=\\\"1\\\" style=\\\"width:auto; height:20px;\\\" class=\\\"table table-condensed table-bordered table-hover\\\">\";\nmsg.payload +=   \"<tr align=\\\"center\\\" class=\\\"active\\\" bgcolor= \\\"#00FFFF\\\" >\";\n// msg.payload +=  \" <tr  bgcolor= \\\"#00FFFF\\\" >\";\nmsg.payload +=   \"<td colspan=\\\"6\\\">Articulos Boucher (resaltados en <b><big>AMARILLO</b></big> estan en <b><big>OFERTA</b></big>)</td>\";\n// msg.payload +=  \" <tr  bgcolor= \\\"#00FFFF\\\" >\";\nmsg.payload +=   \"<tr align=\\\"center\\\" class=\\\"active\\\" bgcolor= \\\"#00FFFF\\\" >\";\nmsg.payload +=    \" <td width=\\\"50\\\">Codigo</td>\";\nmsg.payload +=    \" <td width=\\\"200\\\">Descripcion</td>\";\n// msg.payload +=    \" <td width=\\\"80\\\">Gramaje</td>\";\nmsg.payload +=    \" <td width=\\\"50\\\">Cantidad</td>\";\nmsg.payload +=    \" <td width=\\\"80\\\">Precio Lista</td>\";\nmsg.payload +=    \" <td width=\\\"80\\\">Precio Final</td>\";\nmsg.payload +=    \" <td width=\\\"80\\\">Total</td>\";\nmsg.payload +=  \" </tr>\";\n\nvalor = 0;\ntabla(flow.get(\"166508\"));\ntabla(flow.get(\"198119\"));\ntabla(flow.get(\"224363\"));\ntabla(flow.get(\"224744\"));\ntabla(flow.get(\"231583\"));\ntabla(flow.get(\"243231\"));\ntabla(flow.get(\"243239\"));\ntabla(flow.get(\"244498\"));\ntabla(flow.get(\"245287\"));\ntabla(flow.get(\"252411\"));\ntabla(flow.get(\"256659B\"));\n\nvar valor_boucher = parseFloat(valor).toFixed(2);\nmsg.payload +=  \" </tr>\";\nmsg.payload +=  \" <tr align=\\\"right\\\" bgcolor= \\\"#00FFFF\\\">\";\nmsg.payload +=   \"<td colspan=\\\"5\\\"><b><big>Total= </b></big/td>\";\nmsg.payload +=    \" <td><b><big>\" + valor_boucher + \"</b></big>\";\nmsg.payload += \"</table>\";\nvar boucher = msg.payload;\nvar valor_total = parseFloat(valor_caja) + parseFloat(valor_boucher); valor_total = parseFloat(valor_total).toFixed(2); \n\nvar date = new Date();\nvar fecha = date.getDate() + \"/\" + parseInt(1+date.getMonth()) + \"/\" + date.getUTCFullYear() + \"  --  \" + global.get(\"hsCpu\");\nmsg.payload = \"<table align=\\\"center\\\" border=\\\"1\\\" style=\\\"width:auto; height:20px;\\\" class=\\\"table table-condensed table-bordered table-hover\\\">\";\nmsg.payload += \"<tr align=\\\"center\\\" class=\\\"active\\\" bgcolor= \\\"#00FFFF\\\" >\";\nmsg.payload +=   \"<td colspan=\\\"2\\\" align=\\\"center\\\">\" + fecha + \"</td></tr>\";\nmsg.payload +=   \"<td colspan=\\\"2\\\" align=\\\"center\\\">Valores extraidos de <a href= https://www.lacoopeencasa.coop> www.lacoopeencasa.coop </a> <p style=\\\"color:red;\\\"><b><big>Sucursal BAHIA BLANCA!!!</p></b></big> </td></tr>\";\nmsg.payload += \"<td width=\\\"100\\\"><b><big></b></big></td>\";\nmsg.payload += \"<td width=\\\"100\\\"><b><big>Valor</b></big></td></tr>\";\n\nmsg.payload += \"<td><b><big>Caja</b></big><td>\" + valor_caja + \"</td></tr>\";\nmsg.payload += \"<td><b><big>Boucher</b></big><td>\" + valor_boucher + \"</td></tr>\";\nmsg.payload += \"<td><b><big>Total<td><b><big>\" + valor_total + \"</b></big></td></tr>\";\nmsg.payload += \"</table></tr>\";\nvar encabezado = msg.payload;\n\n\nif (msg.pedido != \"automatico\"){\n    if (global.get(\"cont_coop\") === undefined)global.set(\"cont_coop\", 0);\n    var cont_coop = global.get(\"cont_coop\");\n    cont_coop = cont_coop + 1;\n    global.set(\"cont_coop\", cont_coop);\n    msg.payload = encabezado + caja + boucher + \"<H6>consultas: \" + global.get(\"cont_coop\") + \"</H6>\";\n    node.status({text: \"consultas: \" + global.get(\"cont_coop\")});\n    vaciar();\n    node.send ([msg, null]);\n    msg.payload = global.get(\"cont_coop\"); return([null, null, msg]);\n}\n\n\nmsg = {topic: \"caja\", payload: valor_caja}; node.send([null, msg]);\nmsg = {topic: \"boucher\", payload: valor_boucher}; node.send([null, msg]);\nmsg = {topic: \"total\", payload: valor_total}; node.send([null, msg]);\nflow.set(\"comprobado\", 1);\nvaciar();\n// return;\n\nfunction tabla(dato){\n    dato = JSON.parse(dato);\n    valor = parseFloat(valor) + parseFloat(dato.total);\n    msg.payload +=  \" </tr>\";\n    if (dato.precio_promo !== null) msg.payload +=  \" <tr align=\\\"center\\\" bgcolor= \\\"#FFFF00\\\" >\";\n    if (dato.precio_promo === null) msg.payload +=  \" <tr align=\\\"center\\\">\";\n    // msg.payload +=  \" <tr align=\\\"center\\\">\";\n    msg.payload +=    \" <td>\" + dato.cod_interno + \"</td>\";\n    msg.payload +=    \" <td>\" + dato.descripcion + \"</td>\";\n    // msg.payload +=    \" <td>\" + dato.gramaje + \"</td>\";\n    msg.payload +=    \" <td>\" + dato.cantidad + \"</td>\";    \n    msg.payload +=    \" <td>\" + dato.precio_anterior + \"</td>\";    \n    msg.payload +=    \" <td>\" + dato.precio + \"</td>\";\n    msg.payload +=    \" <td>\" + parseFloat(dato.total).toFixed(2) + \"</td>\";\n    msg.payload +=  \" </tr>\"\n}\n\nfunction vaciar(){\n\nflow.set(\"105113\",\"\");\nflow.set(\"131067\",\"\");\nflow.set(\"135003\",\"\");\nflow.set(\"140220\",\"\");\nflow.set(\"151793\",\"\");\nflow.set(\"152999\",\"\");\nflow.set(\"169188\",\"\");\nflow.set(\"170872\",\"\");\nflow.set(\"175408\",\"\");\nflow.set(\"214145\",\"\");\nflow.set(\"215557\",\"\");\nflow.set(\"216172\",\"\");\nflow.set(\"216449\",\"\");\nflow.set(\"216450\",\"\");\nflow.set(\"216677\",\"\");\nflow.set(\"216699\",\"\");\nflow.set(\"217334\",\"\");\nflow.set(\"218136\",\"\");\nflow.set(\"222387\",\"\");\nflow.set(\"224097\",\"\");\nflow.set(\"224363\",\"\");\nflow.set(\"227142\",\"\");\nflow.set(\"230515\",\"\");\nflow.set(\"234812\",\"\");\nflow.set(\"242835\",\"\");\nflow.set(\"243236\",\"\");\nflow.set(\"243905\",\"\");\nflow.set(\"244227\",\"\");\nflow.set(\"244495\",\"\");\n\nflow.set(\"248167\",\"\");\nflow.set(\"250602\",\"\");\nflow.set(\"253486C\",\"\");\n\nflow.set(\"256659\",\"\");\nflow.set(\"700019\",\"\");\nflow.set(\"700558\",\"\");\nflow.set(\"705207\",\"\");\nflow.set(\"730467\",\"\");\nflow.set(\"740390\",\"\");\nflow.set(\"756687\",\"\");\nflow.set(\"770523\",\"\");\nflow.set(\"920550\",\"\");\nflow.set(\"166508\",\"\");\nflow.set(\"198119\",\"\");\nflow.set(\"224363\",\"\");\nflow.set(\"224744\",\"\");\nflow.set(\"231583\",\"\");\nflow.set(\"700558\",\"\");\nflow.set(\"705207\",\"\");\nflow.set(\"244498\",\"\");\nflow.set(\"245287\",\"\");\nflow.set(\"252411\",\"\");\nflow.set(\"256659B\",\"\");\n}\n\n\n","outputs":3,"noerr":0,"x":1348.0000648498535,"y":743.1905460357666,"wires":[["dfd3ea5e.dff698","f1a94e7f.56c71"],["98a4cda.2e0543","fe18dcf8.29813"],["7a2cbbe6.736ef4","5dfb8412.6299fc"]]},{"id":"641eea95.956894","type":"http request","z":"deff4396.4722a","name":"169188","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=169188","tls":"","x":620.857177734375,"y":274.85719299316406,"wires":[["5f1ae42d.23f84c"]]},{"id":"ef95bde3.c855a","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":1214.1429138183594,"y":1121.5714955329895,"wires":[["3170a08f.1813b"]]},{"id":"c98bdd84.bfad9","type":"http request","z":"deff4396.4722a","name":"243905","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=243905","tls":"","x":608.392951965332,"y":1036.9643859863281,"wires":[["396caf50.b129a"]]},{"id":"ca1cb623.491768","type":"inject","z":"deff4396.4722a","name":"comprobar","topic":"comprobar","payload":"ll","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110.53970336914062,"y":831.5238571166992,"wires":[["9a794d21.ff36e"]]},{"id":"57143856.e8f2e8","type":"http request","z":"deff4396.4722a","name":"105113","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=105113","tls":"","x":622.4285583496094,"y":54.71433210372925,"wires":[["4099b57f.38846c"]]},{"id":"d9442c12.5d71c","type":"http request","z":"deff4396.4722a","name":"151793","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=151793","tls":"","x":622.2857666015625,"y":203.42861938476562,"wires":[["55c124d2.62ee1c"]]},{"id":"d6d0da5d.b2e428","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":771.0000953674316,"y":890.714364528656,"wires":[["3170a08f.1813b"]]},{"id":"f180d7aa.a01048","type":"http request","z":"deff4396.4722a","name":"244495","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=244495","tls":"","x":610.7143859863281,"y":1112.1429371833801,"wires":[["76da8650.357888"]]},{"id":"90062b1c.b307f8","type":"http request","z":"deff4396.4722a","name":"250602","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=250602","tls":"","x":609.2857971191406,"y":1186.4286427497864,"wires":[["7ca5b1e6.483b9"]]},{"id":"b54733d3.6a724","type":"function","z":"deff4396.4722a","name":"","func":"\tvar dato;\n\tvar valor;\n\tvar cant;\n\n\tdato = flow.get(\"105113\"); payload = dato + \"</br>\"; valor = parseFloat(dato.substring(dato.indexOf(\"precio: precio: $\")+9));\n\tdato = flow.get(\"131067\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"135003\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"140220\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"151793\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"152999\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"169188\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"170872\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"175408\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"214145\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"215557\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\n\tdato = flow.get(\"216172\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"216449\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"216450\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"216677\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"216699\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"217334\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"218136\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"222387\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"224097\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"224363\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"227142\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\n\tdato = flow.get(\"230515\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"234812\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"242835\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"243236\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"243905\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"244227\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"244495\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\n\tdato = flow.get(\"248167\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"250602\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"253486\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\n\tdato = flow.get(\"256659\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"700019\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"700558\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"705207\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\n\tdato = flow.get(\"730467\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"740390\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"756687\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"770523\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\tdato = flow.get(\"920550\"); payload += dato + \"</br>\"; valor += parseFloat( parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)));\n\n\n\t// msg.payload = parseFloat(dato.substring(dato.indexOf(\"precio: $\")+9)) * parseInt(dato.substring(dato.indexOf(\"cant:\")+1), dato.indexOf(\"cant:\")+3);\n\tmsg.payload = payload +  \"</br>\" + \"Valor Caja: precio: $\" + valor.toFixed(2);\n\treturn msg;","outputs":1,"noerr":0,"x":1352.8572883605957,"y":816.0715026855469,"wires":[[]]},{"id":"cadea8ce.25e388","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":779.428653717041,"y":579.4286518096924,"wires":[["3170a08f.1813b"]]},{"id":"4d3f888a.443b08","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":781.0000953674316,"y":236.42862844467163,"wires":[["3170a08f.1813b"]]},{"id":"fe18dcf8.29813","type":"debug","z":"deff4396.4722a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1521.750108718872,"y":732.7143449783325,"wires":[]},{"id":"6575aa91.007b84","type":"debug","z":"deff4396.4722a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1422.2858307361603,"y":466.28575134277344,"wires":[]},{"id":"b86bd3da.92551","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 2;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":775.1429481506348,"y":728.000078201294,"wires":[["3170a08f.1813b"]]},{"id":"5dfb8412.6299fc","type":"debug","z":"deff4396.4722a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1523.7143621444702,"y":850.5715265274048,"wires":[]},{"id":"396caf50.b129a","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":770.8573036193848,"y":1039.4286518096924,"wires":[["3170a08f.1813b"]]},{"id":"28817a7e.db5e46","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":1214.1429138183594,"y":1193.000084400177,"wires":[["3170a08f.1813b"]]},{"id":"73fa44dc.96d24c","type":"http request","z":"deff4396.4722a","name":"152999","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=152999","tls":"","x":622.2857666015625,"y":237.71434020996094,"wires":[["4d3f888a.443b08"]]},{"id":"a5daacc0.adaa6","type":"http request","z":"deff4396.4722a","name":"198119","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=198119","tls":"","x":1055.4285850524902,"y":1157.142912864685,"wires":[["9677ee79.5bdcc"]]},{"id":"a63f9ad.d1fce68","type":"http request","z":"deff4396.4722a","name":"224363","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=224363","tls":"","x":1055.4285850524902,"y":1194.2857961654663,"wires":[["28817a7e.db5e46"]]},{"id":"e6e19c04.028c2","type":"http request","z":"deff4396.4722a","name":"224363","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=224363","tls":"","x":616.4286193847656,"y":800.7143788337708,"wires":[["458d00b4.bb81a"]]},{"id":"5f1ae42d.23f84c","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":779.5715065002441,"y":273.57148122787476,"wires":[["3170a08f.1813b"]]},{"id":"a931ef28.863ad","type":"http request","z":"deff4396.4722a","name":"216450","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=216450","tls":"","x":620.7143249511719,"y":542.1429371833801,"wires":[["f8eb0173.2252d"]]},{"id":"6002d625.d89ac8","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":772.285831451416,"y":1002.2857990264893,"wires":[["3170a08f.1813b"]]},{"id":"b90017fb.9ffbe8","type":"http request","z":"deff4396.4722a","name":"131067","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=131067","tls":"","x":623.7142944335938,"y":93.42861938476562,"wires":[["5c0e05ce.6a04ac"]]},{"id":"ee9595b0.139958","type":"http request","z":"deff4396.4722a","name":"216677","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=216677","tls":"","x":620.7143249511719,"y":580.7143635749817,"wires":[["cadea8ce.25e388"]]},{"id":"8d1e731c.cb342","type":"http request","z":"deff4396.4722a","name":"170872","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=170872","tls":"","x":619.4285888671875,"y":314.85719299316406,"wires":[["337ddd2c.8be9c2"]]},{"id":"e93d30a3.b32fd","type":"inject","z":"deff4396.4722a","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":103.35716247558594,"y":869.5000019073486,"wires":[["9a794d21.ff36e"]]},{"id":"1adaaa83.06a925","type":"http request","z":"deff4396.4722a","name":"245287","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=245287","tls":"","x":1051.2856712341309,"y":1431.2857117652893,"wires":[["d9e58002.9fc1c"]]},{"id":"6c476b82.940064","type":"http request","z":"deff4396.4722a","name":"140220","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=140220","tls":"","x":623.7142944335938,"y":166.2857666015625,"wires":[["eaf4f40f.e8ed28"]]},{"id":"f8eb0173.2252d","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":779.428653717041,"y":540.8572254180908,"wires":[["3170a08f.1813b"]]},{"id":"76da8650.357888","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":769.4287147521973,"y":1110.8572254180908,"wires":[["3170a08f.1813b"]]},{"id":"3170a08f.1813b","type":"join","z":"deff4396.4722a","name":"","mode":"custom","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"52","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1219.7143859863281,"y":741.9048280715942,"wires":[["6581ffca.63a8d","44e592ad.9a6ddc"]]},{"id":"469227b5.c6eef8","type":"http request","z":"deff4396.4722a","name":"166508","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=166508","tls":"","x":1055.4285850524902,"y":1122.8572072982788,"wires":[["ef95bde3.c855a"]]},{"id":"b4f9a545.f63e08","type":"http request","z":"deff4396.4722a","name":"756687","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=756687","tls":"","x":605.1428833007812,"y":1494.8571472167969,"wires":[["7a6e8007.870a7"]]},{"id":"54ce4819.408ba8","type":"http request","z":"deff4396.4722a","name":"216699","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=216699","tls":"","x":619.2857971191406,"y":617.8572163581848,"wires":[["9130ce49.eaa87"]]},{"id":"7e267bbe.156c74","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":772.285831451416,"y":929.4286518096924,"wires":[["3170a08f.1813b"]]},{"id":"7df23347.bffebc","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":782.4286231994629,"y":126.42862844467163,"wires":[["3170a08f.1813b"]]},{"id":"149647c7.c11978","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":762.428596496582,"y":1567.8571772575378,"wires":[["3170a08f.1813b"]]},{"id":"d903a785.ff03e8","type":"http request","z":"deff4396.4722a","name":"224097","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=224097","tls":"","x":616.4286193847656,"y":763.5714955329895,"wires":[["22131597.af008a"]]},{"id":"fdec048a.e11958","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":770.8573036193848,"y":1073.7143726348877,"wires":[["3170a08f.1813b"]]},{"id":"b68336d4.054558","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":776.5715370178223,"y":688.000078201294,"wires":[["3170a08f.1813b"]]},{"id":"f1a94e7f.56c71","type":"debug","z":"deff4396.4722a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1526.4643745422363,"y":644.1905612945557,"wires":[]},{"id":"1b708a40.bc22e6","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1211.4285888671875,"y":1390,"wires":[["3170a08f.1813b"]]},{"id":"4e54c0b4.4add2","type":"http request","z":"deff4396.4722a","name":"242835","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=242835","tls":"","x":613.5715026855469,"y":965.000084400177,"wires":[["37e5b062.80bce"]]},{"id":"7dea07a4.eb3178","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":1212.857177734375,"y":1318.5714263916016,"wires":[["3170a08f.1813b"]]},{"id":"aba61f04.d6b4","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":1210,"y":1464.2857055664062,"wires":[["3170a08f.1813b"]]},{"id":"337ddd2c.8be9c2","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 2;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":778.1429176330566,"y":313.57148122787476,"wires":[["3170a08f.1813b"]]},{"id":"561abb64.a6d934","type":"http request","z":"deff4396.4722a","name":"224744","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=224744","tls":"","x":1053.9999694824219,"y":1231.4286546707153,"wires":[["4cbcbf45.90a3e"]]},{"id":"7c37c98.f823d38","type":"http request","z":"deff4396.4722a","name":"740390","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=740390","tls":"","x":605.1428833007812,"y":1460.5714416503906,"wires":[["16efb32e.155fed"]]},{"id":"20a2e4e0.3be61c","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":766.7143898010254,"y":1382.1428771018982,"wires":[["3170a08f.1813b"]]},{"id":"e6127662.487908","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 4;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":763.8572120666504,"y":1530.7143187522888,"wires":[["3170a08f.1813b"]]},{"id":"eaf4f40f.e8ed28","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 2;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":782.4286231994629,"y":165.0000548362732,"wires":[["3170a08f.1813b"]]},{"id":"37e5b062.80bce","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":772.285831451416,"y":963.7143726348877,"wires":[["3170a08f.1813b"]]},{"id":"ee1898c6.e49f28","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno + \"C\", payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":766.5715103149414,"y":1259.4286727905273,"wires":[["3170a08f.1813b","7e85e10b.d1b0b"]]},{"id":"30b152ff.b14d9e","type":"http request","z":"deff4396.4722a","name":"252411","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=252411","tls":"","x":1051.2856712341309,"y":1465.5714173316956,"wires":[["aba61f04.d6b4"]]},{"id":"7f508c8f.f2e924","type":"inject","z":"deff4396.4722a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1202.2857317243302,"y":372.0000501360212,"wires":[["bdf0878d.29af48"]]},{"id":"f81f56b3.959ef8","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":776.7143020629883,"y":422.1429286003113,"wires":[["3170a08f.1813b"]]},{"id":"bdf0878d.29af48","type":"function","z":"deff4396.4722a","name":"","func":"msg.payload = flow.get(\"243236\");\nreturn msg;","outputs":1,"noerr":0,"x":1358.000017438616,"y":414.85719299316406,"wires":[["6575aa91.007b84"]]},{"id":"92396b62.ba1558","type":"http request","z":"deff4396.4722a","name":"230515","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=230515","tls":"","x":612.2857666015625,"y":892.0000762939453,"wires":[["d6d0da5d.b2e428"]]},{"id":"109f5d7f.231ff3","type":"http request","z":"deff4396.4722a","name":"730467","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=730467","tls":"","x":606.5714721679688,"y":1420.5714416503906,"wires":[["a70365be.8b2f78"]]},{"id":"7a6e8007.870a7","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":763.8572120666504,"y":1493.5714354515076,"wires":[["3170a08f.1813b"]]},{"id":"7ca5b1e6.483b9","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":768.0001258850098,"y":1185.142930984497,"wires":[["3170a08f.1813b"]]},{"id":"e1637849.f99568","type":"http request","z":"deff4396.4722a","name":"216172","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=216172","tls":"","x":619.4285888671875,"y":469.14292907714844,"wires":[["9a5d1616.d83a58"]]},{"id":"ee6afd61.4e7cf","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 2;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":778.1429176330566,"y":347.857186794281,"wires":[["3170a08f.1813b"]]},{"id":"9a794d21.ff36e","type":"function","z":"deff4396.4722a","name":"","func":"if (flow.get(\"comprobado\") === undefined)flow.set(\"comprobado\", 0);\n\nvar frecuencia = 10;\nvar tiempo = parseInt(global.get(\"mm\")) % frecuencia;\n\nif (parseInt(global.get(\"hh\")) === 22 && parseInt(global.get(\"mm\")) === 0 && parseInt(global.get(\"ss\")) === 13){\n\tflow.set(\"comprobado\", 0);\n}\n\nnode.status({text: tiempo + \" - \" + flow.get(\"comprobado\") + \" - \" + global.get(\"hsCpu\")});\n\n// if (parseInt(global.get(\"hh\")) === 1 && context.revisando === 0) {\n// \tflow.set(\"comprobado\", 0);\n// \tcontext.revisando = 1;\n// }\n\n// if (flow.get(\"comprobado\") === 1)context.revisando = 0;\n\nif (tiempo === 0 && flow.get(\"comprobado\") === 0){\n\tmsg = {pedido: \"automatico\", payload: \"comprobar\"};\n\treturn msg;\n}\n\nif (msg.topic == \"comprobar\"){\n    msg = {pedido: \"automatico\", payload: \"comprobar\"};\n    return msg;\n}\n\n// if (global.get(\"hh\") === 22 && global.get(\"mm\") === 0 && global.get(\"ss\") === 3) context.revisando = 1;\n//     msg = {pedido: \"automatico\", payload: \"comprobar\"};\n//     return msg;\n// }\n\n\n","outputs":1,"noerr":0,"x":252.2857208251953,"y":869.1428413391113,"wires":[["690fa2ad.6e899c","e6e19c04.028c2","d903a785.ff03e8","2313909a.a4c4d","5ad760ff.99fd8","576569dc.1f60c8","54ce4819.408ba8","ee9595b0.139958","a931ef28.863ad","4ae8fbed.dbc814","e1637849.f99568","e0f6cdfd.a62bf","bc0ed3c2.0b241","d1f7dd08.140b9","8d1e731c.cb342","641eea95.956894","73fa44dc.96d24c","d9442c12.5d71c","c9edb946.55d838","b90017fb.9ffbe8","57143856.e8f2e8","92396b62.ba1558","b3a7fbf3.922e48","4e54c0b4.4add2","4ff7c4b4.6171dc","c98bdd84.bfad9","9fff4fff.b3553","f180d7aa.a01048","32359295.b3048e","90062b1c.b307f8","a8012455.e32078","1145a554.3866db","b42376a.e111f88","76e899ab.f8ae08","46937669.1307c8","109f5d7f.231ff3","7c37c98.f823d38","b4f9a545.f63e08","88d7a18f.f34ef","def30510.94f998","6c476b82.940064","469227b5.c6eef8","a5daacc0.adaa6","a63f9ad.d1fce68","561abb64.a6d934","1b6d2ac5.036c35","171b314a.622d6f","b645b943.501e88","3b210264.5f0bee","1adaaa83.06a925","30b152ff.b14d9e","f772061b.e1cad8","7db76493.6cbb1c"]]},{"id":"7a2cbbe6.736ef4","type":"blynk-ws-out-write","z":"deff4396.4722a","name":"","pin":"100","pinmode":0,"client":"2c18e412.5f5cbc","x":1553.7144165039062,"y":812.0000038146973,"wires":[]},{"id":"5ad760ff.99fd8","type":"http request","z":"deff4396.4722a","name":"218136","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=218136","tls":"","x":617.8572082519531,"y":689.2857899665833,"wires":[["b68336d4.054558"]]},{"id":"c313a7b1.5f0fd8","type":"http in","z":"deff4396.4722a","name":"Request","url":"/cope","method":"get","upload":false,"swaggerDoc":"","x":252.2857551574707,"y":955.1429014205933,"wires":[["57143856.e8f2e8","b90017fb.9ffbe8","c9edb946.55d838","6c476b82.940064","d9442c12.5d71c","73fa44dc.96d24c","641eea95.956894","8d1e731c.cb342","d1f7dd08.140b9","bc0ed3c2.0b241","e0f6cdfd.a62bf","e1637849.f99568","4ae8fbed.dbc814","a931ef28.863ad","ee9595b0.139958","54ce4819.408ba8","576569dc.1f60c8","5ad760ff.99fd8","2313909a.a4c4d","d903a785.ff03e8","e6e19c04.028c2","690fa2ad.6e899c","92396b62.ba1558","b3a7fbf3.922e48","4e54c0b4.4add2","4ff7c4b4.6171dc","c98bdd84.bfad9","9fff4fff.b3553","f180d7aa.a01048","32359295.b3048e","90062b1c.b307f8","a8012455.e32078","1145a554.3866db","b42376a.e111f88","76e899ab.f8ae08","46937669.1307c8","109f5d7f.231ff3","7c37c98.f823d38","b4f9a545.f63e08","88d7a18f.f34ef","def30510.94f998","f772061b.e1cad8","30b152ff.b14d9e","1adaaa83.06a925","3b210264.5f0bee","b645b943.501e88","171b314a.622d6f","1b6d2ac5.036c35","561abb64.a6d934","a63f9ad.d1fce68","a5daacc0.adaa6","469227b5.c6eef8"]]},{"id":"576569dc.1f60c8","type":"http request","z":"deff4396.4722a","name":"217334","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=217334","tls":"","x":619.2857971191406,"y":652.1429371833801,"wires":[["d633738.179be9"]]},{"id":"46937669.1307c8","type":"http request","z":"deff4396.4722a","name":"705207","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=705207","tls":"","x":608.0000610351562,"y":1383.4285888671875,"wires":[["20a2e4e0.3be61c"]]},{"id":"d633738.179be9","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":778.0001258850098,"y":650.8572254180908,"wires":[["3170a08f.1813b"]]},{"id":"a70365be.8b2f78","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 4;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n\n","outputs":1,"noerr":0,"x":765.2858009338379,"y":1419.2857298851013,"wires":[["3170a08f.1813b"]]},{"id":"5c0e05ce.6a04ac","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":782.4286231994629,"y":92.14290761947632,"wires":[["3170a08f.1813b"]]},{"id":"1a443eaf.be41f1","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n\n","outputs":1,"noerr":0,"x":1214.2857055664062,"y":1281.4285736083984,"wires":[["3170a08f.1813b"]]},{"id":"32359295.b3048e","type":"http request","z":"deff4396.4722a","name":"248167","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=248167","tls":"","x":609.2857971191406,"y":1152.1429371833801,"wires":[["b546b13.ef12a5"]]},{"id":"b645b943.501e88","type":"http request","z":"deff4396.4722a","name":"243239","method":"GET","ret":"txt","url":"https://www.lacoopeencasa.coop/ws/index.php/articulo/articuloController/articulo_detalle?cod_interno=243239","tls":"","x":1054.1428489685059,"y":1354.1428589820862,"wires":[["59a29fe5.2caf4"]]},{"id":"b546b13.ef12a5","type":"function","z":"deff4396.4722a","name":"","func":"var cantidad = 1;\nvar payload = msg.payload;\npayload = \"{\" + payload.substring(payload.indexOf(\"cod_interno\")-1, payload.indexOf(\"uxc\")-2) + \"}\";\nvar dato = JSON.parse(payload);\npayload = payload.substring(0, payload.length - 1); \npayload += \",\\\"total\\\": \\\"\" + dato.precio * cantidad;\npayload += \"\\\",\\\"cantidad\\\": \\\"\" + cantidad + \"\\\"}\";\nflow.set(dato.cod_interno, payload); \nmsg.payload = flow.get(dato.cod_interno);\nreturn msg;\n","outputs":1,"noerr":0,"x":768.0001258850098,"y":1150.8572254180908,"wires":[["3170a08f.1813b"]]},{"id":"405016a2.5b5178","type":"debug","z":"1b403a13.0ec8c6","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":820,"y":200,"wires":[]},{"id":"738fdb7.03ae024","type":"blynk-ws-in-write","z":"1b403a13.0ec8c6","name":"bomba man/auto","pin":"101","pin_all":0,"client":"2c18e412.5f5cbc","x":280,"y":250,"wires":[["34ae7c41.536534"]]},{"id":"ab29cf9.0abc23","type":"blynk-ws-in-write","z":"1b403a13.0ec8c6","name":"marcha bomba","pin":"102","pin_all":0,"client":"2c18e412.5f5cbc","x":280,"y":300,"wires":[["34ae7c41.536534"]]},{"id":"ad455046.6f0f4","type":"blynk-ws-in-write","z":"1b403a13.0ec8c6","name":"resistencia man/auto","pin":"103","pin_all":0,"client":"2c18e412.5f5cbc","x":270,"y":350,"wires":[["34ae7c41.536534"]]},{"id":"411433a9.c1b67c","type":"blynk-ws-in-write","z":"1b403a13.0ec8c6","name":"encendido resistencia","pin":"104","pin_all":0,"client":"2c18e412.5f5cbc","x":260,"y":400,"wires":[["34ae7c41.536534"]]},{"id":"840a50b6.4a71e","type":"inject","z":"f682d492.22a758","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":380,"wires":[["4f9303f0.e61c5c"]]},{"id":"fc135b52.7e6988","type":"debug","z":"1b403a13.0ec8c6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":680,"y":320,"wires":[]},{"id":"257acfc3.b3265","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"USBin/Baterias","qos":"2","broker":"c339edbf.39572","x":480,"y":420,"wires":[["97d91f4a.eea84"]]},{"id":"97d91f4a.eea84","type":"function","z":"3ce5b54a.127d6a","name":"","func":"var dato = JSON.parse(msg.payload);\nif (dato.topic === \"Cargador\")return msg;","outputs":1,"noerr":0,"x":630,"y":420,"wires":[["82c1e55f.ffbcf8"]]},{"id":"82c1e55f.ffbcf8","type":"debug","z":"3ce5b54a.127d6a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770,"y":420,"wires":[]},{"id":"93406c91.0eb21","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"32","payloadType":"num","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":320,"y":90,"wires":[["1e933d8e.6df622"]]},{"id":"1e933d8e.6df622","type":"function","z":"3ce5b54a.127d6a","name":"pwmPatioLuz","func":"global.set(\"pwmPatioLuz\", msg.payload)\nnode.status({text: global.get(\"pwmPatioLuz\")})","outputs":1,"noerr":0,"x":500,"y":90,"wires":[[]]},{"id":"9059c158.93b98","type":"debug","z":"a89e305a.c50bb","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":790,"y":230,"wires":[]},{"id":"b542c7c6.822fe8","type":"mqtt in","z":"1b403a13.0ec8c6","name":"Crepuscular","topic":"ESP/TermoSolar/Crepuscular","qos":"2","broker":"e779f8d6.7bc2c8","x":170,"y":570,"wires":[["9a4e037f.7547e","bb45cfec.5bba7"]]},{"id":"9dae04ec.3604a8","type":"inject","z":"1b403a13.0ec8c6","name":"noche","topic":"ESP/TermoSolar/Crepuscular","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":490,"wires":[["bb45cfec.5bba7"]]},{"id":"bb45cfec.5bba7","type":"function","z":"1b403a13.0ec8c6","name":"","func":"var payload = parseInt(msg.payload);\nif (payload === 1){// payload == valor analogico dia/noche\n\tglobal.set(\"Dia\", payload);\n\tglobal.set(\"hsAmanecer\",  global.get(\"hsCpu\"));\n\tmsg = {topic: \"notifyBlynk\", payload: \"Se hizo de dia \" + global.get(\"hsAmanecer\")}; node.send(msg);\n\tmsg = {topic: \"crepMQTT\", payload: payload}; node.send(msg);\n\tmsg = {topic: \"terminalBlynk\", payload: global.get(\"hsCPU\" + \" se hizo de dia defasaje termo 1hs\\n\")}; node.send(msg);\n\tglobal.set(\"avisoMail\", \" se hizo de dia:  \" + global.get(\"hsAmanecer\"));\n}\nif (payload === 0){\n\tglobal.set(\"Dia\", payload);\n\tglobal.set(\"hsAnochecer\",  global.get(\"hsCpu\"));\n\tmsg = {topic: \"notifyBlynk\", payload: \"Se hizo de noche \" + global.get(\"hsAnochecer\")}; node.send(msg);\n\tmsg = {topic: \"crepMQTT\", payload: payload}; node.send(msg);\t\n\tmsg = {topic: \"terminalBlynk\", payload: global.get(\"hsCPU\" + \" se hizo de noche defasaje termo 3hs\\n\")}; node.send(msg);\n\tglobal.set(\"avisoMail\", \" se hizo de noche:  \" + global.get(\"hsAnochecer\"));\n}\nif (global.get(\"Dia\") === 1)node.status({text: \"amanecio: \" + global.get(\"hsAmanecer\")})\nif (global.get(\"Dia\") === 0)node.status({text: \"Oscurecio: \" + global.get(\"hsAnochecer\")})\n","outputs":1,"noerr":0,"x":330,"y":520,"wires":[["5054de74.d7ab1","e47cf739.f64318"]]},{"id":"5054de74.d7ab1","type":"mqtt out","z":"1b403a13.0ec8c6","name":"","topic":"","qos":"2","retain":"","broker":"e779f8d6.7bc2c8","x":460,"y":490,"wires":[]},{"id":"81b26807.0eb538","type":"inject","z":"1b403a13.0ec8c6","name":"dia","topic":"ESP/TermoSolar/Crepuscular","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":530,"wires":[["bb45cfec.5bba7"]]},{"id":"84c16a28.780968","type":"debug","z":"1b403a13.0ec8c6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":930,"y":570,"wires":[]},{"id":"f2b879b7.06d858","type":"e-mail","z":"1b403a13.0ec8c6","server":"smtp.mail.yahoo.com","port":"465","secure":true,"name":"gdietrich22@yahoo.com.ar","dname":"gd28722563","x":920,"y":530,"wires":[]},{"id":"75970444.b3e18c","type":"mqtt in","z":"1b403a13.0ec8c6","name":"","topic":"crepMQTT","qos":"2","broker":"e779f8d6.7bc2c8","x":640,"y":520,"wires":[["a8b86121.02df6","4036110a.2a78c"]]},{"id":"ec863cce.8366f","type":"inject","z":"1b403a13.0ec8c6","name":"","topic":"","payload":"2","payloadType":"global","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":650,"y":570,"wires":[["a8b86121.02df6"]]},{"id":"a8b86121.02df6","type":"function","z":"1b403a13.0ec8c6","name":"","func":"msg.payload = \"cambio en sensor crepuscular\" + global.get(\"avisoMail\") + \" valor sensor: \" + global.get(\"sensorCrep\");\nreturn msg;","outputs":1,"noerr":0,"x":780,"y":570,"wires":[["f2b879b7.06d858","84c16a28.780968"]]},{"id":"4036110a.2a78c","type":"debug","z":"1b403a13.0ec8c6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":900,"y":490,"wires":[]},{"id":"bc78c9b1.093fa8","type":"mqtt out","z":"3ce5b54a.127d6a","name":"","topic":"","qos":"","retain":"","broker":"c339edbf.39572","x":1844.166919708252,"y":92.78570529392789,"wires":[]},{"id":"9a4e037f.7547e","type":"debug","z":"1b403a13.0ec8c6","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":350,"y":570,"wires":[]},{"id":"e47cf739.f64318","type":"debug","z":"1b403a13.0ec8c6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":460,"y":530,"wires":[]},{"id":"7b9c509e.eef1d","type":"delay","z":"1b403a13.0ec8c6","name":"100mS","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":300,"y":210,"wires":[["34ae7c41.536534"]]},{"id":"958c3f89.0f016","type":"delay","z":"50119c6e.6ff584","name":"50","pauseType":"delay","timeout":"200","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":350,"y":200,"wires":[["3c0f64c7.dcf05c"]]},{"id":"8fd47f48.1875","type":"inject","z":"50119c6e.6ff584","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":200,"y":180,"wires":[["958c3f89.0f016"]]},{"id":"6f887f0c.714be","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1320,"y":880,"wires":[["893a6b3c.fdb088"]]},{"id":"94b03f1c.aefa4","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"inicio","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":"5","x":1670,"y":840,"wires":[["22b6af56.2caa3"]]},{"id":"22b6af56.2caa3","type":"function","z":"3ce5b54a.127d6a","name":"","func":"if (global.get(\"estadoAlarma\") === undefined)global.set(\"estadoAlarma\", 0);","outputs":1,"noerr":0,"x":1800,"y":840,"wires":[[]]},{"id":"6cb809d6.6cdd88","type":"ping","z":"f682d492.22a758","name":"","host":"www.google.com","timer":"15","x":1160,"y":70,"wires":[["62bfbe22.257cd","74dde7f7.025908"]]},{"id":"62bfbe22.257cd","type":"function","z":"f682d492.22a758","name":"reinicio por falta de internet","func":"var hh = new Date().getHours();\nvar payload = msg.payload;\ncontext.contador = context.contador || 0;\ncontext.hh = context.hh || 25;\nnode.status({text: context.contador + \" -- \" + hh + \"  --  \" + context.hh});\n\nif (payload === false && context.hh != hh ){\n    context.contador = context.contador + 1;\n    if (context.contador === 4){\n        context.hh = hh;\n        context.contador = 0;\n        msg = {topic: \"reiniciar\", payload: 1};\n        return msg;\n    }\n    return;\n}\nif (payload !== false){context.contador = 0; context.hh = 25;}\n","outputs":1,"noerr":0,"x":1200,"y":105,"wires":[["e2d0535c.d2c9d","fd732d20.9aba"]]},{"id":"db675f86.7f662","type":"mqtt out","z":"f682d492.22a758","name":"","topic":"","qos":"","retain":"","broker":"af08803a.808f4","x":1820,"y":130,"wires":[]},{"id":"74dde7f7.025908","type":"debug","z":"f682d492.22a758","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1360,"y":70,"wires":[]},{"id":"e2d0535c.d2c9d","type":"debug","z":"f682d492.22a758","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1420,"y":105,"wires":[]},{"id":"fd732d20.9aba","type":"function","z":"f682d492.22a758","name":"reinicio auto lunes (02:03:08)","func":"context.reset = context.reset || 0;\nnode.status({text: global.get(\"fechaDia\") + \" - \" + context.reset});\nif (msg.topic == \"reiniciar\"){\n    msg = {topic: \"USBout\", payload: \"resetAntenas\"};\n    node.send(msg);}\n\nif (global.get(\"fechaDia\") === 1 && parseInt(global.get(\"hh\")) === 2 && parseInt(global.get(\"mm\")) === 17 && context.reset >= 1)context.reset = 0;\n\nif (global.get(\"fechaDia\") === 1 && parseInt(global.get(\"hh\")) === 2 && parseInt(global.get(\"mm\")) === 16 && parseInt(global.get(\"ss\")) >= 8 && context.reset === 0){\n    context.reset = 1; msg = {topic: \"USBout\", payload: \"resetAntenas\"}; node.send(msg);}","outputs":1,"noerr":0,"x":1470,"y":140,"wires":[["cc37a35f.53da","d5ad64af.c54c88","18bf2bec.56ad94"]]},{"id":"4019a8f5.184778","type":"inject","z":"f682d492.22a758","name":"","topic":"","payload":"","payloadType":"date","repeat":"14","crontab":"","once":false,"onceDelay":0.1,"x":1155,"y":145,"wires":[["fd732d20.9aba"]]},{"id":"5f5b955a.1cdf7c","type":"inject","z":"f682d492.22a758","name":"reinicio manual","topic":"reiniciar","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1150,"y":180,"wires":[["fd732d20.9aba"]]},{"id":"cc37a35f.53da","type":"debug","z":"f682d492.22a758","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1540,"y":230,"wires":[]},{"id":"6d8cc839.564468","type":"blynk-ws-in-write","z":"f682d492.22a758","name":"reset router","pin":"117","pin_all":0,"client":"2c18e412.5f5cbc","x":1120,"y":220,"wires":[["7127a9af.d9a888"]]},{"id":"7127a9af.d9a888","type":"function","z":"f682d492.22a758","name":"","func":"if (msg.payload != \"1\")return;\nmsg = {topic: \"reiniciar\", payload: 1};\nreturn msg;","outputs":1,"noerr":0,"x":1260,"y":220,"wires":[["fd732d20.9aba"]]},{"id":"29b9e573.32e7ca","type":"blynk-ws-out-set-property","z":"3ce5b54a.127d6a","name":"","pin":0,"pinmode":"1","prop":"bycode","client":"2c18e412.5f5cbc","x":1961.3927841186523,"y":635.9643287658691,"wires":[]},{"id":"e4bbd9b5.cf9f18","type":"delay","z":"3ce5b54a.127d6a","name":"100mS","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1901.3927841186523,"y":595.9643287658691,"wires":[["73837d68.7c6a34"]]},{"id":"dbca9704.86fae8","type":"inject","z":"1b403a13.0ec8c6","name":"timer","topic":"timer","payload":"1","payloadType":"str","repeat":"24","crontab":"","once":false,"onceDelay":0.1,"x":310,"y":90,"wires":[["34ae7c41.536534"]]},{"id":"504fa5d9.30bf1c","type":"function","z":"1b403a13.0ec8c6","name":"","func":"msg = {pin: 127, payload: global.get(\"hsCpu\") + \" -- \" + msg.payload + \"\\n\"};\n// if (msg.payload.includes(\"bomba\") )return msg;\nreturn msg;","outputs":1,"noerr":0,"x":1280,"y":90,"wires":[["25daaf68.5e6d4"]]},{"id":"25daaf68.5e6d4","type":"blynk-ws-out-write","z":"1b403a13.0ec8c6","name":"","pin":0,"pinmode":"1","client":"2c18e412.5f5cbc","x":1460,"y":90,"wires":[]},{"id":"7eb15376.c14e5c","type":"mqtt in","z":"1b403a13.0ec8c6","name":"EstadoBomba","topic":"ESP/TermoSolar/EstadoBomba","qos":"2","broker":"900627dc.76e6a8","x":1070,"y":130,"wires":[["504fa5d9.30bf1c","2f9c07a5.d12e38"]]},{"id":"1fc3f648.3d3c9a","type":"inject","z":"1b403a13.0ec8c6","name":"sin debug","topic":"ESP/TermoSolar/Recibo","payload":"debug0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1180,"y":180,"wires":[["6b84ff87.25f1f"]]},{"id":"43d32cfa.9c0c44","type":"inject","z":"1b403a13.0ec8c6","name":"con debug","topic":"ESP/TermoSolar/Recibo","payload":"debug1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1180,"y":220,"wires":[["6b84ff87.25f1f"]]},{"id":"6b84ff87.25f1f","type":"mqtt out","z":"1b403a13.0ec8c6","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1320,"y":200,"wires":[]},{"id":"43e727a2.f0f9e8","type":"debug","z":"1b403a13.0ec8c6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":700,"y":110,"wires":[]},{"id":"3fd16520.fa514a","type":"inject","z":"1b403a13.0ec8c6","name":"pruea timer","topic":"ESP/TermoSolar/Recibo","payload":"prueba30","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1180,"y":260,"wires":[["6b84ff87.25f1f"]]},{"id":"9ac4a3ca.adf2f","type":"mqtt out","z":"1b403a13.0ec8c6","name":"pedido","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1820,"y":520,"wires":[]},{"id":"2f9c07a5.d12e38","type":"debug","z":"1b403a13.0ec8c6","name":"debug","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1280,"y":130,"wires":[]},{"id":"4925f5fb.a7fa3c","type":"debug","z":"1b403a13.0ec8c6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1270,"y":40,"wires":[]},{"id":"10f2739.582f28c","type":"function","z":"1b403a13.0ec8c6","name":"","func":"msg = {topic: \"ESP/TermoSolar/Recibo\", payload: \"prueba40\"}; node.send(msg);","outputs":1,"noerr":0,"x":1560,"y":520,"wires":[["9ac4a3ca.adf2f","18802ee4.257301"]]},{"id":"43b083da.46c06c","type":"delay","z":"1b403a13.0ec8c6","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1420,"y":520,"wires":[["10f2739.582f28c","7e67a696.be95b8"]]},{"id":"1cfe2f00.c9dec1","type":"mqtt in","z":"1b403a13.0ec8c6","name":"","topic":"ESP/TermoSolar/Config","qos":"2","broker":"e779f8d6.7bc2c8","x":1140,"y":620,"wires":[["5bdf2471.28750c","d3227bdc.56b938"]]},{"id":"179e0cda.eb9203","type":"file in","z":"1b403a13.0ec8c6","name":"recover datos termo","filename":"/home/gaston/BackUp-Node-Red/DatosTermo.txt","format":"utf8","chunk":false,"sendError":false,"x":1470,"y":570,"wires":[["7f41c912.6882e8"]]},{"id":"b4af68b9.58d648","type":"file","z":"1b403a13.0ec8c6","name":"back datos termo","filename":"/home/gaston/BackUp-Node-Red/DatosTermo.txt","appendNewline":false,"createDir":false,"overwriteFile":"true","x":1490,"y":620,"wires":[[]]},{"id":"69952cc0.bc9f34","type":"inject","z":"1b403a13.0ec8c6","name":"","topic":"","payload":"0#0#0#0#0#0#80#55#50#40#650#500#90#1#3","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1320,"y":660,"wires":[["b4af68b9.58d648"]]},{"id":"18802ee4.257301","type":"debug","z":"1b403a13.0ec8c6","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1810,"y":480,"wires":[]},{"id":"5bdf2471.28750c","type":"debug","z":"1b403a13.0ec8c6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1470,"y":660,"wires":[]},{"id":"c808b636.2b3e58","type":"ui_gauge","z":"3ce5b54a.127d6a","name":"","group":"1134b585.4c9e0a","order":4,"width":"2","height":"2","gtype":"gage","title":"Corr. Carga","label":"Ampers","format":"{{value}}","min":"0","max":"20","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":2800,"y":300,"wires":[]},{"id":"766418ef.bc0a18","type":"inject","z":"1b403a13.0ec8c6","name":"","topic":"","payload":"","payloadType":"date","repeat":"15","crontab":"","once":false,"onceDelay":0.1,"x":1660,"y":90,"wires":[[]]},{"id":"30b150ae.4fed5","type":"blynk-ws-in-write","z":"1b403a13.0ec8c6","name":"Rociador 99","pin":"99","pin_all":0,"client":"2c18e412.5f5cbc","x":1660,"y":130,"wires":[["5b774dd6.b86b34","edb86a7b.414028"]]},{"id":"5b774dd6.b86b34","type":"function","z":"1b403a13.0ec8c6","name":"","func":"if (global.get(\"rociadorToldo\") === undefined)global.set(\"rociadorToldo\", 0);\ncontext.contador = context.contador || 0;\ncontext.manual = context.manual || 0;\nvar topic = msg.topic;\n\nif (parseInt(global.get(\"hh\")) === 0 && context.manual === 1)context.manual = 0;\n\nif (topic == \"reset\"){\n  global.set(\"rociadorToldo\", 0);\n    msg.payload = \"reset\"; node.send([msg, null]);\n    context.manual = 0; return;}\n\nif (parseInt(global.get(\"hh\")) >= 10 && parseInt(global.get(\"hh\")) < 20 && global.get(\"tempExterior\") > 28 && global.get(\"rociadorToldo\") === 0 && context.manual === 0){\n    context.contador = 1;\n    global.set(\"rociadorToldo\", 1);\n    msg = {pin: 99, payload: 1}; node.send([null, msg]);\n    msg = {topic: \"USBout\", payload: \"rociar1\"}; node.send([msg, null]);\n    msg = {topic: \"ESP/Lavadero/Presurizadora\", payload: 1}; node.send([msg, null]);\n}\n\nif (global.get(\"rociadorToldo\") === 1){\n  if (parseInt(global.get(\"hh\")) >= 20 || global.get(\"tempExterior\") < 20){\n      context.contador = 0;\n      global.set(\"rociadorToldo\", 0);\n      msg = {pin: 99, payload: 0}; node.send([null, msg]);\n      msg = {topic: \"USBout\", payload: \"rociar0\"}; node.send([msg, null]);\n      msg = {topic: \"ESP/Lavadero/Presurizadora\", payload: 0}; node.send([msg, null]);\n  }\n}\n\nif (global.get(\"rociadorToldo\") === 1)context.contador++;\n\nif (context.contador === 120 && global.get(\"rociadorToldo\") === 1){\n    context.contador = 0;\n    msg = {topic: \"USBout\", payload: \"rociar1\"}; node.send([msg, null]);\n    msg = {topic: \"ESP/Lavadero/Presurizadora\", payload: 1}; node.send([msg, null]);\n}\n\nif (context.contador === 4 && global.get(\"rociadorToldo\") === 1){\n    msg = {topic: \"USBout\", payload: \"rociar0\"}; node.send([msg, null]);\n    msg = {topic: \"ESP/Lavadero/Presurizadora\", payload: 0}; node.send([msg, null]);\n}\n\nif (msg.pin == \"99\"){\n  if (parseInt(msg.payload) === 0)context.manual = 1;\n    global.set(\"rociadorToldo\", parseInt(msg.payload)); msg.payload = global.get(\"rociadorToldo\"); node.send([msg, null]);\n    context.contador = 0;\n    if (global.get(\"rociadorToldo\") === 0) {\n        msg = {topic: \"USBout\", payload: \"rociar0\"}; node.send([msg, null]);\n        msg = {topic: \"ESP/Lavadero/Presurizadora\", payload: 0}; node.send([msg, null]);\n    }\n    if (global.get(\"rociadorToldo\") === 1)  {\n        msg = {topic: \"USBout\", payload: \"rociar1\"}; node.send([msg, null]);\n        msg = {topic: \"ESP/Lavadero/Presurizadora\", payload: 1}; node.send([msg, null]);\n    }\n}\nnode.status({text: global.get(\"rociadorToldo\") + \" --- \" + context.contador + \"   11\"});\n","outputs":2,"noerr":0,"x":1830,"y":80,"wires":[["dcda9eca.6a496","25052ce2.cb02d4"],["92e48221.51213","6c64a60c.682a58"]]},{"id":"edb86a7b.414028","type":"debug","z":"1b403a13.0ec8c6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1800,"y":150,"wires":[]},{"id":"dcda9eca.6a496","type":"mqtt out","z":"1b403a13.0ec8c6","name":"","topic":"","qos":"2","retain":"","broker":"e779f8d6.7bc2c8","x":1970,"y":50,"wires":[]},{"id":"25052ce2.cb02d4","type":"debug","z":"1b403a13.0ec8c6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1970,"y":20,"wires":[]},{"id":"92e48221.51213","type":"blynk-ws-out-write","z":"1b403a13.0ec8c6","name":"","pin":0,"pinmode":"1","client":"2c18e412.5f5cbc","x":2010,"y":100,"wires":[]},{"id":"7db76493.6cbb1c","type":"debug","z":"deff4396.4722a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":260,"y":810,"wires":[]},{"id":"d5ad64af.c54c88","type":"delay","z":"f682d492.22a758","name":"","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1660,"y":90,"wires":[["db675f86.7f662"]]},{"id":"18bf2bec.56ad94","type":"function","z":"f682d492.22a758","name":"","func":"msg = {topic: \"notifyBlynk\", payload: global.get(\"hsCpu\") + \" - Reinicio antena en 15\"};\nnode.send(msg);\nmsg = {topic: \"terminalBlynk\", payload: global.get(\"hsCpu\") + \" - ResetAntenas\\n\"};\nreturn msg;","outputs":1,"noerr":0,"x":1660,"y":170,"wires":[["db675f86.7f662"]]},{"id":"3cb3e7ce.3bfa38","type":"blynk-ws-in-write","z":"1b403a13.0ec8c6","name":"debug","pin":"87","pin_all":0,"client":"2c18e412.5f5cbc","x":1390,"y":430,"wires":[["bc7b6932.26b618"]]},{"id":"bc7b6932.26b618","type":"template","z":"1b403a13.0ec8c6","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"debug{{payload}}","output":"str","x":1520,"y":430,"wires":[["5f53f36d.45d73c"]]},{"id":"5f53f36d.45d73c","type":"mqtt out","z":"1b403a13.0ec8c6","name":"debug","topic":"ESP/TermoSolar/Recibo","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1650,"y":430,"wires":[]},{"id":"7e67a696.be95b8","type":"delay","z":"1b403a13.0ec8c6","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1420,"y":470,"wires":[["5e5cf267.c0596c"]]},{"id":"5e5cf267.c0596c","type":"function","z":"1b403a13.0ec8c6","name":"","func":"msg = {topic: \"ESP/TermoSolar/Recibo\", payload: \"debug0\"}; node.send(msg);","outputs":1,"noerr":0,"x":1560,"y":470,"wires":[["9ac4a3ca.adf2f"]]},{"id":"e08a260.4d66ed8","type":"mqtt in","z":"1b403a13.0ec8c6","name":"","topic":"ESP/TermoSolar/pedido","qos":"2","broker":"e779f8d6.7bc2c8","x":1290,"y":700,"wires":[["f9b86e.43b3c79"]]},{"id":"f9b86e.43b3c79","type":"delay","z":"1b403a13.0ec8c6","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1470,"y":700,"wires":[["5e537393.e7ddbc"]]},{"id":"5e537393.e7ddbc","type":"function","z":"1b403a13.0ec8c6","name":"","func":"msg = {topic: \"ESP/TermoSolar/Recibo\", payload: \"debug0\"}; node.send(msg);","outputs":1,"noerr":0,"x":1600,"y":700,"wires":[["ce5f7470.b5c098"]]},{"id":"ce5f7470.b5c098","type":"mqtt out","z":"1b403a13.0ec8c6","name":"pedido","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1720,"y":700,"wires":[]},{"id":"272cfc40.f68d04","type":"mqtt in","z":"3ce5b54a.127d6a","name":"","topic":"informarNivel","qos":"2","broker":"e779f8d6.7bc2c8","x":350,"y":790,"wires":[["a9daa6c0.59e7c8"]]},{"id":"a9daa6c0.59e7c8","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg= {topic: \"nivTanque\", payload: global.get(\"nivTanque\")}; node.send(msg);\nmsg= {topic: \"tasaLlenado\", payload: parseFloat(global.get(\"tasaLlenadoTanque\")).toFixed(2)};\nnode.send(msg);\n\n\n\n","outputs":1,"noerr":0,"x":490,"y":790,"wires":[["d16ed06d.66af"]]},{"id":"a2cb8119.83298","type":"inject","z":"1b403a13.0ec8c6","name":"","topic":"reset","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1660,"y":50,"wires":[["5b774dd6.b86b34"]]},{"id":"6c64a60c.682a58","type":"debug","z":"1b403a13.0ec8c6","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1980,"y":140,"wires":[]},{"id":"d2a4ac6e.5eeda","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"USBin","qos":"2","broker":"e779f8d6.7bc2c8","x":80,"y":330,"wires":[["db7ae893.312628"]]},{"id":"db7ae893.312628","type":"function","z":"f682d492.22a758","name":"","func":"if (msg.payload.substring(0,10) == \"inicioNano\"){\n    msg.payload = global.get(\"hsCpu\") + \" se reinicio el nano de baterias\\n\";\n    return msg;\n}//inicioNode-Red\nif (msg.payload == \"inicioNode-Red\"){\n    msg.payload = global.get(\"hsCpu\") + \" inicio el servidor\\n\";\n    return msg;\n}//inicioNode-Red","outputs":1,"noerr":0,"x":200,"y":330,"wires":[["ebae64cd.6da328","4f9303f0.e61c5c"]]},{"id":"ebae64cd.6da328","type":"mqtt out","z":"f682d492.22a758","name":"","topic":"terminalBlynk","qos":"","retain":"","broker":"3fe9d635.ec409a","x":310,"y":230,"wires":[]},{"id":"53026f06.81437","type":"inject","z":"f682d492.22a758","name":"inicio serv","topic":"","payload":"inicioNode-Red","payloadType":"str","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":100,"y":280,"wires":[["db7ae893.312628"]]},{"id":"b1811f6e.55c69","type":"debug","z":"f682d492.22a758","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":750,"y":250,"wires":[]},{"id":"46b511c3.6bf47","type":"delay","z":"f682d492.22a758","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":560,"y":360,"wires":[["eef57e3.f227e8","daeb00a8.24e21","3b30e656.644aca"]]},{"id":"4f9303f0.e61c5c","type":"function","z":"f682d492.22a758","name":"","func":"msg.payload = \"{\\\"topic\\\":\\\"vMin\\\",\\\"payload\\\":\" + global.get(\"voltMinimoVaterias\") + \"}\";\nreturn msg;","outputs":1,"noerr":0,"x":390,"y":360,"wires":[["46b511c3.6bf47"]]},{"id":"daeb00a8.24e21","type":"debug","z":"f682d492.22a758","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":730,"y":390,"wires":[]},{"id":"75432a7.2b2c4d4","type":"function","z":"3ce5b54a.127d6a","name":"","func":"var dato = JSON.parse(msg.payload);\nif (dato.topic == \"Baterias/Est/Pedido/Resp\" || msg.topic == \"ESP/Pasillo/Sens/Temp/Pedido\"){\n    msg= {topic: \"tempAmbiente\", payload: global.get(\"tempAmbienteBat\")}; node.send(msg);\n    // node.status ({text: global.get(\"tempAmbienteBat\")});\n    msg= {topic: \"tempBat1\", payload: global.get(\"tempBat1\")}; node.send(msg);\n    msg= {topic: \"tempBat2\", payload: global.get(\"tempBat2\")}; node.send(msg);    \n    msg= {topic: \"tempCPU\", payload: global.get(\"tempCPU\")}; node.send(msg);\n    \n}","outputs":1,"noerr":0,"x":470,"y":870,"wires":[["d944bab3.e770c8","d30cd90.4d82b28"]]},{"id":"d944bab3.e770c8","type":"thingspeak42","z":"3ce5b54a.127d6a","name":"FUVQOCDCDSQ684O3","delay":"15","topic1":"tempAmbiente","topic2":"tempBat1","topic3":"tempBat2","topic4":"tempCPU","topic5":"","topic6":"","topic7":"","topic8":"","endpoint":"https://thingspeak.com","x":680,"y":870,"wires":[]},{"id":"d30cd90.4d82b28","type":"debug","z":"3ce5b54a.127d6a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":640,"y":920,"wires":[]},{"id":"3a7a3c27.58c5e4","type":"mqtt out","z":"73083520.75304c","name":"","topic":"Pedido/Lavadero/Bombas","qos":"","retain":"","broker":"c339edbf.39572","x":830,"y":430,"wires":[]},{"id":"d0fc2ceb.3a0fe","type":"mqtt in","z":"73083520.75304c","name":"","topic":"ESP/Lavadero/Inicio","qos":"2","broker":"c339edbf.39572","x":320,"y":390,"wires":[["372a31a9.dc04ae","2e997313.90675c"]]},{"id":"f8adc943.cc6928","type":"function","z":"73083520.75304c","name":"llenado de tanque (Andando)","func":"var dato = JSON.parse(msg.payload);\nvar nivMaximo = 480;\ncontext.estadoAnterior = context.estadoAnterior || 0;\ncontext.avisoTanque = context.avisoTanque || 0;\nif (global.get(\"fallasLavadero\") === undefined)global.set(\"fallasLavadero\", 0);\n\nif (msg.topic == \"blynk/marchaBomba\"){\n\t// context.avisoTanque = 0;\n\tif (msg.payload === 1)global.set(\"bombaPozo\", 1);\n\tif (msg.payload === 0)global.set(\"bombaPozo\", 0);\n\tmsg = {topic: \"ESP/Lavadero/Bombas/Estado/Rele1\", payload: global.get(\"bombaPozo\")}; node.send([msg, null]);\t\n}\n\nif (msg.topic == \"blynk/llenarTanque\"){\n\tcontext.avisoTanque = 0;\n    context.estadoAnterior = msg.payload;\n    global.set(\"llenarTanque\", msg.payload);\n    global.set(\"bombaPozo\",  msg.payload);\n    global.set(\"valvulaTanque\", msg.payload);\n    // if (global.get(\"nivTanque\") < nivMaximo - 10)global.set(\"valvulaTanque\", 1);\n    msg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"most\\\",\\\"payload\\\":\" + msg.payload + \"}\"}; node.send(msg);\n    enviarDatos();\n}\n\nif (dato.topic == \"bombaRF\"){\n\tif (global.get(\"bombaPozo\") === 0){global.set(\"bombaPozo\", 1);}else{global.set(\"bombaPozo\", 0);}\n\tmsg = {pin: 2, payload: global.get(\"bombaPozo\")}; node.send([null,msg]);\n\tmsg = {topic: \"ESP/Lavadero/Bombas/Estado/Rele1\", payload: global.get(\"bombaPozo\")}; node.send([msg, null]);\t\t\n\treturn;\n}\n\nif (dato.topic === \"google/Tanque\") enviarDatos();\n\nif (dato.topic === \"Nivel\"){\n\tglobal.set(\"nivTanque\", parseInt(dato.payload));\n\tmsg = {topic: \"nivel\", payload: global.get(\"nivTanque\") + \"mm\"}; node.send([msg, null]);\n\tmsg = {topic: \"Actualizacion/Baterias\", payload:\"\"}; node.send([msg, null]);\n\tactualizarEstado();}\n\nif (dato.topic === \"Niveles\"){\n\tmsg = {topic: \"nivMinimo\", payload: dato.nivMinimo};\n\tnode.send([msg, null]);\n\tmsg = {topic: \"nivMaximo\", payload: dato.nivMaximo};\n\tnode.send([msg, null]);\n\tmsg = {topic: \"nivel\", payload: dato.nivel}; global.set(\"nivTanque\", parseInt(dato.nivel)); \n\tnode.send([msg, null]);\n\tmsg = {topic: \"altTanque\", payload: dato.altTanque};\n\tnode.send([msg, null]);\n\tmsg = {topic: \"crepuscular\", payload: dato.crepuscular};\n\tnode.send([msg, null]);\n\tactualizarEstado();\n}\t\n\nif (msg.topic === \"configNano\"){\n\tvar item = msg.payload.split(\" \");\n\tif (item[0] === \"altTanque\")msg.payload = \"{\\\"topic\\\":\\\"altTanque\\\",\\\"payload\\\":\" + item[1] + \"\\\"}\";\n\tif (item[0] === \"minTanque\")msg.payload = \"{\\\"topic\\\":\\\"minTanque\\\",\\\"payload\\\":\" + item[1] + \"\\\"}\";\t\n\tif (item[0] === \"maxTanque\")msg.payload = \"{\\\"topic\\\":\\\"maxTanque\\\",\\\"payload\\\":\" + item[1] + \"\\\"}\";\t\n\tmsg = {topic: \"USBout\", payload: msg.payload}; node.send(msg);}\n\n// if (global.get(\"llenarTanque\") === 1 && global.get(\"nivTanque\") >= nivMaximo)\t{\n// \tglobal.set(\"llenarTanque\", 0);\n// \tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"most\\\",\\\"payload\\\":0}\"}; node.send(msg);\n//     context.estadoAnterior = 0;\n//     global.set(\"bombaPozo\", 0);\n//     global.set(\"valvulaTanque\", 0);\n//     enviarDatos();\t\n// }\n\nif (global.get(\"nivTanque\") >= nivMaximo && context.avisoTanque === 0){\n\tglobal.set(\"bombaPozo\", 0);\n\tglobal.set(\"valvulaTanque\", 0);\n\tglobal.set(\"llenarTanque\", 0);\n    msg = {topic: \"ESP/Lavadero/Bombas/Estado/Rele1\", payload: global.get(\"bombaPozo\")}; node.send(msg);\n    msg = {topic: \"ESP/Lavadero/Bombas/Estado/Rele0\", payload: global.get(\"valvulaTanque\")}; node.send(msg);\n    msg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"most\\\",\\\"payload\\\":0}\"}; node.send(msg);\n\tmsg = {topic: \"notifyBlynk\", payload:\"tanque lleno\"}; node.send(msg);\n\tmsg = {pin: 34, payload: global.get(\"llenarTanque\")}; node.send([null,msg]);\n\tmsg = {pin: 2, payload: global.get(\"bombaPozo\")}; node.send([null,msg]);\n\tcontext.avisoTanque = 1;}\n\nif (dato.topic === \"LlenarTanque\"){global.set(\"llenarTanque\", parseInt(dato.payload));}\n\nif (global.get(\"llenarTanque\") === 1 && context.estadoAnterior === 0){\n\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"most\\\",\\\"payload\\\":1}\"}; node.send(msg);\n    context.estadoAnterior = 1;\n    global.set(\"bombaPozo\", 1);\n    if (global.get(\"nivTanque\") < nivMaximo - 10){\tcontext.avisoTanque = 0; global.set(\"valvulaTanque\", 1);}\n    enviarDatos();\n    }\nif (global.get(\"llenarTanque\") === 0 && context.estadoAnterior === 1){\n\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"most\\\",\\\"payload\\\":0}\"}; node.send(msg);\n    context.estadoAnterior = 0;\n    global.set(\"bombaPozo\", 0);\n    global.set(\"valvulaTanque\", 0);\n    context.avisoTanque = 0;\n    enviarDatos();\n    }    \nnode.status({text: \"Bomba: \" + global.get(\"bombaPozo\") + \"  Valvula: \" + global.get(\"valvulaTanque\") + \" - \" + global.get(\"nivTanque\") + \" - \" + global.get(\"llenarTanque\") + \" - \" + context.estadoAnterior});\nif (msg.topic == \"Pedido/Lavadero/Bombas\") {\n\tvar fallasLavadero = global.get(\"fallasLavadero\") + 1;\n\tglobal.set(\"fallasLavadero\", fallasLavadero);\n\tenviarDatos();\n}\n\nfunction enviarDatos(){\n\t// context.avisoTanque = 0;\n\tmsg = {pin: 2, payload: global.get(\"bombaPozo\")}; node.send([null,msg]);\n    msg = {topic: \"ESP/Lavadero/Bombas/Estado/Rele1\", payload: global.get(\"bombaPozo\")}; node.send(msg);\n    msg = {topic: \"ESP/Lavadero/Bombas/Estado/Rele0\", payload: global.get(\"valvulaTanque\")}; node.send(msg);    \n}\n\nfunction actualizarEstado(){\n\tif (global.get(\"estadoToldo\") !== \"Abriendo\" && global.get(\"estadoToldo\") !== \"Cerrando\"){\n\t\tmsg = {topic: \"Blynk/actualizar/estado\", payload: \"\"};\n\t\tnode.send(msg);}\t\n}\n","outputs":2,"noerr":0,"x":610,"y":240,"wires":[[],[]]},{"id":"45a18b6.5a3e074","type":"blynk-ws-out-write","z":"73083520.75304c","name":"","pin":0,"pinmode":"1","client":"2c18e412.5f5cbc","x":900,"y":280,"wires":[]},{"id":"372a31a9.dc04ae","type":"function","z":"73083520.75304c","name":"llenado de tanque","func":"  context.nivelAnterior = context.nivelAnterior || 0;\n  context.estadoAnterior = context.estadoAnterior || 0;\n  // context.avisoTanque = context.avisoTanque || 0;\n  context.llenadoAnulado = context.llenadoAnulado || 0;\n  context.tiempoLlenado = context.tiempoLlenado || 0;\n  context.tiempoRestante = context.tiempoRestante || 0; // 0 == por nivel\n  context.nivelInicioLlenado = context.nivelInicioLlenado || 0;\n  context.tiempoInicioLlenado = context.tiempoInicioLlenado || 0;\n\n  var date = new Date();\n  // var dato = JSON.parse(msg.payload);\n  var topic = msg.topic;\n  var pin = parseInt(msg.pin);\n  var alturaTanque = 680;\n  var nivMaximo = 400;\n  var nivMinimo = 150;\n  var timerLuces = 12000;\n  var tasaLlenado = 0;\n  // var parseInt(msg.payload) = parseInt(msg.payload);\n\n  if (global.get(\"fallasLavadero\") === undefined)global.set(\"fallasLavadero\", 0);\n  if (global.get(\"luzLavadero\") === undefined)global.set(\"luzLavadero\", 0);\n  if (global.get(\"luzAlacenaLavadero\") === undefined)global.set(\"luzAlacenaLavadero\", 0);\n  if (global.get(\"bombaPozo\") === undefined)global.set(\"bombaPozo\", 0);\n  if (global.get(\"valvulaTanque\") === undefined)global.set(\"valvulaTanque\", 0);\n  if (global.get(\"bombaPileta\") === undefined)global.set(\"bombaPileta\", 0);\n  if (global.get(\"estadoEspTanque\") === undefined)global.set(\"estadoEspTanque\", 1);\n  if (global.get(\"tasaLlenadoTanque\") === undefined)global.set(\"tasaLlenadoTanque\", 0);\n\n  // node.status({text: global.get(\"estadoAlarma\") + \" -- \"  + global.get(\"luzLavadero\")});\n\n  if (topic == \"blynk/marchaBomba\")pin = 2;\n  if (topic == \"blynk/llenarTanque\")pin = 34;\n\n  if (topic == \"google/Alarma\" || topic == \"aviso/Alarma\"){\n    if (global.get(\"luzAlacenaLavadero\") === 1 || global.get(\"luzLavadero\") === 1){\n      node.status({text: global.get(\"estadoAlarma\") + \" -ppp- \"  + global.get(\"luzLavadero\")});\n      if (global.get(\"estadoAlarma\") === 1 && global.get(\"Dia\") === 0){setTimeout(apagadoLuces, timerLuces);}\n      if (global.get(\"estadoAlarma\") === 1 && global.get(\"Dia\") === 1)apagadoLuces();\n    }\n  } \n\n  if (topic == \"google/Lavadero\" || topic == \"crepMQTT\"){\n    enviarBlynk();\n    enviarDatos();\n  }   \n\n  // if (topic == \"ESP/Lavadero/Temperatura\"){\n  //   global.set(\"tempLavadero\", parseFloat(msg.payload).toFixed(2)); \n  //   return;\n  // }\n\n  if (topic == \"ESP/Lavadero/Envio\"){\n    var dato = msg.payload.split(\"#\");\n    global.set(\"bombaPozo\", parseInt(dato[0])); \n    global.set(\"bombaPileta\", parseInt(dato[1])); \n    global.set(\"luzLavadero\", parseInt(dato[2])); \n    global.set(\"luzAlacenaLavadero\", parseInt(dato[3])); \n  //   if (global.get(\"luzLavadero\") === 0)global.set(\"luzAlacenaLavadero\", 0); \n    enviarBlynk();\n    return;\n  }\n\n  if (topic == \"ESP/TanqueAgua/Desconectado\"){\n    var restante = parseInt(nivMaximo) - parseInt(global.get(\"nivTanque\"));\n    var tiempoRestante = (parseInt(restante) * 209) / 104;\n    context.tiempoRestante = parseInt(tiempoRestante * 1000);\n    global.set(\"estadoEspTanque\", 0);// 0 = Desconectado\n    return;\n  }  \n\n  if (topic == \"ESP/TanqueAgua/Inicio\"){\n    global.set(\"estadoEspTanque\", 1);\n    enviarDatos();    \n    return;\n  }   \n\n  // if (global.get(\"estadoEspTanque\") === 0 && global.get(\"llenarTanque\") === 1 && date.getTime() > parseInt(context.tiempoRestante)){\n  //   global.set(\"llenarTanque\", 0); global.set(\"bombaPozo\", 0);  global.set(\"valvulaTanque\", 0); \n  //   msg = {topic: \"notifyBlynk\", payload:\"tanque lleno por tiempo\"}; node.send(msg);\n  //   enviarBlynk(); \n  //   enviarDatos();  \n  // }\n\n  // if (dato.topic == \"bombaRF\"){\n  //   if (global.get(\"bombaPozo\") === 0){global.set(\"bombaPozo\", 1);}else{global.set(\"bombaPozo\", 0);}\n  //   enviarBlynk(); \n  //   enviarDatos(); //return;\n  // }\n\n  if (parseInt(global.get(\"llenarTanque\")) === 1 && parseInt(date.getTime()) > parseInt(context.tiempoLlenado)){\n    context.tiempoLlenado = date.getTime() + 60000;\n    msg = {topic: \"ESP/TanqueAgua/Recibo\", payload: \" \"}; node.send([msg, null]); \n    return;\n  }\n\n  // sube el nivel a razon de 104mm cada 209\"     42mm en 91\"\n  if (topic == \"ESP/TanqueAgua/Envio\"){\n    global.set(\"nivTanque\", parseInt(alturaTanque) - parseInt(msg.payload));\n\n    if (global.get(\"nivTanque\") != context.nivelAnterior){\n      context.nivelAnterior = global.get(\"nivTanque\");\n      if (parseInt(global.get(\"llenarTanque\")) === 1 && parseInt(global.get(\"nivTanque\")) < parseInt(nivMaximo)){\n        var var1 = global.get(\"nivTanque\");\n        tasaLlenado = (date.getTime() - parseInt(context.tiempoInicioLlenado)) / 60000;\n        tasaLlenado = parseFloat((var1 - context.nivelInicioLlenado) / tasaLlenado).toFixed(2);\n        context.nivelInicioLlenado = parseInt(global.get(\"nivTanque\"));\n        context.tiempoInicioLlenado = date.getTime();\n        global.set(\"tasaLlenadoTanque\", tasaLlenado);      \n      }\n      msg = {topic: \"informarNivel\", payload: 1}; node.send([msg, null]);\n      msg = {topic: \"Blynk/actualizar/estado\", payload: 1}; node.send([msg, null]);\n    }   \n\n    if (parseInt(global.get(\"nivTanque\")) < nivMinimo && global.get(\"llenarTanque\") === 0 && context.llenadoAnulado === 0){\n      context.nivelInicioLlenado = parseInt(global.get(\"nivTanque\"));\n      context.tiempoInicioLlenado = date.getTime();\n      msg = {topic: \"terminalBlynk\", payload: global.get(\"fechaCompleta\") + \" Inicio AUTO llenado tanque, \" + context.nivelInicioLlenado + \"mm\\n\"}; node.send([msg, null]);\n      node.status({text: \"nivelInicio: \" + context.nivelInicioLlenado + \"  tiempoInicio: \" + context.tiempoInicioLlenado});\n      context.tiempoLlenado = date.getTime() + 60000;\n      // context.avisoTanque = 0;\n      context.estadoAnterior = 1;\n      global.set(\"llenarTanque\", 1);\n      global.set(\"bombaPozo\",  1);\n      global.set(\"valvulaTanque\", 1);\n      msg = {topic: \"ESP/Lavadero/Recibo\", payload: \"llenando1\"}; node.send([msg, null]);\n      enviarBlynk(); \n      enviarDatos(); //return;    \n    }\n    \n    if (parseInt(global.get(\"nivTanque\")) >= parseInt(nivMaximo) && parseInt(global.get(\"llenarTanque\")) === 1){// && parseInt(global.get(\"estadoEspTanque\")) === 1){ //&& context.avisoTanque === 0 && global.get(\"estadoEspTanque\") === 1){\n      var var1 = global.get(\"nivTanque\");\n      tasaLlenado = (date.getTime() - context.tiempoInicioLlenado) / 60000;        \n      parseFloat((var1 - context.nivelInicioLlenado) / tasaLlenado).toFixed(2);\n      var ponele = var1 - context.nivelInicioLlenado;\n      global.set(\"tasaLlenadoTanque\", tasaLlenado);\n      msg = {topic: \"terminalBlynk\", payload: global.get(\"fechaCompleta\") + \" Paro AUTO Llenado tanque, \" + var1 + \"mm\\n\"}; node.send([msg, null]);\n      global.set(\"llenarTanque\", 0); global.set(\"bombaPozo\", 0);  global.set(\"valvulaTanque\", 0); \n      node.status({text: \"FIN Auto nivelInicio: \" + parseInt(global.get(\"nivTanque\")) - context.nivelInicioLlenado + \"  TiempoLlenado: \" + parseFloat(global.get(\"tasaLlenadoTanque\")).toFixed(2)});\n      msg = {topic: \"notifyBlynk\", payload:\"tanque lleno por nivel\"}; node.send(msg);\n      enviarBlynk(); \n      enviarDatos();//return;\n    }  \n  } \n\n  // if (topic == \"ESP/Lavadero/Inicio\") {\n  //   global.set(\"estadoEspTanque\", 1);\n  //   var fallasLavadero = global.get(\"fallasLavadero\") + 1;\n  //   global.set(\"fallasLavadero\", fallasLavadero); \n  //   global.set(\"tipoFallaLav\", msg.payload.substring(9)); msg = {topic: \"fallas_MQTT\", payload: 1}; node.send([msg, null]);\n  //   enviarDatos(); \n  //   return;\n  // }\n\n  switch (pin){\n    case 2:\n    global.set(\"bombaPozo\", parseInt(msg.payload));\n      enviarDatos(); //return;\n      break;\n\n    case 34:\n      context.estadoAnterior = msg.payload;\n      global.set(\"llenarTanque\", parseInt(msg.payload));\n      global.set(\"bombaPozo\",  parseInt(msg.payload));\n      global.set(\"valvulaTanque\",parseInt( msg.payload));\n      context.tiempoLlenado = date.getTime() + 60000;\n      if (parseInt(msg.payload) === 0) {\n        var var1 = global.get(\"nivTanque\");\n        tasaLlenado = (date.getTime() - context.tiempoInicioLlenado) / 60000;        \n        parseFloat((var1 - context.nivelInicioLlenado) / tasaLlenado).toFixed(2);\n        var ponele = var1 - context.nivelInicioLlenado;\n        global.set(\"tasaLlenadoTanque\", tasaLlenado);\n        msg = {topic: \"terminalBlynk\", payload: global.get(\"fechaCompleta\") + \" Paro MANUAL Llenado tanque, \" + var1 + \"mm\\n\"}; node.send([msg, null]);\n        node.status({text: \"FIN Man nivelInicio: \" + ponele + \"  TiempoLlenado: \" + parseFloat(global.get(\"tasaLlenadoTanque\")).toFixed(2)});\n        context.llenadoAnulado = 1;\n      }\n      if (parseInt(msg.payload) === 1) {\n        context.nivelInicioLlenado = parseInt(global.get(\"nivTanque\"));\n        context.tiempoInicioLlenado = date.getTime();\n        msg = {topic: \"terminalBlynk\", payload: global.get(\"fechaCompleta\") + \" Inicio MANUAL llenado tanque, \" + context.nivelInicioLlenado + \"mm\\n\"}; node.send([msg, null]);\n        node.status({text: \"nivelInicio: \" + context.nivelInicioLlenado + \"  tiempoInicio: \" + context.tiempoInicioLlenado});\n        context.llenadoAnulado = 0;\n        }\n      enviarBlynk();\n      enviarDatos(); //return;\n      break;  \n\n    case 35:\n      // if (parseInt(msg.payload) === 1) global.set(\"luzLavadero\", 0);\n      // if (parseInt(msg.payload) === 0) global.set(\"luzLavadero\", 1);\n      global.set(\"luzLavadero\", parseInt(msg.payload));\n      node.status({text: global.get(\"estadoAlarma\") + \" -fff- \"  + global.get(\"luzLavadero\")});\n      enviarDatos(); //return;\n      break;\n\n    case 36:\n      global.set(\"luzAlacenaLavadero\", parseInt(msg.payload));\n      node.status({text: global.get(\"estadoAlarma\") + \" -ggg- \"  + global.get(\"luzAlacenaLavadero\")});\n      enviarDatos(); //return;\n      break;\n\n    case 37:\n      global.set(\"bombaPileta\", parseInt(msg.payload));\n      enviarDatos(); //return;\n      break;            \n  }\n\n  function enviarBlynk(){\n    msg = {pin: 2, payload: global.get(\"bombaPozo\")}; node.send([null, msg]);\n    msg = {pin: 34, payload: global.get(\"llenarTanque\")}; node.send([null, msg]);\n    msg = {pin: 35, payload: global.get(\"luzLavadero\")}; node.send([null, msg]);\n    msg = {pin: 36, payload: global.get(\"luzAlacenaLavadero\")}; node.send([null, msg]);\n    msg = {pin: 37, payload: global.get(\"bombaPileta\")}; node.send([null, msg]);\n    msg = {pin: 38, payload: global.get(\"valvulaTanque\")}; node.send([null, msg]);\n  }\n\n  function enviarDatos(){//return;\n    var topicNuevo = msg.topic;\n    msg = global.get(\"bombaPozo\") + \"#\";\n    msg += global.get(\"valvulaTanque\") + \"#\";\n    msg += global.get(\"bombaPileta\") + \"#\";\n    msg += global.get(\"luzLavadero\") + \"#\";\n    msg += global.get(\"luzAlacenaLavadero\") + \"#\";\n    msg += global.get(\"pwmMaxLed\") + \"#\";\n    msg += global.get(\"pwmMinLed\") + \"#\";\n    msg += global.get(\"Dia\");\n    if (topicNuevo == \"crepMQTT\")dato += \"#\";\n    msg = {topic: \"ESP/Lavadero/Recibo\", payload: msg};\n    node.send([msg, null]);\n\n\n    // if (global.get(\"valvulaTanque\") === 1) {context.avisoTanque = 0;}\n    // msg = {pin: 2, payload: global.get(\"bombaPozo\")}; node.send([null,msg]);\n    // msg = {pin: 34, payload: global.get(\"llenarTanque\")}; node.send([null,msg]);\n    // msg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"most\\\",\\\"payload\\\":\" + msg.payload + \"}\"}; node.send(msg);\n    // msg = {topic: \"ESP/Lavadero/Bombas/Estado/Rele1\", payload: global.get(\"bombaPozo\")}; node.send(msg);\n    // msg = {topic: \"ESP/Lavadero/Bombas/Estado/Rele0\", payload: global.get(\"valvulaTanque\")}; node.send(msg);    \n    // node.status({text: \"Bomba: \" + global.get(\"bombaPozo\") + \"  Valvula: \" + global.get(\"valvulaTanque\") + \" - \" + global.get(\"nivTanque\") + \" - \" + global.get(\"llenarTanque\") + \" - \" + context.estadoAnterior});\n  }\n\n  function apagadoLuces(){\n      node.status({text: \"apagado auto\"});\n      global.set(\"luzLavadero\", 0);\n      global.set(\"luzAlacenaLavadero\", 0);\n      enviarBlynk();\n      enviarDatos();\n  }","outputs":2,"noerr":0,"x":560,"y":320,"wires":[["9301a9f2.7fadd8","1478565d.118ffa","69ed4820.f1ec68"],["45a18b6.5a3e074","918a71cc.24da3","69ed4820.f1ec68"]]},{"id":"cd3a7d8f.79808","type":"inject","z":"73083520.75304c","name":"","topic":"Pedido/Lavadero/Bombas","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":290,"y":640,"wires":[["372a31a9.dc04ae"]]},{"id":"8b1cf061.2f9e8","type":"inject","z":"73083520.75304c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":610,"y":430,"wires":[["3a7a3c27.58c5e4"]]},{"id":"74aa1606.5dbbd8","type":"inject","z":"73083520.75304c","name":"pulso","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":360,"y":680,"wires":[["372a31a9.dc04ae"]]},{"id":"3c6d3b5c.51ee94","type":"function","z":"73083520.75304c","name":"llenado de tanque","func":"var dato = JSON.parse(msg.payload);\nif (global.get(\"bombaPozo\") === undefined)global.set(\"bombaPozo\", 0);\nif (global.get(\"valvulaTanque\") === undefined)global.set(\"valvulaTanque\", 0);\n\nvar nivMaximo = 420;\ncontext.estadoAnterior = context.estadoAnterior || 0;\ncontext.avisoTanque = context.avisoTanque || 0;\nif (global.get(\"fallasLavadero\") === undefined)global.set(\"fallasLavadero\", 0);\n\n\nif (msg.topic === \"google/Tanque\") enviarDatos();\n\nif (msg.topic == \"blynk/marchaBomba\"){\n\tif (msg.payload === 1)global.set(\"bombaPozo\", 1);\n\tif (msg.payload === 0)global.set(\"bombaPozo\", 0);\n\tenviarDatos(); //return;\n}\n\nif (msg.topic == \"blynk/llenarTanque\"){\n\tcontext.avisoTanque = 0;\n    context.estadoAnterior = msg.payload;\n    global.set(\"llenarTanque\", msg.payload);\n    global.set(\"bombaPozo\",  msg.payload);\n    global.set(\"valvulaTanque\", msg.payload);\n    enviarDatos(); //return;\n}\n\nif (dato.topic == \"bombaRF\"){\n\tif (global.get(\"bombaPozo\") === 0){global.set(\"bombaPozo\", 1);}else{global.set(\"bombaPozo\", 0);}\n\tenviarDatos(); //return;\n}\n\nif (dato.topic === \"Nivel\"){\n\tglobal.set(\"nivTanque\", parseFloat(dato.payload).toFixed(2));\n\tmsg = {topic: \"nivel\", payload: global.get(\"nivTanque\") + \"mm\"}; node.send([msg, null]);\n\tmsg = {topic: \"Actualizacion/Baterias\", payload:\"\"}; node.send([msg, null]);\n\tactualizarEstado();}\n\nif (dato.topic === \"Niveles\"){\n\tmsg = {topic: \"nivMinimo\", payload: dato.nivMinimo};\n\tnode.send([msg, null]);\n\tmsg = {topic: \"nivMaximo\", payload: dato.nivMaximo};\n\tnode.send([msg, null]);\n\tmsg = {topic: \"nivel\", payload: dato.nivel}; global.set(\"nivTanque\", parseInt(dato.nivel)); \n\tnode.send([msg, null]);\n\tmsg = {topic: \"altTanque\", payload: dato.altTanque};\n\tnode.send([msg, null]);\n\tmsg = {topic: \"crepuscular\", payload: dato.crepuscular};\n\tnode.send([msg, null]);\n\tactualizarEstado();\n}\t\n\nif (msg.topic === \"configNano\"){\n\tvar item = msg.payload.split(\" \");\n\tif (item[0] === \"altTanque\")msg.payload = \"{\\\"topic\\\":\\\"altTanque\\\",\\\"payload\\\":\" + item[1] + \"\\\"}\";\n\tif (item[0] === \"minTanque\")msg.payload = \"{\\\"topic\\\":\\\"minTanque\\\",\\\"payload\\\":\" + item[1] + \"\\\"}\";\t\n\tif (item[0] === \"maxTanque\")msg.payload = \"{\\\"topic\\\":\\\"maxTanque\\\",\\\"payload\\\":\" + item[1] + \"\\\"}\";\t\n\tmsg = {topic: \"USBout\", payload: msg.payload}; node.send(msg); return;}\n\nif (global.get(\"nivTanque\") >= nivMaximo && context.avisoTanque === 0){\n\tcontext.avisoTanque = 1;\n\tglobal.set(\"llenarTanque\", 0); global.set(\"bombaPozo\", 0);\tglobal.set(\"valvulaTanque\", 0);\t\n\tmsg = {topic: \"notifyBlynk\", payload:\"tanque lleno\"}; node.send(msg);\n\tenviarDatos();//return;\n} \n\nif (dato.topic === \"LlenarTanque\"){\n\tvar valor = parseInt(dato.payload);\n\tmsg = {topic: \"USBout\", payload: \"llenadoOK\"}; node.send([msg, null]);\n\tglobal.set(\"llenarTanque\", valor); global.set(\"bombaPozo\", valor);\tglobal.set(\"valvulaTanque\", valor);\n\tenviarDatos(); //return;\n}\n\nif (msg.topic === \"Pedido/Lavadero/Bombas\") {\n\tvar fallasLavadero = global.get(\"fallasLavadero\") + 1;\n\tglobal.set(\"fallasLavadero\", fallasLavadero); \n\tglobal.set(\"tipoFallaLav\", msg.payload); msg = {topic: \"fallas_MQTT\", payload: 1}; node.send([msg, null]);\n\tenviarDatos(); //return;\n}\n\nfunction enviarDatos(){\n\tif (global.get(\"valvulaTanque\") === 1) {context.avisoTanque = 0;}\n\tmsg = {pin: 2, payload: global.get(\"bombaPozo\")}; node.send([null,msg]);\n\tmsg = {pin: 34, payload: global.get(\"llenarTanque\")}; node.send([null,msg]);\n\tmsg = {topic: \"USBout\", payload: \"{\\\"topic\\\":\\\"most\\\",\\\"payload\\\":\" + msg.payload + \"}\"}; node.send(msg);\n    msg = {topic: \"ESP/Lavadero/Bombas/Estado/Rele1\", payload: global.get(\"bombaPozo\")}; node.send(msg);\n    msg = {topic: \"ESP/Lavadero/Bombas/Estado/Rele0\", payload: global.get(\"valvulaTanque\")}; node.send(msg);    \n    node.status({text: \"Bomba: \" + global.get(\"bombaPozo\") + \"  Valvula: \" + global.get(\"valvulaTanque\") + \" - \" + global.get(\"nivTanque\") + \" - \" + global.get(\"llenarTanque\") + \" - \" + context.estadoAnterior});\n}\n\nfunction actualizarEstado(){\n\tnode.status({text: \"Bomba: \" + global.get(\"bombaPozo\") + \"  Valvula: \" + global.get(\"valvulaTanque\") + \" - \" + global.get(\"nivTanque\") + \" - \" + global.get(\"llenarTanque\") + \" - \" + context.estadoAnterior});\n\tif (global.get(\"estadoToldo\") !== \"Abriendo\" && global.get(\"estadoToldo\") !== \"Cerrando\"){\n\t\tmsg = {topic: \"Blynk/actualizar/estado\", payload: \"\"};\n\t\tnode.send(msg);}\t\n}\n","outputs":2,"noerr":0,"x":620,"y":200,"wires":[[],[]]},{"id":"1cd85752.a3a0a9","type":"blynk-ws-in-write","z":"73083520.75304c","name":"llenar tanque","pin":"34","pin_all":false,"client":"2c18e412.5f5cbc","x":340,"y":110,"wires":[["372a31a9.dc04ae"]]},{"id":"1fee071c.68d2b9","type":"blynk-ws-in-write","z":"73083520.75304c","name":"marcha Bomba","pin":"2","pin_all":false,"client":"2c18e412.5f5cbc","x":330,"y":70,"wires":[["372a31a9.dc04ae"]]},{"id":"afaaf45c.792d58","type":"blynk-ws-in-write","z":"73083520.75304c","name":"Luz Lavadero","pin":"35","pin_all":false,"client":"2c18e412.5f5cbc","x":340,"y":190,"wires":[["372a31a9.dc04ae"]]},{"id":"b13783a5.1056a","type":"blynk-ws-in-write","z":"73083520.75304c","name":"Bomba Pil","pin":"37","pin_all":false,"client":"2c18e412.5f5cbc","x":350,"y":150,"wires":[["372a31a9.dc04ae"]]},{"id":"82c7e149.ca28c","type":"blynk-ws-in-write","z":"73083520.75304c","name":"Luz Alacena","pin":"36","pin_all":false,"client":"2c18e412.5f5cbc","x":340,"y":230,"wires":[["372a31a9.dc04ae"]]},{"id":"f73a2763.6294d8","type":"delay","z":"73083520.75304c","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":340,"y":350,"wires":[["372a31a9.dc04ae"]]},{"id":"b62417cc.891938","type":"mqtt in","z":"73083520.75304c","name":"","topic":"crepMQTT","qos":"2","broker":"c339edbf.39572","x":160,"y":350,"wires":[["f73a2763.6294d8"]]},{"id":"5f648cf6.a50984","type":"mqtt in","z":"73083520.75304c","name":"","topic":"ESP/Lavadero/Envio","qos":"2","broker":"c339edbf.39572","x":320,"y":470,"wires":[["372a31a9.dc04ae","434968c9.53e158"]]},{"id":"918a71cc.24da3","type":"debug","z":"73083520.75304c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":940,"y":340,"wires":[]},{"id":"455c08a0.b43fc8","type":"blynk-ws-in-write","z":"73083520.75304c","name":"Electrovalvula","pin":"38","pin_all":false,"client":"2c18e412.5f5cbc","x":340,"y":30,"wires":[["372a31a9.dc04ae"]]},{"id":"95311bb7.cbf1f8","type":"mqtt in","z":"1b403a13.0ec8c6","name":"estadoBomba","topic":"ESP/TermoSolar/EstadoBomba","qos":"2","broker":"900627dc.76e6a8","x":150,"y":170,"wires":[["e9fadcce.d40f5"]]},{"id":"1dc8024d.34cc0e","type":"blynk-ws-out-set-property","z":"1b403a13.0ec8c6","name":"","pin":0,"pinmode":"1","prop":"bycode","client":"2c18e412.5f5cbc","x":750,"y":240,"wires":[]},{"id":"924d6af6.9752b8","type":"delay","z":"1b403a13.0ec8c6","name":"","pauseType":"delay","timeout":"50","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":700,"y":280,"wires":[["c2e9aa8f.549168"]]},{"id":"d3227bdc.56b938","type":"function","z":"1b403a13.0ec8c6","name":"","func":"if (msg.payload.substring(0,6) == \"Manual\")return;\nreturn msg;","outputs":1,"noerr":0,"x":1320,"y":620,"wires":[["b4af68b9.58d648"]]},{"id":"7a258b5e.462864","type":"mqtt in","z":"1b403a13.0ec8c6","name":"ModoBomba","topic":"ESP/TermoSolar/ModoBomba","qos":"2","broker":"900627dc.76e6a8","x":1070,"y":80,"wires":[["504fa5d9.30bf1c"]]},{"id":"28a41d8e.6887d2","type":"inject","z":"7ac92c99.66ea94","name":"lavadero","topic":"","payload":"luces del lavadero ","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":186.98815822601318,"y":246.92860174179077,"wires":[["e06c23ee.4ad0f"]]},{"id":"8d90aa92.54ad48","type":"inject","z":"7ac92c99.66ea94","name":"lavadero","topic":"","payload":"luces del lavadero ","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":226.98815822601318,"y":396.92860174179077,"wires":[["d18e6794.44d0b8"]]},{"id":"101f21a4.61ddae","type":"inject","z":"7ac92c99.66ea94","name":"alacena","topic":"","payload":"luces del lavadero alacena","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":218.03570556640625,"y":421.6071357727051,"wires":[["d18e6794.44d0b8"]]},{"id":"a4e1a928.4d8e48","type":"mqtt in","z":"73083520.75304c","name":"","topic":"google/Lavadero","qos":"2","broker":"c339edbf.39572","x":330,"y":430,"wires":[["372a31a9.dc04ae"]]},{"id":"6c87ee78.5a478","type":"delay","z":"7ac92c99.66ea94","name":"","pauseType":"delay","timeout":"250","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":516.9881582260132,"y":216.92860174179077,"wires":[["e06c23ee.4ad0f","ae73895f.b434b8"]]},{"id":"1fd29004.d1b03","type":"inject","z":"7ac92c99.66ea94","name":"desactivar alarma casa","topic":"","payload":"desactivar alarma casa y prendeme la luz del lavadero","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":176.98815822601318,"y":56.92860174179077,"wires":[["5975772b.bee358"]]},{"id":"ae73895f.b434b8","type":"debug","z":"7ac92c99.66ea94","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":696.9881582260132,"y":216.92860174179077,"wires":[]},{"id":"835709bc.2100f8","type":"mqtt in","z":"73083520.75304c","name":"","topic":"google/Alarma","qos":"2","broker":"6b36e4a.1d30b1c","x":340,"y":510,"wires":[["372a31a9.dc04ae"]]},{"id":"6d5b16f4.6200b8","type":"mqtt in","z":"3ce5b54a.127d6a","name":"pedidoTempCPU","topic":"ESP/Pasillo/Sens/Temp/Pedido","qos":"2","broker":"e779f8d6.7bc2c8","x":160,"y":870,"wires":[["f80e8488.c7ef98"]]},{"id":"f80e8488.c7ef98","type":"delay","z":"3ce5b54a.127d6a","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":320,"y":870,"wires":[["75432a7.2b2c4d4"]]},{"id":"b562b4bf.db1948","type":"ui_switch","z":"73083520.75304c","name":"","label":"Luz Lavadero","group":"1c362bad.cfd2e4","order":1,"width":0,"height":0,"passthru":false,"decouple":"false","topic":"Lavadero","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":1370,"y":30,"wires":[["64391eaf.0b1a8"]]},{"id":"64391eaf.0b1a8","type":"function","z":"73083520.75304c","name":"","func":"if (msg.topic == \"Lavadero\")global.set(\"luzLavadero\", parseInt(msg.payload));\nif (msg.topic == \"alacenaLavadero\")global.set(\"luzAlacenaLavadero\", parseInt(msg.payload));\nif (msg.topic == \"llenarTanque\"){\n    global.set(\"llenarTanque\", parseInt(msg.payload));\n    global.set(\"bombaPozo\",  parseInt(msg.payload));\n    global.set(\"valvulaTanque\", parseInt(msg.payload));\n}\nif (msg.topic == \"bombaPozo\")global.set(\"bombaPozo\", parseInt(msg.payload));\nif (msg.topic == \"bombaPileta\")global.set(\"bombaPileta\", parseInt(msg.payload));\n\n\n    msg = {topic: \"google/Lavadero\", payload: 1}; node.send(msg);","outputs":1,"noerr":0,"x":1560,"y":110,"wires":[["c4a3d617.2cee38"]]},{"id":"c4a3d617.2cee38","type":"mqtt out","z":"73083520.75304c","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1680,"y":110,"wires":[]},{"id":"ccca832.54b358","type":"ui_switch","z":"73083520.75304c","name":"","label":"Luz Alacena Lavadero","group":"1c362bad.cfd2e4","order":2,"width":0,"height":0,"passthru":false,"decouple":"false","topic":"alacenaLavadero","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":1380,"y":80,"wires":[["64391eaf.0b1a8"]]},{"id":"79c0ef1e.e128a","type":"mqtt in","z":"73083520.75304c","name":"","topic":"aviso/Alarma","qos":"2","broker":"6b36e4a.1d30b1c","x":340,"y":560,"wires":[["372a31a9.dc04ae"]]},{"id":"ac1c0d51.d53ce","type":"mqtt in","z":"73083520.75304c","name":"","topic":"ESP/TanqueAgua/Envio","qos":"2","broker":"e779f8d6.7bc2c8","x":620,"y":490,"wires":[["25c57580.278eca","97598e91.78ba9"]]},{"id":"4dae47bb.1f1958","type":"mqtt out","z":"73083520.75304c","name":"","topic":"ESP/TanqueAgua/Recibo","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":892.8571243286133,"y":592.8571586608887,"wires":[]},{"id":"23a999bf.ae2176","type":"inject","z":"73083520.75304c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":632.8571243286133,"y":552.8571586608887,"wires":[["4dae47bb.1f1958"]]},{"id":"b01a0ba6.628ca8","type":"debug","z":"73083520.75304c","name":"recibo del tanque agua","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1000,"y":490,"wires":[]},{"id":"69261540.62b3fc","type":"mqtt in","z":"73083520.75304c","name":"","topic":"ESP/TanqueAgua/Debug","qos":"2","broker":"e779f8d6.7bc2c8","x":595.714277267456,"y":698.5714244842529,"wires":[["f0cc8d21.be0e1","fd5828c6.eb3548"]]},{"id":"f0cc8d21.be0e1","type":"debug","z":"73083520.75304c","name":"debug Tanque agua","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":855.714277267456,"y":718.5714244842529,"wires":[]},{"id":"25c57580.278eca","type":"function","z":"73083520.75304c","name":"","func":"var alturaTanque = 680;\nvar nivelAgua = parseInt(alturaTanque) - parseInt(msg.payload);\nglobal.set(\"nivTanque\", nivelAgua);\nnode.status({text: \"dist: \" + msg.payload + \"  nivel: \" + global.get(\"nivTanque\") + \"  \" + global.get(\"hsCpu\")});\n\nmsg = {topic: \"terminalBlynk\", payload: global.get(\"hsCpu\") + \" -- dist agua: \" + msg.payload  + \" -- nivel agua: \" + nivelAgua + \"\\n\"};\nnode.send(msg);\n","outputs":1,"noerr":0,"x":820,"y":490,"wires":[["b01a0ba6.628ca8"]]},{"id":"c93ee759.8ad438","type":"inject","z":"73083520.75304c","name":"","topic":"","payload":"debug1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":642.8571243286133,"y":632.8571586608887,"wires":[["4dae47bb.1f1958"]]},{"id":"fb907efc.411f3","type":"inject","z":"73083520.75304c","name":"","topic":"","payload":"debug0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":642.8571243286133,"y":592.8571586608887,"wires":[["4dae47bb.1f1958"]]},{"id":"fd5828c6.eb3548","type":"function","z":"73083520.75304c","name":"","func":"msg = {topic: \"terminalBlynk\", payload: global.get(\"hsCpu\") + \" -- \" + msg.payload + \"\\n\"};\n// if (msg.payload.includes(\"bomba\") )return msg;\nreturn msg;","outputs":1,"noerr":0,"x":805.714277267456,"y":678.5714244842529,"wires":[["72b3d511.d5ae0c"]]},{"id":"72b3d511.d5ae0c","type":"debug","z":"73083520.75304c","name":"debug Tanque agua","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":975.714277267456,"y":678.5714244842529,"wires":[]},{"id":"97598e91.78ba9","type":"debug","z":"73083520.75304c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":840,"y":540,"wires":[]},{"id":"9952dd57.57521","type":"function","z":"3ce5b54a.127d6a","name":"","func":"var dato = JSON.parse(msg.payload);\n\nif (dato.topic === \"corrMinima\")global.set(\"corrMinimaBaterias\", parseFloat(dato.payload));\nif (dato.topic === \"vMin\")global.set(\"voltMinimoVaterias\", parseFloat(dato.payload));\nif (dato.topic === \"offSetCorriente\")global.set(\"offSetCorriente\", parseFloat(dato.payload));\nnode.status({text: \"vMin: \" + global.get(\"voltMinimoVaterias\") + \"  corrMin: \" + global.get(\"corrMinimaBaterias\") + \"  offSetCorr: \" + global.get(\"offSetCorriente\") })","outputs":1,"noerr":0,"x":580,"y":640,"wires":[[]]},{"id":"394aad6c.6da142","type":"mqtt in","z":"73083520.75304c","name":"","topic":"ESP/TanqueAgua/Envio","qos":"2","broker":"e779f8d6.7bc2c8","x":310,"y":600,"wires":[["372a31a9.dc04ae"]]},{"id":"ecfff9b8.62ae68","type":"mqtt in","z":"73083520.75304c","name":"","topic":"ESP/TanqueAgua/Desconectado","qos":"2","broker":"e779f8d6.7bc2c8","x":280,"y":270,"wires":[["372a31a9.dc04ae"]]},{"id":"9301a9f2.7fadd8","type":"mqtt out","z":"73083520.75304c","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":870,"y":240,"wires":[]},{"id":"fb2718ba.f2d148","type":"mqtt in","z":"73083520.75304c","name":"","topic":"ESP/TanqueAgua/Inicio","qos":"2","broker":"e779f8d6.7bc2c8","x":310,"y":310,"wires":[["372a31a9.dc04ae"]]},{"id":"1b6dc12f.e4ae0f","type":"function","z":"1b403a13.0ec8c6","name":"","func":"// Sal1  thingspeak\n// Sal2  mqtt\n// Sal3  blynk\n// Sal4  mysql\n\ncontext.llenandoTermo = context.llenandoTermo || 0;\ncontext.encendidoResistencia = context.encendidoResistencia || 0;\ncontext.estAnteriorResistencia = context.estAnteriorResistencia || 0;\ncontext.tiempoInicioResistencia = context.tiempoInicioResistencia || 0;\ncontext.bombaAutoAnulada = context.bombaAutoAnulada || 1;\n\nvar topic = msg.topic;\nvar payload = msg.payload;\nvar comienzoLlenado;\nvar terminoLlenado;\nvar valorDia = global.get(\"valorDia\");\nvar valorNoche = global.get(\"valorNoche\");\n\nif (topic == \"crepMQTT\" && payload == \"1\"){\n  global.set(\"millisDia\", new Date().getTime() + 1000 * 60 * 60); \n  msg = {pin: 127, payload: global.get(\"hsCpu\") + \", se hizo de dia defasaje 1hs \\n\"};\n  return([null, null, msg, null]);\n}\nnode.status({text: global.get(\"hh\") + \" -- \" + global.get(\"autoBomba\") + \" -- \" + global.get(\"estBomba\")})\n\nif (topic == \"timer\"){\n if (parseInt(global.get(\"hh\")) === 22 && parseInt(global.get(\"mm\")) === 0 && parseInt(global.get(\"autoBomba\")) === 1 && parseInt(global.get(\"estBomba\")) === 0){\n   msg = {pin: 127, payload: global.get(\"hsCpu\") + \", paso a manual bomba termo \\n\"}; node.send([null, null, msg, null]);\n   global.set(\"autoBomba\", 0);\n   global.set(\"pedBomba\", 0);\n   enviarBlynk();\n   enviarMQTT();\n }\n // if (new Date().getTime() > parseInt(global.get(\"millisDia\")) && parseInt(global.get(\"autoBomba\") === 0)){\n //   msg = {pin: 127, payload: global.get(\"hsCpu\") + \", paso a automatico bomba termo por offset dia \\n\"}; node.send([null, null, msg, null]);\n //   global.set(\"autoBomba\", 1); \n //   enviarMQTT();\n // }\n if (parseInt(global.get(\"hh\")) === 9 && parseInt(global.get(\"mm\")) === 0 && parseInt(global.get(\"autoBomba\")) === 0){\n   msg = {pin: 127, payload: global.get(\"hsCpu\") + \", paso a automatico bomba termo por hora \\n\"}; node.send([null, null, msg, null]);\n   context.bombaAutoAnulada = 0;\n   global.set(\"autoBomba\", 1); \n   // msg = {pin: 102, payload: global.get(\"autoBomba\")}; node.send([null, null, msg, null]);\n   enviarBlynk();\n   enviarMQTT();\n } \n return;\n}\n\n\nif (topic == \"bombaAuto\"){\t\n  if (parseInt(payload) === 0){\n    global.set(\"bombaAutoAnulada\", 0);\n    global.set(\"pedBomba\", 0); }\n    // context.bombaAutoAnulada = 1;} \n  if (parseInt(payload) === 1){\n    global.set(\"bombaAutoAnulada\", 1);}\n    // context.bombaAutoAnulada = 0;}\n  global.set(\"autoBomba\", payload); enviarMQTT();}\n\n// if (topic == \"forzarManual\"){\n//  if (parseInt(payload) === 0){//habilitada\n//    // global.set(\"bombaAutoAnulada\", 1);\n//    global.set(\"autoBomba\", 0); \n//    msg = \"Manual0\";\n//  }\n//    // context.bombaAutoAnulada = 1;} \n//  if (parseInt(payload) === 1){//anulada\n//    // global.set(\"bombaAutoAnulada\", 0);\n//    msg = \"Manual1\";}\n//    // context.bombaAutoAnulada = 0;}\n//  global.set(\"autoBomba\", payload); \n//  msg = {topic:\"ESP/TermoSolar/Config\", payload: msg};\n//     node.send([null, msg, null, null]);\n\n//  // enviarMQTT();}  \n// }\n\nif (topic == \"marchaBomba\" && global.get(\"autoBomba\") === 0){\n  global.set(\"pedBomba\", payload); enviarMQTT();}\n  \nif (topic == \"resistenciaAuto\"){\n  if (parseInt(payload) === 0)global.set(\"pedResistencia\", 0);\n  global.set(\"autoResistencia\", payload); enviarMQTT();}//encendidoResistencia\n\nif (topic == \"encendidoResistencia\" && global.get(\"autoResistencia\") === 0){\n  global.set(\"pedResistencia\", payload); enviarMQTT();}\n\nif (topic == \"ESP/TermoSolar/Envio\"){\n  //0#0#0#15.55#25.55#1020\n  var dato = payload.split(\"#\");\n  global.set(\"estBomba\", parseInt(dato[0])); \n  global.set(\"estResistencia\", parseInt(dato[1])); \n  global.set(\"estToldo\", parseInt(dato[2]));  \n  global.set(\"tempTermoFin\", dato[3]); \n  global.set(\"tempExterior\", dato[4]); \n  global.set(\"sensorCrep\", parseInt(dato[5])); //msg.payload = dato[5]; node.send(msg);\n\n  // msg = {pin: 102, payload: global.get(\"estBomba\")}; node.send([null, null, msg, null]);\n  // msg = {pin: 104, payload: global.get(\"estResistencia\")}; node.send([null, null, msg, null]);\n  // msg = {pin: 110, payload: global.get(\"tempTermoFin\")}; node.send([null, null, msg, null]);\n  // msg = {pin: 111, payload: global.get(\"sensorCrep\")}; node.send([null, null, msg, null]);\n  // msg = {pin: 112, payload: global.get(\"tempExterior\")}; node.send([null, null, msg, null]);\n\n\n  msg= {topic: \"temperaturaTermo\", payload: global.get(\"tempTermoFin\")}; node.send([msg, null, null, null]);\n  // msg = {pin: 113, payload: global.get(\"tempTermoFin\")}; node.send([null, null, msg, null]);\n  // msg = {pin: 110, payload: global.get(\"tempTermoFin\") + \"  --  \" + global.get(\"tempExterior\")}; node.send([null, null, msg, null]);\n\n  msg= {topic: \"crepuscular\", payload: global.get(\"sensorCrep\")}; node.send([msg, null, null, null]);\n  // msg = {pin: 111, payload: global.get(\"sensorCrep\")}; node.send([null, null, msg, null]);\n\n  msg= {topic: \"temperaturaExterior\", payload: global.get(\"tempExterior\")}; node.send([msg, null, null, null]);\n  // msg = {pin: 112, payload: global.get(\"tempExterior\")}; node.send([null, null, msg, null]);  //estBomba\n\n  // msg= {topic: \"estBomba\", payload: global.get(\"estBomba\")}; node.send([msg, null, null, null]);\n  // msg= {topic: \"estResistencia\", payload: global.get(\"estResistencia\")}; node.send([msg, null, null, null]);\n\n//  controlCrepuscular();\n  // controlBomba();\n\n    if(global.get(\"estResistencia\") === 1){\n        if (context.estAnteriorResistencia === 0){\n        context.encendidoResistencia = 1;\n        context.estAnteriorResistencia = 1;\n        // global.set(\"resistenciaEncendida\", new Date().getTime());\n        context.tiempoInicioResistencia = new Date().getTime();}\n\n        var tiempo = (new Date().getTime() - context.tiempoInicioResistencia) / 60000;\n        var potencia = ((1.5/60) * tiempo).toFixed(5);\n        global.set(\"potenciaResistencia\", potencia);\n    // msg = {topic: \"potResistencia\", payload: global.get(\"potenciaResistencia\")}; node.send([msg, null, null, null]);\n    }\n\n    if (global.get(\"estResistencia\") === 0 && context.encendidoResistencia === 1){\n        context.estAnteriorResistencia = 0;\n        context.encendidoResistencia = 0;\n        var tiempo = (new Date().getTime() - context.tiempoInicioResistencia) / 60000;\n        var potencia = ((1.5/60) * tiempo).toFixed(5);\n        tiempo = parseFloat(tiempo).toFixed(2);\n        global.set(\"tiempoEncResis\", tiempo);\n        global.set(\"potenciaResistencia\", potencia);\n\n\n\n        // msg = {topic: \"tiempoEncResis\", payload: global.get(\"tiempoEncResis\")}; node.send([msg, null, null, null]);\n        // msg = {topic: \"potResistencia\", payload: global.get(\"potenciaResistencia\")}; node.send([msg, null, null, null]);\n        // global.set(\"potenciaResistencia\",0);\n    }\n    // if (global.get(\"estResistencia\") === \"0\" && context.encendidoResistencia == \"0\"){\n    //  msg = {topic: \"potResistencia\", payload: global.get(\"potenciaResistencia\")}; \n    //  node.send([msg, null, null, null]);}\n    enviarBlynk();\n}\n\n// if (topic == \"ESP/TermoSolar/ModoBomba\"){\n//  if (payload.substring(0, 9) == \"bombaAuto\"){\n//  // if (payload.includes(\"bombaAuto0\") || payload.includes(\"bombaAuto1\")){\n//    global.set(\"autoBomba\", parseInt(payload.substring(9)));\n//    if (global.get(\"autoBomba\") === 0)global.set(\"pedBomba\", 0);\n//    if (global.get(\"autoBomba\") === 1){estadoBomba = \"Automatico\";}else{estadoBomba = \"Manual\";}\n//    msg = {pin: 102, label: estadoBomba, payload: global.get(\"pedBomba\")}; node.send([null, null, msg, null]);    \n//    // enviarMQTT();\n//    // msg = {pin: 102, payload: global.get(\"autoBomba\")}; node.send([null, null, msg, null]);    \n//  }\n// }\nif (topic == \"ESP/TermoSolar/EstadoBomba\"){//  bombaMarcha1\n  if (payload.substring(0, 11) == \"bombaMarcha\"){// || payload.substring(0, 12) == \"bombaM+archa\"){\n  // if (payload.includes(\"bombaMarcha0\") || payload.includes(\"bombaMarcha1\")){\n    global.set(\"estBomba\", parseInt(payload.substring(11)));\n    if (global.get(\"autoBomba\") === 1){estadoBomba = \"Automatico\";}else{estadoBomba = \"Manual\";}\n    msg = {pin: 102, label: estadoBomba, payload: global.get(\"estBomba\")}; node.send([null, null, msg, null]);\n    // if (global.get(\"estBomba\") === 0)global.set(\"pedBomba\", 0);\n    // msg = {pin: 102, payload: global.get(\"estBomba\")}; node.send([null, null, msg, null]);\n    // enviarMQTT();\n    controlBomba();\n  }\n\n  // global.set(\"estBomba\", parseInt(payload));\n  // msg = {pin: 102, payload: global.get(\"estBomba\")}; node.send([null, null, msg, null]);\n  // controlBomba();\n}\n\nif (topic == \"ESP/TermoSolar/pedido\"){\n    var fallasLivingIluminacion = global.get(\"fallasLivingIluminacion\") + 1;\n    global.set(\"fallasLivingIluminacion\", fallasLivingIluminacion);\n    global.set(\"tipoFallaIlLiving\", msg.payload); \n    enviarMQTT();}\n\nfunction controlBomba(){\n  msg = {topic: \"estBomba\", payload: global.get(\"estBomba\")}; node.send([msg, null, null, null]);\n  if (global.get(\"estBomba\")=== 1 && context.llenandoTermo === 0){\n    context.llenandoTermo = 1;\n    global.set(\"comienzoLlenado\", new Date().getTime());}\n  if (global.get(\"estBomba\") === 0 && context.llenandoTermo === 1){\n    context.llenandoTermo = 0;\n    var tiempo = new Date().getTime() - global.get(\"comienzoLlenado\");\n    tiempo = parseFloat(tiempo / 1000).toFixed(2);\n    global.set(\"tiempoLlenado\", tiempo);\n    msg = {topic: \"tiempoLlenado\", payload: global.get(\"tiempoLlenado\")}; node.send([msg, null, null, null]);\n    enviarBlynk();\n    // msg = {pin: 114, payload: global.get(\"tiempoLlenado\")}; node.send([null, null, msg, null]);\n    // msg = {pin: 105, payload: global.get(\"tiempoLlenado\")}; node.send([null, null, msg, null]);\n  } \n}    \n\n// function controlCrepuscular(){\n//  if (global.get(\"sensorCrep\") > valorDia && global.get(\"Dia\") === 0){global.set(\"Dia\", 1); msg = {topic: \"ESP/TermoSolar/Crepuscular\", payload: global.get(\"Dia\")}; node.send([null, msg, null, null]);}\n//  if (global.get(\"sensorCrep\") < valorNoche && global.get(\"Dia\") === 1){global.set(\"Dia\", 0); msg = {topic: \"ESP/TermoSolar/Crepuscular\", payload: global.get(\"Dia\")}; node.send([null, msg, null, null]);}\n//  // msg = {topic: \"ESP/TermoSolar/Crepuscular\", payload: global.get(\"Dia\")}; node.send([null, msg, null, null]);\n// }\n\nfunction enviarBlynk(){\n    msg = {pin: 101, payload: global.get(\"autoBomba\")}; node.send([null, null, msg, null]);\n    msg = {pin: 102, payload: global.get(\"estBomba\")}; node.send([null, null, msg, null]);\n    msg = {pin: 104, payload: global.get(\"estResistencia\")}; node.send([null, null, msg, null]);\n    msg = {pin: 105, payload: global.get(\"tiempoLlenado\")}; node.send([null, null, msg, null]);\n    msg = {pin: 110, payload: global.get(\"tempTermoFin\") + \"  --  \" + global.get(\"tempExterior\")}; node.send([null, null, msg, null]);  \n    msg = {pin: 111, payload: global.get(\"sensorCrep\")}; node.send([null, null, msg, null]);\n    msg = {pin: 112, payload: global.get(\"tempExterior\")}; node.send([null, null, msg, null]);\n    msg = {pin: 113, payload: global.get(\"tempTermoFin\")}; node.send([null, null, msg, null]);\n    msg = {pin: 114, payload: global.get(\"tiempoLlenado\")}; node.send([null, null, msg, null]);\n}\n\nfunction enviarMQTT(){   \n  // msg = {pin: 101, payload: global.get(\"autoBomba\")}; node.send([null, null, msg, null]);\n  // var estadoBomba;\n  // if (global.get(\"autoBomba\") === 1){estadoBomba = \"Automatico\";}else{estadoBomba = \"Manual\";}\n  // msg = {pin: 102, label: estadoBomba, payload: global.get(\"pedBomba\")}; node.send([null, null, msg, null]);\n  // msg = {pin: 104, payload: global.get(\"pedResistencia\")}; node.send([null, null, msg, null]);\n  // if (topic == \"ESP/TermoSolar/Bomba\")return;\n    // msg.payload = topic; node.send([null, msg, null, null]); \n    payload = global.get(\"autoBomba\") + \"#\"; payload += global.get(\"autoResistencia\") + \"#\"; payload += global.get(\"autoToldo\") + \"#\"; \n    payload += global.get(\"pedBomba\") + \"#\"; payload += global.get(\"pedResistencia\") + \"#\"; payload += global.get(\"pedToldo\") + \"#\"; \n    payload += global.get(\"tempMaximaTermo\") + \"#\"; payload += global.get(\"tempMaxResistencia\") + \"#\"; \n    payload += global.get(\"tempMaxResistenciaManual\") + \"#\"; payload += global.get(\"tempMinimaResistencia\") + \"#\";\n    payload += global.get(\"valorDia\")  + \"#\"; payload += global.get(\"valorNoche\") + \"#\" + global.get(\"segundosMarchaBomba\");\n    payload += \"#\" + global.get(\"offsetDia\")  + \"#\"; payload += global.get(\"offsetNoche\");\n    // payload += \"#\" + global.get(\"bombaAutoAnulada\");\n    msg.payload = payload;  \n    msg = {topic: \"ESP/TermoSolar/Config\", payload: payload}; node.send([null, msg, null, null]);\n}","outputs":4,"noerr":0,"x":80,"y":100,"wires":[[],[],[],[]]},{"id":"e9fadcce.d40f5","type":"delay","z":"1b403a13.0ec8c6","name":"100mS","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":300,"y":170,"wires":[["34ae7c41.536534"]]},{"id":"5c00b591.1f760c","type":"function","z":"a89e305a.c50bb","name":"recibo2","func":" var timerLuces = 12000;\nif (global.get(\"estLiving\") === undefined)global.set(\"estLiving\", 0);\nif (global.get(\"estIsla\") === undefined)global.set(\"estIsla\", 0);\nif (global.get(\"estCielorrazo\") === undefined)global.set(\"estCielorrazo\", 0);\nif (global.get(\"potLiving\") === undefined)global.set(\"potLiving\", 0);\nif (global.get(\"estIslaRGB\") === undefined)global.set(\"estIslaRGB\", 0);\nif (global.get(\"potIsla\") === undefined)global.set(\"potIsla\", 255);\nif (global.get(\"potCielorrazo\") === undefined)global.set(\"potCielorrazo\", 128);\nif (global.get(\"IslaR\") === undefined)global.set(\"IslaR\", 255);\nif (global.get(\"IslaG\") === undefined)global.set(\"IslaG\", 255);\nif (global.get(\"IslaB\") === undefined)global.set(\"IslaB\", 255);\n\nif (global.get(\"pwmMinLed\") === undefined)global.set(\"pwmMinLed\", 20);\nif (global.get(\"pwmMaxLed\") === undefined)global.set(\"pwmMaxLed\", 255);\n\nif (global.get(\"dimmerLeds\") === undefined)global.set(\"dimmerLeds\", 200);\nif (global.get(\"minTeclas\") === undefined)global.set(\"minTeclas\", 15);\nif (global.get(\"maxTeclas\") === undefined)global.set(\"maxTeclas\", 600);\nif (global.get(\"doblePuls\") === undefined)global.set(\"doblePuls\", 1);\nif (global.get(\"fallasLivingIluminacion\") === undefined)global.set(\"fallasLivingIluminacion\", 0);\nif (global.get(\"pwmPatioLuz\") === undefined)global.set(\"pwmPatioLuz\", 33);\ncontext.item = context.item || 0;\n\nvar topic = msg.topic;\nvar payload = parseInt(msg.payload);\n// msg = {topic: \" \", payload: topic}; node.send(msg);\nvar dato;\n// if (global.get(\"Dia\") === 1)global.set(\"dimmerLeds\", 200);\n// if (global.get(\"Dia\") === 0)global.set(\"dimmerLeds\", 50);\n\nif (topic == \"Pedido/Living/Iluminacion\"){  \n    var fallasLivingIluminacion = global.get(\"fallasLivingIluminacion\") + 1;\n    global.set(\"fallasLivingIluminacion\", fallasLivingIluminacion);\n    global.set(\"tipoFallaIlLiving\", payload); msg = {topic: \"fallas_MQTT\", payload: 1}; node.send([msg, null]);\n    enviarMQTT();\n//  msg = {topic: \"minTeclas\", payload: global.get(\"minTeclas\")}; node.send(msg);\n//     msg = {topic: \"maxTeclas\", payload: global.get(\"maxTeclas\")}; node.send(msg);\n    return;\n}\n\nif (topic == \"aviso/Alarma\"){\n    if (global.get(\"estadoAlarma\") === 0 && global.get(\"Dia\") === 0){\n    msg = {topic: \"USBout\", payload: \"Noche\" + global.get(\"pwmPatioLuz\")}; node.send([msg, null]);\n    global.set(\"estLiving\", 1); \n    global.set(\"estIslaRGB\", 1);\n    enviarMQTT();\n    return;\n    }\n    if (global.get(\"estadoAlarma\") === 1 && global.get(\"estLiving\") === 1){setTimeout(apagadoLuces, timerLuces);}\n    if (global.get(\"estadoAlarma\") === 1 && global.get(\"Dia\") === 1){\n        // msg = {topic: \"USBout\", payload: \"Dia\"}; node.send([msg, null]);\n        apagadoLuces();}\n    }\n\n\nif (topic == \"crepMQTT\"){\n    if (global.get(\"Dia\") === 1) {msg = {topic: \"USBout\", payload: \"Dia\"}; node.send([msg, null]);}\n    if (global.get(\"Dia\") === 0) {msg = {topic: \"USBout\", payload: \"Noche\" + global.get(\"pwmPatioLuz\")}; node.send([msg, null]);}\n    // enviarMQTT();\n}\n\n\nif (topic == \"google/Living\") {enviarMQTT(); return;}\n\nif (topic == \"ESP/living/Iluminacion/Envio\" && !topic.includes(\"Recibo de ESP\")){\n    dato = payload.split(\"#\");\n    global.set(\"estIsla\", dato[0]); \n    global.set(\"estCielorrazo\", dato[1]); \n    global.set(\"estIslaRGB\", dato[2]); \n    enviarMQTT();\n    return;\n}\n\nif (topic == \"Blink/potItem\"){\n    context.item = parseInt(msg.payload);\n    switch(parseInt(msg.payload)){\n        case 1:\n            msg = {pin: 19, min: 4, max: 255, label: \"Living\", payload: global.get(\"potLiving\")};\n        break;\n        case 2:\n            msg = {pin: 19, min: 4, max: 255, label: \"Isla\", payload: global.get(\"potIsla\")};\n        break;\n        case 3:\n            msg = {pin: 19, min: 4, max: 255, label: \"Cielorrazo\", payload: global.get(\"potCielorrazo\")};\n        break;\n        case 4:\n            msg = {pin: 19, min: 1, max: 100, label: \"Patio Luz\", payload: global.get(\"pwmPatioLuz\")};\n        break;\n    }\n    node.send([null, msg]);\n}\n\nif (topic == \"Blink/potencia\"){\n    var valor = parseInt(msg.payload);\n    switch(context.item){\n        case 1:\n            if (global.get(\"estLiving\") === 0)return;\n            global.set(\"potLiving\", valor);\n            global.set(\"potIsla\", valor);\n            global.set(\"potCielorrazo\", valor);\n        break;\n        case 2:\n            if (global.get(\"estIsla\") === 0)return;\n            global.set(\"potIsla\", valor);\n        break;\n        case 3:\n            if (global.get(\"estCielorrazo\") === 0)return;\n            global.set(\"potCielorrazo\", valor);\n        break;\n        case 4:\n            if (global.get(\"Dia\") === 1)return;\n            global.set(\"pwmPatioLuz\", valor);\n            msg = {topic: \"USBout\", payload: \"Noche\" + global.get(\"pwmPatioLuz\")}; node.send([msg, null]); return;\n    }\n    enviarMQTT();\n}\n\nif (topic == \"Blink/estLiving\"){\n    global.set(\"estLiving\", payload);  \n    global.set(\"estIslaRGB\", payload);\n    // global.set(\"estIsla\", parseInt(msg.payload)); \n    // global.set(\"estCielorrazo\", parseInt(msg.payload));\n\n    // if (msg.payload === 1) global.set(\"estIslaRGB\", 1);\n    // global.set(\"estIslaRGB\", parseInt(msg.payload));\n    // if (msg.payload === 0) global.set(\"estIslaRGB\", parseInt(msg.payload));\n    enviarMQTT();}\n\nif (topic == \"Blink/estIsla\"){\n    // global.set(\"estIslaRGB\", payload);\n    global.set(\"estIsla\", payload);\n    enviarMQTT();}\n\nif (topic == \"Blink/estCielorrazo\"){\n    // global.set(\"estIslaRGB\", payload);\n    global.set(\"estCielorrazo\", payload); \n    enviarMQTT();}\n\nif (topic == \"Blink/estRGB\"){global.set(\"estIslaRGB\", payload); enviarMQTT();}\n\nif (topic == \"Blink/colorRGB\"){\n    global.set(\"IslaR\", msg.arrayOfValues[0]);\n    global.set(\"IslaG\", msg.arrayOfValues[1]);\n    global.set(\"IslaB\", msg.arrayOfValues[2]);\n    msg = {pin: 32, payload: \"12\"}; node.send([null, msg]);\n    global.set(\"estIslaRGB\", 1);\n    enviarMQTT();\n}\n\nreturn;\n\nfunction apagadoLuces(){\n    // if (global.get(\"estadoAlarma\") === 1 || global.get(\"Dia\") === 1){\n    //  // global.set(\"estLiving\", 0); \n    //  // global.set(\"estIsla\", 0); \n    //  // global.set(\"estCielorrazo\", 0);\n    //  // global.set(\"estIslaRGB\", 0);\n    // }\n    msg = {topic: \"USBout\", payload: \"Dia\"}; node.send([msg, null]);\n    global.set(\"estLiving\", \"0\");\n    global.set(\"estIslaRGB\", \"0\");\n    msg.topic = \"apagadoAuto\";\n    enviarMQTT();\n}\n\nfunction enviarMQTT(){\n    var topicNuevo = msg.topic;\n    msg = {pin: 127, payload: global.get(\"hsCpu\") + \", top: \" + topicNuevo + \", D:\" + global.get(\"Dia\") + \", Al:\" + global.get(\"estadoAlarma\") + \"\\n\"}; node.send([null, msg]);\n    // if (global.get(\"estIsla\") === 0 && global.get(\"estCielorrazo\") === 0 && global.get(\"estIslaRGB\") === 0)global.set(\"estLiving\", 0);\n    if (global.get(\"estIsla\") === 1 || global.get(\"estCielorrazo\") === 1){\n        if(topic !== \"Blink/estLiving\" && topicNuevo !== \"fallas_MQTT\")global.set(\"estLiving\", 1);\n        }\n    if (topicNuevo == \"apagadoAuto\") {\n        global.set(\"estLiving\", 0); \n        msg = {pin: 127, payload: \"Apagado auto\\n\"}; node.send([null, msg]);\n    }\n\n    if (topicNuevo !== \"fallas_MQTT\"){\n    msg = {pin: 14, payload: global.get(\"estLiving\")}; node.send([null, msg]);\n    msg = {pin: 16, payload: global.get(\"estIsla\")}; node.send([null, msg]);\n    msg = {pin: 17, payload: global.get(\"estCielorrazo\")}; node.send([null, msg]);\n    msg = {pin: 29, payload: global.get(\"estIslaRGB\")}; node.send([null, msg]);}\n    if(topic == \"ESP/living/Iluminacion/Envio\")return;\n    \n    if (global.get(\"estLiving\") === 0) {\n            msg = {pin: 16, payload: \"0\"}; node.send([null, msg]);\n            dato = \"0,\"}\n        else{\n            dato = global.get(\"estIsla\") + \",\";}\n    dato += global.get(\"potIsla\") + \"#\";\n\n    if (global.get(\"estLiving\") === 0) {\n            msg = {pin: 17, payload: \"0\"}; node.send([null, msg]);\n            dato += \"0,\"}\n        else{\n            dato += global.get(\"estCielorrazo\") + \",\";}\n    dato += global.get(\"potCielorrazo\") + \"#\";  \n    dato += global.get(\"estIslaRGB\") + \",\";\n    dato += global.get(\"IslaR\") + \",\";\n    dato += global.get(\"IslaG\") + \",\";      \n    dato += global.get(\"IslaB\") + \"#\";\n\n  dato += global.get(\"pwmMaxLed\") + \"#\";\n  dato += global.get(\"pwmMinLed\") + \"#\";\n    // dato += global.get(\"dimmerLeds\") + \"#\";\n\n    dato += global.get(\"minTeclas\") + \"#\";\n    dato += global.get(\"maxTeclas\") + \"#\";\n    dato += global.get(\"doblePuls\");\n    dato += \"#\" + global.get(\"Dia\");\n    if (topicNuevo == \"crepMQTT\")dato += \"#\";\n\n//  msg = {topic: \"ESP/living/Iluminacion/Recibo2\", payload: topicNuevo + \"&\" + global.get(\"estadoAlarma\") + \"&\" + global.get(\"Dia\") + \"\\n\" + dato};    node.send([msg, null]);\n    msg = {topic: \"ESP/living/Iluminacion/Recibo\", payload: dato};\n    node.send([msg, null]);     \n}","outputs":2,"noerr":0,"x":610,"y":260,"wires":[[],[]]},{"id":"190846f5.56b989","type":"blynk-ws-in-write","z":"f682d492.22a758","name":"","pin":"125","pin_all":0,"client":"2c18e412.5f5cbc","x":120,"y":590,"wires":[["e6582073.df041"]]},{"id":"542275be.eb086c","type":"function","z":"f682d492.22a758","name":"","func":"// msg.payload = \"Reinicios: \\n\" + msg.payload;\n\n// node.send(msg.payload);\nfor (i = 0; i < 25; i++) {msg.payload += \"\\n\";}\nmsg = {topic: \"terminalBlynk\", payload: msg.payload};\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":590,"wires":[["b7fcac20.78844"]]},{"id":"e6582073.df041","type":"function","z":"f682d492.22a758","name":"","func":"if (msg.payload == 1)return msg;","outputs":1,"noerr":0,"x":290,"y":590,"wires":[["542275be.eb086c"]]},{"id":"e473ab9b.ae0df8","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"terminalBlynk","qos":"2","broker":"e779f8d6.7bc2c8","x":90,"y":650,"wires":[["967f756.43a8688"]]},{"id":"967f756.43a8688","type":"blynk-ws-out-write","z":"f682d492.22a758","name":"","pin":"127","pinmode":0,"client":"2c18e412.5f5cbc","x":270,"y":650,"wires":[]},{"id":"b7fcac20.78844","type":"mqtt out","z":"f682d492.22a758","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":550,"y":590,"wires":[]},{"id":"de2759e7.8bbbb8","type":"debug","z":"f682d492.22a758","name":"notify blynk","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":590,"y":700,"wires":[]},{"id":"7079fb79.377004","type":"blynk-ws-out-notify","z":"f682d492.22a758","name":"","client":"2c18e412.5f5cbc","queue":false,"rate":1,"x":580,"y":650,"wires":[]},{"id":"adcd093a.97dde8","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"notifyBlynk","qos":"2","broker":"c339edbf.39572","x":439.3095675877157,"y":674.428562436785,"wires":[["7079fb79.377004","de2759e7.8bbbb8"]]},{"id":"15b1f27c.6d37ee","type":"debug","z":"3ce5b54a.127d6a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":430,"y":480,"wires":[]},{"id":"14203a3a.56fab6","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"{\"topic\":\"Alarma/Activacion\",\"payload\":1}","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":390,"wires":[["9641fbd0.64c858"]]},{"id":"19b3fc19.3d8664","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"{\"topic\":\"Alarma/Activacion\",\"payload\":0}","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":210,"y":430,"wires":[["9641fbd0.64c858"]]},{"id":"9160c678.63c1b8","type":"mqtt in","z":"73083520.75304c","name":"","topic":"ESP/Lavadero/Recibo","qos":"2","broker":"e779f8d6.7bc2c8","x":840,"y":640,"wires":[["f3451b54.c08138"]]},{"id":"f3451b54.c08138","type":"debug","z":"73083520.75304c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1030,"y":640,"wires":[]},{"id":"69ed4820.f1ec68","type":"link out","z":"73083520.75304c","name":"MQTT_Lavadero","links":["1e36eea2.90f051"],"x":1035,"y":310,"wires":[]},{"id":"7ee40e1e.072f6","type":"function","z":"73083520.75304c","name":"","func":"msg.payload = parseInt(global.get(\"luzLavadero\")); node.send([msg, null]);\nmsg.payload = parseInt(global.get(\"luzAlacenaLavadero\")); node.send([null, msg]);\nmsg.payload = parseInt(global.get(\"llenarTanque\")); node.send([null, null, msg]);\nmsg.payload = parseInt(global.get(\"bombaPozo\")); node.send([null, null, null, msg]);\nmsg.payload = parseInt(global.get(\"bombaPileta\")); node.send([null, null, null, null, msg]);\n","outputs":5,"noerr":0,"x":1190,"y":130,"wires":[["b562b4bf.db1948"],["ccca832.54b358"],["39ca2758.7802f8"],["91ce983b.2144e8"],["7fc82b24.319e64"]]},{"id":"1e36eea2.90f051","type":"link in","z":"73083520.75304c","name":"","links":["69ed4820.f1ec68"],"x":955,"y":130,"wires":[["36feaa61.dccd16"]]},{"id":"1478565d.118ffa","type":"debug","z":"73083520.75304c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":890,"y":210,"wires":[]},{"id":"6c2b92f3.35e3ac","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"ESP/TanqueAgua/Desconectado","qos":"2","broker":"e779f8d6.7bc2c8","x":1160,"y":390,"wires":[["3f2f7469.fe497c"]]},{"id":"3f2f7469.fe497c","type":"function","z":"f682d492.22a758","name":"","func":"if (msg.topic == \"ESP/TanqueAgua/Desconectado\"){\n    global.set(\"estado-TanqueAgua\", global.get(\"fechaCompleta\") + \" - Desc\\n\");\n    node.send(msg);}\nif (msg.topic == \"ESP/TanqueAgua/Inicio\"){\n    global.set(\"estado-TanqueAgua\", global.get(\"fechaCompleta\") + \" - Con\\n\");\n    node.send(msg);}    ","outputs":1,"noerr":0,"x":1450,"y":450,"wires":[["387a7975.e5c536"]]},{"id":"b969c382.9021a","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"ESP/TanqueAgua/Inicio","qos":"2","broker":"e779f8d6.7bc2c8","x":1190,"y":420,"wires":[["3f2f7469.fe497c"]]},{"id":"b2475a76.cc8158","type":"function","z":"f682d492.22a758","name":"","func":"if (msg.topic == \"ESP/Lavadero/Desconectado\"){\n    global.set(\"estado-Lavadero\", global.get(\"fechaCompleta\") + \" - Desc\\n\");\n    node.send(msg);}\nif (msg.topic == \"ESP/Lavadero/Inicio\"){\n    global.set(\"estado-Lavadero\", global.get(\"fechaCompleta\") + \" - Con\\n\");\n    node.send(msg);}    ","outputs":1,"noerr":0,"x":1450,"y":490,"wires":[["387a7975.e5c536"]]},{"id":"6d640ef2.3b70d","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"ESP/Lavadero/Desconectado","qos":"2","broker":"e779f8d6.7bc2c8","x":1170,"y":460,"wires":[["b2475a76.cc8158"]]},{"id":"9ab72046.ee117","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"ESP/Lavadero/Inicio","qos":"2","broker":"e779f8d6.7bc2c8","x":1200,"y":490,"wires":[["b2475a76.cc8158"]]},{"id":"d4c54255.3ac71","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"ESP/living/Iluminacion/Desconectado","qos":"2","broker":"e779f8d6.7bc2c8","x":1140,"y":530,"wires":[["4a1eceb5.a87ce"]]},{"id":"8796c61b.a19b08","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"ESP/living/Iluminacion/Inicio","qos":"2","broker":"e779f8d6.7bc2c8","x":1170,"y":560,"wires":[["4a1eceb5.a87ce"]]},{"id":"4a1eceb5.a87ce","type":"function","z":"f682d492.22a758","name":"","func":"if (msg.topic == \"ESP/living/Iluminacion/Desconectado\"){\n    global.set(\"estado-IluminacionLiving\", global.get(\"fechaCompleta\") + \" - Desc\\n\");\n    node.send(msg);}\nif (msg.topic == \"ESP/living/Iluminacion/Inicio\"){\n    global.set(\"estado-IluminacionLiving\", global.get(\"fechaCompleta\") + \" - Con\\n\");\n    node.send(msg);}    ","outputs":1,"noerr":0,"x":1450,"y":530,"wires":[["387a7975.e5c536"]]},{"id":"1b97b22f.62662e","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"USBin","qos":"2","broker":"e779f8d6.7bc2c8","x":1080,"y":780,"wires":[["989fe79.e44ca18"]]},{"id":"9470b778.7a4b68","type":"blynk-ws-out-write","z":"f682d492.22a758","name":"","pin":"124","pinmode":0,"client":"2c18e412.5f5cbc","x":1810,"y":480,"wires":[]},{"id":"7ae88411.b62d9c","type":"blynk-ws-in-write","z":"f682d492.22a758","name":"","pin":"124","pin_all":0,"client":"2c18e412.5f5cbc","x":1110,"y":840,"wires":[["3fc11555.38190a"]]},{"id":"3fc11555.38190a","type":"mqtt out","z":"f682d492.22a758","name":"","topic":"USBout","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1330,"y":840,"wires":[]},{"id":"989fe79.e44ca18","type":"function","z":"f682d492.22a758","name":"","func":"var dato = JSON.parse(msg.payload);\n\nif (dato.topic === \"Alarma\"){\n     msg.payload = global.get(\"hsCpu\") + \" -- \" + msg.payload + \"\\n\";\n    return msg;\n}","outputs":1,"noerr":0,"x":1240,"y":780,"wires":[["1c551cc7.091bb3"]]},{"id":"47590b02.cb8864","type":"inject","z":"f682d492.22a758","name":"","topic":"","payload":"{\"topic\":\"Alarma\", \"payload\":1}","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1090,"y":700,"wires":[["989fe79.e44ca18"]]},{"id":"1c551cc7.091bb3","type":"debug","z":"f682d492.22a758","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1520,"y":830,"wires":[]},{"id":"133f14be.63808b","type":"blynk-ws-in-write","z":"f682d492.22a758","name":"","pin":"125","pin_all":0,"client":"2c18e412.5f5cbc","x":1110,"y":740,"wires":[["2b59fd8c.01da42"]]},{"id":"387a7975.e5c536","type":"function","z":"f682d492.22a758","name":"","func":"if (global.get(\"estado-TanqueAgua\") === undefined)global.set(\"estado-TanqueAgua\", null);\nif (global.get(\"estado-Lavadero\") === undefined)global.set(\"estado-Lavadero\", null);\nif (global.get(\"estado-IluminacionLiving\") === undefined)global.set(\"estado-IluminacionLiving\", null);\nif (global.get(\"estado-TermoSolar\") === undefined)global.set(\"estado-TermoSolar\", null);\nif (global.get(\"estado-Bano\") === undefined)global.set(\"estado-Bano\", null);\n// node.send(msg.payload);\nmsg.payload = \"\";\nfor (i = 0; i < 8; i++) {msg.payload += \" \\n\";}\nnode.send(msg);\n\nmsg =  \"Tanque: \" + global.get(\"estado-TanqueAgua\");// + \"\\n\";\nmsg += \"Lav.  : \" + global.get(\"estado-Lavadero\");// + \"\\n\"; + \"\\n\";\nmsg += \"Liv.  : \" + global.get(\"estado-IluminacionLiving\");// + \"\\n\"; + \"\\n\";\nmsg += \"Termo : \" + global.get(\"estado-TermoSolar\");// + \"\\n\"; + \"\\n\";\nmsg += \"Bano  : \" + global.get(\"estado-Bano\");// + \"\\n\"; + \"\\n\";\n\nmsg = {topic: \"\", pin: \"\", payload: msg};\nnode.send(msg);","outputs":1,"noerr":0,"x":1660,"y":480,"wires":[["9470b778.7a4b68","34813dd5.a39a72"]]},{"id":"2b59fd8c.01da42","type":"function","z":"f682d492.22a758","name":"","func":"if (msg.payload == 1)return msg;","outputs":1,"noerr":0,"x":1280,"y":740,"wires":[[]]},{"id":"1d2286a5.550659","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"ESP/TermoSolar/Desconectado","qos":"2","broker":"e779f8d6.7bc2c8","x":1160,"y":600,"wires":[["1b0fed82.69f252"]]},{"id":"f15e495c.458ba8","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"ESP/TermoSolar/Inicio","qos":"2","broker":"e779f8d6.7bc2c8","x":1190,"y":630,"wires":[["1b0fed82.69f252"]]},{"id":"1b0fed82.69f252","type":"function","z":"f682d492.22a758","name":"","func":"if (msg.topic == \"ESP/TermoSolar/Desconectado\"){\n    global.set(\"estado-TermoSolar\", global.get(\"fechaCompleta\") + \" - Desc\\n\");\n    node.send(msg);}\nif (msg.topic == \"ESP/TermoSolar/Inicio\"){\n    global.set(\"estado-TermoSolar\", global.get(\"fechaCompleta\") + \" - Con\\n\");\n    node.send(msg);}    ","outputs":1,"noerr":0,"x":1450,"y":570,"wires":[["387a7975.e5c536"]]},{"id":"a30cc8e9.415ca8","type":"blynk-ws-in-write","z":"f682d492.22a758","name":"","pin":"73","pin_all":0,"client":"2c18e412.5f5cbc","x":1490,"y":370,"wires":[["387a7975.e5c536"]]},{"id":"34813dd5.a39a72","type":"debug","z":"f682d492.22a758","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1780,"y":530,"wires":[]},{"id":"d0c20e34.caca6","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"{\"topic\":\"Cargador\",\"payload\":1,\"volt\":13.33,\"corriente\":13.27}","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":130,"wires":[["f1697d45.0cc3b"]]},{"id":"5b3a90d9.0cd8c","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"{\"topic\":\"Cargador\",\"payload\":0,\"volt\":13.33,\"corriente\":13.27}","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":160,"wires":[["f1697d45.0cc3b"]]},{"id":"f3dd6a94.c87b78","type":"inject","z":"a89e305a.c50bb","name":"","topic":"ESP/living/Iluminacion/Envio","payload":"1#0#0#","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":540,"y":100,"wires":[["cce091cd.a69e5"]]},{"id":"47bd4f5c.e3fe7","type":"inject","z":"a89e305a.c50bb","name":"","topic":"ESP/living/Iluminacion/Envio","payload":"1#1#0#","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":540,"y":140,"wires":[["cce091cd.a69e5"]]},{"id":"973951fb.c17aa","type":"inject","z":"a89e305a.c50bb","name":"","topic":"ESP/living/Iluminacion/Envio","payload":"0#0#0#","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":540,"y":180,"wires":[["cce091cd.a69e5"]]},{"id":"fdb236.1e712dc8","type":"link out","z":"a89e305a.c50bb","name":"iluminacionLiving","links":["a537abd8.9ad478","f8163bcc.da6ee8"],"x":735,"y":200,"wires":[]},{"id":"a537abd8.9ad478","type":"link in","z":"a89e305a.c50bb","name":"","links":["fdb236.1e712dc8"],"x":495,"y":520,"wires":[["53e453ec.adc19c"]]},{"id":"bc99daf.6939328","type":"ui_switch","z":"a89e305a.c50bb","name":"","label":"Living","group":"6a6e2505.7b8a5c","order":3,"width":0,"height":0,"passthru":false,"decouple":"false","topic":"Living","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":720,"y":470,"wires":[["ea8c8683.982cc8"]]},{"id":"ea8c8683.982cc8","type":"function","z":"a89e305a.c50bb","name":"","func":"if (msg.topic == \"Living\")msg = {pin: 14, payload: msg.payload};\n\nif (msg.topic == \"Isla\")msg = {pin: 16, payload: msg.payload};\nif (msg.topic == \"Cielorrazo\")msg = {pin: 17, payload: msg.payload};\nif (msg.topic == \"islaRGB\")msg = {pin: 29, payload: msg.payload};\n\nnode.send(msg);","outputs":1,"noerr":0,"x":900,"y":520,"wires":[["85c85d34.59457"]]},{"id":"4887a903.5ebc68","type":"ui_switch","z":"a89e305a.c50bb","name":"","label":"Isla","group":"6a6e2505.7b8a5c","order":4,"width":0,"height":0,"passthru":false,"decouple":"false","topic":"Isla","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":720,"y":510,"wires":[["ea8c8683.982cc8"]]},{"id":"71b56279.05115c","type":"ui_switch","z":"a89e305a.c50bb","name":"","label":"Cielorrazo","group":"6a6e2505.7b8a5c","order":5,"width":0,"height":0,"passthru":false,"decouple":"false","topic":"Cielorrazo","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":740,"y":550,"wires":[["ea8c8683.982cc8"]]},{"id":"513c6037.5a292","type":"ui_switch","z":"a89e305a.c50bb","name":"","label":"isla RGB","group":"6a6e2505.7b8a5c","order":6,"width":0,"height":0,"passthru":false,"decouple":"false","topic":"islaRGB","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":730,"y":590,"wires":[["ea8c8683.982cc8"]]},{"id":"53e453ec.adc19c","type":"function","z":"a89e305a.c50bb","name":"","func":"msg.payload = global.get(\"estLiving\"); node.send([msg, null]);\nmsg.payload = global.get(\"estIsla\"); node.send([null, msg]);\nmsg.payload = global.get(\"estCielorrazo\"); node.send([null, null, msg]);\nmsg.payload = global.get(\"estIslaRGB\"); node.send([null, null, null, msg]);","outputs":4,"noerr":0,"x":580,"y":520,"wires":[["bc99daf.6939328"],["4887a903.5ebc68"],["71b56279.05115c"],["513c6037.5a292"]]},{"id":"7d7b7582.83f5ac","type":"function","z":"a89e305a.c50bb","name":"recibo2","func":" var timerLuces = 12000;\nif (global.get(\"estLiving\") === undefined)global.set(\"estLiving\", 0);\nif (global.get(\"estIsla\") === undefined)global.set(\"estIsla\", 0);\nif (global.get(\"estCielorrazo\") === undefined)global.set(\"estCielorrazo\", 0);\nif (global.get(\"potLiving\") === undefined)global.set(\"potLiving\", 0);\nif (global.get(\"estIslaRGB\") === undefined)global.set(\"estIslaRGB\", 0);\nif (global.get(\"potIsla\") === undefined)global.set(\"potIsla\", 255);\nif (global.get(\"potCielorrazo\") === undefined)global.set(\"potCielorrazo\", 128);\nif (global.get(\"IslaR\") === undefined)global.set(\"IslaR\", 255);\nif (global.get(\"IslaG\") === undefined)global.set(\"IslaG\", 255);\nif (global.get(\"IslaB\") === undefined)global.set(\"IslaB\", 255);\n\nif (global.get(\"pwmMinLed\") === undefined)global.set(\"pwmMinLed\", 20);\nif (global.get(\"pwmMaxLed\") === undefined)global.set(\"pwmMaxLed\", 255);\n\nif (global.get(\"dimmerLeds\") === undefined)global.set(\"dimmerLeds\", 200);\nif (global.get(\"minTeclas\") === undefined)global.set(\"minTeclas\", 15);\nif (global.get(\"maxTeclas\") === undefined)global.set(\"maxTeclas\", 600);\nif (global.get(\"doblePuls\") === undefined)global.set(\"doblePuls\", 1);\nif (global.get(\"fallasLivingIluminacion\") === undefined)global.set(\"fallasLivingIluminacion\", 0);\nif (global.get(\"pwmPatioLuz\") === undefined)global.set(\"pwmPatioLuz\", 33);\ncontext.item = context.item || 0;\nvar pin = parseInt(msg.pin);\nvar topic = msg.topic;\nvar payload = parseInt(msg.payload);\nvar dato;\n\nif (topic == \"ESP/living/Iluminacion/Inicio\"){  \n    var fallasLivingIluminacion = global.get(\"fallasLivingIluminacion\") + 1;\n    global.set(\"fallasLivingIluminacion\", fallasLivingIluminacion);\n    global.set(\"tipoFallaIlLiving\", payload); msg = {topic: \"fallas_MQTT\", payload: 1}; node.send([msg, null]);\n    enviarMQTT();\n    return;\n}\n\nif (topic == \"aviso/Alarma\"){\n    if (global.get(\"estadoAlarma\") === 0 && global.get(\"Dia\") === 0){\n    msg = {topic: \"USBout\", payload: \"Noche\" + global.get(\"pwmPatioLuz\")}; node.send([msg, null]);\n    global.set(\"estLiving\", 1); \n    global.set(\"estIslaRGB\", 1);\n    enviarMQTT();\n    return;\n    }\n    if (global.get(\"estadoAlarma\") === 1 && global.get(\"estLiving\") === 1){setTimeout(apagadoLuces, timerLuces);}\n    if (global.get(\"estadoAlarma\") === 1 && global.get(\"Dia\") === 1){\n        // msg = {topic: \"USBout\", payload: \"Dia\"}; node.send([msg, null]);\n        apagadoLuces();}\n}\n\n\nif (topic == \"crepMQTT\"){\n    if (global.get(\"Dia\") === 1) {msg = {topic: \"USBout\", payload: \"Dia\"}; node.send([msg, null]);}\n    if (global.get(\"Dia\") === 0) {msg = {topic: \"USBout\", payload: \"Noche\" + global.get(\"pwmPatioLuz\")}; node.send([msg, null]);}\n    // enviarMQTT();\n}\n\n\nif (topic == \"google/Living\") {enviarMQTT(); return;}\n\nif (topic == \"ESP/living/Iluminacion/Envio\" && !topic.includes(\"Recibo de ESP\")){\n    dato = msg.payload.split(\"#\");\n    global.set(\"estIsla\", dato[0]); \n    global.set(\"estCielorrazo\", dato[1]); \n    global.set(\"estIslaRGB\", dato[2]); \n    enviarMQTT();\n    return;\n}\n\nswitch (pin){\n\n  case 8:\n    global.set(\"IslaR\", msg.arrayOfValues[0]);\n    global.set(\"IslaG\", msg.arrayOfValues[1]);\n    global.set(\"IslaB\", msg.arrayOfValues[2]);\n    msg = {pin: 32, payload: \"12\"}; node.send([null, msg]);\n    global.set(\"estIslaRGB\", 1);\n    enviarMQTT();\n  break;\n\n  case 14:\n    global.set(\"estLiving\", payload);  \n    global.set(\"estIslaRGB\", payload);\n    enviarMQTT();\n  break;\n\n  case 16:\n    global.set(\"estIsla\", payload);\n    enviarMQTT();\n  break;\n\n  case 17:\n    global.set(\"estCielorrazo\", payload); \n    enviarMQTT();\n  break;\n\n  case 29:\n    global.set(\"estIslaRGB\", payload); \n    enviarMQTT();\n  break;\n\n  case 18:\n    global.set(\"itemPotencia\", msg.payload);\n    if (parseInt(global.get(\"itemPotencia\")) > 0 && parseInt(global.get(\"itemPotencia\")) <= 4){\n      context.item = parseInt(msg.payload);\n      switch(parseInt(msg.payload)){\n          case 1:\n              msg = {pin: 19, min: 4, max: 255, label: \"Living\", payload: global.get(\"potLiving\")};\n          break;\n          case 2:\n              msg = {pin: 19, min: 4, max: 255, label: \"Isla\", payload: global.get(\"potIsla\")};\n          break;\n          case 3:\n              msg = {pin: 19, min: 4, max: 255, label: \"Cielorrazo\", payload: global.get(\"potCielorrazo\")};\n          break;\n          case 4:\n              msg = {pin: 19, min: 1, max: 100, label: \"Patio Luz\", payload: global.get(\"pwmPatioLuz\")};\n          break;\n      }\n      node.send([null, msg]);\n    }\n  break;\n\n  case 19:\n    if (parseInt(global.get(\"itemPotencia\")) > 0 && parseInt(global.get(\"itemPotencia\")) <= 4){\n      var valor = parseInt(msg.payload);\n      switch(context.item){\n          case 1:\n              if (global.get(\"estLiving\") === 0)return;\n              global.set(\"potLiving\", valor);\n              global.set(\"potIsla\", valor);\n              global.set(\"potCielorrazo\", valor);\n          break;\n          case 2:\n              if (global.get(\"estIsla\") === 0)return;\n              global.set(\"potIsla\", valor);\n          break;\n          case 3:\n              if (global.get(\"estCielorrazo\") === 0)return;\n              global.set(\"potCielorrazo\", valor);\n          break;\n          case 4:\n              if (global.get(\"Dia\") === 1)return;\n              global.set(\"pwmPatioLuz\", valor);\n              msg = {topic: \"USBout\", payload: \"Noche\" + global.get(\"pwmPatioLuz\")}; node.send([msg, null]); return;\n      }\n      enviarMQTT();\n    }\n  break;\n}\nreturn;\n\nfunction apagadoLuces(){\n    msg = {topic: \"USBout\", payload: \"Dia\"}; node.send([msg, null]);\n    global.set(\"estLiving\", \"0\");\n    global.set(\"estIslaRGB\", \"0\");\n    msg.topic = \"apagadoAuto\";\n    enviarMQTT();\n}\n\nfunction enviarMQTT(){\n    var topicNuevo = msg.topic;\n    //msg = {pin: 127, payload: global.get(\"hsCpu\") + \", top: \" + topicNuevo + \", D:\" + global.get(\"Dia\") + \", Al:\" + global.get(\"estadoAlarma\") + \"\\n\"}; node.send([null, msg]);\n    // if (global.get(\"estIsla\") === 0 && global.get(\"estCielorrazo\") === 0 && global.get(\"estIslaRGB\") === 0)global.set(\"estLiving\", 0);\n    if (global.get(\"estIsla\") === 1 || global.get(\"estCielorrazo\") === 1){\n        if(topic !== \"Blink/estLiving\" && topicNuevo !== \"fallas_MQTT\")\n          if (payload !== 0) global.set(\"estLiving\", 1);\n        }\n    if (topicNuevo == \"apagadoAuto\") {\n        global.set(\"estLiving\", 0); \n        msg = {pin: 127, payload: \"Apagado auto\\n\"}; node.send([null, msg]);\n    }\n\n    if (topicNuevo !== \"fallas_MQTT\"){\n    msg = {pin: 14, payload: global.get(\"estLiving\")}; node.send([null, msg]);\n    msg = {pin: 16, payload: global.get(\"estIsla\")}; node.send([null, msg]);\n    msg = {pin: 17, payload: global.get(\"estCielorrazo\")}; node.send([null, msg]);\n    msg = {pin: 29, payload: global.get(\"estIslaRGB\")}; node.send([null, msg]);}\n    if(topic == \"ESP/living/Iluminacion/Envio\")return;\n    \n    if (parseInt(global.get(\"estLiving\")) === 0) {\n            msg = {pin: 16, payload: \"0\"}; node.send([null, msg]);\n            dato = \"0,\"}\n        else{\n            dato = global.get(\"estIsla\") + \",\";}\n    dato += global.get(\"potIsla\") + \"#\";\n\n    if (parseInt(global.get(\"estLiving\")) === 0) {\n            msg = {pin: 17, payload: \"0\"}; node.send([null, msg]);\n            dato += \"0,\"}\n        else{\n            dato += global.get(\"estCielorrazo\") + \",\";}\n    dato += global.get(\"potCielorrazo\") + \"#\";  \n    dato += global.get(\"estIslaRGB\") + \",\";\n    dato += global.get(\"IslaR\") + \",\";\n    dato += global.get(\"IslaG\") + \",\";      \n    dato += global.get(\"IslaB\") + \"#\";\n\n  dato += global.get(\"pwmMaxLed\") + \"#\";\n  dato += global.get(\"pwmMinLed\") + \"#\";\n    // dato += global.get(\"dimmerLeds\") + \"#\";\n\n    dato += global.get(\"minTeclas\") + \"#\";\n    dato += global.get(\"maxTeclas\") + \"#\";\n    dato += global.get(\"doblePuls\");\n    dato += \"#\" + global.get(\"Dia\");\n    if (topicNuevo == \"crepMQTT\")dato += \"#\";\n\n//  msg = {topic: \"ESP/living/Iluminacion/Recibo2\", payload: topicNuevo + \"&\" + global.get(\"estadoAlarma\") + \"&\" + global.get(\"Dia\") + \"\\n\" + dato};    node.send([msg, null]);\n    msg = {topic: \"ESP/living/Iluminacion/Recibo\", payload: dato};\n    node.send([msg, null]);     \n}","outputs":2,"noerr":0,"x":610,"y":360,"wires":[[],[]]},{"id":"85c85d34.59457","type":"link out","z":"a89e305a.c50bb","name":"salidaLiving","links":["f9714068.a5e16"],"x":1000,"y":520,"wires":[]},{"id":"f9714068.a5e16","type":"link in","z":"a89e305a.c50bb","name":"","links":["85c85d34.59457"],"x":470,"y":330,"wires":[["cce091cd.a69e5"]]},{"id":"39ca2758.7802f8","type":"ui_switch","z":"73083520.75304c","name":"","label":"llenar Tanque","group":"1c362bad.cfd2e4","order":5,"width":0,"height":0,"passthru":false,"decouple":"false","topic":"llenarTanque","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":1360,"y":130,"wires":[["64391eaf.0b1a8"]]},{"id":"91ce983b.2144e8","type":"ui_switch","z":"73083520.75304c","name":"","label":"bomba Centrifuga","group":"1c362bad.cfd2e4","order":3,"width":0,"height":0,"passthru":false,"decouple":"false","topic":"bombaPozo","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":1380,"y":170,"wires":[["64391eaf.0b1a8"]]},{"id":"7fc82b24.319e64","type":"ui_switch","z":"73083520.75304c","name":"","label":"bomba Pileta","group":"1c362bad.cfd2e4","order":4,"width":0,"height":0,"passthru":false,"decouple":"false","topic":"bombaPileta","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":1370,"y":220,"wires":[["64391eaf.0b1a8"]]},{"id":"2561d784.bd9058","type":"inject","z":"1b403a13.0ec8c6","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1430,"y":350,"wires":[["d3b1c5ac.e47218"]]},{"id":"d3b1c5ac.e47218","type":"function","z":"1b403a13.0ec8c6","name":"","func":"global.set(\"offsetDia\", 1000);\nglobal.set(\"offsetNoche\", 1000);","outputs":1,"noerr":0,"x":1650,"y":350,"wires":[[]]},{"id":"11e7b4f4.d88f1b","type":"inject","z":"73083520.75304c","name":"","topic":"","payload":"pedidoTemp","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":560,"y":160,"wires":[["dbb96939.ba4ab8"]]},{"id":"dbb96939.ba4ab8","type":"mqtt out","z":"73083520.75304c","name":"","topic":"ESP/Lavadero/Recibo","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":760,"y":160,"wires":[]},{"id":"3979d676.c0ecea","type":"inject","z":"73083520.75304c","name":"","topic":"","payload":"debug1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":540,"y":80,"wires":[["dbb96939.ba4ab8"]]},{"id":"54f26a7a.0992e4","type":"inject","z":"73083520.75304c","name":"","topic":"","payload":"debug0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":540,"y":120,"wires":[["dbb96939.ba4ab8"]]},{"id":"434968c9.53e158","type":"debug","z":"73083520.75304c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":580,"y":390,"wires":[]},{"id":"f0d33edf.cfe5e","type":"mqtt in","z":"73083520.75304c","name":"","topic":"ESP/Lavadero/Debug","qos":"2","broker":"e779f8d6.7bc2c8","x":580,"y":40,"wires":[["4a1081d2.02a7d"]]},{"id":"4a1081d2.02a7d","type":"debug","z":"73083520.75304c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":780,"y":40,"wires":[]},{"id":"2e997313.90675c","type":"debug","z":"73083520.75304c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":610,"y":290,"wires":[]},{"id":"647b05d7.91e4fc","type":"mqtt in","z":"73083520.75304c","name":"","topic":"ESP/Lavadero/Envio","qos":"2","broker":"c339edbf.39572","x":1270,"y":350,"wires":[[]]},{"id":"779c0e4e.57811","type":"function","z":"73083520.75304c","name":"","func":"msg = {topic: \"terminalBlynk\", payload: msg.payload + \"\\n\"};\nreturn msg;","outputs":1,"noerr":0,"x":1480,"y":350,"wires":[["e20d2376.95e8","dd73385a.218a28"]]},{"id":"e20d2376.95e8","type":"mqtt out","z":"73083520.75304c","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1600,"y":360,"wires":[]},{"id":"dd73385a.218a28","type":"debug","z":"73083520.75304c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1610,"y":410,"wires":[]},{"id":"9aff25c6.b51638","type":"inject","z":"73083520.75304c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1270,"y":400,"wires":[["779c0e4e.57811"]]},{"id":"8741a2e0.507c4","type":"mqtt in","z":"73083520.75304c","name":"","topic":"ESP/TanqueAgua/Envio","qos":"2","broker":"e779f8d6.7bc2c8","x":1270,"y":300,"wires":[["31d544e1.b9e88c"]]},{"id":"cc4d8f19.fee14","type":"mqtt in","z":"50119c6e.6ff584","name":"","topic":"ESP/Lavadero/Temperatura","qos":"2","broker":"c339edbf.39572","x":210,"y":270,"wires":[["348adaea.07eaa6"]]},{"id":"a1fc7942.b0f048","type":"mqtt in","z":"73083520.75304c","name":"","topic":"ESP/TanqueAgua/Debug","qos":"2","broker":"e779f8d6.7bc2c8","x":1280,"y":440,"wires":[["779c0e4e.57811"]]},{"id":"fc022c43.683b9","type":"mqtt out","z":"73083520.75304c","name":"","topic":"ESP/TanqueAgua/Recibo","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1540,"y":550,"wires":[]},{"id":"6b68e360.3ced7c","type":"inject","z":"73083520.75304c","name":"","topic":"","payload":"debug0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1290,"y":510,"wires":[["fc022c43.683b9"]]},{"id":"7b980043.10a88","type":"inject","z":"73083520.75304c","name":"","topic":"","payload":"debug1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1290,"y":550,"wires":[["fc022c43.683b9"]]},{"id":"eef212c0.eb9df","type":"inject","z":"73083520.75304c","name":"","topic":"","payload":"nivel","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1290,"y":590,"wires":[["fc022c43.683b9"]]},{"id":"31d544e1.b9e88c","type":"debug","z":"73083520.75304c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1490,"y":300,"wires":[]},{"id":"9dc4feb8.d4bc","type":"blynk-ws-in-write","z":"950c1426.ff4008","name":"","pin":"39","pin_all":0,"client":"2c18e412.5f5cbc","x":150,"y":380,"wires":[["21fe85fc.fb499a"]]},{"id":"959915ed.89c138","type":"blynk-ws-in-write","z":"950c1426.ff4008","name":"","pin":"40","pin_all":0,"client":"2c18e412.5f5cbc","x":150,"y":420,"wires":[["21fe85fc.fb499a","6c7592c5.13c6cc"]]},{"id":"21fe85fc.fb499a","type":"function","z":"950c1426.ff4008","name":"","func":"var pin = parseInt(msg.pin);\nvar intPayload = parseInt(msg.payload);\nvar topic = msg.topic;\nvar topicInicial = msg.topic;\nvar dato;\nvar timerLuces = 12000;  \ncontext.parcheDejarApagarLuz = context.parcheDejarApagarLuz || 0;\nvar date = new Date();\n\nif (global.get(\"pedLuzBano\") === undefined)global.set(\"pedLuzBano\", 0);\nif (global.get(\"modoDucha\") === undefined)global.set(\"modoDucha\", 0);\nif (global.get(\"pedDucha\") === undefined)global.set(\"pedDucha\", 0);\nif (global.get(\"pwmDucha\") === undefined)global.set(\"pwmDucha\", 512);\nif (global.get(\"pedLuzEspejo\") === undefined)global.set(\"pedLuzEspejo\", 0);\nif (global.get(\"pedExtractorBano\") === undefined)global.set(\"pedExtractorBano\", 0);\n\n\nif (topic == \"aviso/Alarma\" && global.get(\"estadoAlarma\") === 1){\n  global.set(\"luzBano\", 0);\n  global.set(\"pedDucha\", 0);\n  global.set(\"pedLuzEspejo\", 0);\n  global.set(\"pedExtractorBano\", 0);  \n  enviarBlynk();\n  enviarMQTT();\n}\n\nif (topic == \"google/Alarma\" || topic == \"aviso/Alarma\"){\n  if (global.get(\"luzBano\") === 1 && global.get(\"estadoAlarma\") === 1)apagadoLuces();\n  context.parcheDejarApagarLuz = date.getTime();\n  return;\n}\n\nif (topic == \"ESP/Bano/Desconectado\") global.set(\"estadoEspTanque\", 0);\n\nif (topic == \"ESP/Pasillo/Iluminacion/Envio\") {\n  global.set(\"luzPasillo\", parseInt(msg.payload.substring(4)));\n  msg = {pin: 44, payload: global.get(\"luzPasillo\")}; node.send([null, msg]);  \n  }\n\nif (topic == \"google/Baño\"){\n  enviarBlynk();\n  enviarMQTT();\n}\n\nif (topic == \"ESP/Bano/Inicio\"){  \n    var fallasBano = global.get(\"fallasBano\") + 1;\n    global.set(\"fallasBano\", fallasBano);\n    global.set(\"fallasBano\", msg.payload);// msg = {topic: \"fallas_MQTT\", payload: 1}; node.send([msg, null]);\n    enviarMQTT();\n    return;\n}\n\nif (topic == \"ESP/Bano/Envio\"){\n  dato = msg.payload.split(\"#\");\n  global.set(\"luzBano\", parseInt(dato[0]));\n  global.set(\"pedLuzEspejo\", parseInt(dato[1]));\n  global.set(\"modoDucha\", parseInt(dato[2]));\n  global.set(\"pedDucha\", parseInt(dato[3]));\n  global.set(\"pedExtractorBano\", parseInt(dato[4]));  \n  enviarBlynk();\n  return;\n}\n// if (global.get(\"luzBano\") === 0 && context.parcheDejarApagarLuz === 1)context.parcheDejarApagarLuz = 0;\n\nswitch (pin){\n  case 39:  \n    global.set(\"modoDucha\", intPayload);\n    // enviarBlynk();\n    enviarMQTT();\n  break;\n  case 40:\n    global.set(\"modoDucha\", 0);\n    global.set(\"pedDucha\", intPayload);\n    // enviarBlynk();\n    enviarMQTT();\n  break;\n  case 41:\n    global.set(\"luzBano\", intPayload);\n    context.parcheDejarApagarLuz = date.getTime();\n    // enviarBlynk();\n    enviarMQTT();  \n  break;\n  case 42:\n    global.set(\"pedLuzEspejo\", intPayload);\n    // context.parcheDejarApagarLuz = date.getTime();\n    // enviarBlynk();\n    enviarMQTT();  \n  break;\n  case 43:\n    global.set(\"pedExtractorBano\", intPayload);\n    // context.parcheDejarApagarLuz = date.getTime();\n    // enviarBlynk();\n    enviarMQTT();  \n  break;\n  case 44:\n    global.set(\"luzPasillo\", intPayload);\n    // context.parcheDejarApagarLuz = date.getTime();\n    // enviarBlynk();\n    msg = {topic: \"ESP/Pasillo/Iluminacion/Recibo\", payload: global.get(\"luzPasillo\")}; node.send([msg, null]);\n  break;    \n}\n\nfunction apagadoLuces(){\n  global.set(\"luzBano\", 0);\n  global.set(\"pedDucha\", 0);\n  global.set(\"pedLuzEspejo\", 0);\n  global.set(\"pedExtractorBano\", 0); \n  enviarBlynk();\n  enviarDatos();\n}\n\nnode.status({text: context.parcheDejarApagarLuz});\n\nfunction enviarBlynk(){\n  msg = {pin: 39, payload: global.get(\"modoDucha\")}; node.send([null, msg]);\n  msg = {pin: 40, payload: global.get(\"pedDucha\")}; node.send([null, msg]);\n  msg = {pin: 41, payload: global.get(\"luzBano\")}; node.send([null, msg]);\n  msg = {pin: 42, payload: global.get(\"pedLuzEspejo\")}; node.send([null, msg]);\n  msg = {pin: 43, payload: global.get(\"pedExtractorBano\")}; node.send([null, msg]);\n}\n\nfunction enviarMQTT(){\n  var dato = global.get(\"luzBano\") + \"#\" + global.get(\"modoDucha\") + \"#\" + global.get(\"pedDucha\") + \"#\" + global.get(\"pwmDucha\");\n  dato += \"#\" + global.get(\"pedLuzEspejo\") + \"#\" + global.get(\"pedExtractorBano\") + \"#\" + global.get(\"Dia\");\n  if (topicInicial == \"ESP/Bano/Inicio\") dato +=\"#\";\n\n  msg = {topic: \"ESP/Bano/Recibo\", payload: dato}; node.send([msg, null]);\n}","outputs":2,"noerr":0,"x":380,"y":220,"wires":[["1afb1498.d4b63b","e6e16af4.05e248","8a400dfa.c0378"],["13552477.e9fb6c","61d3bca9.eec934","8a400dfa.c0378"]]},{"id":"1afb1498.d4b63b","type":"mqtt out","z":"950c1426.ff4008","name":"","topic":"","qos":"2","retain":"","broker":"e779f8d6.7bc2c8","x":550,"y":170,"wires":[]},{"id":"e6e16af4.05e248","type":"debug","z":"950c1426.ff4008","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":590,"y":130,"wires":[]},{"id":"61d3bca9.eec934","type":"blynk-ws-out-set-property","z":"950c1426.ff4008","name":"","pin":0,"pinmode":"1","prop":"bycode","client":"2c18e412.5f5cbc","x":710,"y":210,"wires":[]},{"id":"b40549f1.99a358","type":"blynk-ws-out-write","z":"950c1426.ff4008","name":"","pin":0,"pinmode":"1","client":"2c18e412.5f5cbc","x":730,"y":250,"wires":[]},{"id":"13552477.e9fb6c","type":"delay","z":"950c1426.ff4008","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":540,"y":250,"wires":[["b40549f1.99a358"]]},{"id":"b14ac2dc.f05ff","type":"mqtt in","z":"950c1426.ff4008","name":"","topic":"ESP/Bano/Desconectado","qos":"2","broker":"e779f8d6.7bc2c8","x":140,"y":240,"wires":[["21fe85fc.fb499a"]]},{"id":"8ca18d11.41d98","type":"mqtt in","z":"950c1426.ff4008","name":"","topic":"ESP/Bano/Inicio","qos":"2","broker":"e779f8d6.7bc2c8","x":170,"y":200,"wires":[["21fe85fc.fb499a","fbae0544.193e68"]]},{"id":"8a436730.e6d858","type":"mqtt in","z":"950c1426.ff4008","name":"","topic":"ESP/Bano/Envio","qos":"2","broker":"e779f8d6.7bc2c8","x":170,"y":160,"wires":[["21fe85fc.fb499a","fbae0544.193e68"]]},{"id":"dfef781f.0b8918","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"ESP/Bano/Desconectado","qos":"2","broker":"e779f8d6.7bc2c8","x":1180,"y":310,"wires":[["213cb2d4.76334e","afc9d0d4.35546","82fadd8a.79f0a"]]},{"id":"97a3dd0f.07c0a","type":"mqtt in","z":"f682d492.22a758","name":"","topic":"ESP/Bano/Inicio","qos":"2","broker":"e779f8d6.7bc2c8","x":1210,"y":350,"wires":[["213cb2d4.76334e","2bab1d49.0e0492"]]},{"id":"213cb2d4.76334e","type":"function","z":"f682d492.22a758","name":"","func":" context.tiempo = context.tiempo || 0;\n var dato1 = 0;\n var date = new Date();\n\nif (msg.topic == \"ESP/Bano/Desconectado\"){\n    var ponele = parseFloat((date.getTime() - context.tiempo) / 1000).toFixed(2);\n    global.set(\"tiempoAndando\", ponele);\n    global.set(\"estado-Bano\", global.get(\"fechaCompleta\") + \" - Desc\\n\");\n    node.send(msg);}\nif (msg.topic == \"ESP/Bano/Inicio\"){\n    context.tiempo = date.getTime();\n    global.set(\"estado-Bano\", global.get(\"fechaCompleta\") + \" - Con\\n\");\n    node.send(msg);}    \n\n\n\n// if (msg.topic == \"ESP/Bano/Desconectado\"){\n//     global.set(\"estado-Bano\", global.get(\"fechaCompleta\") + \" - Desc\\n\");\n//     node.send(msg);}\n// if (msg.topic == \"ESP/Bano/Inicio\"){\n//     global.set(\"estado-Bano\", global.get(\"fechaCompleta\") + \" - Con\\n\");\n//     node.send(msg);}    ","outputs":1,"noerr":0,"x":1450,"y":410,"wires":[["387a7975.e5c536","d4f57647.6e2bf8"]]},{"id":"14408124.16056f","type":"blynk-ws-in-write","z":"950c1426.ff4008","name":"","pin":"41","pin_all":0,"client":"2c18e412.5f5cbc","x":150,"y":460,"wires":[["21fe85fc.fb499a"]]},{"id":"b8ac1054.18c5f","type":"inject","z":"950c1426.ff4008","name":"","topic":"","payload":"debug1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":370,"y":280,"wires":[["97973f18.d52c7"]]},{"id":"97973f18.d52c7","type":"mqtt out","z":"950c1426.ff4008","name":"","topic":"ESP/Bano/Recibo","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":570,"y":300,"wires":[]},{"id":"299b6c3b.52f714","type":"inject","z":"950c1426.ff4008","name":"","topic":"","payload":"debug0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":370,"y":320,"wires":[["97973f18.d52c7"]]},{"id":"f8163bcc.da6ee8","type":"link in","z":"950c1426.ff4008","name":"","links":["8a400dfa.c0378","fdb236.1e712dc8"],"x":105,"y":660,"wires":[["9f7904b0.c15b18"]]},{"id":"5bfb52b6.74c93c","type":"ui_switch","z":"950c1426.ff4008","name":"","label":"Luz Baño","group":"1a0f799.46f9186","order":1,"width":0,"height":0,"passthru":false,"decouple":"false","topic":"Bano","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":550,"y":550,"wires":[["8abb737.db91d9"]]},{"id":"8abb737.db91d9","type":"function","z":"950c1426.ff4008","name":"","func":"if (msg.topic == \"modoDucha\")msg = {pin: 39, payload: msg.payload};\nif (msg.topic == \"estadoDucha\")msg = {pin: 40, payload: msg.payload};\nif (msg.topic == \"Bano\")msg = {pin: 41, payload: msg.payload};\nif (msg.topic == \"LuzEspejo\")msg = {pin: 42, payload: msg.payload};\nif (msg.topic == \"Extractor\")msg = {pin: 43, payload: msg.payload};\nif (msg.topic == \"LuzPasillo\")msg = {pin: 44, payload: msg.payload};\n\nnode.send(msg);","outputs":1,"noerr":0,"x":720,"y":650,"wires":[["a4db5227.1e511","154a556c.2d88bb"]]},{"id":"f36dd0d.db4663","type":"ui_switch","z":"950c1426.ff4008","name":"","label":"Modo Ducha","group":"1a0f799.46f9186","order":3,"width":0,"height":0,"passthru":false,"decouple":"false","topic":"modoDucha","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":550,"y":590,"wires":[["8abb737.db91d9"]]},{"id":"1aa9d188.88b25e","type":"ui_switch","z":"950c1426.ff4008","name":"","label":"estado Ducha","group":"1a0f799.46f9186","order":4,"width":0,"height":0,"passthru":false,"decouple":"false","topic":"estadoDucha","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":550,"y":630,"wires":[["8abb737.db91d9"]]},{"id":"62514329.617cec","type":"function","z":"950c1426.ff4008","name":"","func":"msg.payload = global.get(\"luzBano\"); node.send([msg, null, null, null, null, null]);\nmsg.payload = global.get(\"modoDucha\"); node.send([null, msg, null, null, null, null]);\nmsg.payload = global.get(\"pedDucha\"); node.send([null, null, msg, null, null, null]);\nmsg.payload = global.get(\"pedLuzEspejo\"); node.send([null, null, null, msg, null, null]);\nmsg.payload = global.get(\"pedExtractorBano\"); node.send([null, null, null, null, msg, null]);\nmsg.payload = global.get(\"luzPasillo\"); node.send([null, null, null, null, null, msg]);\nnode.status({text: global.get(\"estDucha\")});","outputs":6,"noerr":0,"x":370,"y":660,"wires":[["5bfb52b6.74c93c"],["f36dd0d.db4663"],["1aa9d188.88b25e"],["e2145151.d6d1b"],["7da6f.7adde5918"],["6bff4d14.6d6ef4"]]},{"id":"a4db5227.1e511","type":"link out","z":"950c1426.ff4008","name":"salidaLiving","links":["e18bcac9.69bed8"],"x":820,"y":650,"wires":[]},{"id":"8a400dfa.c0378","type":"link out","z":"950c1426.ff4008","name":"inluminacionBano","links":["f8163bcc.da6ee8"],"x":475,"y":120,"wires":[]},{"id":"e18bcac9.69bed8","type":"link in","z":"950c1426.ff4008","name":"salidaBano","links":["a4db5227.1e511"],"x":235,"y":620,"wires":[["21fe85fc.fb499a"]]},{"id":"9f7904b0.c15b18","type":"delay","z":"950c1426.ff4008","name":"","pauseType":"delay","timeout":"20","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":220,"y":660,"wires":[["62514329.617cec","b1593fd3.794ae"]]},{"id":"154a556c.2d88bb","type":"debug","z":"950c1426.ff4008","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":790,"y":710,"wires":[]},{"id":"786ec675.10bd18","type":"mqtt in","z":"950c1426.ff4008","name":"","topic":"ESP/Bano/Recibo","qos":"2","broker":"e779f8d6.7bc2c8","x":560,"y":370,"wires":[["b278a25a.6e31"]]},{"id":"b278a25a.6e31","type":"debug","z":"950c1426.ff4008","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":740,"y":360,"wires":[]},{"id":"4edcf0ed.7797c","type":"mqtt in","z":"950c1426.ff4008","name":"","topic":"google/Baño","qos":"2","broker":"e779f8d6.7bc2c8","x":180,"y":120,"wires":[["21fe85fc.fb499a"]]},{"id":"cfaa0bbb.3ae258","type":"inject","z":"950c1426.ff4008","name":"","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":760,"wires":[["c56122e5.f22f1"]]},{"id":"f6b601c3.3c579","type":"inject","z":"950c1426.ff4008","name":"","topic":"","payload":"0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":800,"wires":[["c56122e5.f22f1"]]},{"id":"c56122e5.f22f1","type":"function","z":"950c1426.ff4008","name":"","func":"global.set(\"Dia\", parseInt(msg.payload));\nmsg.payload = global.get(\"Dia\"); return msg","outputs":1,"noerr":0,"x":320,"y":790,"wires":[["b1593fd3.794ae"]]},{"id":"b1593fd3.794ae","type":"debug","z":"950c1426.ff4008","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":490,"y":800,"wires":[]},{"id":"fbae0544.193e68","type":"debug","z":"950c1426.ff4008","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":400,"y":150,"wires":[]},{"id":"36feaa61.dccd16","type":"delay","z":"73083520.75304c","name":"","pauseType":"delay","timeout":"20","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1060,"y":130,"wires":[["7ee40e1e.072f6"]]},{"id":"debed86f.a7fc18","type":"ui_switch","z":"3ce5b54a.127d6a","name":"","label":"Alarma","group":"1134b585.4c9e0a","order":2,"width":0,"height":0,"passthru":false,"decouple":"false","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":1720,"y":1070,"wires":[["216d8ecd.aa0852"]]},{"id":"216d8ecd.aa0852","type":"function","z":"3ce5b54a.127d6a","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":1860,"y":1070,"wires":[["9efd2f5c.5b17b"]]},{"id":"9efd2f5c.5b17b","type":"link out","z":"3ce5b54a.127d6a","name":"Alarma","links":["4c0c4b93.d12344"],"x":1965,"y":1070,"wires":[]},{"id":"4c0c4b93.d12344","type":"link in","z":"3ce5b54a.127d6a","name":"","links":["9efd2f5c.5b17b"],"x":1335,"y":960,"wires":[["893a6b3c.fdb088"]]},{"id":"d457b681.39d968","type":"link out","z":"3ce5b54a.127d6a","name":"salidaAlarma","links":["7335ae41.f8a17"],"x":1965,"y":970,"wires":[]},{"id":"7335ae41.f8a17","type":"link in","z":"3ce5b54a.127d6a","name":"","links":["d457b681.39d968"],"x":1315,"y":1070,"wires":[["fa166fd2.de2cf"]]},{"id":"fa166fd2.de2cf","type":"delay","z":"3ce5b54a.127d6a","name":"","pauseType":"delay","timeout":"020","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1420,"y":1070,"wires":[["a8339862.1303c8"]]},{"id":"a8339862.1303c8","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg = {topic: \"\", payload: global.get(\"estadoAlarma\")}; \nreturn msg;","outputs":1,"noerr":0,"x":1570,"y":1070,"wires":[["debed86f.a7fc18"]]},{"id":"66c227c3.fa9bf8","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1390,"y":1120,"wires":[["fa166fd2.de2cf"]]},{"id":"50675f22.97474","type":"ui_text","z":"3ce5b54a.127d6a","group":"1134b585.4c9e0a","order":1,"width":0,"height":0,"name":"","label":"","format":"{{msg.payload}}","layout":"row-center","x":790,"y":320,"wires":[]},{"id":"aa79903b.a6a72","type":"function","z":"3ce5b54a.127d6a","name":"","func":"msg.payload = global.get(\"fechaCompleta\");\nreturn msg;","outputs":1,"noerr":0,"x":660,"y":320,"wires":[["50675f22.97474"]]},{"id":"2ecde4d0.0750bc","type":"delay","z":"3ce5b54a.127d6a","name":"","pauseType":"delay","timeout":"100","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":510,"y":320,"wires":[["aa79903b.a6a72"]]},{"id":"3bb6b87.d0d8b48","type":"function","z":"9c63fd61.9908c","name":"","func":"var pin = parseInt(msg.pin);\nif (pin === 30)global.set(\"minTeclas\", msg.payload);\n\nif (pin === 31)global.set(\"maxTeclas\", msg.payload);\n\nif (msg.topic == \"delBuzzer\")global.set(\"delayBuzzer\", msg.payload);\n\nmsg.payload = global.get(\"minTeclas\") + \"#\";\nmsg.payload += global.get(\"maxTeclas\") + \"#\";\nmsg.payload += global.get(\"delayBuzzer\");\n\nnode.status({text: \"configTeclas: \" + msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":120,"wires":[["46a7dfd7.34709"]]},{"id":"350ff34.cf16b0c","type":"blynk-ws-in-write","z":"9c63fd61.9908c","name":"","pin":"31","pin_all":false,"client":"2c18e412.5f5cbc","x":250,"y":120,"wires":[["3bb6b87.d0d8b48"]]},{"id":"7e3910a8.bab1a","type":"inject","z":"9c63fd61.9908c","name":"delay Buzzador","topic":"delBuzzer","payload":"100","payloadType":"num","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":270,"y":160,"wires":[["3bb6b87.d0d8b48"]]},{"id":"eff0247d.d66af8","type":"blynk-ws-in-write","z":"9c63fd61.9908c","name":"","pin":"30","pin_all":false,"client":"2c18e412.5f5cbc","x":250,"y":80,"wires":[["3bb6b87.d0d8b48","6522f511.31e19c"]]},{"id":"fe2294b1.3506f8","type":"blynk-ws-in-write","z":"9c63fd61.9908c","name":"","pin":"18","pin_all":0,"client":"2c18e412.5f5cbc","x":255.55555725097656,"y":298.8888874053955,"wires":[["686c13df.8c585c"]]},{"id":"686c13df.8c585c","type":"function","z":"9c63fd61.9908c","name":"","func":"var pin = parseInt(msg.pin);\nvar intPayload = parseInt(msg.payload);\nvar topic = msg.topic;\nvar dato;\n\nswitch (pin){\n  case 18:\n    global.set(\"itemPotencia\", msg.payload);\n    // if (parseInt(global.get(\"itemPotencia\")) > 0 && parseInt(global.get(\"itemPotencia\")) <= 5){\n      context.item = parseInt(msg.payload);\n      switch(parseInt(msg.payload)){\n          case 1:\n              msg = {pin: 19, min: 4, max: 255, label: \"Living\", payload: global.get(\"potLiving\")};\n          break;\n          case 2:\n              msg = {pin: 19, min: 4, max: 255, label: \"Isla\", payload: global.get(\"potIsla\")};\n          break;\n          case 3:\n              msg = {pin: 19, min: 4, max: 255, label: \"Cielorrazo\", payload: global.get(\"potCielorrazo\")};\n          break;\n          case 4:\n              msg = {pin: 19, min: 1, max: 100, label: \"Patio Luz\", payload: global.get(\"pwmPatioLuz\")};\n          break;\n          case 5:\n              msg = {pin: 19, min: 10, max: 1023, label: \"Ducha de bano\", payload: global.get(\"pwmDucha\")};\n          break;          \n          case 5:\n              msg = {pin: 19, min: 15, max: 240, label: \"timer extractor baño\", payload: global.get(\"timerExtractorBano\")};\n          break;            \n      }\n      node.send([null, msg]);\n      return;\n    // }\n  break;\n\n  case 19:\n    // if (parseInt(global.get(\"itemPotencia\")) > 0 && parseInt(global.get(\"itemPotencia\")) <= 5){\n      var valor = parseInt(msg.payload);\n      switch(context.item){\n          case 1:\n              if (global.get(\"estLiving\") === 0)return;\n              global.set(\"potLiving\", valor);\n              global.set(\"potIsla\", valor);\n              global.set(\"potCielorrazo\", valor);\n              enviarMQTT(\"living\");\n          break;\n          case 2:\n              if (global.get(\"estIsla\") === 0)return;\n              global.set(\"potIsla\", valor);\n              enviarMQTT(\"living\");\n          break;\n          case 3:\n              if (global.get(\"estCielorrazo\") === 0)return;\n              global.set(\"potCielorrazo\", valor);\n              enviarMQTT(\"living\");\n          break;\n          case 4:\n              if (global.get(\"Dia\") === 1)return;\n              global.set(\"pwmPatioLuz\", valor);\n              enviarMQTT(\"patioLuz\");\n              return;\n          case 5:\n              global.set(\"pwmDucha\", valor);\n              enviarMQTT(\"bano\");\n              return;\n          case 6:\n              global.set(\"timerExtractorBano\", valor);\n              enviarMQTT(\"bano\");\n              return;\n            }            \n          // }\n          break;\n}\n\nfunction enviarMQTT(caso){\n  if (caso == \"bano\"){\n    dato = global.get(\"luzBano\") + \"#\" + global.get(\"modoDucha\") + \"#\" + global.get(\"pedDucha\") + \"#\" + global.get(\"pwmDucha\");\n    dato += \"#\" + global.get(\"pedLuzEspejo\") + \"#\" + global.get(\"pedExtractorBano\") + \"#\" + global.get(\"timerExtractorBano\") + \"#\" + global.get(\"Dia\");\n    msg = {topic: \"ESP/Bano/Recibo\", payload: dato}; node.send([msg, null]);\n  }\n\n  if (caso == \"patioLuz\"){\n    msg = {topic: \"USBout\", payload: \"Noche\" + global.get(\"pwmPatioLuz\")}; \n    node.send([msg, null]);\n  }\n\n  if (caso == \"living\"){\n    dato = global.get(\"estIsla\") + \",\";\n    dato += global.get(\"potIsla\") + \"#\";\n    dato += global.get(\"estCielorrazo\") + \",\";\n    dato += global.get(\"potCielorrazo\") + \"#\";  \n    dato += global.get(\"estIslaRGB\") + \",\";\n    dato += global.get(\"IslaR\") + \",\";\n    dato += global.get(\"IslaG\") + \",\";      \n    dato += global.get(\"IslaB\") + \"#\";\n\n    dato += global.get(\"pwmMaxLed\") + \"#\";\n    dato += global.get(\"pwmMinLed\") + \"#\";\n\n    dato += global.get(\"minTeclas\") + \"#\";\n    dato += global.get(\"maxTeclas\") + \"#\";\n    dato += global.get(\"doblePuls\");\n    dato += \"#\" + global.get(\"Dia\");\n\n    msg = {topic: \"ESP/living/Iluminacion/Recibo\", payload: dato};\n    node.send([msg, null]);\n  }\n}","outputs":2,"noerr":0,"x":485.55555725097656,"y":318.8888874053955,"wires":[["492e8783.590a18","5298c805.c6e8b8"],["b3699b30.344658","aaeb2663.a0d538","fa6e31fd.d268"]]},{"id":"f52e98fb.ab8a18","type":"blynk-ws-in-write","z":"9c63fd61.9908c","name":"","pin":"19","pin_all":0,"client":"2c18e412.5f5cbc","x":255.55555725097656,"y":338.8888874053955,"wires":[["686c13df.8c585c"]]},{"id":"492e8783.590a18","type":"mqtt out","z":"9c63fd61.9908c","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":655.5555572509766,"y":288.8888874053955,"wires":[]},{"id":"5298c805.c6e8b8","type":"debug","z":"9c63fd61.9908c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":675.5555572509766,"y":248.8888874053955,"wires":[]},{"id":"b3699b30.344658","type":"blynk-ws-out-set-property","z":"9c63fd61.9908c","name":"","pin":0,"pinmode":"1","prop":"bycode","client":"2c18e412.5f5cbc","x":825.5555572509766,"y":318.8888874053955,"wires":[]},{"id":"aaeb2663.a0d538","type":"delay","z":"9c63fd61.9908c","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":625.5555572509766,"y":358.8888874053955,"wires":[["58b89a0e.df28f4"]]},{"id":"fa6e31fd.d268","type":"debug","z":"9c63fd61.9908c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":625.5555572509766,"y":398.8888874053955,"wires":[]},{"id":"58b89a0e.df28f4","type":"blynk-ws-out-write","z":"9c63fd61.9908c","name":"","pin":0,"pinmode":"1","client":"2c18e412.5f5cbc","x":795.5555572509766,"y":358.8888874053955,"wires":[]},{"id":"5eb6d95c.00a888","type":"inject","z":"9c63fd61.9908c","name":"Prueba Buzzador","topic":"","payload":"120","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":157.77777862548828,"y":391.11108350753784,"wires":[["3c31e1e9.e0df0e"]]},{"id":"3c31e1e9.e0df0e","type":"mqtt out","z":"9c63fd61.9908c","name":"","topic":"ESP/living/Iluminacion/beep","qos":"","retain":"","broker":"6b36e4a.1d30b1c","x":380,"y":390,"wires":[]},{"id":"16b7cc7a.cf05a4","type":"inject","z":"9c63fd61.9908c","name":"Prueba Buzzador","topic":"","payload":"120","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":440,"wires":[["5fa83d0c.a915c4"]]},{"id":"5fa83d0c.a915c4","type":"mqtt out","z":"9c63fd61.9908c","name":"","topic":"ESP/Lavadero/beep","qos":"","retain":"","broker":"6b36e4a.1d30b1c","x":360,"y":440,"wires":[]},{"id":"3ff308a0.2fcbb8","type":"mqtt in","z":"950c1426.ff4008","name":"","topic":"google/Alarma","qos":"2","broker":"6b36e4a.1d30b1c","x":180,"y":40,"wires":[["21fe85fc.fb499a","e68e8c9f.cc55a"]]},{"id":"68b10cf1.87ba04","type":"mqtt in","z":"950c1426.ff4008","name":"","topic":"aviso/Alarma","qos":"2","broker":"6b36e4a.1d30b1c","x":180,"y":80,"wires":[["21fe85fc.fb499a","f56822cf.d92e8"]]},{"id":"e68e8c9f.cc55a","type":"debug","z":"950c1426.ff4008","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":440,"y":30,"wires":[]},{"id":"f56822cf.d92e8","type":"debug","z":"950c1426.ff4008","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":440,"y":70,"wires":[]},{"id":"299f3d20.503ac2","type":"inject","z":"9c63fd61.9908c","name":"","topic":"","payload":"10","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":210,"wires":[["8a43e102.5f8ac"]]},{"id":"8a43e102.5f8ac","type":"function","z":"9c63fd61.9908c","name":"pwmMinLed","func":"global.set(\"pwmMinLed\", parseInt(msg.payload));\nnode.status({text: global.get(\"pwmMinLed\")})\n","outputs":1,"noerr":0,"x":310,"y":210,"wires":[[]]},{"id":"22b9fb6d.2a6e14","type":"inject","z":"9c63fd61.9908c","name":"","topic":"","payload":"200","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":470,"y":210,"wires":[["49935aed.9c64f4"]]},{"id":"49935aed.9c64f4","type":"function","z":"9c63fd61.9908c","name":"pwmMaxLed","func":"global.set(\"pwmMaxLed\", parseInt(msg.payload));\nnode.status({text: global.get(\"pwmMaxLed\")})","outputs":1,"noerr":0,"x":610,"y":210,"wires":[[]]},{"id":"690bb97b.d73e48","type":"debug","z":"3ce5b54a.127d6a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":480,"y":160,"wires":[]},{"id":"2bab1d49.0e0492","type":"debug","z":"f682d492.22a758","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1480,"y":320,"wires":[]},{"id":"afc9d0d4.35546","type":"debug","z":"f682d492.22a758","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1480,"y":280,"wires":[]},{"id":"56c14218.0b2ebc","type":"function","z":"f682d492.22a758","name":"","func":"msg.payload = \"{\\\"topic\\\":\\\"offSetCorriente\\\",\\\"payload\\\":\" + global.get(\"offSetCorriente\") + \"}\";\nnode.send(msg);","outputs":1,"noerr":0,"x":390,"y":280,"wires":[["8173a1db.4e78"]]},{"id":"8173a1db.4e78","type":"delay","z":"f682d492.22a758","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":560,"y":280,"wires":[["eef57e3.f227e8"]]},{"id":"bb019069.aba2f","type":"serial in","z":"3ce5b54a.127d6a","name":"","serial":"b86d561e.834378","x":240,"y":510,"wires":[["9641fbd0.64c858","15b1f27c.6d37ee"]]},{"id":"15c00bc2.e4ea64","type":"serial out","z":"3ce5b54a.127d6a","name":"","serial":"b86d561e.834378","x":570,"y":690,"wires":[]},{"id":"b337a214.d371b","type":"mqtt in","z":"950c1426.ff4008","name":"","topic":"ESP/Bano/Inicio","qos":"2","broker":"e779f8d6.7bc2c8","x":1000,"y":260,"wires":[["516497ef.4db8f8"]]},{"id":"4967b7f9.0a6ef8","type":"blynk-ws-out-write","z":"950c1426.ff4008","name":"","pin":"127","pinmode":0,"client":"2c18e412.5f5cbc","x":1380,"y":120,"wires":[]},{"id":"97ec3303.e9eed","type":"function","z":"950c1426.ff4008","name":"","func":"msg.payload = msg.payload + \"\\n\";\nreturn msg;","outputs":1,"noerr":0,"x":1190,"y":130,"wires":[["4967b7f9.0a6ef8"]]},{"id":"9e35998b.99f3d8","type":"debug","z":"3ce5b54a.127d6a","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":470,"y":1010,"wires":[]},{"id":"9f832296.c0f4e","type":"inject","z":"f682d492.22a758","name":"","topic":"ESP/Bano/Inicio","payload":"Conectado 0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1480,"y":630,"wires":[["1f6396ab.3e44d9"]]},{"id":"bcf69268.5cdff","type":"inject","z":"f682d492.22a758","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1680,"y":280,"wires":[["2398e4c4.50b4bc"]]},{"id":"2398e4c4.50b4bc","type":"function","z":"f682d492.22a758","name":"","func":"node.status({text: global.get(\"estadoEspTanque\")})\nreturn msg;","outputs":1,"noerr":0,"x":1800,"y":330,"wires":[[]]},{"id":"dc11ce21.b781d","type":"mqtt in","z":"1b403a13.0ec8c6","name":"","topic":"ESP/Lavadero/Presurizadora","qos":"2","broker":"e779f8d6.7bc2c8","x":1720,"y":200,"wires":[["d94fdda5.0d4ad","d4fb51d8.bafcf"]]},{"id":"d94fdda5.0d4ad","type":"function","z":"1b403a13.0ec8c6","name":"","func":"if (msg.payload === \"0\") msg.payload = global.get(\"fechaCompleta\") + \" - Sin Rociar\\n\";\nif (msg.payload === \"1\") msg.payload = global.get(\"fechaCompleta\") + \" - Rociando\\n\";\nreturn msg;","outputs":1,"noerr":0,"x":1910,"y":200,"wires":[["d56383e8.2d3d3"]]},{"id":"d56383e8.2d3d3","type":"mqtt out","z":"1b403a13.0ec8c6","name":"","topic":"terminalBlynk","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":2070,"y":200,"wires":[]},{"id":"d4fb51d8.bafcf","type":"debug","z":"1b403a13.0ec8c6","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1930,"y":240,"wires":[]},{"id":"217f85d1.ebb7fa","type":"mqtt in","z":"950c1426.ff4008","name":"","topic":"ESP/Bano/Debug","qos":"2","broker":"e779f8d6.7bc2c8","x":1010,"y":200,"wires":[["36d380d3.795d4","97ec3303.e9eed"]]},{"id":"36d380d3.795d4","type":"debug","z":"950c1426.ff4008","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1240,"y":200,"wires":[]},{"id":"516497ef.4db8f8","type":"debug","z":"950c1426.ff4008","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1180,"y":260,"wires":[]},{"id":"e61fd473.789698","type":"inject","z":"950c1426.ff4008","name":"","topic":"","payload":"debug1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1100,"y":330,"wires":[["2468cff7.5986c"]]},{"id":"2468cff7.5986c","type":"mqtt out","z":"950c1426.ff4008","name":"","topic":"ESP/Bano/Recibo","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1270,"y":350,"wires":[]},{"id":"efaf625b.c0827","type":"inject","z":"950c1426.ff4008","name":"","topic":"","payload":"debug0","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1100,"y":370,"wires":[["2468cff7.5986c"]]},{"id":"127b49be.578736","type":"inject","z":"950c1426.ff4008","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1060,"y":420,"wires":[["7b7bad84.d50cd4"]]},{"id":"7b7bad84.d50cd4","type":"mqtt out","z":"950c1426.ff4008","name":"","topic":"ESP/Bano/beep","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1250,"y":420,"wires":[]},{"id":"4406089a.a1b598","type":"mqtt out","z":"950c1426.ff4008","name":"","topic":"ESP/Bano/delBuzz","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1260,"y":490,"wires":[]},{"id":"61266c1e.3b7eb4","type":"inject","z":"950c1426.ff4008","name":"","topic":"","payload":"80","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1060,"y":490,"wires":[["4406089a.a1b598"]]},{"id":"e245dd75.b2381","type":"inject","z":"73083520.75304c","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1250,"y":630,"wires":[["b426d73e.4aa108"]]},{"id":"b426d73e.4aa108","type":"function","z":"73083520.75304c","name":"","func":"node.status({text: global.get(\"estadoEspTanque\")})","outputs":1,"noerr":0,"x":1420,"y":640,"wires":[[]]},{"id":"46ba0676.8c03b8","type":"blynk-ws-in-write","z":"1b403a13.0ec8c6","name":"","pin":"98","pin_all":0,"client":"2c18e412.5f5cbc","x":1920,"y":310,"wires":[["640d6047.f80cb"]]},{"id":"640d6047.f80cb","type":"mqtt out","z":"1b403a13.0ec8c6","name":"","topic":"ESP/Lavadero/Presurizadora","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":2190,"y":310,"wires":[]},{"id":"24d7f863.61d028","type":"ui_switch","z":"230e7f04.aca52","name":"","label":"D0","group":"ff2252ef.d12aa","order":0,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"0","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":210,"y":70,"wires":[["411b27cf.122ad8"]]},{"id":"b72e08a8.825f08","type":"ui_switch","z":"230e7f04.aca52","name":"","label":"D1","group":"ff2252ef.d12aa","order":0,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"1","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":210,"y":110,"wires":[["411b27cf.122ad8"]]},{"id":"cc6a27e0.7872a8","type":"ui_switch","z":"230e7f04.aca52","name":"","label":"D2","group":"ff2252ef.d12aa","order":0,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"2","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":210,"y":150,"wires":[["411b27cf.122ad8"]]},{"id":"7de9350c.2c638c","type":"ui_switch","z":"230e7f04.aca52","name":"","label":"D3","group":"ff2252ef.d12aa","order":0,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"3","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":210,"y":190,"wires":[["411b27cf.122ad8"]]},{"id":"c0c34e09.35861","type":"ui_switch","z":"230e7f04.aca52","name":"","label":"D5","group":"ff2252ef.d12aa","order":0,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"5","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":210,"y":270,"wires":[["411b27cf.122ad8"]]},{"id":"f9c62d54.7f094","type":"ui_switch","z":"230e7f04.aca52","name":"","label":"D6","group":"ff2252ef.d12aa","order":0,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"6","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":210,"y":310,"wires":[["411b27cf.122ad8"]]},{"id":"93568155.14a6e","type":"ui_switch","z":"230e7f04.aca52","name":"","label":"D7","group":"ff2252ef.d12aa","order":0,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"7","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":210,"y":350,"wires":[["411b27cf.122ad8"]]},{"id":"97f851d.49cc7b","type":"ui_switch","z":"230e7f04.aca52","name":"","label":"D8","group":"ff2252ef.d12aa","order":0,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"8","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":210,"y":390,"wires":[["411b27cf.122ad8"]]},{"id":"411b27cf.122ad8","type":"function","z":"230e7f04.aca52","name":"","func":"msg = {topic: \"ESP/Bano/Recibo\", payload: \"D\" + parseInt(msg.topic) + msg.payload};\nreturn msg\n","outputs":1,"noerr":0,"x":410,"y":220,"wires":[["20706a8e.08ded6"]]},{"id":"20706a8e.08ded6","type":"mqtt out","z":"230e7f04.aca52","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":570,"y":220,"wires":[]},{"id":"737f249a.6f982c","type":"mqtt in","z":"230e7f04.aca52","name":"","topic":"ESP/Bano/Debug","qos":"2","broker":"e779f8d6.7bc2c8","x":410,"y":300,"wires":[["f1992d54.9e6b6"]]},{"id":"f1992d54.9e6b6","type":"ui_text","z":"230e7f04.aca52","group":"ff2252ef.d12aa","order":0,"width":0,"height":0,"name":"","label":"Debug","format":"{{msg.payload}}","layout":"row-center","x":580,"y":300,"wires":[]},{"id":"e9e852e6.2ee3f","type":"mqtt in","z":"230e7f04.aca52","name":"","topic":"ESP/Bano/Inicio","qos":"2","broker":"e779f8d6.7bc2c8","x":430,"y":380,"wires":[["f1992d54.9e6b6"]]},{"id":"d45c90b5.820a2","type":"debug","z":"230e7f04.aca52","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":670,"y":30,"wires":[]},{"id":"718a8d11.6f6294","type":"mqtt in","z":"230e7f04.aca52","name":"","topic":"ESP/Bano/Recibo","qos":"2","broker":"e779f8d6.7bc2c8","x":480,"y":40,"wires":[["d45c90b5.820a2"]]},{"id":"dcf8322b.95d13","type":"ui_switch","z":"230e7f04.aca52","name":"","label":"D4","group":"ff2252ef.d12aa","order":0,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"4","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":210,"y":230,"wires":[["411b27cf.122ad8"]]},{"id":"3ca76747.edf4b8","type":"ui_gauge","z":"3ce5b54a.127d6a","name":"","group":"1134b585.4c9e0a","order":6,"width":"2","height":"2","gtype":"gage","title":"temp. Termo","label":"Ampers","format":"{{value}}","min":"20","max":"105","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":2800,"y":340,"wires":[]},{"id":"7b3ddd25.47d964","type":"inject","z":"3ce5b54a.127d6a","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":2380,"y":280,"wires":[["a912aad4.45fd28"]]},{"id":"bab5d990.3ba508","type":"blynk-ws-in-write","z":"950c1426.ff4008","name":"","pin":"42","pin_all":0,"client":"2c18e412.5f5cbc","x":150,"y":500,"wires":[["21fe85fc.fb499a"]]},{"id":"e07ba001.6d5ac","type":"blynk-ws-in-write","z":"950c1426.ff4008","name":"","pin":"43","pin_all":0,"client":"2c18e412.5f5cbc","x":150,"y":540,"wires":[["21fe85fc.fb499a"]]},{"id":"217a52f8.4691ee","type":"blynk-ws-in-write","z":"950c1426.ff4008","name":"","pin":"44","pin_all":0,"client":"2c18e412.5f5cbc","x":150,"y":580,"wires":[["21fe85fc.fb499a"]]},{"id":"9942f82e.4ecff8","type":"mqtt in","z":"950c1426.ff4008","name":"","topic":"ESP/Pasillo/Iluminacion","qos":"2","broker":"e779f8d6.7bc2c8","x":150,"y":340,"wires":[["21fe85fc.fb499a"]]},{"id":"e2145151.d6d1b","type":"ui_switch","z":"950c1426.ff4008","name":"","label":"Luz Espejo","group":"1a0f799.46f9186","order":2,"width":0,"height":0,"passthru":false,"decouple":"false","topic":"LuzEspejo","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":550,"y":670,"wires":[["8abb737.db91d9"]]},{"id":"7da6f.7adde5918","type":"ui_switch","z":"950c1426.ff4008","name":"","label":"Extractor","group":"1a0f799.46f9186","order":5,"width":0,"height":0,"passthru":false,"decouple":"false","topic":"Extractor","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":550,"y":710,"wires":[["8abb737.db91d9"]]},{"id":"6bff4d14.6d6ef4","type":"ui_switch","z":"950c1426.ff4008","name":"","label":"Luz Pasillo","group":"1a0f799.46f9186","order":6,"width":0,"height":0,"passthru":false,"decouple":"false","topic":"LuzPasillo","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":550,"y":750,"wires":[["8abb737.db91d9"]]},{"id":"a81eb6e6.5ee268","type":"mqtt in","z":"950c1426.ff4008","name":"","topic":"ESP/Bano/Inicio","qos":"2","broker":"e779f8d6.7bc2c8","x":470,"y":440,"wires":[["c0b061a0.851b"]]},{"id":"e40f3917.988718","type":"mqtt in","z":"950c1426.ff4008","name":"","topic":"ESP/Bano/Desconectado","qos":"2","broker":"e779f8d6.7bc2c8","x":440,"y":480,"wires":[["c0b061a0.851b"]]},{"id":"c0b061a0.851b","type":"function","z":"950c1426.ff4008","name":"","func":"if (msg.topic == \"ESP/Bano/Inicio\"){\n    node.status({text: global.get(\"hsCpu\") + \" Conectado\"});\n    msg.payload = global.get(\"hsCpu\") + \" Conectado\"}\nif (msg.topic == \"ESP/Bano/Desconectado\"){\n    node.status({text: global.get(\"hsCpu\") + \" Desconectado\"});\n    msg.payload = global.get(\"hsCpu\") + \" Desconectado\"}\n    return msg\n    ","outputs":1,"noerr":0,"x":660,"y":460,"wires":[["21c4edfc.7b88a2","3ec40cfc.5fb284"]]},{"id":"21c4edfc.7b88a2","type":"ui_toast","z":"950c1426.ff4008","position":"top right","displayTime":"3","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"","name":"","x":820,"y":460,"wires":[]},{"id":"25411469.c051dc","type":"inject","z":"9c63fd61.9908c","name":"","topic":"","payload":"120#1041#200","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":270,"y":530,"wires":[["d72acde0.fec76"]]},{"id":"d72acde0.fec76","type":"mqtt out","z":"9c63fd61.9908c","name":"","topic":"configTeclas","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":470,"y":570,"wires":[]},{"id":"1c422390.63f36c","type":"inject","z":"9c63fd61.9908c","name":"","topic":"","payload":"10#141#50","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":250,"y":610,"wires":[["d72acde0.fec76"]]},{"id":"46a7dfd7.34709","type":"mqtt out","z":"9c63fd61.9908c","name":"","topic":"configTeclas","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":730,"y":120,"wires":[]},{"id":"86ee33eb.a6baf","type":"inject","z":"f682d492.22a758","name":"","topic":"ESP/Bano/Desconectado","payload":"Desconectado","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1430,"y":670,"wires":[["1f6396ab.3e44d9"]]},{"id":"1f6396ab.3e44d9","type":"mqtt out","z":"f682d492.22a758","name":"","topic":"","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1780,"y":670,"wires":[]},{"id":"47498032.6378d","type":"mqtt in","z":"9c63fd61.9908c","name":"","topic":"ESP/Bano/Inicio","qos":"2","broker":"e779f8d6.7bc2c8","x":1050,"y":100,"wires":[["88bbc72d.835818"]]},{"id":"5199a80f.981d68","type":"mqtt in","z":"9c63fd61.9908c","name":"","topic":"ESP/living/Iluminacion/Inicio","qos":"2","broker":"e779f8d6.7bc2c8","x":1010,"y":140,"wires":[["88bbc72d.835818"]]},{"id":"1c2cb8f0.537f27","type":"mqtt in","z":"9c63fd61.9908c","name":"","topic":"ESP/Lavadero/Inicio","qos":"2","broker":"e779f8d6.7bc2c8","x":1040,"y":180,"wires":[["88bbc72d.835818"]]},{"id":"88bbc72d.835818","type":"link out","z":"9c63fd61.9908c","name":"configTeclas","links":["75cc688a.19a5e8"],"x":1195,"y":140,"wires":[]},{"id":"75cc688a.19a5e8","type":"link in","z":"9c63fd61.9908c","name":"","links":["88bbc72d.835818"],"x":175,"y":50,"wires":[["9df58cbe.a562"]]},{"id":"3ec40cfc.5fb284","type":"debug","z":"950c1426.ff4008","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":820,"y":500,"wires":[]},{"id":"d4f57647.6e2bf8","type":"function","z":"f682d492.22a758","name":"","func":"msg.payload = \"Bano: \" + global.get(\"estado-Bano\") + \" -\" + global.get(\"tiempoAndando\") + \"\\n\";\nreturn msg;","outputs":1,"noerr":0,"x":1680,"y":410,"wires":[["56559479.18063c","ee996d7e.8320b"]]},{"id":"56559479.18063c","type":"mqtt out","z":"f682d492.22a758","name":"","topic":"terminalBlynk","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":1850,"y":380,"wires":[]},{"id":"9df58cbe.a562","type":"delay","z":"9c63fd61.9908c","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":290,"y":50,"wires":[["3bb6b87.d0d8b48"]]},{"id":"ee996d7e.8320b","type":"ui_toast","z":"f682d492.22a758","position":"top right","displayTime":"10","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"","name":"","x":1860,"y":430,"wires":[]},{"id":"db97eea5.4c10e","type":"debug","z":"f682d492.22a758","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2170,"y":320,"wires":[]},{"id":"e45d1c4e.21511","type":"function","z":"f682d492.22a758","name":"","func":"msg = {topic: \"reinBano\", payload: global.get(\"tiempoAndando\")}; \nreturn msg;","outputs":1,"noerr":0,"x":2020,"y":270,"wires":[["be608732.51d9a8","db97eea5.4c10e"]]},{"id":"be608732.51d9a8","type":"thingspeak42","z":"f682d492.22a758","name":"reinicions","delay":"2","topic1":"reinBano","topic2":"","topic3":"","topic4":"","topic5":"","topic6":"","topic7":"","topic8":"","endpoint":"https://thingspeak.com","x":2170,"y":270,"wires":[]},{"id":"82fadd8a.79f0a","type":"delay","z":"f682d492.22a758","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1900,"y":270,"wires":[["e45d1c4e.21511"]]},{"id":"e5846161.9d601","type":"mqtt in","z":"9c63fd61.9908c","name":"","topic":"configTeclas","qos":"2","broker":"e779f8d6.7bc2c8","x":570,"y":80,"wires":[["6522f511.31e19c"]]},{"id":"6522f511.31e19c","type":"debug","z":"9c63fd61.9908c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":750,"y":80,"wires":[]},{"id":"ff3a865.d567b78","type":"mqtt in","z":"950c1426.ff4008","name":"","topic":"ESP/Bano/Debug","qos":"2","broker":"e779f8d6.7bc2c8","x":640,"y":40,"wires":[["9036622a.c2358"]]},{"id":"9036622a.c2358","type":"debug","z":"950c1426.ff4008","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":800,"y":50,"wires":[]},{"id":"6c7592c5.13c6cc","type":"debug","z":"950c1426.ff4008","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":400,"y":350,"wires":[]},{"id":"de2df085.f384a","type":"mqtt in","z":"950c1426.ff4008","name":"","topic":"ESP/Pasillo/Iluminacion/Envio","qos":"2","broker":"e779f8d6.7bc2c8","x":130,"y":280,"wires":[["fc8b9e0a.1621b","21fe85fc.fb499a"]]},{"id":"fc8b9e0a.1621b","type":"debug","z":"950c1426.ff4008","name":"pasillo baño","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":360,"y":280,"wires":[]},{"id":"ea9cce87.20502","type":"file","z":"d1d22de5.be7d8","name":"","filename":"/home/gaston/BackUp-Node-Red/estLavadero.txt","appendNewline":true,"createDir":false,"overwriteFile":"false","x":600,"y":90,"wires":[[]]},{"id":"1483f01e.8d63","type":"function","z":"d1d22de5.be7d8","name":"","func":"\nmsg.payload =  global.get(\"fechaCompleta\") + \" - Lavadero: \" + msg.payload;// + \"\\n\";\nreturn msg\n","outputs":1,"noerr":0,"x":310,"y":120,"wires":[["492e29db.f9fc38","ea9cce87.20502"]]},{"id":"b00c1e9c.76b1f","type":"mqtt in","z":"d1d22de5.be7d8","name":"","topic":"ESP/Lavadero/Envio","qos":"2","broker":"c339edbf.39572","x":120,"y":120,"wires":[["1483f01e.8d63","122e1d60.4124b3"]]},{"id":"492e29db.f9fc38","type":"mqtt out","z":"d1d22de5.be7d8","name":"","topic":"terminalBlynk","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":530,"y":120,"wires":[]},{"id":"196675c1.6f158a","type":"debug","z":"d1d22de5.be7d8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":730,"y":180,"wires":[]},{"id":"bf431fde.5794a","type":"inject","z":"d1d22de5.be7d8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":180,"wires":[["41ec47d0.511188"]]},{"id":"41ec47d0.511188","type":"file in","z":"d1d22de5.be7d8","name":"","filename":"/home/gaston/BackUp-Node-Red/estLavadero.txt","format":"utf8","chunk":false,"sendError":false,"x":430,"y":180,"wires":[["196675c1.6f158a"]]},{"id":"610d6f3f.e3836","type":"file","z":"d1d22de5.be7d8","name":"borrar archivo","filename":"/home/gaston/BackUp-Node-Red/estLavadero.txt","appendNewline":true,"createDir":false,"overwriteFile":"delete","x":400,"y":230,"wires":[[]]},{"id":"dc8a85f8.faf038","type":"inject","z":"d1d22de5.be7d8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":230,"wires":[["610d6f3f.e3836"]]},{"id":"122e1d60.4124b3","type":"debug","z":"d1d22de5.be7d8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":500,"y":50,"wires":[]},{"id":"cb90140a.9e47d8","type":"file","z":"d1d22de5.be7d8","name":"","filename":"/home/gaston/BackUp-Node-Red/estLiving.txt","appendNewline":true,"createDir":false,"overwriteFile":"false","x":590,"y":340,"wires":[[]]},{"id":"13758b96.8466c4","type":"function","z":"d1d22de5.be7d8","name":"","func":"\nmsg.payload =  global.get(\"fechaCompleta\") + \" - Living: \" + msg.payload;// + \"\\n\";\nreturn msg;\n","outputs":1,"noerr":0,"x":310,"y":370,"wires":[["b76c75c2.9de438","cb90140a.9e47d8"]]},{"id":"45337d3c.67ea24","type":"mqtt in","z":"d1d22de5.be7d8","name":"","topic":"ESP/living/Iluminacion/Envio","qos":"2","broker":"c339edbf.39572","x":130,"y":320,"wires":[["13758b96.8466c4","7ac97a85.742ad4"]]},{"id":"b76c75c2.9de438","type":"mqtt out","z":"d1d22de5.be7d8","name":"","topic":"terminalBlynk","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":530,"y":370,"wires":[]},{"id":"66df6729.994e38","type":"debug","z":"d1d22de5.be7d8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":730,"y":430,"wires":[]},{"id":"9b11a295.aa9fd","type":"inject","z":"d1d22de5.be7d8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":430,"wires":[["e7bd5e35.000d3"]]},{"id":"e7bd5e35.000d3","type":"file in","z":"d1d22de5.be7d8","name":"","filename":"/home/gaston/BackUp-Node-Red/estLiving.txt","format":"utf8","chunk":false,"sendError":false,"x":420,"y":430,"wires":[["66df6729.994e38"]]},{"id":"c6ed2774.bcde48","type":"file","z":"d1d22de5.be7d8","name":"borrar archivo","filename":"/home/gaston/BackUp-Node-Red/estLiving.txt","appendNewline":true,"createDir":false,"overwriteFile":"delete","x":400,"y":480,"wires":[[]]},{"id":"fe533bbe.085188","type":"inject","z":"d1d22de5.be7d8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":480,"wires":[["c6ed2774.bcde48"]]},{"id":"7ac97a85.742ad4","type":"debug","z":"d1d22de5.be7d8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":500,"y":300,"wires":[]},{"id":"ac7d9682.bb0ba8","type":"file","z":"d1d22de5.be7d8","name":"","filename":"/home/gaston/BackUp-Node-Red/estBano.txt","appendNewline":true,"createDir":false,"overwriteFile":"false","x":580,"y":600,"wires":[[]]},{"id":"595822c5.ec973c","type":"function","z":"d1d22de5.be7d8","name":"","func":"\nmsg.payload =  global.get(\"fechaCompleta\") + \" - Bano: \" + msg.payload;// + \"\\n\";\nreturn msg\n","outputs":1,"noerr":0,"x":310,"y":630,"wires":[["445380bb.6e7b8","ac7d9682.bb0ba8"]]},{"id":"4052c96b.adbc88","type":"mqtt in","z":"d1d22de5.be7d8","name":"","topic":"ESP/Bano/Envio","qos":"2","broker":"c339edbf.39572","x":110,"y":630,"wires":[["595822c5.ec973c","15c93530.10482b"]]},{"id":"445380bb.6e7b8","type":"mqtt out","z":"d1d22de5.be7d8","name":"","topic":"terminalBlynk","qos":"","retain":"","broker":"e779f8d6.7bc2c8","x":530,"y":630,"wires":[]},{"id":"5f72f005.6a6a9","type":"debug","z":"d1d22de5.be7d8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":730,"y":690,"wires":[]},{"id":"a4b54da4.e4c23","type":"inject","z":"d1d22de5.be7d8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":690,"wires":[["c665267b.7f66f8"]]},{"id":"c665267b.7f66f8","type":"file in","z":"d1d22de5.be7d8","name":"","filename":"/home/gaston/BackUp-Node-Red/estBano.txt","format":"utf8","chunk":false,"sendError":false,"x":400,"y":690,"wires":[["5f72f005.6a6a9"]]},{"id":"62918201.211f7c","type":"file","z":"d1d22de5.be7d8","name":"borrar archivo","filename":"/home/gaston/BackUp-Node-Red/estBano.txt","appendNewline":true,"createDir":false,"overwriteFile":"delete","x":400,"y":740,"wires":[[]]},{"id":"e0cbfe88.9d452","type":"inject","z":"d1d22de5.be7d8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":740,"wires":[["62918201.211f7c"]]},{"id":"15c93530.10482b","type":"debug","z":"d1d22de5.be7d8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":500,"y":560,"wires":[]}]